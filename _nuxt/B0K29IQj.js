const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./btJo1MBV.js","./AxE_3BVK.js","./DlAUqK2U.js","./BzQ49_ll.js","./entry.C2el_uhD.css","./nuxt-icon.Cvbtxq7p.css","./BaajXRc8.js"])))=>i.map(i=>d[i]);
import{d as E,r as V,e as F,o as u,n as h,p as t,j as _,w as f,g as c,I as K,x as o,v as m,F as U,D as J,h as P,_ as z,y as Q,f as j,J as _e,K as Y,L as Z,l as N,M as ue,m as le,u as q,N as me,q as X,a as pe,b as ve,O as fe,H as ee,t as M,s as G,G as be,P as ge,Q as te}from"./BzQ49_ll.js";import{_ as W}from"./EAeUkgBq.js";import{_ as ie}from"./Dzhj1Yli.js";import{_ as we}from"./Cu6O6ZFl.js";import{_ as oe}from"./W1n9aEx_.js";import{c as ye}from"./ZnSD-95i.js";import{_ as he}from"./DVIdC8Zn.js";import{m as ae,_ as $e}from"./BS0ye4fm.js";import{_ as ke}from"./B3dZcLnw.js";import{_ as Ce}from"./DReJ8vQK.js";import{f as O}from"./BFIP-xo3.js";import{_ as De}from"./FRd4tTmK.js";import{_ as Ie}from"./z8RK9n7K.js";import{_ as xe,m as ne}from"./Dy7JMDz2.js";import{_ as Ae}from"./DQ9jL8Ly.js";import{s as L}from"./DhcCwqhx.js";import{c as Be}from"./B4FMxlHh.js";import{n as Pe}from"./BxBPJGBn.js";import"./DD4asW33.js";import"./nNENDGj9.js";import"./3OUiC8Lt.js";import"./Dz0q-Wbl.js";const je={class:"clan-events"},Se={class:"clan-events__inner"},Re={class:"clan-events__count"},Me={class:"clan-events__prop"},Fe={key:0,class:"clan-events__prop"},Ee={class:"clan-events__prop-title"},Oe={key:1,class:"clan-events__prop"},qe={class:"clan-events__prop-title"},Te={key:2},Ue={style:{display:"flex","justify-content":"space-between"}},Le=E({__name:"ClanEvents",props:{savedAt:{type:Number,default:0,required:!0},clan:{type:Object,default:()=>({}),required:!0},savedClan:{type:Object,default:()=>({}),required:!0}},emits:["reset"],setup(n,{emit:v}){const p=n,e=V(null),w=F(()=>{const l=p.clan.members_ids??[],g=p.savedClan.members??[];return Object.values(g).filter($=>!l.includes($.account_id))}),y=F(()=>{var $,C;const l=(($=p.clan)==null?void 0:$.members)??[],g=((C=p.savedClan)==null?void 0:C.members_ids)??[];return Object.values(l).filter(A=>!g.includes(A.account_id))}),D=F(()=>y.value.length+w.value.length),I=v;function b(){var l;I("reset"),(l=e.value)==null||l.doClose()}function s(){var l;(l=e.value)==null||l.doOpen()}function a(){var l;(l=e.value)==null||l.doClose()}return(l,g)=>{const $=z,C=Q,A=W,R=ie;return u(),h("div",je,[t("div",Se,[_(C,{disabled:!c(D),class:K(["clan-events__btn",[c(D)?"clan-events__btn--has-unread":""]]),"is-text":"","is-square":"",title:"События клана",onClick:s},{default:f(()=>[_($,{name:"mail"})]),_:1},8,["disabled","class"]),t("div",Re,o(c(D)>99?"99+":c(D)),1)]),_(R,{ref_key:"dialogRef",ref:e,width:"640px",title:"События клана"},{title:f(()=>[t("div",Me,[g[0]||(g[0]=t("span",{class:"clan-events__prop-title"}," События от ",-1)),m(" "+o(l.$formatter.date.toDateTime(n.savedAt))+" ("+o(l.$formatter.date.toDaysPassed(n.savedAt,Date.now()))+") ",1)])]),footer:f(()=>[t("div",Ue,[g[3]||(g[3]=t("div",null,null,-1)),t("div",null,[_(C,{onClick:b},{default:f(()=>g[1]||(g[1]=[m(" Прочитано ")])),_:1}),_(C,{onClick:a},{default:f(()=>g[2]||(g[2]=[m(" Закрыть ")])),_:1})])])]),default:f(()=>[c(w).length?(u(),h("div",Fe,[t("span",Ee," Покинули ("+o(c(w).length)+") ",1),(u(!0),h(U,null,J(c(w),(i,T)=>(u(),h("span",{key:i.account_id,class:"clan-events__prop-value"},[_(A,{to:{name:"account-id",params:{id:i.account_id}},class:"link"},{default:f(()=>[m(o(i.account_name),1)]),_:2},1032,["to"]),m(o(T+1!==c(w).length?", ":""),1)]))),128))])):P("",!0),c(y).length?(u(),h("div",Oe,[t("span",qe," Вступили ("+o(c(y).length)+") ",1),(u(!0),h(U,null,J(c(y),(i,T)=>(u(),h("span",{key:i.account_id,class:"clan-events__prop-value"},[_(A,{to:{name:"account-id",params:{id:i.account_id}},class:"link"},{default:f(()=>[m(o(i.account_name),1)]),_:2},1032,["to"]),m(o(T+1!==c(y).length?", ":""),1)]))),128))])):P("",!0),c(D)?P("",!0):(u(),h("span",Te," Пока всё тихо ... "))]),_:1},512)])}}}),Ne={class:"social-links"},Ve={class:"social-links__links"},ze=["href","title"],He=E({__name:"SocialLinks",props:{links:{type:Array,default:()=>[],required:!0}},setup(n){return(v,p)=>(u(),h("div",Ne,[t("div",Ve,[(u(!0),h(U,null,J(n.links,e=>(u(),h("a",{key:e.link,class:"link social-links__links-item",href:e.link,target:"_blank",title:e.title},[(u(),j(_e(e.icon)))],8,ze))),128))])]))}}),Ge=/(https?:\/\/)?(www\.)?(discord\.(gg|io|me|li)|discordapp\.com\/invite)\/.+[a-z|0-9]/gi,Je=/(https?:\/\/)?(www\.)?((t|telegram)\.me)\/\+?[a-zA-Z0-9_]{5,32}/gi,Ke=n=>{const v=[],p=n.match(Ge),e=n.match(Je);return p!=null&&p.length&&v.push({title:"Discord",icon:Y(()=>Z(()=>import("./btJo1MBV.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),link:p[0]}),e!=null&&e.length&&v.push({title:"Telegram",icon:Y(()=>Z(()=>import("./BaajXRc8.js"),__vite__mapDeps([6,1,2,3,4,5]),import.meta.url)),link:e[0]}),v},Qe={class:"clan-preview-details__body"},We={key:0,class:"clan-preview-details__section"},Ye={class:"clan-preview-details__props-title"},Ze={class:"clan-preview-details__section"},Xe={class:"clan-preview-details__props-title"},et=["textContent"],tt={key:1,class:"clan-preview-details__section"},at={class:"clan-preview-details__props-title"},nt={class:"clan-preview-details__props"},st={class:"clan-preview-details__prop"},lt={class:"clan-preview-details__prop"},it={class:"clan-preview-details__prop"},ot={class:"clan-preview-details__prop"},ct={key:0,class:"clan-preview-details__prop"},rt={class:"clan-preview-details__section"},dt={class:"clan-preview-details__props-title"},_t={class:"clan-preview-details__props"},ut={class:"clan-preview-details__prop"},mt={class:"clan-preview-details__prop"},pt={class:"clan-preview-details__prop"},vt={class:"clan-preview-details__prop"},ft={class:"clan-preview-details__prop"},bt={class:"clan-preview-details__prop"},gt={style:{display:"flex","justify-content":"space-between"}},wt=E({__name:"ClanPreviewDetails",props:{clan:{type:Object,default:()=>({}),required:!0}},setup(n,{expose:v}){const p=n,e=V(null),w=N({descExpended:!1}),y=F(()=>Ke(p.clan.description??""));function D(){var s;(s=e.value)==null||s.doOpen()}function I(){var s;(s=e.value)==null||s.doClose()}function b(){w.descExpended=!w.descExpended}return v({open:D,close:I}),(s,a)=>{const l=z,g=Q,$=W,C=He,A=ie;return u(),j(A,{ref_key:"clanDetailsRef",ref:e,class:"clan-preview-details",title:`[${n.clan.tag}] ${n.clan.name}`,width:"640px"},{footer:f(()=>[t("div",gt,[c(y).length?(u(),j(C,{key:0,class:"clan-preview-details__links",links:c(y)},null,8,["links"])):P("",!0),_(g,{onClick:I},{default:f(()=>a[16]||(a[16]=[m(" Закрыть ")])),_:1})])]),default:f(()=>[t("div",Qe,[n.clan.motto?(u(),h("div",We,[t("h5",Ye,[_(l,{class:"clan-preview-details__prop-title-icon",name:"format-quote"}),a[0]||(a[0]=m(" Девиз "))]),t("i",null,o(n.clan.motto),1)])):P("",!0),t("div",Ze,[t("h5",Xe,[_(l,{class:"clan-preview-details__prop-title-icon",name:"description"}),a[1]||(a[1]=m(" Описание "))]),n.clan.description?(u(),h("div",{key:0,class:K(["content-area clan-preview-details__desc",c(w).descExpended?"clan-preview-details__desc--expended":""]),textContent:o(n.clan.description)},null,10,et)):P("",!0),_(g,{"is-text":"",class:"clan-preview-details__desc-expend-btn",onClick:b},{default:f(()=>[m(o(c(w).descExpended?"Свернуть":"Развернуть"),1)]),_:1})]),n.clan.motto?(u(),h("div",tt,[t("h5",at,[_(l,{class:"clan-preview-details__prop-title-icon",name:"info"}),a[2]||(a[2]=m(" Информация "))]),t("div",nt,[t("div",st,[a[3]||(a[3]=t("span",{class:"clan-preview-details__prop-title"}," Создатель ",-1)),n.clan.creator_id?(u(),j($,{key:0,class:"link",to:n.clan.creator_id?{name:"account-id",params:{id:n.clan.creator_id}}:{}},{default:f(()=>[m(o(n.clan.creator_name),1)]),_:1},8,["to"])):(u(),h(U,{key:1},[m(" Не известен ")],64))]),t("div",lt,[a[4]||(a[4]=t("span",{class:"clan-preview-details__prop-title"}," Дата создания ",-1)),m(" "+o(s.$formatter.date.toDate(n.clan.created_at*1e3)),1)]),t("div",it,[a[5]||(a[5]=t("span",{class:"clan-preview-details__prop-title"}," Дата обновления ",-1)),m(" "+o(s.$formatter.date.toDate(n.clan.updated_at*1e3)),1)]),t("div",ot,[a[6]||(a[6]=t("span",{class:"clan-preview-details__prop-title"}," Участников ",-1)),m(" "+o(s.$formatter.number.toInteger(n.clan.members_count)),1)]),n.clan.old_tag?(u(),h("div",ct,[a[7]||(a[7]=t("span",{class:"clan-preview-details__prop-title"}," Старое название ",-1)),m(" ["+o(n.clan.old_tag)+"] "+o(n.clan.old_name),1)])):P("",!0)])])):P("",!0),t("div",rt,[t("h5",dt,[_(l,{class:"clan-preview-details__prop-title-icon",name:"person-search"}),a[8]||(a[8]=m(" Рекрутинг "))]),t("div",_t,[t("div",ut,[a[9]||(a[9]=t("span",{class:"clan-preview-details__prop-title"}," Политика приёма. ",-1)),m(" "+o(s.$formatter.clan.recruitingPolicy(n.clan.recruiting_policy))+". ",1)]),n.clan.recruiting_policy==="open"&&n.clan.recruiting_options?(u(),h(U,{key:0},[a[15]||(a[15]=t("div",{class:"clan-preview-details__props-subtitle"}," Пороги статистики для вступления: ",-1)),t("div",mt,[a[10]||(a[10]=t("span",{class:"clan-preview-details__prop-title"}," Боёв в день ",-1)),m(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.average_battles_per_day)),1)]),t("div",pt,[a[11]||(a[11]=t("span",{class:"clan-preview-details__prop-title"}," Боёв всего ",-1)),m(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.battles)),1)]),t("div",vt,[a[12]||(a[12]=t("span",{class:"clan-preview-details__prop-title"}," Урон ср. ",-1)),m(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.average_damage)),1)]),t("div",ft,[a[13]||(a[13]=t("span",{class:"clan-preview-details__prop-title"}," Уровень ",-1)),m(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.vehicles_level)),1)]),t("div",bt,[a[14]||(a[14]=t("span",{class:"clan-preview-details__prop-title"}," Побед ",-1)),m(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.wins_ratio))+"% ",1)])],64)):P("",!0)])])])]),_:1},8,["title"])}}}),yt={class:"clan-preview"},ht={class:"clan-preview__inner"},$t={class:"clan-preview__emblem"},kt={class:"clan-preview__info"},Ct={class:"clan-preview__title"},Dt={class:"clan-preview__tag"},It={class:"clan-preview__name"},xt={class:"clan-preview__props"},At={class:"clan-preview__prop"},Bt={class:"clan-preview__prop-value"},Pt={class:"clan-preview__prop"},jt={class:"clan-preview__prop-value"},St={class:"clan-preview__actions"},Rt=E({__name:"ClanPreview",props:{clan:{type:Object,default:()=>({}),required:!0},hideDescription:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},setup(n){const v=n,p=V(null),e=ue(),w=N({isFavorite:!1});le(()=>{y()});async function y(){const{$indexedDB:a}=q(),l=await a.clansFavorites.get(v.clan.clan_id);w.isFavorite=l?l==null?void 0:l.isFavorite:!1}async function D(){if(!v.clan)return;w.isFavorite=!w.isFavorite;const{$indexedDB:a}=q();await a.clansFavorites.set(v.clan.clan_id,{id:v.clan.clan_id,isFavorite:w.isFavorite})}async function I(){await ye(`${v.clan.tag}/${v.clan.clan_id}`)?e.add({type:"success",title:"Скопировано",message:`${v.clan.tag}/${v.clan.clan_id}`,duration:3e3}):e.add({type:"error",message:"Клан копировании что-то пошло не так",duration:3e3})}function b(){var a;(a=p.value)==null||a.open()}function s(){D()}return(a,l)=>{const g=we,$=z,C=Q,A=oe,R=wt;return u(),h("div",yt,[t("div",ht,[t("div",$t,[_(g,{class:"clan-preview__emblem-img",alt:n.clan.name,emblem:n.clan.emblem_set_id},null,8,["alt","emblem"])]),t("div",kt,[t("div",Ct,[t("span",Dt,"["+o(n.clan.tag??"...")+"]",1),t("span",It,o(n.clan.name??"..."),1)]),t("div",xt,[t("div",At,[l[0]||(l[0]=t("span",{class:"clan-preview__prop-title"}," Участников ",-1)),t("span",Bt,o(n.clan.members_count??"---"),1)]),t("div",Pt,[l[1]||(l[1]=t("span",{class:"clan-preview__prop-title"}," События ",-1)),t("span",jt,[me(a.$slots,"events")])])])]),t("div",St,[_(C,{"is-text":"",class:"clan-preview__actions-btn",title:"Копировать (nickname/ID)",onClick:I},{default:f(()=>[_($,{name:"content-copy"})]),_:1}),_(C,{"is-text":"",class:"clan-preview__actions-btn",title:"Добавить в избранные",onClick:s},{default:f(()=>[c(w).isFavorite?(u(),j($,{key:0,name:"star"})):(u(),j($,{key:1,name:"star-border"}))]),_:1}),_(C,{"is-text":"",class:"clan-preview__actions-btn",title:"Полная информация",onClick:b},{default:f(()=>[_($,{name:"info"})]),_:1})])]),_(A,{loading:n.loading},null,8,["loading"]),_(R,{ref_key:"previewDetailsRef",ref:p,clan:n.clan},null,8,["clan"])])}}}),Mt={class:"clan-view-filters"},Ft={class:"clan-view-filters__list"},Et={class:"clan-view-filters__item clan-view-filters__item--search"},Ot={class:"clan-view-filters__item"},qt={class:"clan-view-filters__item"},Tt=E({__name:"ClanViewFilter",props:{filters:{type:Object,required:!0,default:O.makeClanFilters}},emits:["filters-change"],setup(n,{emit:v}){const p=n,e=[{value:null,label:"Не выбрано"},{value:"<3",label:"Меньше чем 3"},{value:"<5",label:"Меньше чем 5"},{value:"<7",label:"Меньше чем 7"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],w=[{value:null,label:"Не выбрано"},{value:"<1",label:"Меньше чем 1"},{value:"<3",label:"Меньше чем 3"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],y=v;function D(I,b){y("filters-change",{...p.filters,[I]:b})}return(I,b)=>{const s=ke,a=Ce;return u(),h("div",Mt,[t("div",Ft,[t("div",Et,[b[3]||(b[3]=t("div",{class:"clan-view-filters__item-title"}," Поиск в клане ",-1)),_(s,{"model-value":n.filters.search,style:{width:"100%"},placeholder:"Введите ник",type:"search","onUpdate:modelValue":b[0]||(b[0]=l=>D("search",l))},null,8,["model-value"])]),t("div",Ot,[b[4]||(b[4]=t("div",{class:"clan-view-filters__item-title"}," Дней в клане ",-1)),_(a,{"model-value":n.filters.joinedAtDays,style:{width:"150px"},options:e,onChange:b[1]||(b[1]=l=>D("joinedAtDays",l))},null,8,["model-value"])]),t("div",qt,[b[5]||(b[5]=t("div",{class:"clan-view-filters__item-title"}," Дней отсутствовал ",-1)),_(a,{"model-value":n.filters.lastBattleDays,style:{width:"150px"},options:w,onChange:b[2]||(b[2]=l=>D("lastBattleDays",l))},null,8,["model-value"])])])])}}}),Ut={class:"clan-view-table"},Lt={class:"clan-view-table__total"},Nt={class:"clan-view-table__total-value"},Vt={class:"clan-view-table__member"},zt=["title"],Ht={key:0,class:"clan-view-table__name clan-view-table__name--deleted"},Gt={class:"clan-view-table__sub"},Jt={class:"clan-view-table__sub"},Kt={class:"clan-view-table__sub"},Qt={class:"clan-view-table__sub"},Wt={class:"clan-view-table__sub"},Yt={class:"clan-view-table__sub"},Zt=E({__name:"ClanViewMembersTable",props:{members:{type:Array,default:()=>[],required:!0},savedMembers:{type:Array,default:()=>[],required:!0},users:{type:Array,default:()=>[],required:!0},sort:{type:Object,default:()=>({}),required:!0}},emits:["sort"],setup(n,{emit:v}){const p=n,e=v,w=[{key:"account_name",label:"Ник",sortable:!0},{key:"battles",label:"Боёв",sortable:!0,sortMethod(s,a){return s.statistic.all.battles-a.statistic.all.battles}},{key:"winRate",label:"Побед",sortable:!0,sortMethod(s,a){return s.statistic.all.winRate-a.statistic.all.winRate}},{key:"damagePerBattle",label:"Урон",sortable:!0,sortMethod(s,a){return s.statistic.all.damagePerBattle-a.statistic.all.damagePerBattle}},{key:"rating",label:"Рейтинг",sortable:!0,sortMethod(s,a){var $,C;const l=(($=s.statistic.rating)==null?void 0:$.rating)??0,g=((C=a.statistic.rating)==null?void 0:C.rating)??0;return l-g}},{key:"battlesPerDay",label:"Боёв в день",sortable:!0},{key:"last_battle_time",label:"Последний бой",sortable:!0},{key:"joined_at",label:"В клане",sortable:!0}],y=F(()=>p.members.map(s=>{const a=p.savedMembers.find(A=>A.account_id===s.account_id),l=a?L.diff(s.statistic.all,a.statistic.all):null,g=L.battlesPerDay({createAt:s.create_at*1e3,battles:s.statistic.all.battles}),$=l?L.battlesPerDay({battles:s.statistic.all.battles-l.battles,createAt:s.create_at*1e3}):null,C=$?g-$:null;return{...s,battlesPerDay:g,battlesPerDayDiff:C,diff:l}}));function D(s){const a=p.users.find(l=>l.id===s.account_id);return a?{found:!0,online:Date.now()-new Date(a.visitedAt).valueOf()<1e3*60*5}:{found:!1,online:!1}}function I(s){const a=s;return/^del_\d+$/.test(a.account_name)||!a.last_battle_time}function b(s,a){const l=a;return l.diff?s==="winRate"?X.number.toFloatNumber(l.diff[s],!0):X.number.toInteger(l.diff[s],!0):"---"}return(s,a)=>{const l=De,g=z,$=W,C=Ie,A=xe,R=Ae;return u(),h("div",Ut,[t("div",Lt,[a[1]||(a[1]=m(" Кол-во: ")),t("span",Nt,o(c(y).length||0),1)]),c(y)?(u(),j(R,{key:0,data:c(y),"default-sort":n.sort,headers:w,"no-wrap":"","scroll-auto-disabling":"","row-key":"account_id",height:"calc(100vh - 112px)",class:"clan-view-table__table",onSort:a[0]||(a[0]=i=>e("sort",i))},{account_name:f(({row:i})=>[t("span",Vt,[t("span",{class:K(["clan-view-table__role",["clan-view-table__role--"+i.role,D(i).found?"clan-view-table__role--is-user":"",D(i).online?"clan-view-table__role--is-online":""]]),title:s.$formatter.clan.role(i.role)??"Не известна"},[i.role?(u(),j(l,{key:0,width:"18",height:"18",class:"clan-view-table__role-icon",role:i.role},null,8,["role"])):(u(),j(g,{key:1,style:{width:"16px",color:"var(--color-text-light)"},name:"close"}))],10,zt),I(i)?(u(),h("span",Ht,o(i.account_name),1)):(u(),j($,{key:1,class:"link clan-view-table__name",to:{name:"account-id",params:{id:i.account_id}}},{default:f(()=>[m(o(i.account_name),1)]),_:2},1032,["to"]))])]),battles:f(({row:i})=>[m(o(i.statistic.all.battles||"---")+" ",1),t("span",Gt,o(b("battles",i)||"---"),1)]),winRate:f(({row:i})=>[_(C,{"win-rate":i.statistic.all.winRate,class:"clan-view-table__win-rate"},null,8,["win-rate"]),t("span",Jt,o(b("winRate",i)||"---"),1)]),rating:f(({row:i})=>[_(A,{rating:i.statistic.rating},null,8,["rating"])]),damagePerBattle:f(({row:i})=>[m(o(i.statistic.all.damagePerBattle||"---")+" ",1),t("span",Kt,o(b("damagePerBattle",i)),1)]),battlesPerDay:f(({row:i})=>[m(o(i.battlesPerDay||"---")+" ",1),t("span",Qt,o(s.$formatter.number.toInteger(i.battlesPerDayDiff,!0)||"---"),1)]),last_battle_time:f(({row:i})=>[m(o(s.$formatter.date.toRelativeTime(i.last_battle_time*1e3)||"---")+" ",1),t("span",Wt,o(s.$formatter.date.toDateTime(i.last_battle_time*1e3)||"---"),1)]),joined_at:f(({row:i})=>[m(o(s.$formatter.date.toDaysPassed(i.joined_at*1e3)||"---")+" ",1),t("span",Yt,o(s.$formatter.date.toDate(i.joined_at*1e3)||"---"),1)]),_:1},8,["data","default-sort"])):P("",!0)])}}}),Xt=(n,v)=>{const{prop:p,order:e}=v;return e?n.toSorted((w,y)=>{const D=(e==="desc"?y:w)[p],I=(e==="desc"?w:y)[p];return String(D).localeCompare(String(I),void 0,{numeric:!0,sensitivity:"base"})}):n},ea=n=>{n.sort((v,p)=>v.joined_at-p.joined_at)},ta=n=>{n.sort((v,p)=>{const e={recruit:0,private:1,executive_officer:2,commander:3};return e[p.role]-e[v.role]})},aa=n=>{ea(n),ta(n)},se={smart:Xt,clanMembersDefault:aa},na={key:0,class:"clan-page"},sa={key:1,class:"clan-page--no-data"},la={key:0,class:"content-area"},Aa=E({__name:"[id]",setup(n){const{$formatter:v}=q(),p=pe();ve({title:()=>v.route.getTitle(Be.toString(p.name)??"")});const e=N({loading:0,users:[],clanInfo:null,clan:null,filters:O.makeClanFilters(),statisticsSum:null,savedMembers:[],savedClan:null,metricsItems:ae.clan(),clanSavedAt:0,sessionUpdateAt:0,sessionActive:!1}),w=N({order:"desc",prop:""}),y=F(()=>{var d;return((d=e.clan)==null?void 0:d.members)||[]}),D=F(()=>{let d=y.value.filter(k=>{const B=k.account_name.toLowerCase(),x=e.filters.search.toLowerCase();return B.includes(x)});const r=Date.now();if(e.filters.joinedAtDays){const k=O.parseParameter(e.filters.joinedAtDays);d=y.value.filter(B=>O.executeExpression(r-Number(k.value)*te,B.joined_at*1e3,k.operator))}if(e.filters.lastBattleDays){const k=O.parseParameter(e.filters.lastBattleDays);d=y.value.filter(B=>O.executeExpression(r-Number(k.value)*te,B.last_battle_time*1e3,k.operator))}return d}),I=V(!1);le(async()=>{await $(),I.value=!0});async function b(d){e.loading++;try{const{data:r}=await G.clan.getAccountInfo({account_id:d.join(",")});return r}catch(r){return M(r,{title:"Получение данных участников клана"}),null}finally{e.loading--}}async function s(d){e.loading++;try{const{data:r}=await G.clan.getInfo({clan_id:d});e.clanInfo=r[d]??null}catch(r){M(r,{title:"Получение данных клана"})}e.loading--}async function a(d){e.loading++;try{const{data:r}=await be.user.getList({id:d});e.users=r}catch(r){M(r,{title:"Получение данных аккаунта"})}e.loading--}async function l(d){e.loading++;try{const{data:r}=await G.account.getInfo({extra:"statistics.rating",account_id:d.join(",")});return r}catch(r){return M(r,{title:"Получение данных аккаунта"}),null}finally{e.loading--}}async function g(d){await Promise.all([C(d),R(d)])}async function $(){const d=+p.params.id;if(!d||(await s(d),!e.clanInfo))return;const r=await b(e.clanInfo.members_ids);e.clanInfo.members||(e.clanInfo.members={});for(const x in r){const S=r[x];S&&(e.clanInfo.members[x]={account_id:S.account_id,account_name:S.account_name,joined_at:S.joined_at,role:S.role})}await Promise.all([a(e.clanInfo.members_ids),g(e.clanInfo)]),e.savedClan||await A(e.clanInfo);const k=await l(e.clanInfo.members_ids);if(!k)return;e.clan=ne.clan(e.clanInfo,k);const B=Object.values(k).filter(Pe);e.statisticsSum=B.reduce((x,S,H)=>H===0?B[0].statistics:L.sumFull(x,S.statistics),{}),e.metricsItems=ae.clan(B,e.statisticsSum),se.clanMembersDefault(y.value)}async function C(d){e.loading++;try{const r=[],{$indexedDB:k}=q();for(const B in d.members){const x=await k.accountsInfo.get(B);x&&(x.data.created_at=x.timestamp,x.timestamp>e.sessionUpdateAt&&(e.sessionUpdateAt=x.timestamp),r.push(ne.clanMember(d.members[B],x.data)))}e.savedMembers=r}catch(r){M(r,{title:"Загрузка локальных данных аккаунтов"})}e.loading--}async function A(d){e.loading++;try{const{$indexedDB:r}=q();await r.clansInfo.set(d.clan_id,fe(d)),e.savedClan=ee(d),e.clanSavedAt=Date.now()}catch(r){M(r,{title:"Локальное сохранение данных аккаунтов"})}e.loading--}async function R(d){e.loading++;try{const{$indexedDB:r}=q(),k=await r.clansInfo.get(d.clan_id);e.savedClan=(k==null?void 0:k.data)??null,e.clanSavedAt=(k==null?void 0:k.timestamp)??0}catch(r){M(r,{title:"Загрузка локальных данных клана"})}e.loading--}function i(d){d.order||se.clanMembersDefault(y.value)}async function T(){e.clanInfo&&await A(e.clanInfo)}function ce(d){e.filters=ee(d)}return(d,r)=>{const k=Le,B=Rt,x=he,S=$e,H=Tt,re=Zt,de=oe;return c(e).clanInfo?(u(),h("div",na,[_(x,{identity:"preview"},{default:f(()=>[_(B,{class:"clan-page__preview","hide-description":!0,clan:c(e).clanInfo,loading:c(e).loading>0},ge({_:2},[c(e).clanInfo&&c(e).savedClan?{name:"events",fn:f(()=>[_(k,{clan:c(e).clanInfo,"saved-clan":c(e).savedClan,"saved-at":c(e).clanSavedAt,onReset:T},null,8,["clan","saved-clan","saved-at"])]),key:"0"}:void 0]),1032,["clan","loading"])]),_:1}),_(x,{title:"Статистика",identity:"statistic"},{default:f(()=>[_(S,{loading:c(e).loading>0,items:c(e).metricsItems},null,8,["loading","items"])]),_:1}),_(x,{title:"Участники",identity:"members"},{default:f(()=>[_(H,{class:"clan-page__filters",filters:c(e).filters,onFiltersChange:ce},null,8,["filters"]),_(re,{sort:c(w),users:c(e).users,"saved-members":c(e).savedMembers,members:c(D),onSort:i},null,8,["sort","users","saved-members","members"])]),_:1})])):(u(),h("div",sa,[c(I)?(u(),h("div",la,r[0]||(r[0]=[t("p",null,"Нет данных.",-1),t("p",null,"Возможно клан удалён.",-1)]))):P("",!0),_(de,{loading:!c(I)},null,8,["loading"])]))}}});export{Aa as default};
