import{_ as q}from"./DAdBg_Ew.js";import{_ as N}from"./B6ZSgAcB.js";import{_ as R}from"./BnYJ5puK.js";import{_ as b}from"./34P0Lxgg.js";import{d as L,e as C,o as u,q as p,F as x,C as T,s as n,v as m,j as d,t as w,I as H,g as r,u as U,a as j,b as A,c as D,l as $,x as F,m as I,n as k,p as O,A as W,f as G,w as M}from"./Divx9Nzj.js";import{_ as P}from"./DbF9yHVU.js";import{c as J}from"./B4FMxlHh.js";import"./C6J5xBRa.js";import"./4hdVvK08.js";import"./DD4asW33.js";import"./O7DRg4lh.js";import"./AomIj8wQ.js";import"./DlAUqK2U.js";import"./Bssrnu3E.js";import"./DRlS0BVX.js";import"./BxBPJGBn.js";import"./mry5RTp6.js";import"./BLfYOl_8.js";import"./BX-xDoGX.js";import"./D045v6vD.js";import"./0iDIn4Pu.js";import"./C8llOfle.js";import"./D1vz3_zC.js";import"./C7G1eRMI.js";import"./CfaeTVnB.js";import"./mvGY63HI.js";const K={class:"tournaments-list"},Q={class:"tournaments-list__section-title"},X={class:"tournaments-list__list"},Y={class:"tournaments-list__item-img-wrapper"},Z={class:"tournaments-list__item-content"},tt={class:"tournaments-list__item-title"},st={class:"tournaments-list__item-tier"},et={class:"tournaments-list__item-details"},nt={class:"tournaments-list__item-date"},ot=L({__name:"TournamentsList",props:{tournaments:{type:Array,default:()=>[],required:!0},loading:{type:Boolean,default:!1}},setup(g){const f=g,c=C(()=>{const i={running:[],registration_started:[],registration_finished:[],upcoming:[],finished:[],complete:[]};return f.tournaments.forEach(t=>{i[t.status].push(t)}),Object.entries(i).map(([t,s])=>({status:t,list:s})).filter(t=>t.list.length)});function h(i){const t=i.description.match(/Уровень техники: (.+?)\./i);return t!=null&&t[1]?t==null?void 0:t[1]:""}return(i,t)=>{const s=N,v=R,y=b;return u(),p("div",K,[(u(!0),p(x,null,T(r(c),l=>(u(),p("div",{key:l.status,class:"tournaments-list__section"},[n("div",Q,m(i.$formatter.tournament.status(l.status)),1),n("ul",X,[(u(!0),p(x,null,T(l.list,o=>(u(),p("li",{key:o.tournament_id,class:"tournaments-list__item"},[n("div",Y,[d(s,{class:"tournaments-list__item-img",loading:"lazy",src:o.logo.original,alt:"image"},null,8,["src"])]),n("div",Z,[n("div",tt,[w(m(o.title)+" ",1),n("div",st,m(h(o)),1)]),n("div",et,[n("div",nt,m(i.$formatter.date.toDateTime(o.start_at*1e3)),1),n("div",{class:H(["tournaments-list__item-status",["tournaments-list__item-status--"+o.status]])},m(i.$formatter.tournament.status(o.status)),3)])]),d(v,{class:"tournaments-list__item-link link",to:{name:"tournaments-id",params:{id:o.tournament_id}}},null,8,["to"])]))),128))])]))),128)),d(y,{loading:g.loading},null,8,["loading"])])}}}),at={class:"tournaments-page__filter"},it={class:"tournaments-page__count"},rt={class:"tournaments-page__list"},Rt=L({__name:"index",setup(g){const{$formatter:f}=U(),c=j();A({title:()=>f.route.getTitle(J.toString(c.name)??"")});const h=[null,"upcoming","registration_started","registration_finished","running","finished","complete"],i=D(),t=$({loading:0,tournaments:[],status:null}),s=$({page:1,pageSize:25,total:0}),v=$(h.map(e=>({label:e?F.tournament.status(e):"Все",value:e}))),y=C(()=>s.total>s.page*s.pageSize);I(async()=>{var e;t.status=((e=c.query)==null?void 0:e.status)??null,S(),await o(),window.addEventListener("scroll",l)}),W(()=>{window.removeEventListener("scroll",l)});function l(){const{scrollTop:e,scrollHeight:a,clientHeight:_}=document.documentElement;t.loading===0&&y.value&&e+_>=a-100&&(s.page+=1,o())}async function o(){t.loading++;try{if(t.status===null&&s.page===1){const _=await k.tournaments.getList({limit:s.pageSize,status:"running"});t.tournaments.push(..._.data)}const e=["upcoming","registration_started","registration_finished","finished","complete"].join(","),a=await k.tournaments.getList({limit:s.pageSize,page_no:s.page,status:t.status??e});s.total=a.meta.total,t.tournaments.push(...a.data)}catch(e){O(e,{title:"Получение списка турниров"})}t.loading--}function S(){i.replace({query:{...c.query,status:t.status||null}}).catch(()=>{})}function z(){s.page=1,t.tournaments=[],S(),o()}return(e,a)=>{const _=q,B=ot,E=P;return u(),G(E,{class:"tournaments-page"},{default:M(()=>[n("div",at,[a[1]||(a[1]=w(" По статусу: ")),d(_,{modelValue:r(t).status,"onUpdate:modelValue":a[0]||(a[0]=V=>r(t).status=V),style:{width:"200px"},options:r(v),onChange:z},null,8,["modelValue","options"])]),n("div",it,[a[2]||(a[2]=n("span",{class:"tournaments-page__count-title"}," Кол-во: ",-1)),w(" "+m(r(s).total),1)]),n("div",rt,[d(B,{tournaments:r(t).tournaments,loading:r(t).loading>0},null,8,["tournaments","loading"])])]),_:1})}}});export{Rt as default};
