import{_ as I}from"./Cl_1G4Vr.js";import{d as k,k as C,r as b,c as E,s as $,aR as F,aS as O,o as d,e as B,w as u,f as v,l as y,h as r,m as i,q as m,t as S,g as U,ak as A,al as H,_ as D,v as w,T as P,F as j,B as q,E as z,a as G,A as L,a8 as J}from"./DJlEGeV1.js";import{_ as K}from"./CIh7AwxB.js";import{u as Q}from"./j8H2iFUT.js";import{_ as N}from"./D-TuSGJo.js";import{_ as W}from"./B7WhaZnE.js";import{_ as X}from"./BmHpWDuk.js";import{u as Y}from"./roZIKyQo.js";import{u as Z}from"./YbE3Ovi3.js";import{u as tt}from"./btAca64B.js";import{u as et}from"./C1V66jBN.js";import"./RPJY7rI9.js";import"./DD4asW33.js";import"./NWUEeXks.js";import"./PfUKTOG5.js";import"./BxBPJGBn.js";import"./RA3fBwkA.js";import"./BE0zBel4.js";const ot={key:0,class:"update-message"},nt={class:"update-message__title"},st={class:"update-message__control"},at=k({__name:"UpdateMessage",setup(x){C(()=>{f()});const _=b(!1),c=b(null),s=H(),p=E(()=>{const t=s.public.clientVersion;return!c.value||!t||_.value?!1:c.value!==t});function f(){const{$firebase:t}=$(),l=t.db();F(O(l,"app","info"),n=>{const e=n.data();c.value=(e==null?void 0:e.version)??null},n=>{Q(n,{title:"Получение данных версии из Firebase"})})}function o(){location.reload()}function a(){_.value=!0}return(t,l)=>{const n=D,e=w,g=K;return d(),B(A,{name:"update-message-"},{default:u(()=>[v(p)?(d(),y("div",ot,[r(g,{class:"update-message__inner"},{default:u(()=>[i("div",nt,[r(n,{class:"update-message__icon",name:"new-releases"}),m(" Обновление v"+S(v(c)),1)]),l[2]||(l[2]=i("div",{class:"update-message__body"}," Что бы изменения вступили в силу, необходимо обновить страницу. ",-1)),i("div",st,[r(e,{class:"update-message__btn",onClick:o},{default:u(()=>l[0]||(l[0]=[m(" Обновить ")])),_:1}),r(e,{class:"update-message__btn",onClick:a},{default:u(()=>l[1]||(l[1]=[m(" Скрыть ")])),_:1})])]),_:1})])):U("",!0)]),_:1})}}}),it={class:"update-db-dialog__header"},lt={style:{display:"flex","justify-content":"flex-end"}},rt=k({__name:"UpdateDBDialog",emits:["confirm"],setup(x,{expose:_,emit:c}){const s=b(null),p=c;function f(){var a;(a=s.value)==null||a.doClose(),p("confirm")}function o(){var a;(a=s.value)==null||a.doOpen()}return _({open:o}),(a,t)=>{const l=D,n=w,e=N;return d(),B(e,{ref_key:"dialogRef",ref:s,class:"update-db-dialog","modal-enabled":"",width:"480px"},{title:u(()=>[i("div",it,[r(l,{class:"update-db-dialog__icon",name:"database-alert"}),t[0]||(t[0]=i("b",null,"База данных обновлена",-1))])]),footer:u(()=>[i("div",lt,[r(n,{onClick:f},{default:u(()=>t[1]||(t[1]=[m(" Так точно ")])),_:1})])]),default:u(()=>[t[2]||(t[2]=m(" Для продолжения использования необходимо: ")),t[3]||(t[3]=i("br",null,null,-1)),t[4]||(t[4]=m(" 1. Закрыть все вкладки ресурса, кроме активной.")),t[5]||(t[5]=i("br",null,null,-1)),t[6]||(t[6]=m(" 2. Обновить текущую страницу.")),t[7]||(t[7]=i("br",null,null,-1)),t[8]||(t[8]=m(" 3. Готово.")),t[9]||(t[9]=i("br",null,null,-1))]),_:1},512)}}}),ut={class:"ui-notification"},ct={key:0,class:"ui-notification__item-title"},_t={class:"ui-notification__item-body"},dt=["onClick"],pt=k({__name:"UiNotification",props:{appendToBody:{type:Boolean,default:!1}},setup(x){const _=Y(),c=s=>{if(s.title)return s.title;switch(s.type){case"success":return"Успешно";case"error":return"Ошибка";case"info":return"Информация";case"warning":return"Внимание";default:return s.title}};return(s,p)=>{const f=X;return d(),B(f,null,{default:u(()=>[i("div",ut,[r(P,{tag:"ul",class:"ui-notification__list",name:"ui-notification__item-"},{default:u(()=>[(d(!0),y(j,null,q(v(_).items,o=>(d(),y("li",{key:o.id,class:z(["ui-notification__item",[o.type?"ui-notification__item--"+o.type:""]])},[o.title||o.type?(d(),y("div",ct,S(c(o)),1)):U("",!0),i("div",_t,S(o.message),1),i("button",{class:"ui-notification__item-close",onClick:a=>v(_).remove(o)},null,8,dt)],2))),128))]),_:1})])]),_:1})}}}),ft={class:"layout"},Vt=k({__name:"default",async setup(x){const{$storage:_}=$(),c=G(),s=Z(),p=tt(),f=et(),o=_.user.get();o&&s.setUser({accountId:Number(o.account_id),name:o.nickname}),C(()=>{l(),f.init()});const a=b(null),t=b(null);L(()=>c.fullPath,(n,e)=>{n!==e&&p.toggleMainSearch(!1)}),J(()=>{var n,e;p.mainSearchOpened?(n=a.value)==null||n.doOpen():(e=a.value)==null||e.doClose()});async function l(){const{$indexedDB:n}=$(),e=await n.getInstance();e.onBlocked=()=>{var g;return(g=t.value)==null?void 0:g.open()}}return(n,e)=>{const g=I,h=at,R=rt,M=W,T=N,V=pt;return d(),y("div",ft,[r(g),r(h),r(R,{ref_key:"updateDBRef",ref:t},null,512),v(f).isTablet?(d(),B(T,{key:0,ref_key:"searchDialogRef",ref:a,title:"Поиск аккаунтов и кланов",width:"480px",position:"top",onClose:e[0]||(e[0]=mt=>v(p).toggleMainSearch(!1))},{default:u(()=>[r(M,{style:{height:"270px"}})]),_:1},512)):U("",!0),r(V)])}}});export{Vt as default};
