import{_ as L,a as W,u as le,h as q}from"./disableScroll.DDlwJlcl.js";import{_ as G}from"./nuxt-link.C4UY2yYj.js";import{_ as ee}from"./CDialog.vue.B3NqeRuW.js";import{f as R,r as H,i as j,o as d,c as f,a,b as r,w as m,k as c,C as Z,t as o,d as u,F as O,A as U,m as A,j as P,D as ie,_ as J,n as V,q as te,E as oe,s as K,g as ce,G as re,H as _e}from"./entry.ctIX2KUb.js";import{_ as ae}from"./ContentLoader.vue.qy506COs.js";import{c as de,m as ue,s as Q,_ as me}from"./index.Bm8ajNGF.js";import{s as E,a as z}from"./request.C9u4Wmp-.js";import{_ as pe}from"./ClanEmblem.vue.Cq724das.js";import{_ as ve}from"./PageSection.vue.Ba-0kVIV.js";import{_ as fe}from"./CInput.vue.DyZig88L.js";import{_ as he}from"./CSelect.vue.B4ErcSKo.js";import{f as S}from"./index.DmknSq2w.js";import{_ as be}from"./RoleIcon.vue.CjiTVPTv.js";import{_ as ge}from"./WinRate.vue.CAQSEhR2.js";import{_ as we,m as X}from"./RatingIcon.vue.BgTnxmp_.js";import{_ as ye}from"./CTable.vue.DsGWM1Ic.js";import{s as T}from"./index.BCHmrf2d.js";import{n as $e}from"./notEmpty.BxBPJGBn.js";import{c as Y}from"./cloneDeep.D2VMXt5F.js";import{a as ke}from"./index.VOeJb_dr.js";import"./CImage.vue.fZ9_0vcv.js";import"./image-broken.DVFaI8IF.js";import"./nuxt-icon.CmJtK45D.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./isArrayLike.BUSTlxXz.js";const Ce={class:"clan-events"},De={class:"clan-events__inner"},Ie={class:"clan-events__count"},xe={class:"clan-events__prop"},Be=a("span",{class:"clan-events__prop-title"}," События от ",-1),Ae={key:0,class:"clan-events__prop"},Pe={class:"clan-events__prop-title"},je={key:1,class:"clan-events__prop"},Re={class:"clan-events__prop-title"},Se={key:2},Fe={style:{display:"flex","justify-content":"space-between"}},Me=a("div",null,null,-1),Ee=R({__name:"ClanEvents",props:{savedAt:{type:Number,default:0,required:!0},clan:{type:Object,default:()=>({}),required:!0},savedClan:{type:Object,default:()=>({}),required:!0}},emits:["reset"],setup(n,{emit:h}){const e=n,p=H(null),v=j(()=>{const l=e.clan.members_ids??[],b=e.savedClan.members??[];return Object.values(b).filter(g=>!l.includes(g.account_id))}),C=j(()=>{var g,y;const l=((g=e.clan)==null?void 0:g.members)??[],b=((y=e.savedClan)==null?void 0:y.members_ids)??[];return Object.values(l).filter(I=>!b.includes(I.account_id))}),$=j(()=>C.value.length+v.value.length),D=h;function w(){var l;D("reset"),(l=p.value)==null||l.doClose()}function s(){var l;(l=p.value)==null||l.doOpen()}function i(){var l;(l=p.value)==null||l.doClose()}return(l,b)=>{const g=L,y=W,I=G,F=ee;return d(),f("div",Ce,[a("div",De,[r(y,{disabled:!c($),class:Z(["clan-events__btn",[c($)?"clan-events__btn--has-unread":""]]),"is-text":"","is-square":"",title:"События клана",onClick:s},{default:m(()=>[r(g,{name:"mail"})]),_:1},8,["disabled","class"]),a("div",Ie,o(c($)>99?"99+":c($)),1)]),r(F,{ref_key:"dialogRef",ref:p,width:"640px",title:"События клана"},{title:m(()=>[a("div",xe,[Be,u(" "+o(l.$formatter.date.toDateTime(n.savedAt))+" ("+o(l.$formatter.date.toDaysPassed(n.savedAt,Date.now()))+") ",1)])]),footer:m(()=>[a("div",Fe,[Me,a("div",null,[r(y,{onClick:w},{default:m(()=>[u(" Прочитано ")]),_:1}),r(y,{onClick:i},{default:m(()=>[u(" Закрыть ")]),_:1})])])]),default:m(()=>[c(v).length?(d(),f("div",Ae,[a("span",Pe," Покинули ("+o(c(v).length)+") ",1),(d(!0),f(O,null,U(c(v),(t,_)=>(d(),f("span",{key:t.account_id,class:"clan-events__prop-value"},[r(I,{to:{name:"account-id",params:{id:t.account_id}},class:"link"},{default:m(()=>[u(o(t.account_name),1)]),_:2},1032,["to"]),u(o(_+1!==c(v).length?", ":""),1)]))),128))])):A("",!0),c(C).length?(d(),f("div",je,[a("span",Re," Вступили ("+o(c(C).length)+") ",1),(d(!0),f(O,null,U(c(C),(t,_)=>(d(),f("span",{key:t.account_id,class:"clan-events__prop-value"},[r(I,{to:{name:"account-id",params:{id:t.account_id}},class:"link"},{default:m(()=>[u(o(t.account_name),1)]),_:2},1032,["to"]),u(o(_+1!==c(C).length?", ":""),1)]))),128))])):A("",!0),c($)?A("",!0):(d(),f("span",Se," Пока всё тихо ... "))]),_:1},512)])}}}),Oe={class:"social-links"},qe={class:"social-links__links"},Te=["href","title"],Ve=R({__name:"SocialLinks",props:{links:{type:Array,default:()=>[],required:!0}},setup(n){return(h,e)=>(d(),f("div",Oe,[a("div",qe,[(d(!0),f(O,null,U(n.links,p=>(d(),f("a",{key:p.link,class:"link social-links__links-item",href:p.link,target:"_blank",title:p.title},[(d(),P(ie(p.icon),{width:"24",height:"24"}))],8,Te))),128))])]))}}),Le=/(https?:\/\/)?(www\.)?(discord\.(gg|io|me|li)|discordapp\.com\/invite)\/.+[a-z|0-9]/gi,Ne=/(https?:\/\/)?(www\.)?((t|telegram)\.me)\/\+?[a-zA-Z0-9_]{5,32}/gi,ze=n=>{const h=[],e=n.match(Le),p=n.match(Ne);return e!=null&&e.length&&h.push({title:"Discord",icon:()=>J(()=>import("./discord.DbDKZSm_.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),link:e[0]}),p!=null&&p.length&&h.push({title:"Telegram",icon:()=>J(()=>import("./telegram.DqMEzK-U.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url),link:p[0]}),h},Ue={parse:ze},We={class:"clan-preview-details__body"},Ge={key:0,class:"clan-preview-details__section"},He={class:"clan-preview-details__props-title"},Ze={class:"clan-preview-details__section"},Je={class:"clan-preview-details__props-title"},Ke=["textContent"],Qe={key:1,class:"clan-preview-details__section"},Xe={class:"clan-preview-details__props-title"},Ye={class:"clan-preview-details__props"},et={class:"clan-preview-details__prop"},tt=a("span",{class:"clan-preview-details__prop-title"}," Создатель ",-1),at={class:"clan-preview-details__prop"},nt=a("span",{class:"clan-preview-details__prop-title"}," Дата создания ",-1),st={class:"clan-preview-details__prop"},lt=a("span",{class:"clan-preview-details__prop-title"}," Дата обновления ",-1),it={class:"clan-preview-details__prop"},ot=a("span",{class:"clan-preview-details__prop-title"}," Участников ",-1),ct={key:0,class:"clan-preview-details__prop"},rt=a("span",{class:"clan-preview-details__prop-title"}," Старое название ",-1),_t={class:"clan-preview-details__section"},dt={class:"clan-preview-details__props-title"},ut={class:"clan-preview-details__props"},mt={class:"clan-preview-details__prop"},pt=a("span",{class:"clan-preview-details__prop-title"}," Политика приёма. ",-1),vt=a("div",{class:"clan-preview-details__props-subtitle"}," Пороги статистики для вступления: ",-1),ft={class:"clan-preview-details__prop"},ht=a("span",{class:"clan-preview-details__prop-title"}," Боёв в день ",-1),bt={class:"clan-preview-details__prop"},gt=a("span",{class:"clan-preview-details__prop-title"}," Боёв всего ",-1),wt={class:"clan-preview-details__prop"},yt=a("span",{class:"clan-preview-details__prop-title"}," Урон ср. ",-1),$t={class:"clan-preview-details__prop"},kt=a("span",{class:"clan-preview-details__prop-title"}," Уровень ",-1),Ct={class:"clan-preview-details__prop"},Dt=a("span",{class:"clan-preview-details__prop-title"}," Побед ",-1),It={style:{display:"flex","justify-content":"space-between"}},xt=R({__name:"ClanPreviewDetails",props:{clan:{type:Object,default:()=>({}),required:!0}},setup(n,{expose:h}){const e=n,p=H(null),v=V({descExpended:!1}),C=j(()=>Ue.parse(e.clan.description??""));function $(){var s;(s=p.value)==null||s.doOpen()}function D(){var s;(s=p.value)==null||s.doClose()}function w(){v.descExpended=!v.descExpended}return h({open:$,close:D}),(s,i)=>{const l=L,b=W,g=G,y=Ve,I=ee;return d(),P(I,{ref_key:"clanDetailsRef",ref:p,class:"clan-preview-details",title:`[${n.clan.tag}] ${n.clan.name}`,width:"640px"},{footer:m(()=>[a("div",It,[r(y,{class:"clan-preview-details__links",links:c(C)},null,8,["links"]),r(b,{onClick:D},{default:m(()=>[u(" Закрыть ")]),_:1})])]),default:m(()=>[a("div",We,[n.clan.motto?(d(),f("div",Ge,[a("h5",He,[r(l,{class:"clan-preview-details__prop-title-icon",name:"format-quote"}),u(" Девиз ")]),a("i",null,o(n.clan.motto),1)])):A("",!0),a("div",Ze,[a("h5",Je,[r(l,{class:"clan-preview-details__prop-title-icon",name:"description"}),u(" Описание ")]),n.clan.description?(d(),f("div",{key:0,class:Z(["content-area clan-preview-details__desc",c(v).descExpended?"clan-preview-details__desc--expended":""]),textContent:o(n.clan.description)},null,10,Ke)):A("",!0),r(b,{"is-text":"",class:"clan-preview-details__desc-expend-btn",onClick:w},{default:m(()=>[u(o(c(v).descExpended?"Свернуть":"Развернуть"),1)]),_:1})]),n.clan.motto?(d(),f("div",Qe,[a("h5",Xe,[r(l,{class:"clan-preview-details__prop-title-icon",name:"info"}),u(" Информация ")]),a("div",Ye,[a("div",et,[tt,n.clan.creator_id?(d(),P(g,{key:0,class:"link",to:n.clan.creator_id?{name:"account-id",params:{id:n.clan.creator_id}}:{}},{default:m(()=>[u(o(n.clan.creator_name),1)]),_:1},8,["to"])):(d(),f(O,{key:1},[u(" Не известен ")],64))]),a("div",at,[nt,u(" "+o(s.$formatter.date.toDate(n.clan.created_at*1e3)),1)]),a("div",st,[lt,u(" "+o(s.$formatter.date.toDate(n.clan.updated_at*1e3)),1)]),a("div",it,[ot,u(" "+o(s.$formatter.number.toInteger(n.clan.members_count)),1)]),n.clan.old_tag?(d(),f("div",ct,[rt,u(" ["+o(n.clan.old_tag)+"] "+o(n.clan.old_name),1)])):A("",!0)])])):A("",!0),a("div",_t,[a("h5",dt,[r(l,{class:"clan-preview-details__prop-title-icon",name:"person-search"}),u(" Рекрутинг ")]),a("div",ut,[a("div",mt,[pt,u(" "+o(s.$formatter.clan.recruitingPolicy(n.clan.recruiting_policy))+". ",1)]),n.clan.recruiting_policy==="open"&&n.clan.recruiting_options?(d(),f(O,{key:0},[vt,a("div",ft,[ht,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.average_battles_per_day)),1)]),a("div",bt,[gt,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.battles)),1)]),a("div",wt,[yt,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.average_damage)),1)]),a("div",$t,[kt,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.vehicles_level)),1)]),a("div",Ct,[Dt,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.wins_ratio))+"% ",1)])],64)):A("",!0)])])])]),_:1},8,["title"])}}}),Bt={class:"clan-preview"},At={class:"clan-preview__inner"},Pt={class:"clan-preview__emblem"},jt={class:"clan-preview__info"},Rt={class:"clan-preview__title"},St={class:"clan-preview__tag"},Ft={class:"clan-preview__name"},Mt={class:"clan-preview__props"},Et={class:"clan-preview__prop"},Ot=a("span",{class:"clan-preview__prop-title"}," Участников ",-1),qt={class:"clan-preview__prop-value"},Tt={class:"clan-preview__prop"},Vt=a("span",{class:"clan-preview__prop-title"}," События ",-1),Lt={class:"clan-preview__prop-value"},Nt={class:"clan-preview__actions"},zt=R({__name:"ClanPreview",props:{clan:{type:Object,default:()=>({}),required:!0},hideDescription:{type:[Boolean,String],default:!1},loading:{type:Boolean,default:!1}},setup(n){const h=n,e=H(null),p=le(),v=V({isFavorite:!1});te(()=>{C()});async function C(){const i=await E.indexedDB.clansFavorites.get(h.clan.clan_id);v.isFavorite=i?i==null?void 0:i.isFavorite:!1}async function $(){h.clan&&(v.isFavorite=!v.isFavorite,await E.indexedDB.clansFavorites.set(h.clan.clan_id,{id:h.clan.clan_id,isFavorite:v.isFavorite}))}async function D(){await de(`${h.clan.tag}/${h.clan.clan_id}`)?p.add({type:"success",title:"Скопировано",message:`${h.clan.tag}/${h.clan.clan_id}`,duration:3e3}):p.add({type:"error",message:"Клан копировании что-то пошло не так",duration:3e3})}function w(){var i;(i=e.value)==null||i.open()}function s(){$()}return(i,l)=>{const b=L,g=W,y=ae,I=xt;return d(),f("div",Bt,[a("div",At,[a("div",Pt,[r(pe,{class:"clan-preview__emblem-img",alt:n.clan.name,emblem:n.clan.emblem_set_id},null,8,["alt","emblem"])]),a("div",jt,[a("div",Rt,[a("span",St,"["+o(n.clan.tag??"...")+"]",1),a("span",Ft,o(n.clan.name??"..."),1)]),a("div",Mt,[a("div",Et,[Ot,a("span",qt,o(n.clan.members_count??"---"),1)]),a("div",Tt,[Vt,a("span",Lt,[oe(i.$slots,"events")])])])]),a("div",Nt,[r(g,{"is-text":"",class:"clan-preview__actions-btn",title:"Копировать (nickname/ID)",onClick:D},{default:m(()=>[r(b,{name:"content-copy"})]),_:1}),r(g,{"is-text":"",class:"clan-preview__actions-btn",title:"Добавить в избранные",onClick:s},{default:m(()=>[c(v).isFavorite?(d(),P(b,{key:0,name:"star"})):(d(),P(b,{key:1,name:"star-border"}))]),_:1}),r(g,{"is-text":"",class:"clan-preview__actions-btn",title:"Полная информация",onClick:w},{default:m(()=>[r(b,{name:"info"})]),_:1})])]),r(y,{loading:n.loading},null,8,["loading"]),r(I,{ref_key:"previewDetailsRef",ref:e,clan:n.clan},null,8,["clan"])])}}}),Ut={class:"clan-view-filters"},Wt={class:"clan-view-filters__list"},Gt={class:"clan-view-filters__item clan-view-filters__item--search"},Ht=a("div",{class:"clan-view-filters__item-title"}," Поиск в клане ",-1),Zt={class:"clan-view-filters__item"},Jt=a("div",{class:"clan-view-filters__item-title"}," Дней в клане ",-1),Kt={class:"clan-view-filters__item"},Qt=a("div",{class:"clan-view-filters__item-title"}," Дней отсутствовал ",-1),Xt=R({__name:"ClanViewFilter",props:{filters:{type:Object,required:!0,default:S.makeClanFilters}},emits:["filters-change"],setup(n,{emit:h}){const e=n,p=[{value:null,label:"Не выбрано"},{value:"<3",label:"Меньше чем 3"},{value:"<5",label:"Меньше чем 5"},{value:"<7",label:"Меньше чем 7"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],v=[{value:null,label:"Не выбрано"},{value:"<1",label:"Меньше чем 1"},{value:"<3",label:"Меньше чем 3"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],C=h;function $(D,w){C("filters-change",{...e.filters,[D]:w})}return(D,w)=>{const s=fe,i=he;return d(),f("div",Ut,[a("div",Wt,[a("div",Gt,[Ht,r(s,{"model-value":n.filters.search,style:{width:"100%"},placeholder:"Введите ник",type:"search","onUpdate:modelValue":w[0]||(w[0]=l=>$("search",l))},null,8,["model-value"])]),a("div",Zt,[Jt,r(i,{"model-value":n.filters.joinedAtDays,style:{width:"150px"},options:p,onChange:w[1]||(w[1]=l=>$("joinedAtDays",l))},null,8,["model-value"])]),a("div",Kt,[Qt,r(i,{"model-value":n.filters.lastBattleDays,style:{width:"150px"},options:v,onChange:w[2]||(w[2]=l=>$("lastBattleDays",l))},null,8,["model-value"])])])])}}}),Yt={class:"clan-view-table"},ea={class:"clan-view-table__total"},ta={class:"clan-view-table__total-value"},aa={class:"clan-view-table__member"},na=["title"],sa={key:0,class:"clan-view-table__name clan-view-table__name--deleted"},la={class:"clan-view-table__sub"},ia={class:"clan-view-table__sub"},oa={class:"clan-view-table__sub"},ca={class:"clan-view-table__sub"},ra={class:"clan-view-table__sub"},_a={class:"clan-view-table__sub"},da=R({__name:"ClanViewMembersTable",props:{members:{type:Array,default:()=>[],required:!0},savedMembers:{type:Array,default:()=>[],required:!0},users:{type:Array,default:()=>[],required:!0},sort:{type:Object,default:()=>({}),required:!0}},emits:["sort"],setup(n,{emit:h}){const e=n,p=h,v=[{key:"account_name",label:"Ник",sortable:!0},{key:"battles",label:"Боёв",sortable:!0,sortMethod(s,i){return s.statistic.all.battles-i.statistic.all.battles}},{key:"winRate",label:"Побед",sortable:!0,sortMethod(s,i){return s.statistic.all.winRate-i.statistic.all.winRate}},{key:"damagePerBattle",label:"Урон",sortable:!0,sortMethod(s,i){return s.statistic.all.damagePerBattle-i.statistic.all.damagePerBattle}},{key:"rating",label:"Рейтинг",sortable:!0,sortMethod(s,i){var g,y;const l=((g=s.statistic.rating)==null?void 0:g.rating)??0,b=((y=i.statistic.rating)==null?void 0:y.rating)??0;return l-b}},{key:"battlesPerDay",label:"Боёв в день",sortable:!0},{key:"last_battle_time",label:"Последний бой",sortable:!0},{key:"joined_at",label:"В клане",sortable:!0}],C=j(()=>e.members.map(s=>{const i=e.savedMembers.find(y=>y.account_id===s.account_id),l=i?T.diff(s.statistic.all,i.statistic.all):null,b=T.battlesPerDay({createAt:s.create_at*1e3,battles:s.statistic.all.battles}),g=i?T.battlesPerDay({createAt:i.create_at,battles:(l==null?void 0:l.battles)||0})-b:null;return{...s,battlesPerDay:b,battlesPerDayDiff:g,diff:l}}));function $(s){const i=e.users.find(l=>l.id===s.account_id);return i?{found:!0,online:Date.now()-new Date(i.visitedAt).valueOf()<1e3*60*5}:{found:!1,online:!1}}function D(s){const i=s;return/^del_\d+$/.test(i.account_name)||!i.last_battle_time}function w(s,i){const l=i;return l.diff?s==="winRate"?K.number.toFloatNumber(l.diff[s],!0):K.number.toInteger(l.diff[s],!0):"---"}return(s,i)=>{const l=be,b=L,g=G,y=ge,I=we,F=ye;return d(),f("div",Yt,[a("div",ea,[u(" Кол-во: "),a("span",ta,o(c(C).length||0),1)]),c(C)?(d(),P(F,{key:0,data:c(C),"default-sort":n.sort,headers:v,"no-wrap":"","scroll-auto-disabling":"","row-key":"account_id",height:"calc(100vh - 112px)",class:"clan-view-table__table",onSort:i[0]||(i[0]=t=>p("sort",t))},{account_name:m(({row:t})=>[a("span",aa,[a("span",{class:Z(["clan-view-table__role",["clan-view-table__role--"+t.role,$(t).found?"clan-view-table__role--is-user":"",$(t).online?"clan-view-table__role--is-online":""]]),title:s.$formatter.clan.role(t.role)??"Не известна"},[t.role?(d(),P(l,{key:0,width:"18",height:"18",class:"clan-view-table__role-icon",role:t.role},null,8,["role"])):(d(),P(b,{key:1,style:{width:"16px",color:"var(--color-text-light)"},name:"close"}))],10,na),D(t)?(d(),f("span",sa,o(t.account_name),1)):(d(),P(g,{key:1,class:"link clan-view-table__name",to:{name:"account-id",params:{id:t.account_id}}},{default:m(()=>[u(o(t.account_name),1)]),_:2},1032,["to"]))])]),battles:m(({row:t})=>[u(o(t.statistic.all.battles||"---")+" ",1),a("span",la,o(w("battles",t)||"---"),1)]),winRate:m(({row:t})=>[r(y,{"model-value":t.statistic.all.winRate,class:"clan-view-table__win-rate"},null,8,["model-value"]),a("span",ia,o(w("winRate",t)||"---"),1)]),rating:m(({row:t})=>[r(I,{rating:t.statistic.rating},null,8,["rating"])]),damagePerBattle:m(({row:t})=>[u(o(t.statistic.all.damagePerBattle||"---")+" ",1),a("span",oa,o(w("damagePerBattle",t)),1)]),battlesPerDay:m(({row:t})=>[u(o(t.battlesPerDay||"---")+" ",1),a("span",ca,o(s.$formatter.number.toInteger(t.battlesPerDayDiff,!0)||"---"),1)]),last_battle_time:m(({row:t})=>[u(o(s.$formatter.date.toRelativeTime(t.last_battle_time*1e3)||"---")+" ",1),a("span",ra,o(s.$formatter.date.toDateTime(t.last_battle_time*1e3)||"---"),1)]),joined_at:m(({row:t})=>[u(o(s.$formatter.date.toDaysPassed(t.joined_at*1e3)||"---")+" ",1),a("span",_a,o(s.$formatter.date.toDate(t.joined_at*1e3)||"---"),1)]),_:1},8,["data","default-sort"])):A("",!0)])}}}),ua={key:0,class:"clan-page"},ma={key:1,class:"clan-page--no-data"},pa={key:0,class:"content-area"},va=a("p",null,"Нет данных.",-1),fa=a("p",null,"Возможно клан удалён.",-1),ha=[va,fa],za=R({__name:"[id]",setup(n){const h=ce(),e=V({loading:0,users:[],clanInfo:null,clan:null,filters:S.makeClanFilters(),statisticsSum:null,savedMembers:[],savedClan:null,metricsItems:[],clanSavedAt:0}),p=V({order:"desc",prop:""}),v=j(()=>{var t;return((t=e.clan)==null?void 0:t.members)||[]}),C=j(()=>{let t=v.value.filter(k=>{const B=k.account_name.toLowerCase(),M=e.filters.search.toLowerCase();return B.includes(M)});const _=Date.now(),x=1e3*60*60*24;if(e.filters.joinedAtDays){const k=S.parseParameter(e.filters.joinedAtDays);t=v.value.filter(B=>S.executeExpression(_-Number(k.value)*x,B.joined_at*1e3,k.operator))}if(e.filters.lastBattleDays){const k=S.parseParameter(e.filters.lastBattleDays);t=v.value.filter(B=>S.executeExpression(_-Number(k.value)*x,B.last_battle_time*1e3,k.operator))}return t});te(()=>{const t=+h.params.id;t&&i(t)});async function $(t){e.loading++;try{const{data:_}=await z.clan.getAccountInfo({account_id:t.join(",")});return _}catch(_){return q(_,{title:"Получение данных участников клана"}),null}finally{e.loading--}}async function D(t){e.loading++;try{const{data:_}=await z.clan.getInfo({clan_id:t});e.clanInfo=_[t]??null}catch(_){q(_,{title:"Получение данных клана"})}e.loading--}async function w(t){e.loading++;try{const{data:_}=await ke.user.getList({id:t});e.users=_}catch(_){q(_,{title:"Получение данных аккаунта"})}e.loading--}async function s(t){e.loading++;try{const{data:_}=await z.account.getInfo({extra:"statistics.rating",account_id:t.join(",")});return _}catch(_){return q(_,{title:"Получение данных аккаунта"}),null}finally{e.loading--}}async function i(t){if(await D(t),!e.clanInfo)return;const _=await $(e.clanInfo.members_ids);e.clanInfo.members=_,await Promise.all([w(e.clanInfo.members_ids),l(e.clanInfo),g(e.clanInfo)]),e.savedClan||await b(e.clanInfo);const x=await s(e.clanInfo.members_ids);if(!x)return;e.clan=X.clan(e.clanInfo,x);const k=Object.values(x).filter($e);e.statisticsSum=k.reduce((B,M,N)=>N===0?k[0].statistics:T.sumFull(B,M.statistics),{}),e.metricsItems=ue.clan(k,e.statisticsSum),Q.clanMembersDefault(v.value)}async function l(t){e.loading++;const _=[];for(const x in t.members){const k=await E.indexedDB.accountsInfo.get(x);k&&(k.data.created_at=k.timestamp,_.push(X.clanMember(t.members[x],k.data)))}e.savedMembers=_,e.loading--}async function b(t){e.loading++,await E.indexedDB.clansInfo.set(t.clan_id,re(t)),e.savedClan=Y(t),e.clanSavedAt=Date.now(),e.loading--}async function g(t){e.loading++;const _=await E.indexedDB.clansInfo.get(t.clan_id);e.savedClan=(_==null?void 0:_.data)??null,e.clanSavedAt=(_==null?void 0:_.timestamp)??0,e.loading--}function y(t){t.order||Q.clanMembersDefault(v.value)}async function I(){e.clanInfo&&await b(e.clanInfo)}function F(t){console.log(t.search),e.filters=Y(t)}return(t,_)=>{const x=Ee,k=zt,B=ve,M=me,N=Xt,ne=da,se=ae;return c(e).clanInfo?(d(),f("div",ua,[r(B,{identity:"preview"},{default:m(()=>[r(k,{class:"clan-page__preview","hide-description":!0,clan:c(e).clanInfo,loading:c(e).loading>0},_e({_:2},[c(e).clanInfo&&c(e).savedClan?{name:"events",fn:m(()=>[r(x,{clan:c(e).clanInfo,"saved-clan":c(e).savedClan,"saved-at":c(e).clanSavedAt,onReset:I},null,8,["clan","saved-clan","saved-at"])]),key:"0"}:void 0]),1032,["clan","loading"])]),_:1}),r(B,{title:"Статистика",identity:"statistic"},{default:m(()=>[r(M,{loading:c(e).loading>0,items:c(e).metricsItems},null,8,["loading","items"])]),_:1}),r(B,{title:"Участники",identity:"members"},{default:m(()=>[r(N,{class:"clan-page__filters",filters:c(e).filters,onFiltersChange:F},null,8,["filters"]),r(ne,{sort:c(p),users:c(e).users,"saved-members":c(e).savedMembers,members:c(C),onSort:y},null,8,["sort","users","saved-members","members"])]),_:1})])):(d(),f("div",ma,[c(e).loading?A("",!0):(d(),f("div",pa,ha)),r(se,{loading:c(e).loading>0},null,8,["loading"])]))}}});export{za as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./discord.DbDKZSm_.js","./nuxt-icon.CmJtK45D.js","./_plugin-vue_export-helper.DlAUqK2U.js","./entry.ctIX2KUb.js","./nuxt-icon.MfBulapQ.css","./telegram.DqMEzK-U.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
