import{_ as z}from"./z8RK9n7K.js";import{d as j,u as D,a as P,b as E,M as R,l as f,e as V,m as W,s as G,t as y,G as H,f as k,w as i,o as l,j as c,v as m,x as p,p as M,n as O,g as b,q as _,_ as U,y as q}from"./BzQ49_ll.js";import{_ as F}from"./EAeUkgBq.js";import{_ as J}from"./BvAUi8YU.js";import{_ as K}from"./DQ9jL8Ly.js";import{_ as L}from"./ClKgTggm.js";import{c as Q}from"./B4FMxlHh.js";import{n as X}from"./BxBPJGBn.js";import{c as Y}from"./ZnSD-95i.js";import"./DD4asW33.js";import"./CXg2uAHC.js";import"./B3dZcLnw.js";import"./W1n9aEx_.js";import"./B6X_EJD7.js";import"./CBZ5Hpp1.js";import"./Dzhj1Yli.js";import"./Dz0q-Wbl.js";import"./CEk9wgDu.js";import"./BDnRw2QZ.js";import"./AxE_3BVK.js";import"./DlAUqK2U.js";import"./BLT2yTlJ.js";import"./D18XexEg.js";import"./CUW021nm.js";import"./DZCDALHE.js";import"./B4KzezSC.js";const Z={class:"recruiting-page__name"},tt={key:1},Nt=j({__name:"recruitment-solo",setup(at){const{$formatter:h}=D(),x=P();E({title:()=>h.route.getTitle(Q.toString(x.name)??"")});const u=R(),e=f({loading:0,accounts:[],clanAccounts:[]}),o=f({page:1,pageSize:100,total:0});e.loading++;const S=[{label:"#",key:"position",width:40},{label:"Ник",key:"nickname"},{label:"Клан",key:"clan"},{label:"% Побед",key:"win_rate"},{label:"Бои",key:"battles",formatter(t){return _.number.toInteger(t)}},{label:"Урон/Бой",key:"damage_per_battle",formatter(t){return _.number.toInteger(t)}},{label:"Последний бой",key:"last_battle_time",formatter(t){return typeof t=="string"?_.date.toDateTime(t):"---"}}],C=V(()=>e.accounts.map(t=>{var s;const a=(s=e.clanAccounts.find(r=>r.account_id===t.id))==null?void 0:s.clan;return{...t,clan:a}}));W(()=>{d()});async function d(){var t;e.loading--,await B(),(t=e.accounts)!=null&&t.length&&await w(e.accounts.map(a=>a.id))}async function w(t){e.loading++;try{const{data:a}=await G.clan.getAccountInfo({extra:"clan",account_id:t.join(",")});e.clanAccounts=Object.values(a).filter(X)}catch(a){y(a,{title:"Ошибка поучения списка клановых аккаунтов"})}e.loading--}async function B(){var t;e.loading++;try{const a=await H.stat.accounts.getSolo({lastBattleInDays:2,minWinRate:58,minBattles:1e4,minDamagePerBattle:1800,page:o.page,pageSize:o.pageSize});e.accounts=a.data,o.total=(t=a.meta)!=null&&t.hasNext?o.page*o.pageSize+a.data.length:o.page*o.pageSize-1}catch(a){y(a,{title:"Запрос соло игроков"})}e.loading--}async function A(t){await Y(t.nickname)?u.add({type:"success",title:"Скопировано",message:t.nickname,duration:3e3}):u.add({type:"error",message:"При копировании что-то пошло не так",duration:3e3})}function $(t){Object.assign(o,t),d()}return(t,a)=>{const s=z,r=U,v=q,g=F,N=J,I=K,T=L;return l(),k(T,{class:"recruiting-page"},{default:i(()=>[c(I,{class:"recruiting-page__table","row-key":"id",data:b(C),headers:S,"scroll-to-top":"","max-height":"calc(100vh - 70px)"},{position:i(({index:n})=>[m(p(n+1),1)]),win_rate:i(({row:n})=>[c(s,{"win-rate":n.win_rate},null,8,["win-rate"])]),nickname:i(({row:n})=>[M("div",Z,[c(v,{class:"recruiting-page__name-copy","is-text":"",title:"Копировать (nickname)",onClick:et=>A(n)},{default:i(()=>[c(r,{name:"content-copy"})]),_:2},1032,["onClick"]),c(g,{class:"link",to:{name:"account-id",params:{id:n.id}}},{default:i(()=>[m(p(n.nickname),1)]),_:2},1032,["to"])])]),clan:i(({row:n})=>[n.clan?(l(),k(g,{key:0,title:n.clan.name,class:"recruiting-page__clan link",to:{name:"clan-id",params:{id:n.clan.clan_id}}},{default:i(()=>[m(p(n.clan.tag),1)]),_:2},1032,["title","to"])):(l(),O("span",tt,"---"))]),footer:i(()=>[c(N,{pagination:b(o),onChange:$},null,8,["pagination"])]),_:1},8,["data"])]),_:1})}}});export{Nt as default};
