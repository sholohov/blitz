import{_ as S}from"./3lIG1lYq.js";import{d as N,u as D,j as d,c as E,k as T,l as p,m as l,h as i,w as c,f as m,n as f,p as j,s as g,o as _,e as z,t as u,F as A,q as V,_ as q,v as H}from"./DJlEGeV1.js";import{_ as P}from"./BynAauhr.js";import{_ as R}from"./D_bDmjDt.js";import{_ as U}from"./PfUKTOG5.js";import{n as G}from"./BxBPJGBn.js";import{u as L}from"./j8H2iFUT.js";import{_ as M}from"./DqK6BF4J.js";import"./DD4asW33.js";import"./roZIKyQo.js";import"./RPJY7rI9.js";import"./B2ejvlwh.js";import"./BV1GL1vA.js";import"./CpfoCNYP.js";import"./DlAUqK2U.js";const O={class:"clan-favorites-page"},J={class:"clan-favorites-page__inner"},K={class:"clan-favorites-page__name"},_a=N({__name:"favorites",setup(Q){D({title:"Избранное / Кланы"});const t=d({clans:[],favoritesIds:null,loading:0}),o=d({total:0,page:1,pageSize:100}),v=[{key:"tag",label:"Название"},{key:"members_count",align:"center",label:"Уч-ков"},{key:"updated_at",label:"Обновлён",formatter:a=>a&&typeof a=="number"?f.date.toRelativeTime(a*1e3):"---"},{key:"created_at",label:"Создан",formatter:a=>a?f.date.toDate(Number(a)*1e3):"---"},{key:"actions",width:60}],h=E(()=>{const a=o.page*o.pageSize,n=a-o.pageSize;return(t.favoritesIds??[]).slice(n,a)});T(()=>{r()});async function y(a){t.loading++;try{const{data:n}=await j.clan.getInfo({clan_id:a.join(",")});t.clans=Object.values(n).filter(G)??[]}catch(n){L(n,{title:"Получение данных клана"})}t.loading--}async function b(){const{$indexedDB:a}=g(),n=await a.clansFavorites.getAll();t.favoritesIds=(n??[]).filter(s=>s.isFavorite).map(s=>s.id),o.total=t.favoritesIds.length}async function r(){var a;t.favoritesIds||await b(),(a=t.favoritesIds)!=null&&a.length&&await y(h.value)}async function k(a){const{$indexedDB:n}=g();await n.clansFavorites.remove(a),t.clans.length<o.total?t.clans=t.clans.filter(s=>s.clan_id!==a):await r()}async function x(){await r()}return(a,n)=>{const s=S,I=q,$=H,B=P,C=R,F=U;return _(),p("div",O,[n[0]||(n[0]=l("div",{class:"clan-favorites-page__description content-area",style:{"max-width":"800px"}},[l("p",null,' Список кланов добавленных в "Избранные". Данные хранятся в браузере. '),l("p",null,' Добавить в избранное, можно нажав "Звёздочку" превью на странице клана. ')],-1)),l("div",J,[i(C,{"no-wrap":"","scroll-to-top":"","scroll-auto-disabling":"",headers:v,data:m(t).clans,height:"calc(100vh - 112px)"},{tag:c(({row:e})=>[e!=null&&e.tag&&(e!=null&&e.name)?(_(),z(s,{key:0,class:"clan-favorites-page__details link",to:{name:"clan-id",params:{id:e.clan_id}}},{default:c(()=>[i(M,{class:"clan-favorites-page__emblem",alt:e.tag,emblem:e.emblem_set_id},null,8,["alt","emblem"]),l("span",K," ["+u(e.tag)+"] "+u(e.name),1)]),_:2},1032,["to"])):(_(),p(A,{key:1},[V(" Удалён ")],64))]),actions:c(({row:e})=>[i($,{title:"Удалить","is-text":"","is-square":"",onClick:W=>k(e.clan_id)},{default:c(()=>[i(I,{name:"delete"})]),_:2},1032,["onClick"])]),footer:c(()=>[i(B,{pagination:m(o),onChange:x},null,8,["pagination"])]),_:1},8,["data"]),i(F,{loading:m(t).loading>0},null,8,["loading"])])])}}});export{_a as default};
