import{_ as ct}from"./CzIwMopt.js";import{d as H,o as u,n as b,p as n,F as O,B as E,t as _,q as w,s as U,f as R,j as P,c as G,k as Y,l as M,m as j,e as o,g as S,H as K,w as L,b as F,r as ut,z as mt,as as _t,at as dt,au as pt,ab as gt,ak as ft,u as ht,a as bt}from"./CbpaTVLF.js";import{_ as Z}from"./D0bbJ2Al.js";import{_ as yt}from"./CGYFkopd.js";import{_ as Q}from"./BufGgsVL.js";import{_ as vt}from"./B5RtmFoY.js";import{_ as $t}from"./CvmZtYpT.js";import{_ as Tt}from"./BWArym7p.js";import{n as nt}from"./BxBPJGBn.js";import{s as J}from"./C04RlcEn.js";import{_ as wt}from"./gcaCL54F.js";import{d as kt,t as St}from"./SI484xt3.js";import{_ as It}from"./BYsS9vqb.js";import{_ as st}from"./CygPWfd9.js";import{_ as Ct}from"./2hDUhXFL.js";import{_ as At}from"./CTdUBdYB.js";import"./CWJ3BWWI.js";import"./SB0MPsD8.js";import"./DlAUqK2U.js";import"./DSyc53rl.js";import"./CeC760OF.js";import"./DD4asW33.js";import"./BfR1J8Wj.js";import"./CK40c25S.js";import"./D-_bMSkg.js";import"./C_bjtiOT.js";import"./Wb6dze4w.js";import"./Cl8s4ibS.js";import"./BX5NZO3T.js";import"./BnCvvBO_.js";import"./CURRwDO9.js";const xt={key:0,class:"tournaments-stages"},Ot={class:"tournaments-stages__inner"},Rt={class:"tournaments-stages__list"},Gt={class:"tournaments-stages__title"},qt={class:"tournaments-stages__params"},Dt={class:"tournaments-stages__param"},Lt={class:"tournaments-stages__param"},Et={class:"tournaments-stages__param"},Mt={class:"tournaments-stages__param"},jt=H({__name:"TournamentsStages",props:{stages:{type:Array,default:()=>[]}},setup(m){function s(t){const e=U.encyclopedia.tier(t.min_tier),r=U.encyclopedia.tier(t.max_tier);return e===r?e:`${e} - ${r}`}return(t,e)=>m.stages.length?(u(),b("div",xt,[n("div",Ot,[n("ul",Rt,[(u(!0),b(O,null,E(m.stages,r=>(u(),b("li",{key:r.stage_id,class:"tournaments-stages__stage"},[n("div",Gt,_(r.title),1),n("div",qt,[n("div",Dt,[e[0]||(e[0]=n("span",{class:"tournaments-stages__param-title"}," Дата ",-1)),r.start_at?(u(),b(O,{key:0},[w(_(t.$formatter.date.toDateTime(r.start_at*1e3)),1)],64)):(u(),b(O,{key:1},[w(" --- ")],64))]),n("div",Lt,[e[1]||(e[1]=n("span",{class:"tournaments-stages__param-title"}," Система ",-1)),w(" "+_(t.$formatter.tournament.stageType(r.type)),1)]),n("div",Et,[e[2]||(e[2]=n("span",{class:"tournaments-stages__param-title"}," Уровень ",-1)),w(" "+_(s(r)),1)]),n("div",Mt,[e[3]||(e[3]=n("span",{class:"tournaments-stages__param-title"}," Условие ",-1)),w(" до "+_(r.victory_limit)+" побед ",1)])])]))),128))])])])):R("",!0)}}),Nt={class:"tournaments-matches"},Ut={class:"tournaments-matches__filters"},Ft={class:"tournaments-matches__filters-item"},Pt={class:"tournaments-matches__filters-item"},Vt={class:"tournaments-matches__list"},Bt={class:"tournaments-matches__round"},Ht={class:"tournaments-matches__teams"},Wt={class:"tournaments-matches__score"},Xt={class:"tournaments-matches__date"},Yt=H({__name:"TournamentsMatches",props:{stages:{type:Array,default:()=>[],required:!0},tournamentId:{type:Object,default:()=>({}),required:!0}},setup(m){const s=m,t=P({loading:0,matches:[],selectedStage:null,selectedGroup:null}),e=P({page:1,pageSize:25,total:0}),r=G(()=>s.stages.map(i=>({label:i.title,value:i}))),$=G(()=>t.selectedStage?t.selectedStage.groups.map(i=>({label:`Группа ${i.group_order}`,value:i})):[]);Y(()=>{var i;t.selectedStage=I(),t.selectedGroup=((i=t.selectedStage)==null?void 0:i.groups[0])??null,g()});function I(){const i=s.stages.findLast(y=>y.state==="complete");return s.stages.findLast(y=>y.state==="schedule_ready")??i??s.stages[0]}function g(){!t.selectedStage||!t.selectedGroup||f(s.tournamentId,t.selectedStage.stage_id,t.selectedGroup.group_id)}async function f(i,c,y){t.loading++;try{const{data:v,meta:h}=await M.tournaments.getMatches({tournament_id:i,stage_id:c,group_id:y,limit:e.pageSize,page_no:e.page});e.total=h.total,t.matches=v}catch(v){j(v,{title:"Получение списка матчей"})}t.loading--}function C(i){t.selectedStage=i,t.selectedGroup=i.groups[0],e.page=1,g()}function A(i){t.selectedGroup=i,e.page=1,g()}return(i,c)=>{var v;const y=Z;return u(),b("div",Nt,[n("div",Ut,[n("div",Ft,[w(" Этап ("+_(o(e).total??0)+") ",1),S(y,{value:o(t).selectedStage,"id-key":"stage_id",style:{width:"250px"},options:o(r),onChange:C},null,8,["value","options"])]),n("div",Pt,[w(" Группа ("+_(((v=o(t).selectedStage)==null?void 0:v.groups.length)??0)+") ",1),S(y,{value:o(t).selectedGroup,"id-key":"group_id",style:{width:"170px"},options:o($),onChange:A},null,8,["value","options"])])]),n("div",Vt,[(u(!0),b(O,null,E(o(t).matches,h=>(u(),b("div",{key:h.id,class:"tournaments-matches__match"},[n("div",Bt," round: "+_(h.round),1),n("div",Ht,[(u(),b(O,null,E([1,2],x=>n("div",{key:x,class:K(["tournaments-matches__team",["tournaments-matches__team--"]])},[w(_(h[`team_${x}_id`])+" ",1),n("span",Wt,_(h[`team_${x}_score`]||0),1)])),64))]),n("span",Xt,_(i.$formatter.date.toDateTime(h.start_time*1e3)),1)]))),128))])])}}}),zt={class:"tournament-team"},Jt={class:"tournament-team__inner"},Kt={class:"tournament-team__props-list"},Qt={class:"tournament-team__props"},Zt={class:"tournament-team__props"},te={class:"tournament-team__props"},ee={class:"tournament-team__player-list"},ae={key:0,class:"tournament-team__details"},ne={class:"tournament-team__player-name"},se={class:"tournament-team__player-stat"},oe={class:"tournament-team__stat-item"},ie={key:1,class:"tournament-team__empty"},le=H({__name:"TournamentTeam",props:{tournament:{type:Object,default:()=>({}),required:!0},team:{type:Object,default:()=>({}),required:!0}},setup(m){const s=m,t=P({loading:0,players:[],statisticsAll:null});Y(()=>{const g=s.tournament.max_players_count;t.players=Array(g).fill($({})),I()});async function e(g){t.loading++;try{const{data:f}=await M.clan.getAccountInfo({extra:"clan",account_id:g.join(",")});return Object.values(f).filter(nt)}catch(f){return j(f,{title:"Поучение списка клановых аккаунтов"}),[]}finally{t.loading--}}async function r(g){t.loading++;try{const{data:f}=await M.account.getInfo({extra:"statistics.rating",account_id:g.join(",")});return Object.values(f).filter(nt)}catch(f){return j(f,{title:"Поучение списка аккаунтов"}),[]}finally{t.loading--}}function $(g){var A,i,c,y,v,h,x,d;const f=(A=g.account)==null?void 0:A.statistics.all,C=(i=g.account)==null?void 0:i.statistics.rating;return{id:((c=g.player)==null?void 0:c.account_id)??0,name:((y=g.player)==null?void 0:y.name)??"",isOwner:((v=g.player)==null?void 0:v.role)==="owner",clan:(h=g.clanAccount)!=null&&h.clan?{id:g.clanAccount.clan_id,tag:((x=g.clanAccount.clan)==null?void 0:x.tag)??"",name:((d=g.clanAccount.clan)==null?void 0:d.name)??""}:null,statistic:{all:f?J.accountAll(f):null,rating:C?J.accountRating(C):null}}}async function I(){const g=s.team.players.map(c=>c.account_id),[f,C]=await Promise.all([r(g),e(g)]),A=f.reduce((c,y,v)=>v===0?f[0].statistics:J.sumFull(c,y.statistics),{});t.statisticsAll=J.accountAll(A.all,f.length);const i=s.tournament.max_players_count;t.players=Array(i).fill({}).map((c,y)=>{const v=s.team.players[y],h=f.find(d=>d.account_id===(v==null?void 0:v.account_id)),x=C.find(d=>d.account_id===(v==null?void 0:v.account_id));return $({player:v,account:h,clanAccount:x})}).sort(c=>c.isOwner?1:0)}return(g,f)=>{var y,v;const C=vt,A=$t,i=Tt,c=Q;return u(),b("div",zt,[n("div",Jt,[n("div",Kt,[n("div",Qt,[f[0]||(f[0]=n("span",{class:"tournament-team__props-title"},"Статус",-1)),w(" "+_(g.$formatter.tournament.teamStatusDetails(m.team.status)),1)]),n("div",Zt,[f[1]||(f[1]=n("span",{class:"tournament-team__props-title"},"Ср. побед",-1)),S(C,{"win-rate":((y=o(t).statisticsAll)==null?void 0:y.winRate)||0},null,8,["win-rate"])]),n("div",te,[f[2]||(f[2]=n("span",{class:"tournament-team__props-title"},"Ср. боёв",-1)),w(" "+_(g.$formatter.number.toInteger(((v=o(t).statisticsAll)==null?void 0:v.battles)||0)),1)])]),n("ul",ee,[(u(!0),b(O,null,E(o(t).players,(h,x)=>{var d;return u(),b("li",{key:h.id||x,class:"tournament-team__player"},[S(A,{width:"18",height:"18",class:"tournament-team__player-role",role:h.isOwner?"commander":"private"},null,8,["role"]),h.id?(u(),b("div",ae,[n("div",ne,[S(i,{class:"tournament-team__player-link link",to:{name:"account-id",params:{id:h.id}}},{default:L(()=>[w(_(h.name),1)]),_:2},1032,["to"]),h.clan?(u(),F(i,{key:0,class:"tournament-team__player-link link",to:{name:"clan-id",params:{id:h.clan.id}}},{default:L(()=>{var k;return[w(_(`[${(k=h.clan)==null?void 0:k.tag}]`),1)]}),_:2},1032,["to"])):R("",!0)]),n("span",se,[h.statistic.all?(u(),F(C,{key:0,class:"tournament-team__stat-item","win-rate":h.statistic.all.winRate},null,8,["win-rate"])):R("",!0),n("span",oe,_((d=h.statistic.all)==null?void 0:d.battles),1)])])):(u(),b("span",ie," Место свободно "))])}),128))]),S(c,{"backdrop-light":"",loading:o(t).loading>0},null,8,["loading"])])])}}}),re={class:"tournaments-teams"},ce={class:"tournaments-teams__filters"},ue={class:"tournaments-teams__filters-item"},me={class:"tournaments-teams__filters-item"},_e={class:"tournaments-teams__count"},de={class:"tournaments-teams__list"},pe=["onClick"],ge={class:"tournaments-teams__team-description"},fe={class:"tournaments-teams__team-name"},he={class:"tournaments-teams__team-owner"},be={class:"tournaments-teams__team-owner-text"},ye={class:"tournaments-teams__team-count"},ve=H({__name:"TournamentsTeams",props:{tournament:{type:Object,default:()=>({}),required:!0}},setup(m){const s=[null,"confirmed","forming","disqualified"],t=m,e=ut(null),r=P({loading:0,teams:[],currentTeam:null}),$=P({page:1,total:0,pageSize:50}),I=P({status:"confirmed",search:""}),g=s.map(d=>({label:d?U.tournament.teamStatus(d):"Все",value:d})),f=G(()=>$.total>$.page*$.pageSize);Y(()=>{window.addEventListener("scroll",y)}),mt(()=>{window.removeEventListener("scroll",y)});function C(d){var k;return(k=d.players.find(q=>q.role==="owner"))==null?void 0:k.name}const A=kt(i,1e3,{leading:!0});async function i(){await c()}async function c(){r.loading++;try{const{data:d,meta:k}=await M.tournaments.getTeams({tournament_id:t.tournament.tournament_id,limit:$.pageSize,page_no:$.page,...I});$.total=k.total,r.teams.push(...d)}catch(d){j(d,{title:"Получение списка команд"})}r.loading--}function y(){if(!r.teams.length)return;const{scrollTop:d,scrollHeight:k,clientHeight:q}=document.documentElement;r.loading===0&&f.value&&f.value&&d+q>=k-100&&($.page+=1,c())}function v(){$.page=1,r.teams=[],i()}async function h(d=""){I.search=d=d.trim(),!(d.length<2&&d!=="")&&($.page=1,r.teams=[],await A())}function x(d){var k;r.currentTeam=d,(k=e.value)==null||k.doOpen()}return(d,k)=>{var p;const q=Z,W=yt,B=Q,a=le,l=wt;return u(),b("div",re,[n("div",ce,[n("div",ue,[k[0]||(k[0]=w(" Статус ")),S(q,{"model-value":o(I).status,style:{width:"220px"},options:o(g),onChange:v},null,8,["model-value","options"])]),n("div",me,[k[1]||(k[1]=w(" Поиск ")),S(W,{"model-value":o(I).search,type:"search",placeholder:"Введите название команды",style:{width:"300px"},onInput:h},null,8,["model-value"])])]),n("div",_e,[k[2]||(k[2]=n("div",{class:"tournaments-teams__count-title"}," Кол-во: ",-1)),w(" "+_(o($).total||0),1)]),n("div",de,[(u(!0),b(O,null,E(o(r).teams,T=>(u(),b("button",{key:T.team_id,class:"tournaments-teams__team",onClick:D=>x(T)},[n("span",{class:K(["tournaments-teams__status",[T.status?`tournaments-teams__status--${T.status}`:""]])},null,2),n("span",ge,[n("span",fe,_(T.title),1),n("span",he,[n("span",be,_(C(T)),1)])]),n("span",ye,_(T.players.length)+" / "+_(m.tournament.max_players_count),1)],8,pe))),128)),S(B,{loading:o(r).loading>0},null,8,["loading"])]),S(l,{ref_key:"teamDialogRef",ref:e,width:"500px",title:(p=o(r).currentTeam)==null?void 0:p.title},{default:L(()=>[o(r).currentTeam?(u(),F(a,{key:0,tournament:m.tournament,team:o(r).currentTeam},null,8,["tournament","team"])):R("",!0)]),_:1},8,["title"])])}}});function $e(m,s,t){var e=-1,r=m.length;s<0&&(s=-s>r?0:r+s),t=t>r?r:t,t<0&&(t+=r),r=s>t?0:t-s>>>0,s>>>=0;for(var $=Array(r);++e<r;)$[e]=m[e+s];return $}var Te=$e,we=gt,ke=dt,Se=pt,Ie=_t;function Ce(m,s,t){if(!Ie(t))return!1;var e=typeof s;return(e=="number"?ke(t)&&Se(s,t.length):e=="string"&&s in t)?we(t[s],m):!1}var Ae=Ce,xe=St,ot=1/0,Oe=17976931348623157e292;function Re(m){if(!m)return m===0?m:0;if(m=xe(m),m===ot||m===-ot){var s=m<0?-1:1;return s*Oe}return m===m?m:0}var Ge=Re,qe=Ge;function De(m){var s=qe(m),t=s%1;return s===s?t?s-t:s:0}var Le=De,Ee=Te,Me=Ae,je=Le,Ne=Math.ceil,Ue=Math.max;function Fe(m,s,t){(t?Me(m,s,t):s===void 0)?s=1:s=Ue(je(s),0);var e=m==null?0:m.length;if(!e||s<1)return[];for(var r=0,$=0,I=Array(Ne(e/s));r<e;)I[$++]=Ee(m,r,r+=s);return I}var Pe=Fe;const Ve=ft(Pe),Be={class:"tournaments-tables"},He={class:"tournaments-tables__filters"},We={class:"tournaments-tables__filters-item"},Xe={class:"tournaments-tables__filters-item"},Ye={class:"tournaments-tables__stage-state"},ze={key:0,class:"tournaments-tables__table-scroll"},Je={key:0,class:"tournaments-tables__table-round-title"},Ke=["onClick"],Qe={class:"tournaments-tables__table-team-details"},Ze={class:"tournaments-tables__table-team-title"},ta={class:"tournaments-tables__table-team-score"},ea={class:"tournaments-tables__table-team-details"},aa={class:"tournaments-tables__table-team-title"},na=H({__name:"TournamentsTables",props:{tournamentId:{type:[String,Number],default:"",required:!0},stages:{type:Array,default:()=>[],required:!0}},setup(m){const s=m,t=P({loading:0,standings:[],tables:[],matches:[],selectedStage:null,selectedGroup:null,tableOne:[],tableTwo:[],highlightTeamId:null,total:0,standingsTotal:0}),e=G(()=>t.tables.filter(a=>{var l;return a.group_id===((l=t.selectedGroup)==null?void 0:l.group_id)})),r=G(()=>e.value.map(a=>{const l=t.standings.find(p=>a.team_id===p.team_id&&p.group_id===a.group_id);return{...a,wins:(l==null?void 0:l.wins)??0,draws:(l==null?void 0:l.draws)??0,losses:(l==null?void 0:l.losses)??0}})),$=[{key:"position",label:"#",width:40,align:"center"},{key:"name",label:"Команда"},{key:"matches_played",label:"Бои",width:60,align:"center"},{key:"wins",label:"Победы",width:60,align:"center"},{key:"draws",label:"Ничьи",width:60,align:"center"},{key:"losses",label:"Пораж.",width:60,align:"center"},{key:"team_points",label:"Очки",width:60,align:"center"}],I=G(()=>s.stages.map(a=>({label:a.title,value:a,disabled:!["complete","schedule_ready"].includes(a.state)}))),g=G(()=>t.selectedStage?t.selectedStage.groups.map(a=>({label:`Группа ${a.group_order}`,value:a})):[]),f=G(()=>{var a;switch((a=t.selectedStage)==null?void 0:a.state){case"draft":return"Проект создан";case"groups_ready":return"Группы сформированы";case"schedule_ready":return"График построен";case"complete":return"Этап завершён";default:return"..."}});Y(async()=>{var a;t.selectedStage=c(),t.selectedGroup=((a=t.selectedStage)==null?void 0:a.groups[0])??null,await y(),A()});function C(a){var p;const l=(p=t.selectedStage)==null?void 0:p.type;if(l==="SE"){if(a===1)return"Финал";if(a===2)return"Полуфинал";if(a===3)return"Четвертьфинал";if(a===-1)return"Матч за третье место"}if(l==="DE"){if(a===3)return"Верхняя сетка | Четвертьфинал";if(a===2)return"Верхняя сетка | Полуфинал";if(a===1)return"Верхняя сетка | Финал";if(a===0)return"Гранд-Финал";if(a===-1)return"Нижняя сетка | Финал";if(a===-2)return"Нижняя сетка | Полуфинал";if(a===-3)return"Нижняя сетка | Четвертьфинал"}return""}function A(){t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.matches.forEach(a=>{const l=t.tables.find(D=>D.team_id===a.team_1_id),p=t.tables.find(D=>D.team_id===a.team_2_id);if(!l||!p)return;const T={...a,teams:[l,p]};a.round===3&&t.tableOne[0].push(T),a.round===2&&t.tableOne[1].push(T),a.round===1&&t.tableOne[2].push(T),a.round===-3&&t.tableTwo[0].push(T),a.round===-2&&t.tableTwo[1].push(T),a.round===-1&&t.tableTwo[2].push(T),a.round===0&&t.tableTwo[3].push(T)})}function i(a,l){return l.team_id===a.winner_team_id}function c(){const a=s.stages.findLast(p=>p.state==="schedule_ready"),l=s.stages.findLast(p=>p.state==="complete");return a??l??s.stages[0]}async function y(){var p,T,D;const a=(p=t.selectedStage)==null?void 0:p.stage_id,l=(T=t.selectedGroup)==null?void 0:T.group_id;!a||!l||(await d({tournament_id:s.tournamentId,group_id:l,stage_id:a}),((D=t.selectedStage)==null?void 0:D.type)==="RR"?await h({tournament_id:s.tournamentId,team_id:e.value.map(z=>z.team_id).join(",")}):await v({tournament_id:s.tournamentId,group_id:l,stage_id:a}))}async function v(a){t.loading++;try{const{data:l}=await M.tournaments.getMatches({...a,limit:25});t.matches=l}catch(l){j(l,{title:"Получение матчей"})}t.loading--}async function h(a){const l=Ve(String(a.team_id).split(","),10);for(const p of l)await x({...a,team_id:p.join(",")})}async function x(a){t.loading++;try{const{data:l,meta:p}=await M.tournaments.getStandings({...a,limit:25});t.standings.push(...l),t.standingsTotal=p.total}catch(l){j(l,{title:"Получение результатов команд"})}t.loading--}async function d(a){let l=1;const p=25,T=async()=>{await k({...a,page_no:l,limit:p}),t.total>l*p&&(l++,await T())};await T()}async function k(a){t.loading++;try{const{data:l,meta:p}=await M.tournaments.getTables(a);t.tables.push(...l),t.total=p.total}catch(l){j(l,{title:"Получение турнирной сетки"})}t.loading--}async function q(a){t.selectedStage=a,t.selectedGroup=a.groups[0],t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.standings=[],t.tables=[],t.matches=[],await y(),t.selectedStage.type!=="RR"&&A()}async function W(a){t.selectedGroup=a,t.selectedStage&&(t.selectedStage.type==="RR"?(t.standings=[],await h({tournament_id:s.tournamentId,team_id:e.value.map(l=>l.team_id).join(",")})):(t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.matches=[],await v({tournament_id:s.tournamentId,group_id:a.group_id,stage_id:t.selectedStage.stage_id}),A()))}function B(a){t.highlightTeamId=a.team_id}return(a,l)=>{var z,tt;const p=Z,T=It,D=Q;return u(),b("div",Be,[n("div",He,[n("div",We,[w(" Этап ("+_(o(t).total??0)+") ",1),S(p,{"model-value":o(t).selectedStage,"id-key":"stage_id",style:{width:"250px"},options:o(I),disabled:!o(I).length,onChange:q},null,8,["model-value","options","disabled"])]),n("div",Xe,[w(" Группа ("+_(((z=o(t).selectedStage)==null?void 0:z.groups.length)??"---")+") ",1),S(p,{"model-value":o(t).selectedGroup,"id-key":"group_id",style:{width:"170px"},disabled:!o(g).length,options:o(g),onChange:W},null,8,["model-value","disabled","options"])])]),n("div",Ye,[l[0]||(l[0]=n("span",{class:"tournaments-tables__stage-state-label"}," Состояние этапа ",-1)),w(" "+_(o(f)),1)]),((tt=o(t).selectedStage)==null?void 0:tt.type)!=="RR"?(u(),b("div",ze,[(u(!0),b(O,null,E([o(t).tableOne,o(t).tableTwo],(V,et)=>(u(),b("div",{key:et,class:K(["tournaments-tables__table",[`tournaments-tables__table--${et?"bottom":"top"}`]])},[(u(!0),b(O,null,E(V,(it,lt)=>(u(),b("div",{key:lt,class:"tournaments-tables__table-round"},[(u(!0),b(O,null,E(it,(X,rt)=>(u(),b("div",{key:X.id,class:"tournaments-tables__table-battle"},[rt===0?(u(),b("div",Je,_(C(X.round)),1)):R("",!0),(u(!0),b(O,null,E(X.teams,(N,at)=>(u(),b("button",{key:at,class:K(["tournaments-tables__table-team",[i(X,N)?"tournaments-tables__table-team--is-winner":"",N.team_id===o(t).highlightTeamId?"tournaments-tables__table-team--is-highlight":""]]),onClick:ba=>B(N)},[n("span",Qe,[S(st,{class:"tournaments-tables__table-team-clan-emblem",alt:N.clan_label,emblem:N.clan_emblem_preset_id},null,8,["alt","emblem"]),n("span",Ze,[N.clan_label?(u(),b(O,{key:0},[w(" ["+_(N.clan_label)+"] ",1)],64)):R("",!0),w(" "+_(N.title),1)])]),n("span",ta,_(X[`team_${at+1}_score`]??"-"),1)],10,Ke))),128))]))),128))]))),128))],2))),128))])):(u(),F(T,{key:1,"no-wrap":"","scroll-auto-disabling":"","row-key":"account_id",height:"calc(100vh - 112px)",headers:$,data:o(r)},{name:L(({row:V})=>[n("div",ea,[S(st,{class:"tournaments-tables__table-team-clan-emblem",alt:V.clan_label,emblem:V.clan_emblem_preset_id},null,8,["alt","emblem"]),n("span",aa,[V.clan_label?(u(),b(O,{key:0},[w(" ["+_(V.clan_label)+"] ",1)],64)):R("",!0),w(" "+_(V.title),1)])])]),_:1},8,["data"])),S(D,{loading:o(t).loading>0},null,8,["loading"])])}}}),sa={key:0,class:"tournaments-info-page__inner"},oa={class:"tournaments-info-page__header"},ia={class:"tournaments-info-page__details"},la={class:"tournaments-info-page__title"},ra={class:"tournaments-info-page__props"},ca={class:"tournaments-info-page__prop"},ua={class:"tournaments-info-page__prop-title"},ma={class:"tournaments-info-page__props"},_a={class:"tournaments-info-page__prop"},da={class:"tournaments-info-page__body"},pa=["textContent"],ga={class:"tournaments-info-page__body"},fa={class:"tournaments-info-page__body"},ha={class:"tournaments-info-page__body"},Ja=H({__name:"[id]",setup(m){const s=ht(),t=bt(),e=P({loading:0,tournament:null,stages:[],activeTab:"info"}),r=G(()=>{var c,y;const i=[{label:"Описание",name:"info"},{label:"Команды",name:"teams",disabled:((c=e.tournament)==null?void 0:c.status)==="upcoming"}];return e.stages.length&&i.push({label:"Сетка",name:"tables",disabled:!["running","finished","complete"].includes(((y=e.tournament)==null?void 0:y.status)??"")}),i}),$=G(()=>{var i;switch((i=e.tournament)==null?void 0:i.status){case"upcoming":return{title:"Начало регистрации",date:U.date.toDateTime(e.tournament.registration_start_at*1e3)};case"registration_started":return{title:"Окончание регистрации",date:U.date.toDateTime(e.tournament.registration_end_at*1e3)};case"registration_finished":return{title:"Начало мачей",date:U.date.toDateTime(e.tournament.matches_start_at*1e3)};case"running":return{title:"Завершение",date:U.date.toDateTime(e.tournament.end_at*1e3)};case"finished":case"complete":return{title:"Завершен",date:U.date.toDateTime(e.tournament.end_at*1e3)}}return{title:"---",date:"---"}});Y(async()=>{var c;const i=(c=s.query)==null?void 0:c.activeTab;C(i||r.value[0].name),await I()});async function I(){const i=s.params.id;i&&await Promise.all([g(i),f(i)])}async function g(i){e.loading++;try{const{data:c}=await M.tournaments.getInfo({tournament_id:i});e.tournament=c[i]??null}catch(c){j(c,{title:"Получение информации турнира"})}e.loading--}async function f(i){e.loading++;try{const{data:c}=await M.tournaments.getStages({tournament_id:i});e.stages=c??[]}catch(c){j(c,{title:"Получение этапов турнира"})}e.loading--}function C(i){var c;e.activeTab=i,((c=s.query)==null?void 0:c.activeTab)!==i&&t.replace({query:{...s.query,activeTab:i}})}function A({name:i}){C(i)}return(i,c)=>{const y=ct,v=jt,h=Yt,x=ve,d=na,k=Ct,q=Q,W=At;return u(),F(W,{class:"tournaments-info-page"},{default:L(()=>{var B,a,l,p;return[o(e).tournament?(u(),b("div",sa,[n("div",oa,[S(y,{src:o(e).tournament.logo.original,alt:"Tournament IMG",class:"tournaments-info-page__img"},null,8,["src"]),n("div",ia,[n("h1",la,_((B=o(e).tournament)==null?void 0:B.title),1),n("div",ra,[n("div",ca,[n("div",ua,_(o($).title),1),w(" "+_(o($).date),1)])]),n("div",ma,[n("div",_a,[c[1]||(c[1]=n("div",{class:"tournaments-info-page__prop-title"}," Команд ",-1)),w(" "+_(((a=o(e).tournament)==null?void 0:a.teams.confirmed)||0)+" / "+_(((l=o(e).tournament)==null?void 0:l.teams.total)||0)+" / "+_(((p=o(e).tournament)==null?void 0:p.teams.max)||0),1)])])])]),S(k,{modelValue:o(e).activeTab,"onUpdate:modelValue":c[0]||(c[0]=T=>o(e).activeTab=T),tabs:o(r),onTabClick:A},{info:L(()=>[n("div",da,[o(e).stages.length?(u(),F(v,{key:0,stages:o(e).stages,class:"tournaments-info-page__stages","tournament-id":o(e).tournament.tournament_id},null,8,["stages","tournament-id"])):R("",!0),n("div",{class:"tournaments-info-page__description",textContent:_(o(e).tournament.description)},null,8,pa)])]),matches:L(()=>[n("div",ga,[o(e).stages.length?(u(),F(h,{key:0,stages:o(e).stages,"tournament-id":o(e).tournament.tournament_id},null,8,["stages","tournament-id"])):R("",!0)])]),teams:L(()=>[n("div",fa,[S(x,{tournament:o(e).tournament},null,8,["tournament"])])]),tables:L(()=>[n("div",ha,[o(e).stages.length?(u(),F(d,{key:0,"tournament-id":o(e).tournament.tournament_id,stages:o(e).stages},null,8,["tournament-id","stages"])):R("",!0)])]),_:1},8,["modelValue","tabs"])])):R("",!0),S(q,{loading:o(e).loading>0},null,8,["loading"])]}),_:1})}}});export{Ja as default};
