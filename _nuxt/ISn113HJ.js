import{d as U,o as g,l as w,m as e,h as s,t as C,M as yt,_ as G,x as K,y as L,F as I,B as E,w as i,E as N,c as F,j as q,f as r,T as wt,A as Z,q as T,v as tt,N as $t,s as Vt,u as Tt,r as M,k as Ct,g as j,e as W}from"./DJlEGeV1.js";import{_ as Bt}from"./DWPY84V0.js";import{_ as et}from"./B2ejvlwh.js";import{_ as J,a as H,b as at}from"./MfvBAw4a.js";import{_ as st}from"./rxWbx8Xz.js";import{_ as xt}from"./y4O4U22S.js";import{_ as Rt}from"./D_bDmjDt.js";import{_ as Pt}from"./CIh7AwxB.js";import{_ as St}from"./DhLB81g5.js";import{_ as Ut}from"./D-TuSGJo.js";import{_ as Mt}from"./UkAV1zrn.js";import{_ as nt}from"./pQ9QSYKp.js";import{_ as It}from"./C8Fhmymt.js";import{s as B}from"./CqK7YKqf.js";import{u as Dt}from"./C1V66jBN.js";import{u as Ot}from"./btAca64B.js";import{c as Y}from"./BE0zBel4.js";import"./BV1GL1vA.js";import"./CpfoCNYP.js";import"./DlAUqK2U.js";import"./DD4asW33.js";import"./RPJY7rI9.js";const jt={class:"hand-statistic-tank-preview__img-wrapper"},Nt={class:"hand-statistic-tank-preview__description"},qt={class:"hand-statistic-tank-preview__description-tank"},Et={class:"hand-statistic-tank-preview__name"},Ht={class:"hand-statistic-tank-preview__name-text"},zt={class:"hand-statistic-tank-preview__description-tank"},At={class:"hand-statistic-tank-preview__props"},Wt={class:"hand-statistic-tank-preview__prop"},Ft={class:"hand-statistic-tank-preview__prop-value"},Gt={class:"hand-statistic-tank-preview__prop"},Kt={class:"hand-statistic-tank-preview__prop-value"},Lt={class:"hand-statistic-tank-preview__prop"},Jt={class:"hand-statistic-tank-preview__prop-value"},Qt=U({__name:"HandStatisticTankPreview",props:{tank:{type:Object,default:()=>({}),required:!0}},setup(p){return(l,o)=>{const y=et,c=H,b=G,v=st;return g(),w("div",yt({class:"hand-statistic-tank-preview"},l.$attrs),[e("div",jt,[s(y,{class:"hand-statistic-tank-preview__nation-img",src:`/img/nations/nation-${p.tank.nation}.svg`,alt:p.tank.nation},null,8,["src","alt"]),s(y,{class:"hand-statistic-tank-preview__tank-img",src:p.tank.images.preview,alt:p.tank.name},null,8,["src","alt"]),s(J,{class:"hand-statistic-tank-preview__tier",tier:p.tank.tier},null,8,["tier"])]),e("div",Nt,[e("div",qt,[e("div",Et,[s(c,{type:p.tank.type,class:"hand-statistic-tank-preview__type","is-premium":p.tank.is_premium,"is-collectible":p.tank.is_collectible},null,8,["type","is-premium","is-collectible"]),e("span",Ht,C(p.tank.name??`Tank ID: ${p.tank.tank_id}`),1)])]),e("div",zt,[e("div",At,[e("span",Wt,[s(b,{name:"sword-cross",size:"18"}),e("span",Ft,C(l.$formatter.number.toInteger(p.tank.stat.battles)),1)]),e("span",Gt,[s(b,{name:"flag-variant",size:"18"}),e("span",Kt,[s(v,{"win-rate":p.tank.stat.winRate},null,8,["win-rate"])])]),e("span",Lt,[s(b,{name:"destruction",size:"18"}),e("span",Jt,C(l.$formatter.number.toInteger(p.tank.stat.damagePerBattle)),1)])])])])],16)}}}),Xt=U({__name:"NationSelect",props:K({noWrap:{type:Boolean,default:!1,required:!1}},{modelValue:{required:!0,default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(p){const l=L(p,"modelValue"),o=["ussr","germany","usa","uk","japan","china","france","european","other"];function y(c,b){b?l.value.push(c):l.value=[...l.value.filter(v=>v!==c)]}return(c,b)=>{const v=at,V=nt;return g(),w("div",{class:N(["nation-select",[p.noWrap?"nation-select--no-wrap":""]])},[(g(),w(I,null,E(o,n=>{var u;return s(V,{key:n,"model-value":!!((u=l.value)!=null&&u.includes(n)),onChange:k=>y(n,k)},{default:i(()=>[s(v,{nation:n},null,8,["nation"])]),_:2},1032,["model-value","onChange"])}),64))],2)}}}),Yt=U({__name:"TypeSelect",props:K({noWrap:{type:Boolean,default:!1,required:!1}},{modelValue:{required:!0,default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(p){const l=L(p,"modelValue"),o=["lightTank","mediumTank","heavyTank","AT-SPG"];function y(c,b){b?l.value.push(c):l.value=[...l.value.filter(v=>v!==c)]}return(c,b)=>{const v=H,V=nt;return g(),w("div",{class:N(["type-select",[p.noWrap?"type-select--no-wrap":""]])},[(g(),w(I,null,E(o,n=>{var u;return s(V,{key:n,"model-value":!!((u=l.value)!=null&&u.includes(n)),onChange:k=>y(n,k)},{default:i(()=>[s(v,{type:n},null,8,["type"])]),_:2},1032,["model-value","onChange"])}),64))],2)}}}),Zt={class:"hand-statistic-tank-select"},te={class:"hand-statistic-tank-select__filters"},ee={class:"hand-statistic-tank-select__filters-item"},ae={class:"hand-statistic-tank-select__filters-item"},se={class:"hand-statistic-tank-select__filters-item"},ne=["onClick"],ie={class:"hand-statistic-tank-select__item-details"},le={class:"hand-statistic-tank-select__item-props"},oe=U({__name:"HandStatisticTankSelect",props:{items:{type:Object,default:()=>({}),required:!0},exclude:{type:Array,default:()=>[],required:!1}},emits:["select"],setup(p,{emit:l}){const o=p,y=F(()=>Object.values(o.items).sort((u,k)=>k.tier-u.tier).filter(u=>[!u.name.startsWith("#"),!o.exclude.includes(u.tank_id),c.tiers.length?c.tiers.includes(u.tier):!0,c.types.length?c.types.includes(u.type):!0,c.nations.length?c.nations.includes(u.nation):!0].every(k=>k))),c=q({tiers:[],types:[],nations:[]}),b=l;function v(u){let k="standard";return u.is_premium&&(k="premium"),u.is_collectible&&(k="collectible"),k}function V(u){b("select",u)}function n(u){return o.exclude.includes(u.tank_id)}return(u,k)=>{const R=Mt,$=Xt,P=Yt,f=et,S=at,z=H,A=J;return g(),w("div",Zt,[e("div",te,[e("div",ee,[s(R,{modelValue:r(c).tiers,"onUpdate:modelValue":k[0]||(k[0]=h=>r(c).tiers=h),"no-wrap":""},null,8,["modelValue"])]),e("div",ae,[s($,{modelValue:r(c).nations,"onUpdate:modelValue":k[1]||(k[1]=h=>r(c).nations=h),"no-wrap":""},null,8,["modelValue"])]),e("div",se,[s(P,{modelValue:r(c).types,"onUpdate:modelValue":k[2]||(k[2]=h=>r(c).types=h),"no-wrap":""},null,8,["modelValue"])])]),s(wt,{tag:"div",name:"hand-statistic-tank-select__item-",class:"hand-statistic-tank-select__list"},{default:i(()=>[(g(!0),w(I,null,E(r(y),h=>(g(),w("div",{key:h.tank_id,role:"button","aria-pressed":"false",class:N(["hand-statistic-tank-select__item",[n(h)?"hand-statistic-tank-select__item--excluded":""]]),tabindex:"0",onClick:Q=>V(h)},[s(f,{class:"hand-statistic-tank-select__item-img",alt:h.name,src:h.images.preview},null,8,["alt","src"]),e("div",ie,[e("div",{class:N(["hand-statistic-tank-select__item-name",`hand-statistic-tank-select__item-name--${v(h)}`])},C(h.name),3),e("div",le,[s(S,{size:"18",nation:h.nation},null,8,["nation"]),s(z,{size:"24",type:h.type},null,8,["type"]),s(A,{tier:h.tier},null,8,["tier"])])])],10,ne))),128))]),_:1})])}}}),de={class:"hand-statistic-tank-edit"},ce={class:"hand-statistic-tank-edit__body"},re={class:"hand-statistic-tank-edit__params"},ue={class:"hand-statistic-tank-edit__params-item"},_e={class:"hand-statistic-tank-edit__params"},me={class:"hand-statistic-tank-edit__params-item"},pe={class:"hand-statistic-tank-edit__params"},ke={class:"hand-statistic-tank-edit__params-item"},fe={class:"hand-statistic-tank-edit__params-item"},ve={class:"hand-statistic-tank-edit__params-item"},he={style:{display:"flex","justify-content":"space-between"}},ge=U({__name:"HandStatisticTankEdit",props:{modelValue:{required:!0,default:()=>({})},modelModifiers:{}},emits:K(["close","save"],["update:modelValue"]),setup(p,{emit:l}){const o=L(p,"modelValue"),y=q({damage_dealt:0});Z(()=>[o.value.stat],()=>{const{losses:V,wins:n}=o.value.stat;o.value.stat.battles=V+n,o.value.stat.winRate=B.winRate(o.value.stat),o.value.stat.damagePerBattle=B.damagePerBattle(o.value.stat)},{deep:!0});const c=l;function b(){c("close")}function v(){o.value.stat=B.sum(o.value.stat,y),c("save",o.value)}return(V,n)=>{const u=It,k=G,R=tt;return g(),w("div",de,[e("div",ce,[e("div",re,[n[5]||(n[5]=e("div",{class:"hand-statistic-tank-edit__params-title"}," Информация о технике ",-1)),e("div",ue,[n[4]||(n[4]=e("span",{class:"hand-statistic-tank-edit__params-item-title"}," Название: ",-1)),T(" "+C(o.value.name),1)])]),e("div",_e,[n[7]||(n[7]=e("div",{class:"hand-statistic-tank-edit__params-title"}," Показатели за бой ",-1)),e("div",me,[n[6]||(n[6]=e("span",{class:"hand-statistic-tank-edit__params-item-title"}," Урон: ",-1)),s(u,{modelValue:r(y).damage_dealt,"onUpdate:modelValue":n[0]||(n[0]=$=>r(y).damage_dealt=$),width:"100px",min:"0"},null,8,["modelValue"])])]),e("div",pe,[n[11]||(n[11]=e("div",{class:"hand-statistic-tank-edit__params-title"}," Суммарные показатели ",-1)),e("div",ke,[n[8]||(n[8]=e("span",{class:"hand-statistic-tank-edit__params-item-title"}," Урон: ",-1)),s(u,{modelValue:o.value.stat.damage_dealt,"onUpdate:modelValue":n[1]||(n[1]=$=>o.value.stat.damage_dealt=$),width:"100px",min:"0"},null,8,["modelValue"])]),e("div",fe,[n[9]||(n[9]=e("span",{class:"hand-statistic-tank-edit__params-item-title"}," Побед: ",-1)),s(u,{modelValue:o.value.stat.wins,"onUpdate:modelValue":n[2]||(n[2]=$=>o.value.stat.wins=$),width:"100px",min:"0"},null,8,["modelValue"])]),e("div",ve,[n[10]||(n[10]=e("span",{class:"hand-statistic-tank-edit__params-item-title"}," Пораж.: ",-1)),s(u,{modelValue:o.value.stat.losses,"onUpdate:modelValue":n[3]||(n[3]=$=>o.value.stat.losses=$),width:"100px",min:"0"},null,8,["modelValue"])])])]),e("div",he,[s(R,{onClick:b},{before:i(()=>[s(k,{name:"close"})]),default:i(()=>[n[12]||(n[12]=T(" Отмена "))]),_:1}),s(R,{onClick:v},{before:i(()=>[s(k,{name:"content-save"})]),default:i(()=>[n[13]||(n[13]=T(" Сохранить "))]),_:1})])])}}}),be={class:"hand-statistic-page"},ye={class:"hand-statistic-page__average-list"},we={class:"hand-statistic-page__average-label"},$e={class:"hand-statistic-page__average-value"},Ve={class:"hand-statistic-page__settings"},Te={key:0},Ce={key:0},Be={key:0},xe={class:"hand-statistic-page__table-row"},Re={style:{display:"flex",gap:"10px"}},Pe={class:"hand-statistic-page__params"},Se={class:"hand-statistic-page__param"},Ue={style:{margin:"0 0 0 10px"}},Me={style:{display:"flex","justify-content":"space-between"}},Ie={style:{display:"flex","justify-content":"space-between"}},De={style:{display:"flex","justify-content":"space-between"}},na=U({__name:"hand-statistic",setup(p){$t(a=>({"7cba4658":r(S).bgColorOpacity}));const{$formatter:l,$indexedDB:o}=Vt();Tt({title:[l.route.getTitle("hand-statistic")].join(" - ")});const y=M(),c=M(),b=M(),v=M(),V=Dt(),n=F(()=>V.isMobile),u=F(()=>V.isTablet),k=[{key:"name",label:"Танк",sortable:!0},{key:"battles",label:l.stat.accountProp("battles"),sortable:!0,sortMethod(a,t){const d=a,_=t;return d.stat.battles-_.stat.battles}},{key:"winRate",label:l.stat.accountProp("wins"),sortable:!0,sortMethod(a,t){const d=a,_=t;return d.stat.winRate-_.stat.winRate}},{key:"damagePerBattle",label:l.stat.accountProp("damage_dealt"),sortable:!0,sortMethod(a,t){const d=a,_=t;return d.stat.damagePerBattle-_.stat.damagePerBattle}},{key:"controls",label:"",width:100}],R=[{key:"battles",label:l.stat.accountProp("battles"),sortable:!0,sortMethod(a,t){const d=a,_=t;return d.stat.battles-_.stat.battles}},{key:"winRate",label:l.stat.accountProp("wins"),sortable:!0,sortMethod(a,t){const d=a,_=t;return d.stat.winRate-_.stat.winRate}},{key:"damagePerBattle",label:l.stat.accountProp("damage_dealt"),sortable:!0,sortMethod(a,t){const d=a,_=t;return d.stat.damagePerBattle-_.stat.damagePerBattle}}],$=M([{key:"battles",label:l.stat.accountProp("battles"),value:"0"},{key:"winRate",label:l.stat.accountProp("winRate"),value:"0"},{key:"damagePerBattle",label:l.stat.accountProp("damagePerBattle"),value:"0"}]),P=Ot(),f=q({tanks:[],currentTank:null}),S=q({bgColorOpacity:1});Z(()=>f.tanks,()=>z(),{deep:!0,immediate:!0}),Ct(async()=>{await P.getTanksVehicles();const a=await o.handStatistic.getAll();a==null||a.forEach(t=>{var _;const d=(_=P.vehicles)==null?void 0:_[t.id];d&&f.tanks.push(A(d,t.data))})});function z(){var t;let a={};f.tanks.forEach(d=>{a=B.sum(a,d.stat)}),(t=$.value)==null||t.forEach(d=>{d.key==="battles"&&(d.value=l.number.toInteger(a.battles??0)),d.key==="winRate"&&(d.value=l.number.toFloatPercent(B.winRate(a))),d.key==="damagePerBattle"&&(d.value=l.number.toInteger(B.damagePerBattle(a)))})}function A(a,t){return{...a,stat:{...t,battles:(t.losses||0)+(t.wins||0),winRate:B.winRate(t),damagePerBattle:B.damagePerBattle(t)}}}function h(){var a;(a=y.value)==null||a.doOpen()}function Q(){var a;(a=b.value)==null||a.doOpen()}async function it(a){if(!f.tanks.some(t=>t.tank_id===a.tank_id)){const t=()=>({battles:0,damage_dealt:0,losses:0,wins:0,winRate:0,damagePerBattle:0});await o.handStatistic.set(a.tank_id,t()),f.tanks.push({...a,stat:t()})}}function X(a){var t;f.currentTank=Y(a),(t=c.value)==null||t.doOpen()}async function lt(){var a;await((a=c.value)==null?void 0:a.doClose()),f.currentTank=null}async function ot(a){var _;const t=f.tanks.findIndex(D=>D.tank_id===a.tank_id),d=Y(a);t>=0&&f.tanks.splice(t,1,d),await o.handStatistic.set(a.tank_id,d.stat),await((_=c.value)==null?void 0:_.doClose()),f.currentTank=null}function dt(){var a;(a=v.value)==null||a.doOpen()}function ct(){var a;(a=v.value)==null||a.doClose()}async function rt(){var a;f.tanks.length&&(await o.handStatistic.clear(),f.tanks=[]),(a=v.value)==null||a.doClose()}return(a,t)=>{const d=G,_=tt,D=Bt,ut=Qt,_t=xt,mt=H,pt=J,kt=st,ft=Rt,vt=Pt,ht=St,O=Ut,gt=oe,bt=ge;return g(),w(I,null,[e("div",be,[s(vt,{class:"hand-statistic-page__inner"},{default:i(()=>[s(D,{title:"Средние показатели"},{default:i(()=>[e("div",ye,[(g(!0),w(I,null,E(r($),m=>(g(),w("div",{key:m.key,class:"hand-statistic-page__average-item"},[e("div",we,C(m.label),1),e("div",$e,C(m.value),1)]))),128))]),e("div",Ve,[s(_,{onClick:h},{before:i(()=>[s(d,{name:"add"})]),default:i(()=>[r(n)?j("",!0):(g(),w("span",Te," Добавить танк "))]),_:1}),s(_,{onClick:Q},{before:i(()=>[s(d,{name:"tune"})]),default:i(()=>[r(n)?j("",!0):(g(),w("span",Ce," Настройки "))]),_:1}),s(_,{onClick:dt},{before:i(()=>[s(d,{name:"refresh"})]),default:i(()=>[r(n)?j("",!0):(g(),w("span",Be," Сброс "))]),_:1})])]),_:1}),s(D,{title:"Техника"},{default:i(()=>[r(u)?(g(),W(_t,{key:0,headers:R,data:r(f).tanks},{default:i(({row:m})=>[s(ut,{tank:m,onClick:x=>X(m)},null,8,["tank","onClick"])]),_:1},8,["data"])):(g(),W(ft,{key:1,headers:k,data:r(f).tanks},{name:i(({row:m})=>[e("div",xe,[s(mt,{size:"24",type:m.type},null,8,["type"]),s(pt,{tier:m.tier},null,8,["tier"]),T(" "+C(m.name),1)])]),battles:i(({row:m})=>[T(C(r(l).number.toInteger(m.stat.battles)),1)]),winRate:i(({row:m})=>[s(kt,{"win-rate":m.stat.winRate},null,8,["win-rate"])]),damagePerBattle:i(({row:m})=>[T(C(r(l).number.toInteger(m.stat.damagePerBattle)),1)]),controls:i(({row:m})=>[e("div",Re,[s(_,{onClick:x=>X(m)},{before:i(()=>[s(d,{name:"edit"})]),default:i(()=>[t[4]||(t[4]=T(" Изменить "))]),_:2},1032,["onClick"]),t[5]||(t[5]=e("div",null,null,-1))])]),_:1},8,["data"]))]),_:1})]),_:1})]),s(O,{ref_key:"settingsDialogRef",ref:b,width:"480px",title:"Настройки"},{footer:i(()=>[e("div",Me,[t[8]||(t[8]=e("span",null,null,-1)),s(_,{onClick:t[1]||(t[1]=m=>{var x;return(x=r(b))==null?void 0:x.doClose()})},{default:i(()=>t[7]||(t[7]=[T(" Закрыть ")])),_:1})])]),default:i(()=>[e("div",Pe,[e("div",Se,[t[6]||(t[6]=e("div",{class:"hand-statistic-page__param-title"}," Прозрачность фона показателей ",-1)),s(ht,{modelValue:r(S).bgColorOpacity,"onUpdate:modelValue":t[0]||(t[0]=m=>r(S).bgColorOpacity=m),width:"200px",min:0,max:1,step:.1},null,8,["modelValue"]),e("span",Ue,C(r(l).number.toPercent((r(S).bgColorOpacity||0)*100)),1)])])]),_:1},512),s(O,{ref_key:"addTankDialogRef",ref:y,width:"640px",title:"Добавление танка"},{footer:i(()=>[e("div",Ie,[t[10]||(t[10]=e("span",null,null,-1)),s(_,{onClick:t[2]||(t[2]=m=>{var x;return(x=r(y))==null?void 0:x.doClose()})},{default:i(()=>t[9]||(t[9]=[T(" Закрыть ")])),_:1})])]),default:i(()=>[r(P).vehicles?(g(),W(gt,{key:0,items:r(P).vehicles,exclude:r(f).tanks.map(m=>m.tank_id),onSelect:it},null,8,["items","exclude"])):j("",!0)]),_:1},512),s(O,{ref_key:"editTankDialogRef",ref:c,width:"480px",title:"Изменение показателей"},{default:i(()=>[s(bt,{modelValue:r(f).currentTank,"onUpdate:modelValue":t[3]||(t[3]=m=>r(f).currentTank=m),onClose:lt,onSave:ot},null,8,["modelValue"])]),_:1},512),s(O,{ref_key:"confirmResetDialogRef",ref:v,width:"480px",title:"Сброс сессии"},{footer:i(()=>[e("div",De,[s(_,{onClick:ct},{default:i(()=>t[11]||(t[11]=[T(" Нет ")])),_:1}),s(_,{onClick:rt},{default:i(()=>t[12]||(t[12]=[T(" Да ")])),_:1})])]),default:i(()=>[t[13]||(t[13]=e("div",{class:"content-area"},[e("p",null," Вы уверены? Текущий прогресс будет утерян. ")],-1))]),_:1},512)],64)}}});export{na as default};
