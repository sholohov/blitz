const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./3ZcCzRCL.js","./SB0MPsD8.js","./DlAUqK2U.js","./CbpaTVLF.js","./entry.C2el_uhD.css","./nuxt-icon.Cvbtxq7p.css","./BNxWb-pH.js"])))=>i.map(i=>d[i]);
import{d as E,r as V,c as F,o as m,n as y,p as t,g as _,w as b,x as z,H as K,e as c,_ as W,t as o,F as L,B as J,q as p,f as P,b as j,I as de,J as Z,K as Q,j as T,L as _e,k as le,v as U,M as ue,s as X,u as me,O as ee,l as H,m as M,E as pe,N as ve,G as te,P as fe}from"./CbpaTVLF.js";import{_ as Y}from"./BWArym7p.js";import{_ as ie}from"./gcaCL54F.js";import{_ as be}from"./CygPWfd9.js";import{_ as oe}from"./BufGgsVL.js";import{c as we}from"./ZnSD-95i.js";import{_ as ge}from"./DqZ5VINZ.js";import{m as ae,_ as ye}from"./CAlBEv5y.js";import{_ as he}from"./CGYFkopd.js";import{_ as $e}from"./D0bbJ2Al.js";import{f as O}from"./catDNVfW.js";import{_ as ke}from"./CvmZtYpT.js";import{_ as Ce}from"./B5RtmFoY.js";import{_ as De,m as ne}from"./DK6Y3mmo.js";import{_ as Ie}from"./BYsS9vqb.js";import{s as N}from"./C04RlcEn.js";import{n as xe}from"./BxBPJGBn.js";import"./DD4asW33.js";import"./CzIwMopt.js";import"./CWJ3BWWI.js";import"./SB0MPsD8.js";import"./DlAUqK2U.js";import"./DSyc53rl.js";import"./CeC760OF.js";const Ae={class:"clan-events"},Be={class:"clan-events__inner"},Pe={class:"clan-events__count"},je={class:"clan-events__prop"},Se={key:0,class:"clan-events__prop"},Re={class:"clan-events__prop-title"},Me={key:1,class:"clan-events__prop"},Fe={class:"clan-events__prop-title"},Ee={key:2},Oe={style:{display:"flex","justify-content":"space-between"}},qe=E({__name:"ClanEvents",props:{savedAt:{type:Number,default:0,required:!0},clan:{type:Object,default:()=>({}),required:!0},savedClan:{type:Object,default:()=>({}),required:!0}},emits:["reset"],setup(n,{emit:v}){const e=n,u=V(null),f=F(()=>{const l=e.clan.members_ids??[],g=e.savedClan.members??[];return Object.values(g).filter(h=>!l.includes(h.account_id))}),D=F(()=>{var h,k;const l=((h=e.clan)==null?void 0:h.members)??[],g=((k=e.savedClan)==null?void 0:k.members_ids)??[];return Object.values(l).filter(A=>!g.includes(A.account_id))}),$=F(()=>D.value.length+f.value.length),x=v;function w(){var l;x("reset"),(l=u.value)==null||l.doClose()}function s(){var l;(l=u.value)==null||l.doOpen()}function a(){var l;(l=u.value)==null||l.doClose()}return(l,g)=>{const h=z,k=W,A=Y,R=ie;return m(),y("div",Ae,[t("div",Be,[_(k,{disabled:!c($),class:K(["clan-events__btn",[c($)?"clan-events__btn--has-unread":""]]),"is-text":"","is-square":"",title:"События клана",onClick:s},{default:b(()=>[_(h,{name:"mail"})]),_:1},8,["disabled","class"]),t("div",Pe,o(c($)>99?"99+":c($)),1)]),_(R,{ref_key:"dialogRef",ref:u,width:"640px",title:"События клана"},{title:b(()=>[t("div",je,[g[0]||(g[0]=t("span",{class:"clan-events__prop-title"}," События от ",-1)),p(" "+o(l.$formatter.date.toDateTime(n.savedAt))+" ("+o(l.$formatter.date.toDaysPassed(n.savedAt,Date.now()))+") ",1)])]),footer:b(()=>[t("div",Oe,[g[3]||(g[3]=t("div",null,null,-1)),t("div",null,[_(k,{onClick:w},{default:b(()=>g[1]||(g[1]=[p(" Прочитано ")])),_:1}),_(k,{onClick:a},{default:b(()=>g[2]||(g[2]=[p(" Закрыть ")])),_:1})])])]),default:b(()=>[c(f).length?(m(),y("div",Se,[t("span",Re," Покинули ("+o(c(f).length)+") ",1),(m(!0),y(L,null,J(c(f),(i,q)=>(m(),y("span",{key:i.account_id,class:"clan-events__prop-value"},[_(A,{to:{name:"account-id",params:{id:i.account_id}},class:"link"},{default:b(()=>[p(o(i.account_name),1)]),_:2},1032,["to"]),p(o(q+1!==c(f).length?", ":""),1)]))),128))])):P("",!0),c(D).length?(m(),y("div",Me,[t("span",Fe," Вступили ("+o(c(D).length)+") ",1),(m(!0),y(L,null,J(c(D),(i,q)=>(m(),y("span",{key:i.account_id,class:"clan-events__prop-value"},[_(A,{to:{name:"account-id",params:{id:i.account_id}},class:"link"},{default:b(()=>[p(o(i.account_name),1)]),_:2},1032,["to"]),p(o(q+1!==c(D).length?", ":""),1)]))),128))])):P("",!0),c($)?P("",!0):(m(),y("span",Ee," Пока всё тихо ... "))]),_:1},512)])}}}),Ue={class:"social-links"},Le={class:"social-links__links"},Ne=["href","title"],Te=E({__name:"SocialLinks",props:{links:{type:Array,default:()=>[],required:!0}},setup(n){return(v,e)=>(m(),y("div",Ue,[t("div",Le,[(m(!0),y(L,null,J(n.links,u=>(m(),y("a",{key:u.link,class:"link social-links__links-item",href:u.link,target:"_blank",title:u.title},[(m(),j(de(u.icon)))],8,Ne))),128))])]))}}),Ve=/(https?:\/\/)?(www\.)?(discord\.(gg|io|me|li)|discordapp\.com\/invite)\/.+[a-z|0-9]/gi,ze=/(https?:\/\/)?(www\.)?((t|telegram)\.me)\/\+?[a-zA-Z0-9_]{5,32}/gi,Ge=n=>{const v=[],e=n.match(Ve),u=n.match(ze);return e!=null&&e.length&&v.push({title:"Discord",icon:Z(()=>Q(()=>import("./3ZcCzRCL.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),link:e[0]}),u!=null&&u.length&&v.push({title:"Telegram",icon:Z(()=>Q(()=>import("./BNxWb-pH.js"),__vite__mapDeps([6,1,2,3,4,5]),import.meta.url)),link:u[0]}),v},He={class:"clan-preview-details__body"},Je={key:0,class:"clan-preview-details__section"},Ke={class:"clan-preview-details__props-title"},We={class:"clan-preview-details__section"},Ye={class:"clan-preview-details__props-title"},Ze=["textContent"],Qe={key:1,class:"clan-preview-details__section"},Xe={class:"clan-preview-details__props-title"},et={class:"clan-preview-details__props"},tt={class:"clan-preview-details__prop"},at={class:"clan-preview-details__prop"},nt={class:"clan-preview-details__prop"},st={class:"clan-preview-details__prop"},lt={key:0,class:"clan-preview-details__prop"},it={class:"clan-preview-details__section"},ot={class:"clan-preview-details__props-title"},ct={class:"clan-preview-details__props"},rt={class:"clan-preview-details__prop"},dt={class:"clan-preview-details__prop"},_t={class:"clan-preview-details__prop"},ut={class:"clan-preview-details__prop"},mt={class:"clan-preview-details__prop"},pt={class:"clan-preview-details__prop"},vt={style:{display:"flex","justify-content":"space-between"}},ft=E({__name:"ClanPreviewDetails",props:{clan:{type:Object,default:()=>({}),required:!0}},setup(n,{expose:v}){const e=n,u=V(null),f=T({descExpended:!1}),D=F(()=>Ge(e.clan.description??""));function $(){var s;(s=u.value)==null||s.doOpen()}function x(){var s;(s=u.value)==null||s.doClose()}function w(){f.descExpended=!f.descExpended}return v({open:$,close:x}),(s,a)=>{const l=z,g=W,h=Y,k=Te,A=ie;return m(),j(A,{ref_key:"clanDetailsRef",ref:u,class:"clan-preview-details",title:`[${n.clan.tag}] ${n.clan.name}`,width:"640px"},{footer:b(()=>[t("div",vt,[c(D).length?(m(),j(k,{key:0,class:"clan-preview-details__links",links:c(D)},null,8,["links"])):P("",!0),_(g,{onClick:x},{default:b(()=>a[16]||(a[16]=[p(" Закрыть ")])),_:1})])]),default:b(()=>[t("div",He,[n.clan.motto?(m(),y("div",Je,[t("h5",Ke,[_(l,{class:"clan-preview-details__prop-title-icon",name:"format-quote"}),a[0]||(a[0]=p(" Девиз "))]),t("i",null,o(n.clan.motto),1)])):P("",!0),t("div",We,[t("h5",Ye,[_(l,{class:"clan-preview-details__prop-title-icon",name:"description"}),a[1]||(a[1]=p(" Описание "))]),n.clan.description?(m(),y("div",{key:0,class:K(["content-area clan-preview-details__desc",c(f).descExpended?"clan-preview-details__desc--expended":""]),textContent:o(n.clan.description)},null,10,Ze)):P("",!0),_(g,{"is-text":"",class:"clan-preview-details__desc-expend-btn",onClick:w},{default:b(()=>[p(o(c(f).descExpended?"Свернуть":"Развернуть"),1)]),_:1})]),n.clan.motto?(m(),y("div",Qe,[t("h5",Xe,[_(l,{class:"clan-preview-details__prop-title-icon",name:"info"}),a[2]||(a[2]=p(" Информация "))]),t("div",et,[t("div",tt,[a[3]||(a[3]=t("span",{class:"clan-preview-details__prop-title"}," Создатель ",-1)),n.clan.creator_id?(m(),j(h,{key:0,class:"link",to:n.clan.creator_id?{name:"account-id",params:{id:n.clan.creator_id}}:{}},{default:b(()=>[p(o(n.clan.creator_name),1)]),_:1},8,["to"])):(m(),y(L,{key:1},[p(" Не известен ")],64))]),t("div",at,[a[4]||(a[4]=t("span",{class:"clan-preview-details__prop-title"}," Дата создания ",-1)),p(" "+o(s.$formatter.date.toDate(n.clan.created_at*1e3)),1)]),t("div",nt,[a[5]||(a[5]=t("span",{class:"clan-preview-details__prop-title"}," Дата обновления ",-1)),p(" "+o(s.$formatter.date.toDate(n.clan.updated_at*1e3)),1)]),t("div",st,[a[6]||(a[6]=t("span",{class:"clan-preview-details__prop-title"}," Участников ",-1)),p(" "+o(s.$formatter.number.toInteger(n.clan.members_count)),1)]),n.clan.old_tag?(m(),y("div",lt,[a[7]||(a[7]=t("span",{class:"clan-preview-details__prop-title"}," Старое название ",-1)),p(" ["+o(n.clan.old_tag)+"] "+o(n.clan.old_name),1)])):P("",!0)])])):P("",!0),t("div",it,[t("h5",ot,[_(l,{class:"clan-preview-details__prop-title-icon",name:"person-search"}),a[8]||(a[8]=p(" Рекрутинг "))]),t("div",ct,[t("div",rt,[a[9]||(a[9]=t("span",{class:"clan-preview-details__prop-title"}," Политика приёма. ",-1)),p(" "+o(s.$formatter.clan.recruitingPolicy(n.clan.recruiting_policy))+". ",1)]),n.clan.recruiting_policy==="open"&&n.clan.recruiting_options?(m(),y(L,{key:0},[a[15]||(a[15]=t("div",{class:"clan-preview-details__props-subtitle"}," Пороги статистики для вступления: ",-1)),t("div",dt,[a[10]||(a[10]=t("span",{class:"clan-preview-details__prop-title"}," Боёв в день ",-1)),p(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.average_battles_per_day)),1)]),t("div",_t,[a[11]||(a[11]=t("span",{class:"clan-preview-details__prop-title"}," Боёв всего ",-1)),p(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.battles)),1)]),t("div",ut,[a[12]||(a[12]=t("span",{class:"clan-preview-details__prop-title"}," Урон ср. ",-1)),p(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.average_damage)),1)]),t("div",mt,[a[13]||(a[13]=t("span",{class:"clan-preview-details__prop-title"}," Уровень ",-1)),p(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.vehicles_level)),1)]),t("div",pt,[a[14]||(a[14]=t("span",{class:"clan-preview-details__prop-title"}," Побед ",-1)),p(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.wins_ratio))+"% ",1)])],64)):P("",!0)])])])]),_:1},8,["title"])}}}),bt={class:"clan-preview"},wt={class:"clan-preview__inner"},gt={class:"clan-preview__emblem"},yt={class:"clan-preview__info"},ht={class:"clan-preview__title"},$t={class:"clan-preview__tag"},kt={class:"clan-preview__name"},Ct={class:"clan-preview__props"},Dt={class:"clan-preview__prop"},It={class:"clan-preview__prop-value"},xt={class:"clan-preview__prop"},At={class:"clan-preview__prop-value"},Bt={class:"clan-preview__actions"},Pt=E({__name:"ClanPreview",props:{clan:{type:Object,default:()=>({}),required:!0},hideDescription:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},setup(n){const v=n,e=V(null),u=_e(),f=T({isFavorite:!1});le(()=>{D()});async function D(){const{$indexedDB:a}=U(),l=await a.clansFavorites.get(v.clan.clan_id);f.isFavorite=l?l==null?void 0:l.isFavorite:!1}async function $(){if(!v.clan)return;f.isFavorite=!f.isFavorite;const{$indexedDB:a}=U();await a.clansFavorites.set(v.clan.clan_id,{id:v.clan.clan_id,isFavorite:f.isFavorite})}async function x(){await we(`${v.clan.tag}/${v.clan.clan_id}`)?u.add({type:"success",title:"Скопировано",message:`${v.clan.tag}/${v.clan.clan_id}`,duration:3e3}):u.add({type:"error",message:"Клан копировании что-то пошло не так",duration:3e3})}function w(){var a;(a=e.value)==null||a.open()}function s(){$()}return(a,l)=>{const g=be,h=z,k=W,A=oe,R=ft;return m(),y("div",bt,[t("div",wt,[t("div",gt,[_(g,{class:"clan-preview__emblem-img",alt:n.clan.name,emblem:n.clan.emblem_set_id},null,8,["alt","emblem"])]),t("div",yt,[t("div",ht,[t("span",$t,"["+o(n.clan.tag??"...")+"]",1),t("span",kt,o(n.clan.name??"..."),1)]),t("div",Ct,[t("div",Dt,[l[0]||(l[0]=t("span",{class:"clan-preview__prop-title"}," Участников ",-1)),t("span",It,o(n.clan.members_count??"---"),1)]),t("div",xt,[l[1]||(l[1]=t("span",{class:"clan-preview__prop-title"}," События ",-1)),t("span",At,[ue(a.$slots,"events")])])])]),t("div",Bt,[_(k,{"is-text":"",class:"clan-preview__actions-btn",title:"Копировать (nickname/ID)",onClick:x},{default:b(()=>[_(h,{name:"content-copy"})]),_:1}),_(k,{"is-text":"",class:"clan-preview__actions-btn",title:"Добавить в избранные",onClick:s},{default:b(()=>[c(f).isFavorite?(m(),j(h,{key:0,name:"star"})):(m(),j(h,{key:1,name:"star-border"}))]),_:1}),_(k,{"is-text":"",class:"clan-preview__actions-btn",title:"Полная информация",onClick:w},{default:b(()=>[_(h,{name:"info"})]),_:1})])]),_(A,{loading:n.loading},null,8,["loading"]),_(R,{ref_key:"previewDetailsRef",ref:e,clan:n.clan},null,8,["clan"])])}}}),jt={class:"clan-view-filters"},St={class:"clan-view-filters__list"},Rt={class:"clan-view-filters__item clan-view-filters__item--search"},Mt={class:"clan-view-filters__item"},Ft={class:"clan-view-filters__item"},Et=E({__name:"ClanViewFilter",props:{filters:{type:Object,required:!0,default:O.makeClanFilters}},emits:["filters-change"],setup(n,{emit:v}){const e=n,u=[{value:null,label:"Не выбрано"},{value:"<3",label:"Меньше чем 3"},{value:"<5",label:"Меньше чем 5"},{value:"<7",label:"Меньше чем 7"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],f=[{value:null,label:"Не выбрано"},{value:"<1",label:"Меньше чем 1"},{value:"<3",label:"Меньше чем 3"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],D=v;function $(x,w){D("filters-change",{...e.filters,[x]:w})}return(x,w)=>{const s=he,a=$e;return m(),y("div",jt,[t("div",St,[t("div",Rt,[w[3]||(w[3]=t("div",{class:"clan-view-filters__item-title"}," Поиск в клане ",-1)),_(s,{"model-value":n.filters.search,style:{width:"100%"},placeholder:"Введите ник",type:"search","onUpdate:modelValue":w[0]||(w[0]=l=>$("search",l))},null,8,["model-value"])]),t("div",Mt,[w[4]||(w[4]=t("div",{class:"clan-view-filters__item-title"}," Дней в клане ",-1)),_(a,{"model-value":n.filters.joinedAtDays,style:{width:"150px"},options:u,onChange:w[1]||(w[1]=l=>$("joinedAtDays",l))},null,8,["model-value"])]),t("div",Ft,[w[5]||(w[5]=t("div",{class:"clan-view-filters__item-title"}," Дней отсутствовал ",-1)),_(a,{"model-value":n.filters.lastBattleDays,style:{width:"150px"},options:f,onChange:w[2]||(w[2]=l=>$("lastBattleDays",l))},null,8,["model-value"])])])])}}}),Ot={class:"clan-view-table"},qt={class:"clan-view-table__total"},Ut={class:"clan-view-table__total-value"},Lt={class:"clan-view-table__member"},Nt=["title"],Tt={key:0,class:"clan-view-table__name clan-view-table__name--deleted"},Vt={class:"clan-view-table__sub"},zt={class:"clan-view-table__sub"},Gt={class:"clan-view-table__sub"},Ht={class:"clan-view-table__sub"},Jt={class:"clan-view-table__sub"},Kt={class:"clan-view-table__sub"},Wt=E({__name:"ClanViewMembersTable",props:{members:{type:Array,default:()=>[],required:!0},savedMembers:{type:Array,default:()=>[],required:!0},users:{type:Array,default:()=>[],required:!0},sort:{type:Object,default:()=>({}),required:!0}},emits:["sort"],setup(n,{emit:v}){const e=n,u=v,f=[{key:"account_name",label:"Ник",sortable:!0},{key:"battles",label:"Боёв",sortable:!0,sortMethod(s,a){return s.statistic.all.battles-a.statistic.all.battles}},{key:"winRate",label:"Побед",sortable:!0,sortMethod(s,a){return s.statistic.all.winRate-a.statistic.all.winRate}},{key:"damagePerBattle",label:"Урон",sortable:!0,sortMethod(s,a){return s.statistic.all.damagePerBattle-a.statistic.all.damagePerBattle}},{key:"rating",label:"Рейтинг",sortable:!0,sortMethod(s,a){var h,k;const l=((h=s.statistic.rating)==null?void 0:h.rating)??0,g=((k=a.statistic.rating)==null?void 0:k.rating)??0;return l-g}},{key:"battlesPerDay",label:"Боёв в день",sortable:!0},{key:"last_battle_time",label:"Последний бой",sortable:!0},{key:"joined_at",label:"В клане",sortable:!0}],D=F(()=>e.members.map(s=>{const a=e.savedMembers.find(A=>A.account_id===s.account_id),l=a?N.diff(s.statistic.all,a.statistic.all):null,g=N.battlesPerDay({createAt:s.create_at*1e3,battles:s.statistic.all.battles}),h=l?N.battlesPerDay({battles:s.statistic.all.battles-l.battles,createAt:s.create_at*1e3}):null,k=h?g-h:null;return{...s,battlesPerDay:g,battlesPerDayDiff:k,diff:l}}));function $(s){const a=e.users.find(l=>l.id===s.account_id);return a?{found:!0,online:Date.now()-new Date(a.visitedAt).valueOf()<1e3*60*5}:{found:!1,online:!1}}function x(s){const a=s;return/^del_\d+$/.test(a.account_name)||!a.last_battle_time}function w(s,a){const l=a;return l.diff?s==="winRate"?X.number.toFloatNumber(l.diff[s],!0):X.number.toInteger(l.diff[s],!0):"---"}return(s,a)=>{const l=ke,g=z,h=Y,k=Ce,A=De,R=Ie;return m(),y("div",Ot,[t("div",qt,[a[1]||(a[1]=p(" Кол-во: ")),t("span",Ut,o(c(D).length||0),1)]),c(D)?(m(),j(R,{key:0,data:c(D),"default-sort":n.sort,headers:f,"no-wrap":"","scroll-auto-disabling":"","row-key":"account_id",height:"calc(100vh - 112px)",class:"clan-view-table__table",onSort:a[0]||(a[0]=i=>u("sort",i))},{account_name:b(({row:i})=>[t("span",Lt,[t("span",{class:K(["clan-view-table__role",["clan-view-table__role--"+i.role,$(i).found?"clan-view-table__role--is-user":"",$(i).online?"clan-view-table__role--is-online":""]]),title:s.$formatter.clan.role(i.role)??"Не известна"},[i.role?(m(),j(l,{key:0,width:"18",height:"18",class:"clan-view-table__role-icon",role:i.role},null,8,["role"])):(m(),j(g,{key:1,style:{width:"16px",color:"var(--color-text-light)"},name:"close"}))],10,Nt),x(i)?(m(),y("span",Tt,o(i.account_name),1)):(m(),j(h,{key:1,class:"link clan-view-table__name",to:{name:"account-id",params:{id:i.account_id}}},{default:b(()=>[p(o(i.account_name),1)]),_:2},1032,["to"]))])]),battles:b(({row:i})=>[p(o(i.statistic.all.battles||"---")+" ",1),t("span",Vt,o(w("battles",i)||"---"),1)]),winRate:b(({row:i})=>[_(k,{"win-rate":i.statistic.all.winRate,class:"clan-view-table__win-rate"},null,8,["win-rate"]),t("span",zt,o(w("winRate",i)||"---"),1)]),rating:b(({row:i})=>[_(A,{rating:i.statistic.rating},null,8,["rating"])]),damagePerBattle:b(({row:i})=>[p(o(i.statistic.all.damagePerBattle||"---")+" ",1),t("span",Gt,o(w("damagePerBattle",i)),1)]),battlesPerDay:b(({row:i})=>[p(o(i.battlesPerDay||"---")+" ",1),t("span",Ht,o(s.$formatter.number.toInteger(i.battlesPerDayDiff,!0)||"---"),1)]),last_battle_time:b(({row:i})=>[p(o(s.$formatter.date.toRelativeTime(i.last_battle_time*1e3)||"---")+" ",1),t("span",Jt,o(s.$formatter.date.toDateTime(i.last_battle_time*1e3)||"---"),1)]),joined_at:b(({row:i})=>[p(o(s.$formatter.date.toDaysPassed(i.joined_at*1e3)||"---")+" ",1),t("span",Kt,o(s.$formatter.date.toDate(i.joined_at*1e3)||"---"),1)]),_:1},8,["data","default-sort"])):P("",!0)])}}}),Yt=(n,v)=>{const{prop:e,order:u}=v;return u?n.toSorted((f,D)=>{const $=(u==="desc"?D:f)[e],x=(u==="desc"?f:D)[e];return String($).localeCompare(String(x),void 0,{numeric:!0,sensitivity:"base"})}):n},Zt=n=>{n.sort((v,e)=>v.joined_at-e.joined_at)},Qt=n=>{n.sort((v,e)=>{const u={recruit:0,private:1,executive_officer:2,commander:3};return u[e.role]-u[v.role]})},Xt=n=>{Zt(n),Qt(n)},se={smart:Yt,clanMembersDefault:Xt},ea={key:0,class:"clan-page"},ta={key:1,class:"clan-page--no-data"},aa={key:0,class:"content-area"},xa=E({__name:"[id]",setup(n){const v=me(),e=T({loading:0,users:[],clanInfo:null,clan:null,filters:O.makeClanFilters(),statisticsSum:null,savedMembers:[],savedClan:null,metricsItems:ae.clan(),clanSavedAt:0,sessionUpdateAt:0,sessionActive:!1}),u=T({order:"desc",prop:""}),f=F(()=>{var d;return((d=e.clan)==null?void 0:d.members)||[]}),D=F(()=>{let d=f.value.filter(C=>{const B=C.account_name.toLowerCase(),I=e.filters.search.toLowerCase();return B.includes(I)});const r=Date.now();if(e.filters.joinedAtDays){const C=O.parseParameter(e.filters.joinedAtDays);d=f.value.filter(B=>O.executeExpression(r-Number(C.value)*ee,B.joined_at*1e3,C.operator))}if(e.filters.lastBattleDays){const C=O.parseParameter(e.filters.lastBattleDays);d=f.value.filter(B=>O.executeExpression(r-Number(C.value)*ee,B.last_battle_time*1e3,C.operator))}return d}),$=V(!1);le(async()=>{await g(),$.value=!0});async function x(d){e.loading++;try{const{data:r}=await H.clan.getAccountInfo({account_id:d.join(",")});return r}catch(r){return M(r,{title:"Получение данных участников клана"}),null}finally{e.loading--}}async function w(d){e.loading++;try{const{data:r}=await H.clan.getInfo({clan_id:d});e.clanInfo=r[d]??null}catch(r){M(r,{title:"Получение данных клана"})}e.loading--}async function s(d){e.loading++;try{const{data:r}=await pe.user.getList({id:d});e.users=r}catch(r){M(r,{title:"Получение данных аккаунта"})}e.loading--}async function a(d){e.loading++;try{const{data:r}=await H.account.getInfo({extra:"statistics.rating",account_id:d.join(",")});return r}catch(r){return M(r,{title:"Получение данных аккаунта"}),null}finally{e.loading--}}async function l(d){await Promise.all([h(d),A(d)])}async function g(){const d=+v.params.id;if(!d||(await w(d),!e.clanInfo))return;const r=await x(e.clanInfo.members_ids);e.clanInfo.members||(e.clanInfo.members={});for(const I in r){const S=r[I];S&&(e.clanInfo.members[I]={account_id:S.account_id,account_name:S.account_name,joined_at:S.joined_at,role:S.role})}await Promise.all([s(e.clanInfo.members_ids),l(e.clanInfo)]),e.savedClan||await k(e.clanInfo);const C=await a(e.clanInfo.members_ids);if(!C)return;e.clan=ne.clan(e.clanInfo,C);const B=Object.values(C).filter(xe);e.statisticsSum=B.reduce((I,S,G)=>G===0?B[0].statistics:N.sumFull(I,S.statistics),{}),e.metricsItems=ae.clan(B,e.statisticsSum),se.clanMembersDefault(f.value)}async function h(d){e.loading++;try{const r=[],{$indexedDB:C}=U();for(const B in d.members){const I=await C.accountsInfo.get(B);I&&(I.data.created_at=I.timestamp,I.timestamp>e.sessionUpdateAt&&(e.sessionUpdateAt=I.timestamp),r.push(ne.clanMember(d.members[B],I.data)))}e.savedMembers=r}catch(r){M(r,{title:"Загрузка локальных данных аккаунтов"})}e.loading--}async function k(d){e.loading++;try{const{$indexedDB:r}=U();await r.clansInfo.set(d.clan_id,ve(d)),e.savedClan=te(d),e.clanSavedAt=Date.now()}catch(r){M(r,{title:"Локальное сохранение данных аккаунтов"})}e.loading--}async function A(d){e.loading++;try{const{$indexedDB:r}=U(),C=await r.clansInfo.get(d.clan_id);e.savedClan=(C==null?void 0:C.data)??null,e.clanSavedAt=(C==null?void 0:C.timestamp)??0}catch(r){M(r,{title:"Загрузка локальных данных клана"})}e.loading--}function R(d){d.order||se.clanMembersDefault(f.value)}async function i(){e.clanInfo&&await k(e.clanInfo)}function q(d){e.filters=te(d)}return(d,r)=>{const C=qe,B=Pt,I=ge,S=ye,G=Et,ce=Wt,re=oe;return c(e).clanInfo?(m(),y("div",ea,[_(I,{identity:"preview"},{default:b(()=>[_(B,{class:"clan-page__preview","hide-description":!0,clan:c(e).clanInfo,loading:c(e).loading>0},fe({_:2},[c(e).clanInfo&&c(e).savedClan?{name:"events",fn:b(()=>[_(C,{clan:c(e).clanInfo,"saved-clan":c(e).savedClan,"saved-at":c(e).clanSavedAt,onReset:i},null,8,["clan","saved-clan","saved-at"])]),key:"0"}:void 0]),1032,["clan","loading"])]),_:1}),_(I,{title:"Статистика",identity:"statistic"},{default:b(()=>[_(S,{loading:c(e).loading>0,items:c(e).metricsItems},null,8,["loading","items"])]),_:1}),_(I,{title:"Участники",identity:"members"},{default:b(()=>[_(G,{class:"clan-page__filters",filters:c(e).filters,onFiltersChange:q},null,8,["filters"]),_(ce,{sort:c(u),users:c(e).users,"saved-members":c(e).savedMembers,members:c(D),onSort:R},null,8,["sort","users","saved-members","members"])]),_:1})])):(m(),y("div",ta,[c($)?(m(),y("div",aa,r[0]||(r[0]=[t("p",null,"Нет данных.",-1),t("p",null,"Возможно клан удалён.",-1)]))):P("",!0),_(re,{loading:!c($)},null,8,["loading"])]))}}});export{xa as default};
