import{_ as N}from"./Co0YW0xm.js";import{d as B,a2 as T,k as V,r as W,l as q,p as s,o as r,m as f,n as p,F as G,D as O,v as S,h as L,f as l,I as M,q as _,G as w,u as $,a as j,c as k,e as P,w as z,g as E}from"./DEnf58KD.js";import{f as I}from"./YHuVnumQ.js";import{s as i}from"./BLrdWoSV.js";import{_ as H}from"./CzQIR5HZ.js";import"./B4FMxlHh.js";const U={class:"widget-account-session__list"},J={class:"widget-account-session__label"},K={class:"widget-account-session__value"},Q=B({__name:"WidgetAccountSession",props:{params:{type:Object,default:()=>I.makeAccountSessionWidgetFilters,required:!0}},setup(m){T(n=>({"4e90af88":o.params.bgColorOpacity,"2264f1fa":o.params.bgColor,"0885f9db":o.params.textColor}));const o=m,t=V({loading:0,accountSession:null,account:null,achievementsInfo:null,accountAchievements:null,accountAchievementsSession:null,tanksStat:null,tanksStatSession:null,updateTimerDuration:3e4}),u=W([]);q(()=>{D()});async function v(){t.loading++;try{const{data:n}=await _.encyclopedia.getAchievements();t.achievementsInfo=n??null}catch(n){console.error(n)}t.loading--}async function d(n){t.loading++;try{const{data:e}=await _.account.getInfo({account_id:n,extra:"statistics.rating"});t.account=(e==null?void 0:e[n])??null}catch(e){console.error(e)}t.loading--}async function g(n){t.loading++;try{const{data:e}=await w.session.account.get(n);t.accountSession=e.raw}catch(e){console.error(e)}t.loading--}async function y(n){t.loading++;try{const{data:e}=await _.account.getAchievements({account_id:n});t.accountAchievements=(e==null?void 0:e[n])??null}catch(e){console.error(e)}t.loading--}async function x(n){t.loading++;try{const{data:e}=await w.session.accountAchievements.get(n);t.accountAchievementsSession=e.raw}catch(e){console.error(e)}t.loading--}function F(n,e){switch(n){case"battles":return s.number.toInteger(e.battles);case"winRate":return s.number.toFloatPercent(e.winRate);case"damagePerBattle":return s.number.toInteger(e.damagePerBattle);case"fragPerBattle":return s.number.toFloatNumber(e.fragPerBattle);case"surviveRate":return s.number.toFloatPercent(e.spottedPerBattle);case"hitRate":return s.number.toFloatPercent(e.hitRate);case"spottedPerBattle":return s.number.toFloatNumber(e.spottedPerBattle);case"xpPerBattle":return"xpPerBattle"in e?s.number.toInteger(e.xpPerBattle):"---";default:return"---"}}function h(){if(!t.account||!t.accountSession)return;const n=i.diffFull(t.account.statistics,t.accountSession.statistics);let e;t.achievementsInfo&&t.accountAchievements&&t.accountAchievementsSession&&(e=i.accountAchievementsDiff(t.accountAchievements,t.accountAchievementsSession,t.achievementsInfo)),u.value=o.params.attributes.map(a=>{var b,A;if(a==="teamGamePoints"&&e)return{key:a,label:s.stat.accountProp(a),value:String(i.teamPoints(n,e))};const c=(b=t.achievementsInfo)==null?void 0:b[a];if(c&&e)return{key:a,label:String(c.name).replace(/\([^)]+\)/gi,"")??a,value:String(((A=e.achievements)==null?void 0:A[a])??0)};const R=o.params.battleMode==="rating"&&n.rating?i.accountRating(n.rating):i.accountAll(n.all);return{key:a,label:s.stat.accountProp(a),value:F(a,R)}})}function C(n){h();let e;const a=async()=>{t.loading++,clearTimeout(e),await Promise.all([d(n),y(n)]),h(),e=setTimeout(a,t.updateTimerDuration),t.loading--};a()}async function D(){u.value=o.params.attributes.map(e=>({key:e,label:s.stat.accountProp(e),value:"---"}));const n=o.params.accountId;n&&(await Promise.all([v(),g(n),x(n)]),t.accountSession&&C(n))}return(n,e)=>{const a=N;return r(),f("div",{class:M(["widget-account-session",["widget-account-session--"+m.params.style]])},[p("div",U,[(r(!0),f(G,null,O(l(u),c=>(r(),f("div",{key:c.key,class:"widget-account-session__item"},[p("div",J,S(c.label),1),p("div",K,S(c.value),1),L(a,{loading:l(t).loading>0},null,8,["loading"])]))),128))])],2)}}}),ae=B({__name:"account-session",setup(m){$({title:"Виджет Сессии Аккаунта"});const o=j(),t=k(()=>I.makeAccountSessionWidgetFilters(o.query));return(u,v)=>{const d=Q,g=H;return r(),P(g,null,{default:z(()=>[l(t)?(r(),P(d,{key:0,class:"widgets-account-session-page",params:l(t)},null,8,["params"])):E("",!0)]),_:1})}}});export{ae as default};
