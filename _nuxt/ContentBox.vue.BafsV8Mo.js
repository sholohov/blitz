import{_ as G}from"./CInput.vue.MRANpBXr.js";import{_ as P,a as k}from"./request.BjF5k-df.js";import{f as N,h as W,r as c,i as D,q as H,y as J,R as Q,o as i,c as u,a as E,b as $,k as x,l as X,w as T,F as R,A as I,t as K,B as Y,m as Z,$ as ee,M as te,j as ne,C as ae,G as oe,D as se}from"./entry.DxBPLwvI.js";import{n as le}from"./notEmpty.BxBPJGBn.js";import{d as ce}from"./debounce.BCnAhbZM.js";import{h as A}from"./disableScroll.CgQQwGmz.js";const ie={class:"main-search__inner"},re={class:"main-search__input"},ue={key:0,class:"main-search__dropdown"},de={key:0,class:"main-search__item-title"},me=["onKeydown","onClick","textContent"],ye=N({__name:"MainSearch",props:{context:{type:String,default:"account"}},setup(C){const L=W(),_=c(null),h=c(null),o=c(""),p=c([]),g=c([]),y=c([]),f=c([]),r=c(0),v=c(-1),V=D(()=>[p.value,g.value,y.value]),U=D(()=>[p.value,g.value,y.value].some(e=>e.length>0));H(()=>{window.addEventListener("click",S)}),J(()=>{window.removeEventListener("click",S)});function w(){p.value=[],g.value=[],y.value=[]}function S(e){var t;(t=_.value)!=null&&t.contains(e.target)||(w(),o.value="")}async function b(e){var t;w(),await L.push({name:e.context+"-id",params:{id:String(e.id)}}),(t=h.value)==null||t.focus()}function M(){var t;const e=(t=_.value)==null?void 0:t.querySelectorAll(".main-search__item-btn");return e?[...e]:[]}async function j(e){r.value++;try{const a=((await k.account.getList({search:e,limit:5})).data||[]).map(n=>({name:n.nickname,id:n.account_id,context:"account"}));if(a.length){const n=await k.clan.getAccountInfo({extra:"clan",account_id:a.map(l=>l.id).join(",")});n.data&&a.forEach(l=>{var s,m;const d=(m=(s=n.data[l.id])==null?void 0:s.clan)==null?void 0:m.tag;l.name+=d?` [${d}]`:""}),p.value=[{id:1,name:"Аккаунты",context:"title"},...a]}}catch(t){A(t,{title:"Поиск аккаунта"})}r.value--}async function q(e){r.value++;try{const{data:t}=await k.clan.getList({search:e,limit:5}),a=(t.filter(le)??[]).map(n=>({name:`[${n.tag}] ${n.name}`,id:n.clan_id,context:"clan"}));a.length&&(g.value=[{id:2,name:"Кланы",context:"title"},...a])}catch(t){A(t,{title:"Поиск клана"})}r.value--}async function F(e){r.value++;try{const a=((await k.tournaments.getList({search:e,limit:5})).data||[]).map(n=>({name:n.title,id:n.tournament_id,context:"tournaments"}));a.length&&(y.value=[{id:3,name:"Турниры",context:"title"},...a])}catch(t){A(t,{title:"Поиск турнира"})}r.value--}async function O(){var e,t;((e=o.value)==null?void 0:e.length)>=3&&/[^а-яё]+/gi.test(o.value)&&await j(o.value.trim()),((t=o.value)==null?void 0:t.length)>=2&&(await q(o.value.trim()),await F(o.value.trim())),await te(),f.value=M()}const z=ce(O,1e3,{leading:!0});Q(async()=>{o.value=o.value.replace(/\/\d+$/,"").trim(),o.value.length<2&&w(),await z()});function B(e){var a,n,l,d,s,m;const t=e.target;r.value>0||(e.key==="Escape"&&(w(),o.value="",v.value=-1,(a=h.value)==null||a.focus()),t.tagName==="INPUT"&&(v.value=-1),e.key==="ArrowUp"&&(e.preventDefault(),(n=f.value)!=null&&n.length&&v.value>0?(l=f.value[--v.value])==null||l.focus():(d=h.value)==null||d.focus()),e.key==="ArrowDown"&&(e.preventDefault(),(s=f.value)!=null&&s.length&&v.value<f.value.length-1&&((m=f.value[++v.value])==null||m.focus())))}return(e,t)=>{const a=G,n=P;return i(),u("div",{ref_key:"rootRef",ref:_,class:"main-search"},[E("div",ie,[E("div",re,[$(a,{ref_key:"inputRef",ref:h,modelValue:x(o),"onUpdate:modelValue":t[0]||(t[0]=l=>X(o)?o.value=l:null),placeholder:"Поиск игрока, клана или турнира",type:"search",onKeydown:B},null,8,["modelValue"])]),$(ee,null,{default:T(()=>[x(U)?(i(),u("div",ue,[(i(!0),u(R,null,I(x(V),(l,d)=>(i(),u("ul",{key:d,class:"main-search__list",onKeydown:B},[(i(!0),u(R,null,I(l,s=>(i(),u("li",{key:s.context+s.id,class:"main-search__item"},[s.context==="title"?(i(),u("div",de,K(s.name),1)):(i(),u("button",{key:1,class:"main-search__item-btn",onKeydown:Y(m=>b(s),["enter"]),onClick:m=>b(s),textContent:K(s.name)},null,40,me))]))),128))],32))),128)),$(n,{loading:x(r)>0},null,8,["loading"])])):Z("",!0)]),_:1})])],512)}}}),we=N({__name:"ContentBox",props:{tag:{type:String,default:"div"},innerClass:{type:String,default:void 0}},setup(C){return(L,_)=>(i(),ne(se(C.tag),{class:"content-box"},{default:T(()=>[E("div",{class:ae(["content-box__inner",[C.innerClass]])},[oe(L.$slots,"default")],2)]),_:3}))}});export{we as _,ye as a};
