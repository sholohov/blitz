import{_ as U}from"./D0bbJ2Al.js";import{_ as M}from"./CC4nJMY4.js";import{_ as R}from"./BWArym7p.js";import{d as O,c as j,e as u,o as _,b as A,w as i,p as a,g as c,t as s,q as r,n as z,F as w,x as q,h as D,j as C,s as d,k as E,E as S,m as B,l as T,f as G}from"./CbpaTVLF.js";import{_ as H}from"./B5RtmFoY.js";import{_ as W}from"./BeChpmDq.js";import{_ as J}from"./BYsS9vqb.js";import{u as K}from"./CeC760OF.js";import{_ as Q}from"./BufGgsVL.js";import{s as X}from"./C04RlcEn.js";import"./DSyc53rl.js";import"./DD4asW33.js";const Y={style:{display:"flex","align-items":"center",gap:"14px",padding:"10px"}},Z={style:{display:"flex","flex-direction":"column","align-items":"center"}},tt={style:{"font-size":"12px","font-weight":"500",margin:"4px 0 0"}},et={style:{margin:"0 0 8px 0"}},at={style:{display:"flex","align-items":"center",gap:"20px"}},ot={style:{display:"flex",gap:"10px"}},nt={style:{display:"inline-flex","flex-direction":"column","font-size":"14px"}},st={style:{"font-size":"12px",color:"var(--color-text-light)"}},lt={style:{display:"flex",gap:"10px"}},rt={style:{display:"inline-flex","flex-direction":"column","font-size":"14px"}},it={style:{"font-size":"12px",color:"var(--color-text-light)"}},ct={style:{display:"flex",gap:"10px"}},dt={style:{display:"inline-flex","flex-direction":"column","font-size":"14px"}},ut={style:{"font-size":"12px",color:"var(--color-text-light)"}},pt={class:"leaderboards-accounts-table__nickname"},_t={class:"leaderboards-accounts-table__sub"},mt={class:"leaderboards-accounts-table__sub"},bt={class:"leaderboards-accounts-table__sub"},ft={class:"leaderboards-accounts-table__sub"},gt={class:"leaderboards-accounts-table__sub"},yt={class:"leaderboards-accounts-table__sub"},ht=O({__name:"LeaderboardAccountTable",props:{items:{type:Array,default:()=>[],required:!0},headers:{type:Array,default:()=>[],required:!0}},setup(x){const k=j(()=>K().isTablet);return(e,m)=>{const v=M,b=R,g=q,$=H,F=W,V=J;return u(k)?(_(),A(F,{key:0,ref:"accountsTable","no-wrap":"","row-key":"id","scroll-to-top":"","scroll-auto-disabling":"",data:x.items,height:"calc(100vh - 112px)"},{default:i(({row:t})=>{var l,p,y;return[a("div",Y,[a("span",Z,[c(v,{position:t.position},null,8,["position"]),a("span",tt,s(t.xp_per_battle),1)]),a("div",null,[a("div",et,[c(b,{style:{"font-weight":"500"},class:"link",to:{name:"account-id",params:{id:t.id}}},{default:i(()=>[r(s(t.nickname),1)]),_:2},1032,["to"]),t.clan?(_(),A(b,{key:0,class:"link",to:{name:"clan-id",params:{id:t.clan.clan_id}}},{default:i(()=>[r(" ["+s(t.clan.tag)+"] ",1)]),_:2},1032,["to"])):(_(),z(w,{key:1},[r(" [ --- ] ")],64))]),a("div",at,[a("span",ot,[c(g,{name:"sword-cross",size:"18",style:{color:"var(--color-text-light)"}}),a("span",nt,[r(s(e.$formatter.number.toInteger(t.battles))+" ",1),a("span",st,s(e.$formatter.number.toInteger((l=t.stat)==null?void 0:l.battles)||"---"),1)])]),a("span",lt,[c(g,{name:"flag-variant",size:"18",style:{color:"var(--color-text-light)"}}),a("span",rt,[c($,{"win-rate":t.win_rate},null,8,["win-rate"]),a("span",it,s(e.$formatter.number.toFloatPercent((p=t.stat)==null?void 0:p.winRate)??"---"),1)])]),a("span",ct,[c(g,{name:"destruction",size:"18",style:{color:"var(--color-text-light)"}}),a("span",dt,[r(s(e.$formatter.number.toInteger(t.damage_per_battle))+" ",1),a("span",ut,s(e.$formatter.number.toInteger((y=t.stat)==null?void 0:y.damagePerBattle)),1)])])])])])]}),_:1},8,["data"])):(_(),A(V,{key:1,ref:"accountsTable","no-wrap":"","row-key":"id","scroll-to-top":"","scroll-auto-disabling":"",headers:x.headers,data:x.items,height:"calc(100vh - 112px)"},{nickname:i(({row:t})=>[a("div",pt,[c(v,{class:"leaderboards-accounts-table__nickname-mark",position:t.position},null,8,["position"]),c(b,{class:"leaderboards-accounts-table__nickname-link link",to:{name:"account-id",params:{id:t.id}}},{default:i(()=>[r(s(t.nickname),1)]),_:2},1032,["to"])])]),clan:i(({row:t})=>[t.clan?(_(),A(b,{key:0,class:"leaderboards-accounts-table__clan link",to:{name:"clan-id",params:{id:t.clan.clan_id}}},{default:i(()=>[r(s(t.clan.tag),1)]),_:2},1032,["to"])):(_(),z(w,{key:1},[r(" --- ")],64))]),battles:i(({row:t})=>{var l;return[r(s(t.battles)+" ",1),a("div",_t,s(e.$formatter.number.toInteger((l=t.stat)==null?void 0:l.battles)||"---"),1)]}),win_rate:i(({row:t})=>{var l;return[c($,{"win-rate":t.win_rate,class:"leaderboards-accounts-table__win-rate"},null,8,["win-rate"]),a("div",mt,s(e.$formatter.number.toFloatPercent((l=t.stat)==null?void 0:l.winRate)||"---"),1)]}),damage_per_battle:i(({row:t})=>{var l;return[r(s(t.damage_per_battle)+" ",1),a("div",bt,s(e.$formatter.number.toInteger((l=t.stat)==null?void 0:l.damagePerBattle)||"---"),1)]}),frags_per_battle:i(({row:t})=>{var l,p;return[r(s(t.frags_per_battle)+" / "+s(t.frags8p_per_battle)+" ",1),a("div",ft,s(e.$formatter.number.toFloatNumber((l=t.stat)==null?void 0:l.fragPerBattle)||"---")+" / "+s(e.$formatter.number.toFloatNumber((p=t.stat)==null?void 0:p.frag8pPerBattle)||"---"),1)]}),xp_per_battle:i(({row:t})=>{var l;return[r(s(t.xp_per_battle)+" ",1),a("div",gt,s(e.$formatter.number.toInteger((l=t.stat)==null?void 0:l.xpPerBattle)||"---"),1)]}),spotted_per_battle:i(({row:t})=>{var l;return[r(s(t.spotted_per_battle)+" ",1),a("div",yt,s(e.$formatter.number.toInteger((l=t.stat)==null?void 0:l.spottedPerBattle)||"---"),1)]}),_:1},8,["headers","data"]))}}}),xt={class:"leaderboards-accounts-page"},kt={key:0,class:"leaderboards-accounts-page__user-position"},vt={class:"leaderboards-accounts-page__filters"},$t={class:"leaderboards-accounts-page__filters-item"},It={class:"leaderboards-accounts-page__filters-item"},Ot=O({__name:"accounts",setup(x){const k=D(),e=C({loading:0,tanks:[],accountsLeaderboard:[],userOnLeaderboard:null,items:[],clanAccounts:null,accounts:null}),m=C({page:1,pageSize:99,period:7,battlesPerDay:10,battlesMin:1e4}),v=[7,14,30,60,90].map(o=>({value:o,label:new Intl.NumberFormat("ru",{style:"unit",unit:"day",unitDisplay:"long"}).format(o)})),b=[{label:"От 1к",value:1e3},{label:"от 5к",value:5e3},{label:"от 10к",value:1e4},{label:"от 30к",value:3e4}],g=[{key:"nickname",label:"Ник"},{key:"clan",label:"Клан"},{key:"xp_per_battle",label:"Опыт",tooltip:d.stat.accountProp("xp"),formatter:o=>d.number.toInteger(o)},{key:"battles",label:"Бои",tooltip:d.stat.accountProp("battles"),formatter:o=>d.number.toInteger(o)},{key:"win_rate",label:"Победы",tooltip:d.stat.accountProp("winRate"),formatter:o=>d.number.toFloatNumber(o)},{key:"damage_per_battle",label:"Урон",tooltip:d.stat.accountProp("damagePerBattle"),formatter:o=>d.number.toInteger(o)},{key:"frags_per_battle",label:"Уничт. / ур. >= 8",tooltip:d.stat.accountProp("fragPerBattle"),formatter:o=>d.number.toFloatNumber(o)},{key:"spotted_per_battle",label:"Обн.",tooltip:d.stat.accountProp("spotted"),formatter:o=>d.number.toFloatNumber(o)}];E(()=>{p()});async function $(o){e.loading++;try{const{data:n}=await T.account.getInfo({extra:"statistics.rating",account_id:o.join(",")});e.accounts=n??null}catch(n){e.accounts=null,B(n,{title:"Поучение списка аккаунтов"})}e.loading--}async function F(o){e.loading++;try{const{data:n}=await T.clan.getAccountInfo({extra:"clan",account_id:o.join(",")});e.clanAccounts=n??null}catch(n){e.clanAccounts=null,B(n,{title:"Ошибка поучения списка клановых аккаунтов"})}e.loading--}async function V(){e.loading++;try{const{data:o}=await S.leaderboards.getAccounts(m);e.accountsLeaderboard=o}catch(o){e.accountsLeaderboard=[],B(o,{title:"Получение рейтинга игроков"})}e.loading--}async function t(){e.loading++;try{const{data:o}=await S.leaderboards.getAccounts({...m,ids:[k.accountId]});e.userOnLeaderboard=o[0]}catch(o){e.userOnLeaderboard=null,B(o,{title:"Получение рейтинга пользователя"})}e.loading--}async function l(){const o=e.accountsLeaderboard.map(n=>n.id);o.length&&(await Promise.allSettled([F(o),$(o)]),e.items=e.accountsLeaderboard.map(n=>{var L,h,f,N;const I=(h=(L=e.clanAccounts)==null?void 0:L[n.id])==null?void 0:h.clan,P=(N=(f=e.accounts)==null?void 0:f[n.id])==null?void 0:N.statistics;return{...n,stat:P?X.accountAll(P.all):null,clan:I??null}}))}async function p(){await Promise.all([V(),k.accountId?t():null]),await l()}function y(){p()}return(o,n)=>{var h;const I=U,P=ht,L=Q;return _(),z("div",xt,[n[6]||(n[6]=a("div",{class:"leaderboards-accounts-page__description content-area"},[a("h2",null,"Топ «Опытных» игроков"),a("p",null,'Чем выше средний "Опыт", тем выше ваша позиция в рейтинге.'),a("p",null,"Условия участия:"),a("ol",null,[a("li",null,"Быть авторизованным на ресурсе не менее 3-х дней"),a("li",null,'Провести суммарно не менее 10 "обычных" боёв в сутки')])],-1)),u(e).userOnLeaderboard?(_(),z("div",kt,[n[2]||(n[2]=r(" Ваша позиция в рейтинге: ")),a("b",null,s((h=u(e).userOnLeaderboard)==null?void 0:h.position),1),n[3]||(n[3]=r(". "))])):G("",!0),a("div",vt,[a("div",$t,[n[4]||(n[4]=r(" За период: ")),c(I,{modelValue:u(m).period,"onUpdate:modelValue":n[0]||(n[0]=f=>u(m).period=f),style:{width:"120px"},options:u(v),onChange:y},null,8,["modelValue","options"])]),a("div",It,[n[5]||(n[5]=r(" Боёв: ")),c(I,{modelValue:u(m).battlesMin,"onUpdate:modelValue":n[1]||(n[1]=f=>u(m).battlesMin=f),style:{width:"120px"},options:b,onChange:y},null,8,["modelValue"])])]),c(P,{headers:g,items:u(e).items},null,8,["items"]),c(L,{loading:u(e).loading>0},null,8,["loading"])])}}});export{Ot as default};
