const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B7rQWyBW.js","./CpfoCNYP.js","./DlAUqK2U.js","./DJlEGeV1.js","./entry.Brd7_UbU.css","./nuxt-icon.MfBulapQ.css","./DrqzXMui.js"])))=>i.map(i=>d[i]);
import{d as E,r as N,c as M,o as m,l as y,m as t,h as _,w as b,f as c,E as K,t as o,q as p,F as L,B as J,g as P,_ as z,v as W,e as j,G as de,H as Z,I as Q,j as V,k as le,s as U,J as _e,n as X,u as ue,a as me,K as pe,p as G,D as ve,L as fe,O as ee}from"./DJlEGeV1.js";import{_ as Y}from"./3lIG1lYq.js";import{_ as ie}from"./D-TuSGJo.js";import{_ as be}from"./DqK6BF4J.js";import{_ as oe}from"./PfUKTOG5.js";import{u as we}from"./roZIKyQo.js";import{c as ge}from"./ZnSD-95i.js";import{_ as ye}from"./DWPY84V0.js";import{m as te,_ as he}from"./rwet2Jwp.js";import{_ as $e}from"./NWUEeXks.js";import{_ as ke}from"./C93CMuTi.js";import{f as O}from"./WElupeSM.js";import{_ as Ce}from"./DrOSxoAn.js";import{_ as De}from"./rxWbx8Xz.js";import{_ as Ie,m as ae}from"./C8j7-1Rq.js";import{_ as Ae}from"./D_bDmjDt.js";import{s as T}from"./CqK7YKqf.js";import{u as F}from"./j8H2iFUT.js";import{n as xe}from"./BxBPJGBn.js";import{c as ne}from"./BE0zBel4.js";import"./RPJY7rI9.js";import"./DD4asW33.js";import"./B2ejvlwh.js";import"./BV1GL1vA.js";import"./CpfoCNYP.js";import"./DlAUqK2U.js";import"./pQ9QSYKp.js";import"./C1V66jBN.js";const Be={class:"clan-events"},Pe={class:"clan-events__inner"},je={class:"clan-events__count"},Se={class:"clan-events__prop"},Re={key:0,class:"clan-events__prop"},Fe={class:"clan-events__prop-title"},Me={key:1,class:"clan-events__prop"},Ee={class:"clan-events__prop-title"},Oe={key:2},qe={style:{display:"flex","justify-content":"space-between"}},Ue=E({__name:"ClanEvents",props:{savedAt:{type:Number,default:0,required:!0},clan:{type:Object,default:()=>({}),required:!0},savedClan:{type:Object,default:()=>({}),required:!0}},emits:["reset"],setup(n,{emit:v}){const e=n,u=N(null),f=M(()=>{const l=e.clan.members_ids??[],g=e.savedClan.members??[];return Object.values(g).filter(h=>!l.includes(h.account_id))}),D=M(()=>{var h,k;const l=((h=e.clan)==null?void 0:h.members)??[],g=((k=e.savedClan)==null?void 0:k.members_ids)??[];return Object.values(l).filter(x=>!g.includes(x.account_id))}),$=M(()=>D.value.length+f.value.length),A=v;function w(){var l;A("reset"),(l=u.value)==null||l.doClose()}function s(){var l;(l=u.value)==null||l.doOpen()}function a(){var l;(l=u.value)==null||l.doClose()}return(l,g)=>{const h=z,k=W,x=Y,R=ie;return m(),y("div",Be,[t("div",Pe,[_(k,{disabled:!c($),class:K(["clan-events__btn",[c($)?"clan-events__btn--has-unread":""]]),"is-text":"","is-square":"",title:"События клана",onClick:s},{default:b(()=>[_(h,{name:"mail"})]),_:1},8,["disabled","class"]),t("div",je,o(c($)>99?"99+":c($)),1)]),_(R,{ref_key:"dialogRef",ref:u,width:"640px",title:"События клана"},{title:b(()=>[t("div",Se,[g[0]||(g[0]=t("span",{class:"clan-events__prop-title"}," События от ",-1)),p(" "+o(l.$formatter.date.toDateTime(n.savedAt))+" ("+o(l.$formatter.date.toDaysPassed(n.savedAt,Date.now()))+") ",1)])]),footer:b(()=>[t("div",qe,[g[3]||(g[3]=t("div",null,null,-1)),t("div",null,[_(k,{onClick:w},{default:b(()=>g[1]||(g[1]=[p(" Прочитано ")])),_:1}),_(k,{onClick:a},{default:b(()=>g[2]||(g[2]=[p(" Закрыть ")])),_:1})])])]),default:b(()=>[c(f).length?(m(),y("div",Re,[t("span",Fe," Покинули ("+o(c(f).length)+") ",1),(m(!0),y(L,null,J(c(f),(i,q)=>(m(),y("span",{key:i.account_id,class:"clan-events__prop-value"},[_(x,{to:{name:"account-id",params:{id:i.account_id}},class:"link"},{default:b(()=>[p(o(i.account_name),1)]),_:2},1032,["to"]),p(o(q+1!==c(f).length?", ":""),1)]))),128))])):P("",!0),c(D).length?(m(),y("div",Me,[t("span",Ee," Вступили ("+o(c(D).length)+") ",1),(m(!0),y(L,null,J(c(D),(i,q)=>(m(),y("span",{key:i.account_id,class:"clan-events__prop-value"},[_(x,{to:{name:"account-id",params:{id:i.account_id}},class:"link"},{default:b(()=>[p(o(i.account_name),1)]),_:2},1032,["to"]),p(o(q+1!==c(D).length?", ":""),1)]))),128))])):P("",!0),c($)?P("",!0):(m(),y("span",Oe," Пока всё тихо ... "))]),_:1},512)])}}}),Le={class:"social-links"},Te={class:"social-links__links"},Ve=["href","title"],Ne=E({__name:"SocialLinks",props:{links:{type:Array,default:()=>[],required:!0}},setup(n){return(v,e)=>(m(),y("div",Le,[t("div",Te,[(m(!0),y(L,null,J(n.links,u=>(m(),y("a",{key:u.link,class:"link social-links__links-item",href:u.link,target:"_blank",title:u.title},[(m(),j(de(u.icon)))],8,Ve))),128))])]))}}),ze=/(https?:\/\/)?(www\.)?(discord\.(gg|io|me|li)|discordapp\.com\/invite)\/.+[a-z|0-9]/gi,He=/(https?:\/\/)?(www\.)?((t|telegram)\.me)\/\+?[a-zA-Z0-9_]{5,32}/gi,Ge=n=>{const v=[],e=n.match(ze),u=n.match(He);return e!=null&&e.length&&v.push({title:"Discord",icon:Z(()=>Q(()=>import("./B7rQWyBW.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),link:e[0]}),u!=null&&u.length&&v.push({title:"Telegram",icon:Z(()=>Q(()=>import("./DrqzXMui.js"),__vite__mapDeps([6,1,2,3,4,5]),import.meta.url)),link:u[0]}),v},Je={class:"clan-preview-details__body"},Ke={key:0,class:"clan-preview-details__section"},We={class:"clan-preview-details__props-title"},Ye={class:"clan-preview-details__section"},Ze={class:"clan-preview-details__props-title"},Qe=["textContent"],Xe={key:1,class:"clan-preview-details__section"},et={class:"clan-preview-details__props-title"},tt={class:"clan-preview-details__props"},at={class:"clan-preview-details__prop"},nt={class:"clan-preview-details__prop"},st={class:"clan-preview-details__prop"},lt={class:"clan-preview-details__prop"},it={key:0,class:"clan-preview-details__prop"},ot={class:"clan-preview-details__section"},ct={class:"clan-preview-details__props-title"},rt={class:"clan-preview-details__props"},dt={class:"clan-preview-details__prop"},_t={class:"clan-preview-details__prop"},ut={class:"clan-preview-details__prop"},mt={class:"clan-preview-details__prop"},pt={class:"clan-preview-details__prop"},vt={class:"clan-preview-details__prop"},ft={style:{display:"flex","justify-content":"space-between"}},bt=E({__name:"ClanPreviewDetails",props:{clan:{type:Object,default:()=>({}),required:!0}},setup(n,{expose:v}){const e=n,u=N(null),f=V({descExpended:!1}),D=M(()=>Ge(e.clan.description??""));function $(){var s;(s=u.value)==null||s.doOpen()}function A(){var s;(s=u.value)==null||s.doClose()}function w(){f.descExpended=!f.descExpended}return v({open:$,close:A}),(s,a)=>{const l=z,g=W,h=Y,k=Ne,x=ie;return m(),j(x,{ref_key:"clanDetailsRef",ref:u,class:"clan-preview-details",title:`[${n.clan.tag}] ${n.clan.name}`,width:"640px"},{footer:b(()=>[t("div",ft,[c(D).length?(m(),j(k,{key:0,class:"clan-preview-details__links",links:c(D)},null,8,["links"])):P("",!0),_(g,{onClick:A},{default:b(()=>a[16]||(a[16]=[p(" Закрыть ")])),_:1})])]),default:b(()=>[t("div",Je,[n.clan.motto?(m(),y("div",Ke,[t("h5",We,[_(l,{class:"clan-preview-details__prop-title-icon",name:"format-quote"}),a[0]||(a[0]=p(" Девиз "))]),t("i",null,o(n.clan.motto),1)])):P("",!0),t("div",Ye,[t("h5",Ze,[_(l,{class:"clan-preview-details__prop-title-icon",name:"description"}),a[1]||(a[1]=p(" Описание "))]),n.clan.description?(m(),y("div",{key:0,class:K(["content-area clan-preview-details__desc",c(f).descExpended?"clan-preview-details__desc--expended":""]),textContent:o(n.clan.description)},null,10,Qe)):P("",!0),_(g,{"is-text":"",class:"clan-preview-details__desc-expend-btn",onClick:w},{default:b(()=>[p(o(c(f).descExpended?"Свернуть":"Развернуть"),1)]),_:1})]),n.clan.motto?(m(),y("div",Xe,[t("h5",et,[_(l,{class:"clan-preview-details__prop-title-icon",name:"info"}),a[2]||(a[2]=p(" Информация "))]),t("div",tt,[t("div",at,[a[3]||(a[3]=t("span",{class:"clan-preview-details__prop-title"}," Создатель ",-1)),n.clan.creator_id?(m(),j(h,{key:0,class:"link",to:n.clan.creator_id?{name:"account-id",params:{id:n.clan.creator_id}}:{}},{default:b(()=>[p(o(n.clan.creator_name),1)]),_:1},8,["to"])):(m(),y(L,{key:1},[p(" Не известен ")],64))]),t("div",nt,[a[4]||(a[4]=t("span",{class:"clan-preview-details__prop-title"}," Дата создания ",-1)),p(" "+o(s.$formatter.date.toDate(n.clan.created_at*1e3)),1)]),t("div",st,[a[5]||(a[5]=t("span",{class:"clan-preview-details__prop-title"}," Дата обновления ",-1)),p(" "+o(s.$formatter.date.toDate(n.clan.updated_at*1e3)),1)]),t("div",lt,[a[6]||(a[6]=t("span",{class:"clan-preview-details__prop-title"}," Участников ",-1)),p(" "+o(s.$formatter.number.toInteger(n.clan.members_count)),1)]),n.clan.old_tag?(m(),y("div",it,[a[7]||(a[7]=t("span",{class:"clan-preview-details__prop-title"}," Старое название ",-1)),p(" ["+o(n.clan.old_tag)+"] "+o(n.clan.old_name),1)])):P("",!0)])])):P("",!0),t("div",ot,[t("h5",ct,[_(l,{class:"clan-preview-details__prop-title-icon",name:"person-search"}),a[8]||(a[8]=p(" Рекрутинг "))]),t("div",rt,[t("div",dt,[a[9]||(a[9]=t("span",{class:"clan-preview-details__prop-title"}," Политика приёма. ",-1)),p(" "+o(s.$formatter.clan.recruitingPolicy(n.clan.recruiting_policy))+". ",1)]),n.clan.recruiting_policy==="open"&&n.clan.recruiting_options?(m(),y(L,{key:0},[a[15]||(a[15]=t("div",{class:"clan-preview-details__props-subtitle"}," Пороги статистики для вступления: ",-1)),t("div",_t,[a[10]||(a[10]=t("span",{class:"clan-preview-details__prop-title"}," Боёв в день ",-1)),p(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.average_battles_per_day)),1)]),t("div",ut,[a[11]||(a[11]=t("span",{class:"clan-preview-details__prop-title"}," Боёв всего ",-1)),p(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.battles)),1)]),t("div",mt,[a[12]||(a[12]=t("span",{class:"clan-preview-details__prop-title"}," Урон ср. ",-1)),p(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.average_damage)),1)]),t("div",pt,[a[13]||(a[13]=t("span",{class:"clan-preview-details__prop-title"}," Уровень ",-1)),p(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.vehicles_level)),1)]),t("div",vt,[a[14]||(a[14]=t("span",{class:"clan-preview-details__prop-title"}," Побед ",-1)),p(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.wins_ratio))+"% ",1)])],64)):P("",!0)])])])]),_:1},8,["title"])}}}),wt={class:"clan-preview"},gt={class:"clan-preview__inner"},yt={class:"clan-preview__emblem"},ht={class:"clan-preview__info"},$t={class:"clan-preview__title"},kt={class:"clan-preview__tag"},Ct={class:"clan-preview__name"},Dt={class:"clan-preview__props"},It={class:"clan-preview__prop"},At={class:"clan-preview__prop-value"},xt={class:"clan-preview__prop"},Bt={class:"clan-preview__prop-value"},Pt={class:"clan-preview__actions"},jt=E({__name:"ClanPreview",props:{clan:{type:Object,default:()=>({}),required:!0},hideDescription:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},setup(n){const v=n,e=N(null),u=we(),f=V({isFavorite:!1});le(()=>{D()});async function D(){const{$indexedDB:a}=U(),l=await a.clansFavorites.get(v.clan.clan_id);f.isFavorite=l?l==null?void 0:l.isFavorite:!1}async function $(){if(!v.clan)return;f.isFavorite=!f.isFavorite;const{$indexedDB:a}=U();await a.clansFavorites.set(v.clan.clan_id,{id:v.clan.clan_id,isFavorite:f.isFavorite})}async function A(){await ge(`${v.clan.tag}/${v.clan.clan_id}`)?u.add({type:"success",title:"Скопировано",message:`${v.clan.tag}/${v.clan.clan_id}`,duration:3e3}):u.add({type:"error",message:"Клан копировании что-то пошло не так",duration:3e3})}function w(){var a;(a=e.value)==null||a.open()}function s(){$()}return(a,l)=>{const g=be,h=z,k=W,x=oe,R=bt;return m(),y("div",wt,[t("div",gt,[t("div",yt,[_(g,{class:"clan-preview__emblem-img",alt:n.clan.name,emblem:n.clan.emblem_set_id},null,8,["alt","emblem"])]),t("div",ht,[t("div",$t,[t("span",kt,"["+o(n.clan.tag??"...")+"]",1),t("span",Ct,o(n.clan.name??"..."),1)]),t("div",Dt,[t("div",It,[l[0]||(l[0]=t("span",{class:"clan-preview__prop-title"}," Участников ",-1)),t("span",At,o(n.clan.members_count??"---"),1)]),t("div",xt,[l[1]||(l[1]=t("span",{class:"clan-preview__prop-title"}," События ",-1)),t("span",Bt,[_e(a.$slots,"events")])])])]),t("div",Pt,[_(k,{"is-text":"",class:"clan-preview__actions-btn",title:"Копировать (nickname/ID)",onClick:A},{default:b(()=>[_(h,{name:"content-copy"})]),_:1}),_(k,{"is-text":"",class:"clan-preview__actions-btn",title:"Добавить в избранные",onClick:s},{default:b(()=>[c(f).isFavorite?(m(),j(h,{key:0,name:"star"})):(m(),j(h,{key:1,name:"star-border"}))]),_:1}),_(k,{"is-text":"",class:"clan-preview__actions-btn",title:"Полная информация",onClick:w},{default:b(()=>[_(h,{name:"info"})]),_:1})])]),_(x,{loading:n.loading},null,8,["loading"]),_(R,{ref_key:"previewDetailsRef",ref:e,clan:n.clan},null,8,["clan"])])}}}),St={class:"clan-view-filters"},Rt={class:"clan-view-filters__list"},Ft={class:"clan-view-filters__item clan-view-filters__item--search"},Mt={class:"clan-view-filters__item"},Et={class:"clan-view-filters__item"},Ot=E({__name:"ClanViewFilter",props:{filters:{type:Object,required:!0,default:O.makeClanFilters}},emits:["filters-change"],setup(n,{emit:v}){const e=n,u=[{value:null,label:"Не выбрано"},{value:"<3",label:"Меньше чем 3"},{value:"<5",label:"Меньше чем 5"},{value:"<7",label:"Меньше чем 7"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],f=[{value:null,label:"Не выбрано"},{value:"<1",label:"Меньше чем 1"},{value:"<3",label:"Меньше чем 3"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],D=v;function $(A,w){D("filters-change",{...e.filters,[A]:w})}return(A,w)=>{const s=$e,a=ke;return m(),y("div",St,[t("div",Rt,[t("div",Ft,[w[3]||(w[3]=t("div",{class:"clan-view-filters__item-title"}," Поиск в клане ",-1)),_(s,{"model-value":n.filters.search,style:{width:"100%"},placeholder:"Введите ник",type:"search","onUpdate:modelValue":w[0]||(w[0]=l=>$("search",l))},null,8,["model-value"])]),t("div",Mt,[w[4]||(w[4]=t("div",{class:"clan-view-filters__item-title"}," Дней в клане ",-1)),_(a,{"model-value":n.filters.joinedAtDays,style:{width:"150px"},options:u,onChange:w[1]||(w[1]=l=>$("joinedAtDays",l))},null,8,["model-value"])]),t("div",Et,[w[5]||(w[5]=t("div",{class:"clan-view-filters__item-title"}," Дней отсутствовал ",-1)),_(a,{"model-value":n.filters.lastBattleDays,style:{width:"150px"},options:f,onChange:w[2]||(w[2]=l=>$("lastBattleDays",l))},null,8,["model-value"])])])])}}}),qt={class:"clan-view-table"},Ut={class:"clan-view-table__total"},Lt={class:"clan-view-table__total-value"},Tt={class:"clan-view-table__member"},Vt=["title"],Nt={key:0,class:"clan-view-table__name clan-view-table__name--deleted"},zt={class:"clan-view-table__sub"},Ht={class:"clan-view-table__sub"},Gt={class:"clan-view-table__sub"},Jt={class:"clan-view-table__sub"},Kt={class:"clan-view-table__sub"},Wt={class:"clan-view-table__sub"},Yt=E({__name:"ClanViewMembersTable",props:{members:{type:Array,default:()=>[],required:!0},savedMembers:{type:Array,default:()=>[],required:!0},users:{type:Array,default:()=>[],required:!0},sort:{type:Object,default:()=>({}),required:!0}},emits:["sort"],setup(n,{emit:v}){const e=n,u=v,f=[{key:"account_name",label:"Ник",sortable:!0},{key:"battles",label:"Боёв",sortable:!0,sortMethod(s,a){return s.statistic.all.battles-a.statistic.all.battles}},{key:"winRate",label:"Побед",sortable:!0,sortMethod(s,a){return s.statistic.all.winRate-a.statistic.all.winRate}},{key:"damagePerBattle",label:"Урон",sortable:!0,sortMethod(s,a){return s.statistic.all.damagePerBattle-a.statistic.all.damagePerBattle}},{key:"rating",label:"Рейтинг",sortable:!0,sortMethod(s,a){var h,k;const l=((h=s.statistic.rating)==null?void 0:h.rating)??0,g=((k=a.statistic.rating)==null?void 0:k.rating)??0;return l-g}},{key:"battlesPerDay",label:"Боёв в день",sortable:!0},{key:"last_battle_time",label:"Последний бой",sortable:!0},{key:"joined_at",label:"В клане",sortable:!0}],D=M(()=>e.members.map(s=>{const a=e.savedMembers.find(x=>x.account_id===s.account_id),l=a?T.diff(s.statistic.all,a.statistic.all):null,g=T.battlesPerDay({createAt:s.create_at*1e3,battles:s.statistic.all.battles}),h=l?T.battlesPerDay({battles:s.statistic.all.battles-l.battles,createAt:s.create_at*1e3}):null,k=h?g-h:null;return{...s,battlesPerDay:g,battlesPerDayDiff:k,diff:l}}));function $(s){const a=e.users.find(l=>l.id===s.account_id);return a?{found:!0,online:Date.now()-new Date(a.visitedAt).valueOf()<1e3*60*5}:{found:!1,online:!1}}function A(s){const a=s;return/^del_\d+$/.test(a.account_name)||!a.last_battle_time}function w(s,a){const l=a;return l.diff?s==="winRate"?X.number.toFloatNumber(l.diff[s],!0):X.number.toInteger(l.diff[s],!0):"---"}return(s,a)=>{const l=Ce,g=z,h=Y,k=De,x=Ie,R=Ae;return m(),y("div",qt,[t("div",Ut,[a[1]||(a[1]=p(" Кол-во: ")),t("span",Lt,o(c(D).length||0),1)]),c(D)?(m(),j(R,{key:0,data:c(D),"default-sort":n.sort,headers:f,"no-wrap":"","scroll-auto-disabling":"","row-key":"account_id",height:"calc(100vh - 112px)",class:"clan-view-table__table",onSort:a[0]||(a[0]=i=>u("sort",i))},{account_name:b(({row:i})=>[t("span",Tt,[t("span",{class:K(["clan-view-table__role",["clan-view-table__role--"+i.role,$(i).found?"clan-view-table__role--is-user":"",$(i).online?"clan-view-table__role--is-online":""]]),title:s.$formatter.clan.role(i.role)??"Не известна"},[i.role?(m(),j(l,{key:0,width:"18",height:"18",class:"clan-view-table__role-icon",role:i.role},null,8,["role"])):(m(),j(g,{key:1,style:{width:"16px",color:"var(--color-text-light)"},name:"close"}))],10,Vt),A(i)?(m(),y("span",Nt,o(i.account_name),1)):(m(),j(h,{key:1,class:"link clan-view-table__name",to:{name:"account-id",params:{id:i.account_id}}},{default:b(()=>[p(o(i.account_name),1)]),_:2},1032,["to"]))])]),battles:b(({row:i})=>[p(o(i.statistic.all.battles||"---")+" ",1),t("span",zt,o(w("battles",i)||"---"),1)]),winRate:b(({row:i})=>[_(k,{"win-rate":i.statistic.all.winRate,class:"clan-view-table__win-rate"},null,8,["win-rate"]),t("span",Ht,o(w("winRate",i)||"---"),1)]),rating:b(({row:i})=>[_(x,{rating:i.statistic.rating},null,8,["rating"])]),damagePerBattle:b(({row:i})=>[p(o(i.statistic.all.damagePerBattle||"---")+" ",1),t("span",Gt,o(w("damagePerBattle",i)),1)]),battlesPerDay:b(({row:i})=>[p(o(i.battlesPerDay||"---")+" ",1),t("span",Jt,o(s.$formatter.number.toInteger(i.battlesPerDayDiff,!0)||"---"),1)]),last_battle_time:b(({row:i})=>[p(o(s.$formatter.date.toRelativeTime(i.last_battle_time*1e3)||"---")+" ",1),t("span",Kt,o(s.$formatter.date.toDateTime(i.last_battle_time*1e3)||"---"),1)]),joined_at:b(({row:i})=>[p(o(s.$formatter.date.toDaysPassed(i.joined_at*1e3)||"---")+" ",1),t("span",Wt,o(s.$formatter.date.toDate(i.joined_at*1e3)||"---"),1)]),_:1},8,["data","default-sort"])):P("",!0)])}}}),Zt=(n,v)=>{const{prop:e,order:u}=v;return u?n.toSorted((f,D)=>{const $=(u==="desc"?D:f)[e],A=(u==="desc"?f:D)[e];return String($).localeCompare(String(A),void 0,{numeric:!0,sensitivity:"base"})}):n},Qt=n=>{n.sort((v,e)=>v.joined_at-e.joined_at)},Xt=n=>{n.sort((v,e)=>{const u={recruit:0,private:1,executive_officer:2,commander:3};return u[e.role]-u[v.role]})},ea=n=>{Qt(n),Xt(n)},se={smart:Zt,clanMembersDefault:ea},ta={key:0,class:"clan-page"},aa={key:1,class:"clan-page--no-data"},na={key:0,class:"content-area"},Sa=E({__name:"[id]",setup(n){ue({title:"Инфо / Кланы"});const v=me(),e=V({loading:0,users:[],clanInfo:null,clan:null,filters:O.makeClanFilters(),statisticsSum:null,savedMembers:[],savedClan:null,metricsItems:te.clan(),clanSavedAt:0,sessionUpdateAt:0,sessionActive:!1}),u=V({order:"desc",prop:""}),f=M(()=>{var d;return((d=e.clan)==null?void 0:d.members)||[]}),D=M(()=>{let d=f.value.filter(C=>{const B=C.account_name.toLowerCase(),I=e.filters.search.toLowerCase();return B.includes(I)});const r=Date.now();if(e.filters.joinedAtDays){const C=O.parseParameter(e.filters.joinedAtDays);d=f.value.filter(B=>O.executeExpression(r-Number(C.value)*ee,B.joined_at*1e3,C.operator))}if(e.filters.lastBattleDays){const C=O.parseParameter(e.filters.lastBattleDays);d=f.value.filter(B=>O.executeExpression(r-Number(C.value)*ee,B.last_battle_time*1e3,C.operator))}return d}),$=N(!1);le(async()=>{await g(),$.value=!0});async function A(d){e.loading++;try{const{data:r}=await G.clan.getAccountInfo({account_id:d.join(",")});return r}catch(r){return F(r,{title:"Получение данных участников клана"}),null}finally{e.loading--}}async function w(d){e.loading++;try{const{data:r}=await G.clan.getInfo({clan_id:d});e.clanInfo=r[d]??null}catch(r){F(r,{title:"Получение данных клана"})}e.loading--}async function s(d){e.loading++;try{const{data:r}=await ve.user.getList({id:d});e.users=r}catch(r){F(r,{title:"Получение данных аккаунта"})}e.loading--}async function a(d){e.loading++;try{const{data:r}=await G.account.getInfo({extra:"statistics.rating",account_id:d.join(",")});return r}catch(r){return F(r,{title:"Получение данных аккаунта"}),null}finally{e.loading--}}async function l(d){await Promise.all([h(d),x(d)])}async function g(){const d=+v.params.id;if(!d||(await w(d),!e.clanInfo))return;const r=await A(e.clanInfo.members_ids);e.clanInfo.members||(e.clanInfo.members={});for(const I in r){const S=r[I];S&&(e.clanInfo.members[I]={account_id:S.account_id,account_name:S.account_name,joined_at:S.joined_at,role:S.role})}await Promise.all([s(e.clanInfo.members_ids),l(e.clanInfo)]),e.savedClan||await k(e.clanInfo);const C=await a(e.clanInfo.members_ids);if(!C)return;e.clan=ae.clan(e.clanInfo,C);const B=Object.values(C).filter(xe);e.statisticsSum=B.reduce((I,S,H)=>H===0?B[0].statistics:T.sumFull(I,S.statistics),{}),e.metricsItems=te.clan(B,e.statisticsSum),se.clanMembersDefault(f.value)}async function h(d){e.loading++;try{const r=[],{$indexedDB:C}=U();for(const B in d.members){const I=await C.accountsInfo.get(B);I&&(I.data.created_at=I.timestamp,I.timestamp>e.sessionUpdateAt&&(e.sessionUpdateAt=I.timestamp),r.push(ae.clanMember(d.members[B],I.data)))}e.savedMembers=r}catch(r){F(r,{title:"Загрузка локальных данных аккаунтов"})}e.loading--}async function k(d){e.loading++;try{const{$indexedDB:r}=U();await r.clansInfo.set(d.clan_id,pe(d)),e.savedClan=ne(d),e.clanSavedAt=Date.now()}catch(r){F(r,{title:"Локальное сохранение данных аккаунтов"})}e.loading--}async function x(d){e.loading++;try{const{$indexedDB:r}=U(),C=await r.clansInfo.get(d.clan_id);e.savedClan=(C==null?void 0:C.data)??null,e.clanSavedAt=(C==null?void 0:C.timestamp)??0}catch(r){F(r,{title:"Загрузка локальных данных клана"})}e.loading--}function R(d){d.order||se.clanMembersDefault(f.value)}async function i(){e.clanInfo&&await k(e.clanInfo)}function q(d){e.filters=ne(d)}return(d,r)=>{const C=Ue,B=jt,I=ye,S=he,H=Ot,ce=Yt,re=oe;return c(e).clanInfo?(m(),y("div",ta,[_(I,{identity:"preview"},{default:b(()=>[_(B,{class:"clan-page__preview","hide-description":!0,clan:c(e).clanInfo,loading:c(e).loading>0},fe({_:2},[c(e).clanInfo&&c(e).savedClan?{name:"events",fn:b(()=>[_(C,{clan:c(e).clanInfo,"saved-clan":c(e).savedClan,"saved-at":c(e).clanSavedAt,onReset:i},null,8,["clan","saved-clan","saved-at"])]),key:"0"}:void 0]),1032,["clan","loading"])]),_:1}),_(I,{title:"Статистика",identity:"statistic"},{default:b(()=>[_(S,{loading:c(e).loading>0,items:c(e).metricsItems},null,8,["loading","items"])]),_:1}),_(I,{title:"Участники",identity:"members"},{default:b(()=>[_(H,{class:"clan-page__filters",filters:c(e).filters,onFiltersChange:q},null,8,["filters"]),_(ce,{sort:c(u),users:c(e).users,"saved-members":c(e).savedMembers,members:c(D),onSort:R},null,8,["sort","users","saved-members","members"])]),_:1})])):(m(),y("div",aa,[c($)?(m(),y("div",na,r[0]||(r[0]=[t("p",null,"Нет данных.",-1),t("p",null,"Возможно клан удалён.",-1)]))):P("",!0),_(re,{loading:!c($)},null,8,["loading"])]))}}});export{Sa as default};
