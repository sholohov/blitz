import{_ as R}from"./BwHplgHP.js";import{_ as j}from"./iTp3qQA6.js";import{_ as q}from"./CX4hQkTI.js";import{d as M,e as D,g as _,o as m,f as P,w as c,s as e,j as d,v as s,t as r,q as A,F as w,y as E,u as G,a as H,b as W,k as J,l as C,x as u,m as K,G as O,p as L,n as U,h as Q}from"./BytUdlbn.js";import{_ as X}from"./QCHe77Wz.js";import{_ as Y}from"./B-cWSxsJ.js";import{_ as Z}from"./Bt0MSxaA.js";import{u as tt}from"./1T5zVu7K.js";import{_ as et}from"./D4jFUD0b.js";import{c as at}from"./B4FMxlHh.js";import{s as ot}from"./rFoUnFSB.js";import"./DlbbhUVy.js";import"./DD4asW33.js";const nt={style:{display:"flex","align-items":"center",gap:"14px",padding:"10px"}},st={style:{display:"flex","flex-direction":"column","align-items":"center"}},lt={style:{"font-size":"12px","font-weight":"500",margin:"4px 0 0"}},rt={style:{margin:"0 0 8px 0"}},it={style:{display:"flex","align-items":"center",gap:"20px"}},ct={style:{display:"flex",gap:"10px"}},dt={style:{display:"inline-flex","flex-direction":"column","font-size":"14px"}},ut={style:{"font-size":"12px",color:"var(--color-text-light)"}},pt={style:{display:"flex",gap:"10px"}},_t={style:{display:"inline-flex","flex-direction":"column","font-size":"14px"}},mt={style:{"font-size":"12px",color:"var(--color-text-light)"}},bt={style:{display:"flex",gap:"10px"}},ft={style:{display:"inline-flex","flex-direction":"column","font-size":"14px"}},gt={style:{"font-size":"12px",color:"var(--color-text-light)"}},yt={class:"leaderboards-accounts-table__nickname"},ht={class:"leaderboards-accounts-table__sub"},xt={class:"leaderboards-accounts-table__sub"},kt={class:"leaderboards-accounts-table__sub"},vt={class:"leaderboards-accounts-table__sub"},$t={class:"leaderboards-accounts-table__sub"},It={class:"leaderboards-accounts-table__sub"},Pt=M({__name:"LeaderboardAccountTable",props:{items:{type:Array,default:()=>[],required:!0},headers:{type:Array,default:()=>[],required:!0}},setup(h){const B=D(()=>tt().isTablet);return(i,z)=>{const o=j,p=q,g=E,x=X,F=Y,N=Z;return _(B)?(m(),P(F,{key:0,ref:"accountsTable","no-wrap":"","row-key":"id","scroll-to-top":"","scroll-auto-disabling":"",data:h.items,height:"calc(100vh - 112px)"},{default:c(({row:t})=>{var l,b,k;return[e("div",nt,[e("span",st,[d(o,{position:t.position},null,8,["position"]),e("span",lt,s(t.xp_per_battle),1)]),e("div",null,[e("div",rt,[d(p,{style:{"font-weight":"500"},class:"link",to:{name:"account-id",params:{id:t.id}}},{default:c(()=>[r(s(t.nickname),1)]),_:2},1032,["to"]),t.clan?(m(),P(p,{key:0,class:"link",to:{name:"clan-id",params:{id:t.clan.clan_id}}},{default:c(()=>[r(" ["+s(t.clan.tag)+"] ",1)]),_:2},1032,["to"])):(m(),A(w,{key:1},[r(" [ --- ] ")],64))]),e("div",it,[e("span",ct,[d(g,{name:"sword-cross",size:"18",style:{color:"var(--color-text-light)"}}),e("span",dt,[r(s(i.$formatter.number.toInteger(t.battles))+" ",1),e("span",ut,s(i.$formatter.number.toInteger((l=t.stat)==null?void 0:l.battles)||"---"),1)])]),e("span",pt,[d(g,{name:"flag-variant",size:"18",style:{color:"var(--color-text-light)"}}),e("span",_t,[d(x,{"win-rate":t.win_rate},null,8,["win-rate"]),e("span",mt,s(i.$formatter.number.toFloatPercent((b=t.stat)==null?void 0:b.winRate)??"---"),1)])]),e("span",bt,[d(g,{name:"destruction",size:"18",style:{color:"var(--color-text-light)"}}),e("span",ft,[r(s(i.$formatter.number.toInteger(t.damage_per_battle))+" ",1),e("span",gt,s(i.$formatter.number.toInteger((k=t.stat)==null?void 0:k.damagePerBattle)),1)])])])])])]}),_:1},8,["data"])):(m(),P(N,{key:1,ref:"accountsTable","no-wrap":"","row-key":"id","scroll-to-top":"","scroll-auto-disabling":"",headers:h.headers,data:h.items,height:"calc(100vh - 112px)"},{nickname:c(({row:t})=>[e("div",yt,[d(o,{class:"leaderboards-accounts-table__nickname-mark",position:t.position},null,8,["position"]),d(p,{class:"leaderboards-accounts-table__nickname-link link",to:{name:"account-id",params:{id:t.id}}},{default:c(()=>[r(s(t.nickname),1)]),_:2},1032,["to"])])]),clan:c(({row:t})=>[t.clan?(m(),P(p,{key:0,class:"leaderboards-accounts-table__clan link",to:{name:"clan-id",params:{id:t.clan.clan_id}}},{default:c(()=>[r(s(t.clan.tag),1)]),_:2},1032,["to"])):(m(),A(w,{key:1},[r(" --- ")],64))]),battles:c(({row:t})=>{var l;return[r(s(t.battles)+" ",1),e("div",ht,s(i.$formatter.number.toInteger((l=t.stat)==null?void 0:l.battles)||"---"),1)]}),win_rate:c(({row:t})=>{var l;return[d(x,{"win-rate":t.win_rate,class:"leaderboards-accounts-table__win-rate"},null,8,["win-rate"]),e("div",xt,s(i.$formatter.number.toFloatPercent((l=t.stat)==null?void 0:l.winRate)||"---"),1)]}),damage_per_battle:c(({row:t})=>{var l;return[r(s(t.damage_per_battle)+" ",1),e("div",kt,s(i.$formatter.number.toInteger((l=t.stat)==null?void 0:l.damagePerBattle)||"---"),1)]}),frags_per_battle:c(({row:t})=>{var l,b;return[r(s(t.frags_per_battle)+" / "+s(t.frags8p_per_battle)+" ",1),e("div",vt,s(i.$formatter.number.toFloatNumber((l=t.stat)==null?void 0:l.fragPerBattle)||"---")+" / "+s(i.$formatter.number.toFloatNumber((b=t.stat)==null?void 0:b.frag8pPerBattle)||"---"),1)]}),xp_per_battle:c(({row:t})=>{var l;return[r(s(t.xp_per_battle)+" ",1),e("div",$t,s(i.$formatter.number.toInteger((l=t.stat)==null?void 0:l.xpPerBattle)||"---"),1)]}),spotted_per_battle:c(({row:t})=>{var l;return[r(s(t.spotted_per_battle)+" ",1),e("div",It,s(i.$formatter.number.toInteger((l=t.stat)==null?void 0:l.spottedPerBattle)||"---"),1)]}),_:1},8,["headers","data"]))}}}),Lt={class:"leaderboards-accounts-page"},At={key:0,class:"leaderboards-accounts-page__user-position"},Bt={class:"leaderboards-accounts-page__filters"},zt={class:"leaderboards-accounts-page__filters-item"},Ft={class:"leaderboards-accounts-page__filters-item"},Et=M({__name:"accounts",setup(h){const{$formatter:B}=G(),i=H();W({title:()=>B.route.getTitle(at.toString(i.name)??"")});const z=J(),o=C({loading:0,tanks:[],accountsLeaderboard:[],userOnLeaderboard:null,items:[],clanAccounts:null,accounts:null}),p=C({page:1,pageSize:99,period:7,battlesPerDay:10,battlesMin:1e4}),g=[7,14,30,60,90].map(a=>({value:a,label:new Intl.NumberFormat("ru",{style:"unit",unit:"day",unitDisplay:"long"}).format(a)})),x=[{label:"От 1к",value:1e3},{label:"от 5к",value:5e3},{label:"от 10к",value:1e4},{label:"от 30к",value:3e4}],F=[{key:"nickname",label:"Ник"},{key:"clan",label:"Клан"},{key:"xp_per_battle",label:"Опыт",tooltip:u.stat.accountProp("xp"),formatter:a=>u.number.toInteger(a)},{key:"battles",label:"Бои",tooltip:u.stat.accountProp("battles"),formatter:a=>u.number.toInteger(a)},{key:"win_rate",label:"Победы",tooltip:u.stat.accountProp("winRate"),formatter:a=>u.number.toFloatNumber(a)},{key:"damage_per_battle",label:"Урон",tooltip:u.stat.accountProp("damagePerBattle"),formatter:a=>u.number.toInteger(a)},{key:"frags_per_battle",label:"Уничт. / ур. >= 8",tooltip:u.stat.accountProp("fragPerBattle"),formatter:a=>u.number.toFloatNumber(a)},{key:"spotted_per_battle",label:"Обн.",tooltip:u.stat.accountProp("spotted"),formatter:a=>u.number.toFloatNumber(a)}];K(()=>{V()});async function N(a){o.loading++;try{const{data:n}=await U.account.getInfo({extra:"statistics.rating",account_id:a.join(",")});o.accounts=n??null}catch(n){o.accounts=null,L(n,{title:"Поучение списка аккаунтов"})}o.loading--}async function t(a){o.loading++;try{const{data:n}=await U.clan.getAccountInfo({extra:"clan",account_id:a.join(",")});o.clanAccounts=n??null}catch(n){o.clanAccounts=null,L(n,{title:"Ошибка поучения списка клановых аккаунтов"})}o.loading--}async function l(){o.loading++;try{const{data:a}=await O.leaderboards.getAccounts(p);o.accountsLeaderboard=a}catch(a){o.accountsLeaderboard=[],L(a,{title:"Получение рейтинга игроков"})}o.loading--}async function b(){o.loading++;try{const{data:a}=await O.leaderboards.getAccounts({...p,ids:[z.accountId]});o.userOnLeaderboard=a[0]}catch(a){o.userOnLeaderboard=null,L(a,{title:"Получение рейтинга пользователя"})}o.loading--}async function k(){const a=o.accountsLeaderboard.map(n=>n.id);a.length&&(await Promise.allSettled([t(a),N(a)]),o.items=o.accountsLeaderboard.map(n=>{var I,y,f,T;const v=(y=(I=o.clanAccounts)==null?void 0:I[n.id])==null?void 0:y.clan,$=(T=(f=o.accounts)==null?void 0:f[n.id])==null?void 0:T.statistics;return{...n,stat:$?ot.accountAll($.all):null,clan:v??null}}))}async function V(){await Promise.all([l(),z.accountId?b():null]),await k()}function S(){V()}return(a,n)=>{var y;const v=R,$=Pt,I=et;return m(),A("div",Lt,[n[6]||(n[6]=e("div",{class:"leaderboards-accounts-page__description content-area"},[e("h2",null,"Топ «Опытных» игроков"),e("p",null,'Чем выше средний "Опыт", тем выше ваша позиция в рейтинге.'),e("p",null,"Условия участия:"),e("ol",null,[e("li",null,"Быть авторизованным на ресурсе не менее 3-х дней"),e("li",null,'Провести суммарно не менее 10 "обычных" боёв в сутки')])],-1)),_(o).userOnLeaderboard?(m(),A("div",At,[n[2]||(n[2]=r(" Ваша позиция в рейтинге: ")),e("b",null,s((y=_(o).userOnLeaderboard)==null?void 0:y.position),1),n[3]||(n[3]=r(". "))])):Q("",!0),e("div",Bt,[e("div",zt,[n[4]||(n[4]=r(" За период: ")),d(v,{modelValue:_(p).period,"onUpdate:modelValue":n[0]||(n[0]=f=>_(p).period=f),style:{width:"120px"},options:_(g),onChange:S},null,8,["modelValue","options"])]),e("div",Ft,[n[5]||(n[5]=r(" Боёв: ")),d(v,{modelValue:_(p).battlesMin,"onUpdate:modelValue":n[1]||(n[1]=f=>_(p).battlesMin=f),style:{width:"120px"},options:x,onChange:S},null,8,["modelValue"])])]),d($,{headers:F,items:_(o).items},null,8,["items"]),d(I,{loading:_(o).loading>0},null,8,["loading"])])}}});export{Et as default};
