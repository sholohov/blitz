import{_ as S}from"./nuxt-link.vBf0PoaZ.js";import{h as N,_ as D,a as E}from"./disableScroll.BMhynJqB.js";import{_ as T}from"./TablePagination.vue.DVEjoycq.js";import{_ as j}from"./UiTable.vue.BVfjirGu.js";import{a as z,s as m,_ as V}from"./request.DYurK6w5.js";import{f as q,u as A,n as d,i as O,q as P,c as p,a as l,b as o,w as i,k as r,s as f,o as _,j as R,t as g,F as U,d as H}from"./entry.BCxoBdpj.js";import{n as L}from"./notEmpty.BxBPJGBn.js";import{_ as M}from"./ClanEmblem.vue.CnbRVmgc.js";import"./UiImage.vue.DS0P_sJE.js";import"./image-broken.I0tdFF4R.js";import"./nuxt-icon.j5VLktT_.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const W={class:"clan-favorites-page"},G=l("div",{class:"clan-favorites-page__description content-area",style:{"max-width":"800px"}},[l("p",null,' Список кланов добавленных в "Избранные". Данные хранятся в браузере. '),l("p",null,' Добавить в избранное, можно нажав "Звёздочку" превью на странице клана. ')],-1),J={class:"clan-favorites-page__inner"},K={class:"clan-favorites-page__name"},ra=q({__name:"favorites",setup(Q){A({title:"Избранное / Кланы"});const t=d({clans:[],favoritesIds:null,loading:0}),s=d({total:0,page:1,pageSize:100}),u=[{key:"tag",label:"Название"},{key:"members_count",align:"center",label:"Уч-ков"},{key:"updated_at",label:"Обновлён",formatter:a=>a&&typeof a=="number"?f.date.toRelativeTime(a*1e3):"---"},{key:"created_at",label:"Создан",formatter:a=>a?f.date.toDate(Number(a)*1e3):"---"},{key:"actions",width:60}],v=O(()=>{const a=s.page*s.pageSize,n=a-s.pageSize;return(t.favoritesIds??[]).slice(n,a)});P(()=>{c()});async function h(a){t.loading++;try{const{data:n}=await z.clan.getInfo({clan_id:a.join(",")});t.clans=Object.values(n).filter(L)??[]}catch(n){N(n,{title:"Получение данных клана"})}t.loading--}async function y(){const a=await m.indexedDB.clansFavorites.getAll();t.favoritesIds=(a??[]).filter(n=>n.isFavorite).map(n=>n.id),s.total=t.favoritesIds.length}async function c(){var a;t.favoritesIds||await y(),(a=t.favoritesIds)!=null&&a.length&&await h(v.value)}async function b(a){await m.indexedDB.clansFavorites.remove(a),t.clans.length<s.total?t.clans=t.clans.filter(n=>n.clan_id!==a):await c()}async function k(){await c()}return(a,n)=>{const x=S,I=D,B=E,C=T,$=j,F=V;return _(),p("div",W,[G,l("div",J,[o($,{"no-wrap":"","scroll-to-top":"","scroll-auto-disabling":"",headers:u,data:r(t).clans,height:"calc(100vh - 112px)"},{tag:i(({row:e})=>[e!=null&&e.tag&&(e!=null&&e.name)?(_(),R(x,{key:0,class:"clan-favorites-page__details link",to:{name:"clan-id",params:{id:e.clan_id}}},{default:i(()=>[o(M,{class:"clan-favorites-page__emblem",alt:e.tag,emblem:e.emblem_set_id},null,8,["alt","emblem"]),l("span",K," ["+g(e.tag)+"] "+g(e.name),1)]),_:2},1032,["to"])):(_(),p(U,{key:1},[H(" Удалён ")],64))]),actions:i(({row:e})=>[o(B,{title:"Удалить","is-text":"","is-square":"",onClick:X=>b(e.clan_id)},{default:i(()=>[o(I,{name:"delete"})]),_:2},1032,["onClick"])]),footer:i(()=>[o(C,{pagination:r(s),onChange:k},null,8,["pagination"])]),_:1},8,["data"]),o(F,{loading:r(t).loading>0},null,8,["loading"])])])}}});export{ra as default};
