const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./qhzwaMnq.js","./CpfoCNYP.js","./DlAUqK2U.js","./DJlEGeV1.js","./entry.Brd7_UbU.css","./nuxt-icon.MfBulapQ.css","./CMNy-woT.js","./CSLC2_Ak.js","./D0cYrKZZ.js"])))=>i.map(i=>d[i]);
import{N as Bt}from"./CpfoCNYP.js";import{Q as Ot,o as f,l as b,m as s,d as N,c as M,n as B,h as _,E as X,f as r,t as y,g as P,r as z,j as Q,e as L,w as A,q as I,F as K,B as at,_ as lt,v as tt,p as st,D as dt,k as xt,s as W,x as Et,y as Mt,z as He,T as ee,R as Ge,S as J,G as ae,H as kt,I as yt,C as Nt,A as Dt,U as Pt,V as ze,W as Ze,X as Ke,Y as We,Z as Xe,$ as Qe,a0 as Ye,a1 as Je,a2 as ta,a3 as ea,a4 as aa,a5 as na,a as sa,a6 as Tt,a7 as It,K as gt}from"./DJlEGeV1.js";import{_ as oa,m as ot}from"./C8j7-1Rq.js";import{_ as ne}from"./3lIG1lYq.js";import{_ as ct}from"./PfUKTOG5.js";import{_ as mt}from"./D-TuSGJo.js";import{u as F}from"./j8H2iFUT.js";import{u as ia}from"./roZIKyQo.js";import{c as la}from"./ZnSD-95i.js";import{_ as rt}from"./pQ9QSYKp.js";import{u as Ut}from"./C1V66jBN.js";import{_ as ca}from"./DWPY84V0.js";import{_ as se,m as nt}from"./rwet2Jwp.js";import{_ as $t}from"./B2ejvlwh.js";import{f as oe,m as ra}from"./WElupeSM.js";import{a as _t,b as ie,_ as ua}from"./MfvBAw4a.js";import{_ as ft}from"./rxWbx8Xz.js";import{_ as le}from"./C93CMuTi.js";import{_ as ce}from"./D_bDmjDt.js";import{_ as re}from"./y4O4U22S.js";import{s as q}from"./CqK7YKqf.js";import{_ as da}from"./UkAV1zrn.js";import{u as ma}from"./YbE3Ovi3.js";import{u as _a}from"./btAca64B.js";import{c as et}from"./BE0zBel4.js";const fa={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"};function pa(a,c){return f(),b("svg",fa,c[0]||(c[0]=[s("path",{fill:"currentColor","fill-rule":"evenodd",d:"M28.5 43c8.56 0 15.5-3.134 15.5-7v6c0 3.866-6.94 7-15.5 7-8.56 0-15.5-3.134-15.5-7v-6c0 3.866 6.94 7 15.5 7Z","clip-rule":"evenodd"},null,-1),s("path",{fill:"currentColor","fill-rule":"evenodd",d:"M34.5 36c8.56 0 15.5-3.134 15.5-7v6c0 3.866-6.94 7-15.5 7-8.56 0-15.5-3.134-15.5-7v-6c0 3.866 6.94 7 15.5 7Z","clip-rule":"evenodd"},null,-1),s("path",{fill:"currentColor","fill-rule":"evenodd",d:"M44 19c0 3.866-6.94 7-15.5 7-8.56 0-15.5-3.134-15.5-7v6c0 3.866 6.94 7 15.5 7 8.56 0 15.5-3.134 15.5-7v-6Zm-1 0c0 1.296-1.21 2.8-3.951 4.038C36.4 24.234 32.672 25 28.5 25s-7.9-.766-10.549-1.962C15.211 21.801 14 20.296 14 19c0-1.296 1.21-2.8 3.951-4.038C20.6 13.766 24.328 13 28.5 13s7.9.766 10.549 1.962C41.789 16.199 43 17.704 43 19Z","clip-rule":"evenodd"},null,-1)]))}const Vt={render(){return Ot(Bt,{icon:{render:pa},name:"gold"})}},va={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"};function ha(a,c){return f(),b("svg",va,c[0]||(c[0]=[s("path",{stroke:"currentColor","stroke-width":"4",d:"m31 13.472 3.486 10.73.45 1.382H47.67l-9.127 6.63-1.176.855.45 1.382 3.486 10.73-9.127-6.632L31 37.695l-1.176.854-9.127 6.631 3.487-10.73.449-1.381-1.176-.854-9.127-6.631h12.735l.449-1.382L31 13.472Z"},null,-1)]))}const ka={render(){return Ot(Bt,{icon:{render:ha},name:"xp"})}},ya={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"};function ga(a,c){return f(),b("svg",ya,c[0]||(c[0]=[s("path",{fill:"currentColor","fill-rule":"evenodd",d:"M49.306 27.104 44.133 9l9.483 11.573-4.31 6.53Zm-14.426 25L56 23.654v13.793l-14.655 7.759h12.069l-7.759 5.172-10.776 1.724Zm-21.552-25L18.5 9 9.017 20.574l4.31 6.53Zm13.793 25L6 23.656v13.793l14.655 7.758H8.586l7.759 5.173 10.776 1.724ZM21 20l10-4 10 4v16l-10 8-10-8V20Zm6 12.5L29 22l5.5-1-2 7 4-.5-7 11 2-8-4.5 2Z","clip-rule":"evenodd"},null,-1)]))}const ba={render(){return Ot(Bt,{icon:{render:ga},name:"prem"})}},wa={class:"account-resources"},$a={class:"account-resources__inner"},Aa={key:0,class:"account-resources__item"},Ra={class:"account-resources__text"},Ta={class:"account-resources__item"},Ia={class:"account-resources__text"},Sa={class:"account-resources__item"},Ca={class:"account-resources__text"},Da={class:"account-resources__item"},Pa={class:"account-resources__text"},Ba=N({__name:"AccountResources",props:{resources:{type:Object,required:!0,default:()=>({})}},setup(a){const c=a,u=M(()=>{const v=c.resources.premium_expires_at*1e3;return v-Date.now()<=0?"":B.date.toTimePassed(v,Date.now(),!0)});return(v,o)=>(f(),b("div",wa,[s("div",$a,[a.resources.is_premium.toLocaleString()?(f(),b("div",Aa,[_(r(ba),{filled:!0,"font-controlled":!1,class:X(["account-resources__icon",[{"account-resources__icon--prem":r(u)}]])},null,8,["class"]),s("div",Ra,y(r(u)||"0 дн."),1)])):P("",!0),s("div",Ta,[_(r(Vt),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--gold"}),s("div",Ia,y(a.resources.gold.toLocaleString()),1)]),s("div",Sa,[_(r(Vt),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--credits"}),s("div",Ca,y(a.resources.credits.toLocaleString()),1)]),s("div",Da,[_(r(ka),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--xp"}),s("div",Pa,y(a.resources.free_xp.toLocaleString()),1)])])]))}}),Oa={class:"account-preview-details__body"},xa={class:"account-preview-details__section"},Ma={class:"account-preview-details__props-title"},Ua={class:"account-preview-details__props"},La={class:"account-preview-details__prop"},qa={class:"account-preview-details__prop"},Fa={key:0,class:"account-preview-details__section"},Ea={class:"account-preview-details__props-title"},Na={class:"account-preview-details__props"},Va={class:"account-preview-details__prop"},ja={class:"account-preview-details__prop"},Ha={class:"account-preview-details__section"},Ga={class:"account-preview-details__props-title"},za={key:0,class:"account-preview-details__props"},Za={class:"account-preview-details__prop"},Ka={class:"account-preview-details__prop"},Wa={class:"account-preview-details__prop"},Xa={class:"account-preview-details__prop"},Qa={class:"account-preview-details__prop"},Ya={key:1,class:"account-preview-details__props"},Ja={key:1,class:"account-preview-details__section"},tn={class:"account-preview-details__props-title"},en={class:"account-preview-details__props"},an={class:"account-preview-details__prop"},nn={key:0,class:"account-preview-details__clan-history"},sn={class:"account-preview-details__clan-history-date"},on={key:1,class:"account-preview-details__clan-history-link"},ln={style:{display:"flex","justify-content":"space-between"}},cn=N({__name:"AccountPreviewDetails",props:{account:{type:[Object,null],required:!0},clanAccount:{type:[Object,null],required:!0}},setup(a,{expose:c}){const u=a,v=z(null),o=Q({user:null,clan:null,clanHistory:[],loading:0,isOpened:!1});async function l(e){o.loading++;try{const{data:n}=await st.clan.getInfo({clan_id:e});o.clan=n?n[e]:null}catch(n){F(n,{title:"Получение данных клана"})}o.loading--}async function g(e){o.loading++;try{const{data:n}=await dt.user.get(e);o.user=n}catch(n){if(dt.isResponse(n)&&n.status===404)return;F(n,{title:"Получение данных пользователя"})}finally{o.loading--}}async function k(e){o.loading++;try{const{data:n}=await st.clan.getInfo({clan_id:e.join(","),fields:"clan_id,name,tag"});return n??null}catch(n){return F(n,{title:"Получение данных кланов"}),null}finally{o.loading--}}function p(e,n){o.clanHistory=e.map((h,S,$)=>{const{raw:R,timestamp:C}=h,O=R&&n?n[R.clan_id]:null,V=`[${(O==null?void 0:O.tag)??"Deleted"}]`,U=$.length-1===S,H=e[S-1],E=B.date.toDaysPassed(C,H==null?void 0:H.timestamp);return{key:C,date:`${B.date.toDate(C)} (${U?" ... ":E})`,info:R?`${V} ${B.clan.role(R.role)}`:"Не в клане",clanId:(R==null?void 0:R.clan_id)??null}})}async function t(e){o.loading++;try{const{data:n}=await dt.stat.clansAccounts.getActivityList({id:e});return n??[]}catch(n){return F(n,{title:"Получение данных пользователя"}),[]}finally{o.loading--}}async function w(){var n;if(o.isOpened||!u.account||(o.isOpened=!0,(n=u.clanAccount)!=null&&n.clan_id&&await l(u.clanAccount.clan_id),await g(u.account.account_id),!o.user))return;const e=await t(u.account.account_id);if(e.length){const h=e.filter(({raw:$})=>$==null?void 0:$.clan_id).map(({raw:$})=>$==null?void 0:$.clan_id),S=await k(h);p(e,S)}}function T(){var e;(e=v.value)==null||e.doClose()}async function i(){var e;await w(),await((e=v.value)==null?void 0:e.doOpen())}return c({close:T,open:i}),(e,n)=>{const h=lt,S=ne,$=ct,R=tt,C=mt;return a.account?(f(),L(C,{key:0,ref_key:"detailedDialogRef",ref:v,class:"account-preview-details",title:"Дополнительная информация",width:"600px"},{footer:A(()=>[s("div",ln,[n[16]||(n[16]=s("span",null,null,-1)),_(R,{onClick:T},{default:A(()=>n[15]||(n[15]=[I(" Закрыть ")])),_:1})])]),default:A(()=>{var O,V,U,H;return[s("div",Oa,[s("div",xa,[s("h5",Ma,[_(h,{class:"account-preview-details__prop-title-icon",name:"sports-esports"}),n[0]||(n[0]=I(" Аккаунт игрока "))]),s("div",Ua,[s("div",La,[n[1]||(n[1]=s("span",{class:"account-preview-details__prop-title"}," Дата создания ",-1)),I(" "+y(e.$formatter.date.toDate(a.account.created_at*1e3)),1)]),s("div",qa,[n[2]||(n[2]=s("span",{class:"account-preview-details__prop-title"}," Дата обновления ",-1)),I(" "+y(e.$formatter.date.toDate(a.account.updated_at*1e3)),1)])])]),r(o).user?(f(),b("div",Fa,[s("h5",Ea,[_(h,{class:"account-preview-details__prop-title-icon",name:"person"}),n[3]||(n[3]=I(" Пользователь ресурса "))]),s("div",Na,[s("div",Va,[n[4]||(n[4]=s("span",{class:"account-preview-details__prop-title"}," Зарегистрирован ",-1)),I(" "+y(e.$formatter.date.toDate(((O=r(o).user)==null?void 0:O.createAt)??0)),1)]),s("div",ja,[n[5]||(n[5]=s("span",{class:"account-preview-details__prop-title"}," Последний визит ",-1)),I(" "+y(e.$formatter.date.toDate(((V=r(o).user)==null?void 0:V.visitedAt)??0)),1)])])])):P("",!0),s("div",Ha,[s("h5",Ga,[_(h,{class:"account-preview-details__prop-title-icon",name:"groups"}),n[6]||(n[6]=I(" Клан игрока "))]),r(o).clan&&a.clanAccount?(f(),b("div",za,[s("div",Za,[n[7]||(n[7]=s("span",{class:"account-preview-details__prop-title"}," Командир ",-1)),r(o).clan.leader_id?(f(),L(S,{key:0,class:"account-preview-details__clan-history-link link",to:{name:"account-id",params:{id:r(o).clan.leader_id}}},{default:A(()=>{var E;return[I(y((E=r(o).clan)==null?void 0:E.leader_name),1)]}),_:1},8,["to"])):P("",!0)]),s("div",Ka,[n[8]||(n[8]=s("span",{class:"account-preview-details__prop-title"}," Участников ",-1)),I(" "+y(e.$formatter.number.toInteger((U=r(o).clan)==null?void 0:U.members_count)),1)]),s("div",Wa,[n[9]||(n[9]=s("span",{class:"account-preview-details__prop-title"}," Создан ",-1)),I(" "+y(e.$formatter.date.toDate(((H=r(o).clan)==null?void 0:H.created_at)*1e3)),1)]),s("div",Xa,[n[10]||(n[10]=s("span",{class:"account-preview-details__prop-title"}," Роль ",-1)),I(" "+y(e.$formatter.clan.role(a.clanAccount.role)),1)]),s("div",Qa,[n[11]||(n[11]=s("span",{class:"account-preview-details__prop-title"}," Вступил ",-1)),I(" "+y(e.$formatter.date.toDate(a.clanAccount.joined_at*1e3))+" ("+y(e.$formatter.date.toDaysPassed(a.clanAccount.joined_at*1e3))+") ",1)])])):(f(),b("div",Ya,n[12]||(n[12]=[s("div",{class:"account-preview-details__prop"}," Не состоит в клане ",-1)])))]),r(o).user?(f(),b("div",Ja,[s("h5",tn,[_(h,{class:"account-preview-details__prop-title-icon",name:"history"}),n[13]||(n[13]=I(" Клановая история "))]),s("div",en,[s("div",an,[n[14]||(n[14]=s("span",{class:"account-preview-details__prop-title"}," Отражаются только те дни в которые произошла смена клана или должности. Данные собираются со дня регистрации на сайте. ",-1)),r(o).clanHistory.length?(f(),b("div",nn,[(f(!0),b(K,null,at(r(o).clanHistory,E=>(f(),b("div",{key:E.key,class:"account-preview-details__clan-history-item"},[s("span",sn,y(E.date),1),E.clanId?(f(),L(S,{key:0,class:"account-preview-details__clan-history-link link",to:{name:"clan-id",params:{id:E.clanId}}},{default:A(()=>[I(y(E.info),1)]),_:2},1032,["to"])):(f(),b("span",on,y(E.info),1))]))),128))])):(f(),b(K,{key:1},[I(" Данные собираются. ")],64))])])])):P("",!0)]),_($,{"backdrop-light":"",loading:r(o).loading>0},null,8,["loading"])]}),_:1},512)):P("",!0)}}}),rn={class:"account-preview"},un={key:0,class:"account-preview__inner"},dn={class:"account-preview__league"},mn={class:"account-preview__info"},_n={class:"account-preview__nickname"},fn={class:"account-preview__nickname-text"},pn={class:"account-preview__clan-text"},vn={class:"account-preview__props"},hn={class:"account-preview__prop"},kn={class:"account-preview__prop-value"},yn={key:0,class:"account-preview__prop"},gn={class:"account-preview__prop-value"},bn={class:"account-preview__actions"},wn=N({__name:"AccountPreview",props:{account:{type:[Object,null],default:null,required:!0},loading:{type:Boolean,default:!1}},setup(a){const c=z(null),u=a,v=ia(),o=Q({clanAccount:null,isFavorite:!0,clan:null,detailsLoading:!1}),l=M(()=>{var i;return(i=o.clanAccount)==null?void 0:i.clan});xt(()=>{var e,n;p(),((e=u.account)==null?void 0:e.account_id)&&g((n=u.account)==null?void 0:n.account_id)});async function g(i){try{const{data:e}=await st.clan.getAccountInfo({account_id:i,extra:"clan"});o.clanAccount=e?e[i]:null}catch(e){F(e,{title:"Получение данных клана"})}}async function k(){var i;o.detailsLoading=!0,await((i=c.value)==null?void 0:i.open()),o.detailsLoading=!1}async function p(){if(!u.account)return;const{$indexedDB:i}=W(),e=await i.accountsFavorites.get(u.account.account_id);o.isFavorite=e?e==null?void 0:e.isFavorite:!1}async function t(){if(!u.account)return;o.isFavorite=!o.isFavorite;const{$indexedDB:i}=W();await i.accountsFavorites.set(u.account.account_id,{id:u.account.account_id,isFavorite:o.isFavorite})}function w(){t()}async function T(){var e,n,h,S;await la(`${(e=u.account)==null?void 0:e.nickname}/${(n=u.account)==null?void 0:n.account_id}`)?v.add({type:"success",title:"Скопировано",message:`${(h=u.account)==null?void 0:h.nickname}/${(S=u.account)==null?void 0:S.account_id}`,duration:3e3}):v.add({type:"error",message:"При копировании что-то пошло не так",duration:3e3})}return(i,e)=>{var O;const n=oa,h=ne,S=lt,$=tt,R=ct,C=cn;return f(),b("div",rn,[a.account?(f(),b("div",un,[s("div",dn,[_(n,{large:"",rating:a.account.statistics.rating},null,8,["rating"])]),s("div",mn,[s("div",_n,[s("span",fn,y(a.account.nickname),1)]),r(o).clanAccount&&r(l)?(f(),L(h,{key:0,class:"account-preview__clan link",title:"Перейти к клану",to:{name:"clan-id",params:{id:r(l).clan_id}}},{default:A(()=>[s("span",pn," ["+y(r(l).tag)+"] "+y(r(l).name),1)]),_:1},8,["to"])):P("",!0),s("div",vn,[s("div",hn,[e[0]||(e[0]=s("span",{class:"account-preview__prop-title"}," Последний бой ",-1)),s("span",kn,y(i.$formatter.date.toRelativeTime(a.account.last_battle_time*1e3)),1)]),r(o).clanAccount?(f(),b("div",yn,[e[1]||(e[1]=s("span",{class:"account-preview__prop-title"}," Должность ",-1)),s("span",gn,y(i.$formatter.clan.role((O=r(o).clanAccount)==null?void 0:O.role)),1)])):P("",!0)])]),s("div",bn,[_($,{"is-text":"",class:"account-preview__actions-btn",title:"Копировать (nickname/ID)",onClick:T},{default:A(()=>[_(S,{name:"content-copy"})]),_:1}),_($,{"is-text":"",class:"account-preview__actions-btn",title:"Добавить в избранные",onClick:w},{default:A(()=>[r(o).isFavorite?(f(),L(S,{key:0,name:"star"})):(f(),L(S,{key:1,name:"star-border"}))]),_:1}),_($,{"is-text":"",disabled:r(o).detailsLoading,class:"account-preview__actions-btn",title:"Дополнительная информация",onClick:k},{default:A(()=>[_(S,{name:"info"})]),_:1},8,["disabled"])])])):P("",!0),_(R,{loading:a.loading},null,8,["loading"]),_(C,{ref_key:"accountPreviewDetailsRef",ref:c,account:a.account,"clan-account":r(o).clanAccount},null,8,["account","clan-account"])])}}}),$n=window.setInterval,An={class:"session-panel"},Rn={class:"session-panel__inner"},Tn={class:"session-panel__item"},In={class:"session-panel__buttons"},Sn={key:0,class:"session-panel__item session-panel__item--time"},Cn={class:"session-panel__time"},Dn={style:{"text-align":"right"}},jt=60,Pn=N({__name:"SessionPanel",props:Et({updateAt:{type:Number,required:!0,default:0},hideAutoUpdate:{type:Boolean,default:!1},loading:{type:Boolean,required:!0,default:!1}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:Et(["reset","update","session-active"],["update:modelValue"]),setup(a,{emit:c}){const u=Mt(a,"modelValue"),v=a,o=Ut(),l=z(null),g=Q({autoUpdateChecked:!1,autoUpdateInterval:jt,autoUpdateCounter:jt,autoUpdateTimer:0}),k=M(()=>{const i=B.date.toDateTime(v.updateAt),e=B.date.toDaysPassed(v.updateAt,Date.now(),!0);return`${i} (${e})`});He(()=>{clearInterval(g.autoUpdateTimer)});const p=c;function t(){var i;(i=l.value)==null||i.doOpen()}function w(i){var e;i&&p("reset"),(e=l.value)==null||e.doClose()}function T(){if(g.autoUpdateChecked=!g.autoUpdateChecked,g.autoUpdateCounter=g.autoUpdateInterval,!g.autoUpdateChecked){clearInterval(g.autoUpdateTimer);return}const i=()=>{if(clearInterval(g.autoUpdateTimer),g.autoUpdateTimer=$n(i,1e3),g.autoUpdateCounter>0){g.autoUpdateCounter--;return}g.autoUpdateCounter=g.autoUpdateInterval,p("update")};p("update"),i()}return(i,e)=>{const n=rt,h=lt,S=tt,$=ct,R=mt;return f(),b("div",An,[s("div",Rn,[s("div",Tn,[s("div",In,[_(n,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=C=>u.value=C),class:"session-panel__btn",title:"Просмотр статистики за сессию"},{default:A(()=>e[3]||(e[3]=[I(" Сессия ")])),_:1},8,["modelValue"]),a.hideAutoUpdate===!1?(f(),L(S,{key:0,class:"session-panel__btn",title:"Автоматическое обновление данных",onClick:T},{before:A(()=>[_(h,{name:"refresh-auto"})]),default:A(()=>[r(o).isTablet?P("",!0):(f(),b(K,{key:0},[I(" Обновление ")],64)),I(" "+y(r(g).autoUpdateCounter)+" сек. ",1)]),_:1})):P("",!0),_(S,{class:"session-panel__btn",title:"Сброс данных сессии",onClick:t},{default:A(()=>[_(h,{name:"close"})]),_:1})])]),r(k)?(f(),b("div",Sn,[s("span",Cn,[e[4]||(e[4]=s("span",{class:"session-panel__time-title"}," Время начала ",-1)),I(" "+y(r(k)),1)])])):P("",!0)]),_($,{loading:a.loading},null,8,["loading"]),_(R,{ref_key:"confirmDialogRef",ref:l,title:"Сброс сессии"},{default:A(()=>[e[7]||(e[7]=s("div",{style:{margin:"0 0 1em"}}," Вы уверены, что хотите сбросить сессию? ",-1)),s("div",Dn,[_(S,{align:"center",width:"80px",onClick:e[1]||(e[1]=C=>w(!0))},{default:A(()=>e[5]||(e[5]=[I(" Да ")])),_:1}),_(S,{align:"center",width:"80px",onClick:e[2]||(e[2]=C=>w(!1))},{default:A(()=>e[6]||(e[6]=[I(" Нет ")])),_:1})])]),_:1},512)])}}}),Bn={class:"accounts-metrics"},On={class:"accounts-metrics__filters"},xn={class:"accounts-metrics__filters-item"},Mn={class:"accounts-metrics__filters-item"},Un={class:"accounts-metrics__plates"},Ln=N({__name:"AccountsMetrics",props:{metrics:{type:Array,required:!0,default:()=>[]},filters:{type:Object,required:!0,default:()=>({})},loading:{type:Boolean,default:!1}},emits:["filters","is-open"],setup(a,{emit:c}){const u=["battles","winRate","damagePerBattle","winsInPlatoon","battlesPerDay","tanksWithMaster"],v=a,o=Q({isOpen:!1}),l=M(()=>o.isOpen?v.metrics:v.metrics.filter(p=>u.includes(p.key))),g=c;function k(){const p=v.filters.battleMode==="random"?"rating":"random";g("filters",{...v.filters,battleMode:p})}return(p,t)=>{const w=rt,T=se;return f(),b("div",Bn,[s("div",On,[s("div",xn,[_(w,{"model-value":a.filters.battleMode==="rating",onChange:k},{default:A(()=>t[1]||(t[1]=[I(" Рейтинг ")])),_:1},8,["model-value"])]),s("div",Mn,[_(w,{modelValue:r(o).isOpen,"onUpdate:modelValue":t[0]||(t[0]=i=>r(o).isOpen=i)},{default:A(()=>t[2]||(t[2]=[I(" Все показатели ")])),_:1},8,["modelValue"])])]),s("div",Un,[_(T,{loading:a.loading,items:r(l)},null,8,["loading","items"])])])}}}),qn=["onClick"],Fn={class:"achievements-list__item-inner"},En={class:"achievements-list__item-img-wrapper"},Nn={key:0,class:"achievements-list__item-count"},Vn={key:0,class:"achievements-list__item-series"},jn={key:1,class:"achievements-list__item-details"},Hn=N({__name:"AchievementsList",props:{achievements:{type:Array,default:()=>[]},hideName:{type:Boolean,default:!1}},emits:["medal-click"],setup(a,{emit:c}){const u=c;function v(o){u("medal-click",o)}return(o,l)=>{const g=$t;return f(),b("div",{class:X(["achievements-list",[a.hideName?"achievements-list--small":""]])},[a.achievements.length?(f(),L(ee,{key:0,tag:"ul",class:"achievements-list__list",name:"achievements-list__item-"},{default:A(()=>[(f(!0),b(K,null,at(a.achievements,k=>(f(),b("li",{key:k.key,class:X(["achievements-list__item",[!k.count&&!k.series?"achievements-list__item--no-count":""]])},[s("button",{class:"achievements-list__item-btn",onClick:p=>v(k)},[s("span",Fn,[s("span",En,[_(g,{class:"achievements-list__item-img",src:k.image,alt:k.key,"data-name":k.name},null,8,["src","alt","data-name"])]),k.count||k.series?(f(),b("span",Nn,[I(y(k.count)+" ",1),k.series?(f(),b("span",Vn," / "+y(k.series),1)):P("",!0)])):P("",!0),a.hideName?P("",!0):(f(),b("span",jn,y(k.name),1))])],8,qn)],2))),128))]),_:1})):P("",!0)],2)}}}),Gn={key:0,class:"achievements-block__details"},zn={class:"achievements-block__details-header"},Zn={class:"achievements-block__details-name"},Kn={class:"achievements-block__details-body"},Wn=["textContent"],Xn=["textContent"],Qn={class:"achievements-block__details-footer"},Yn=N({__name:"AchievementsDetails",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(a,{expose:c}){const u=Mt(a,"modelValue"),v=z(null),o=z(!1);function l(){o.value=!1}function g(){var k;(k=v.value)==null||k.doOpen()}return c({open:g}),(k,p)=>{const t=$t,w=tt,T=mt;return f(),L(T,{ref_key:"detailsRef",ref:v,width:"640px",onOpen:l},{footer:A(()=>[s("div",Qn,[_(w,{onClick:p[0]||(p[0]=i=>{var e;return(e=r(v))==null?void 0:e.doClose()})},{default:A(()=>p[1]||(p[1]=[I(" Закрыть ")])),_:1})])]),default:A(()=>{var i;return[u.value?(f(),b("div",Gn,[s("div",zn,[_(t,{class:"achievements-block__details-img",src:u.value.image,alt:u.value.key},null,8,["src","alt"]),s("span",Zn,y((i=u.value)==null?void 0:i.name),1),s("div",Kn,[u.value.description?(f(),b("div",{key:0,textContent:y(u.value.description)},null,8,Wn)):P("",!0),u.value.condition?(f(),b("div",{key:1,textContent:y(u.value.condition)},null,8,Xn)):P("",!0)])])])):P("",!0)]}),_:1},512)}}}),Jn={key:0,class:"achievements-block__inner"},ts={class:"achievements-block__filter"},es={class:"achievements-block__filter-item"},as={class:"achievements-block__filter-item"},ns={class:"achievements-block__filter-item"},ss={class:"achievements-block__section-title"},os={key:1,class:"achievements-block__empty"},is={key:1,class:"achievements-block__empty"},ue=N({__name:"AchievementsBlock",props:{achievements:{type:Object,required:!0,default:()=>({})},achievementsInfo:{type:Object,required:!0,default:()=>({})},filters:{type:Object,required:!0,default:()=>oe.makeAccountFilters()}},emits:["filters-changed"],setup(a,{emit:c}){const u=["markOfMastery","markOfMasteryI","markOfMasteryII","markOfMasteryIII","heroesOfRassenay","medalLafayettePool","medalRadleyWalters","warrior","medalKolobanov","mainGun","sniper","camper","medalBrothersInArms","medalCrucialContribution"],v=["battle","epic","title","commemorative","step","platoon"],o=a,l=z(),g=z(),k=Q({currentMedal:null,showAll:!1}),p=M(()=>{const n=Object.keys(o.achievements.achievements),h=Object.keys(o.achievements.achievements);return n.length||h.length}),t=M(()=>{if(o.filters.achievementsShow==="important"){const h=[];return Object.keys(o.achievements.achievements).forEach(S=>{const $=ot.achievementsMedal({key:S,achievements:o.achievements,encyclopedia:o.achievementsInfo});h.push($)}),u.reduce((S,$)=>{const R=h.find(C=>C.key===$);return R?[...S,R]:S},[])}const n=Object.keys(o.achievementsInfo);return o.filters.achievementsShow==="deserved"?n.map(h=>ot.achievementsMedal({key:h,achievements:o.achievements,encyclopedia:o.achievementsInfo})).filter(h=>o.achievements.achievements[h.key]||o.achievements.max_series[h.key]).sort((h,S)=>h.key.localeCompare(S.key)):n.map(h=>ot.achievementsMedal({key:h,achievements:o.achievements,encyclopedia:o.achievementsInfo})).toSorted((h,S)=>h.key.localeCompare(S.key))}),w=M(()=>{const n={};return t.value.forEach(h=>{n[h.section]||(n[h.section]={name:h.section,items:[]}),n[h.section].items.push(h)}),Object.values(n).sort((h,S)=>v.indexOf(h.name)-v.indexOf(S.name))}),T=c;function i({key:n}){var h;k.currentMedal=t.value.find(S=>S.key===n)??null,(h=g.value)==null||h.open()}function e(n){T("filters-changed",{...o.filters,achievementsShow:n})}return(n,h)=>{const S=rt,$=Hn,R=Yn;return f(),b("div",{ref_key:"mainRef",ref:l,class:"achievements-block"},[r(p)?(f(),b("div",Jn,[s("div",ts,[s("div",es,[_(S,{"model-value":a.filters.achievementsShow==="important",onChange:h[0]||(h[0]=C=>e("important"))},{default:A(()=>h[4]||(h[4]=[I(" Значимые ")])),_:1},8,["model-value"])]),s("div",as,[_(S,{"model-value":a.filters.achievementsShow==="deserved",onChange:h[1]||(h[1]=C=>e("deserved"))},{default:A(()=>h[5]||(h[5]=[I(" Заслуженные ")])),_:1},8,["model-value"])]),s("div",ns,[_(S,{"model-value":a.filters.achievementsShow===null,onChange:h[2]||(h[2]=C=>e(null))},{default:A(()=>h[6]||(h[6]=[I(" Все ")])),_:1},8,["model-value"])])]),r(t).length?(f(),b(K,{key:0},[a.filters.achievementsShow==="important"?(f(),L($,{key:0,achievements:r(t),"hide-name":!0,onMedalClick:i},null,8,["achievements"])):(f(!0),b(K,{key:1},at(r(w),C=>(f(),b("div",{key:C.name,class:"achievements-block__section"},[s("div",ss,y(n.$formatter.achievements.section(C.name)),1),_($,{achievements:C.items,"hide-count":r(k).showAll,onMedalClick:i},null,8,["achievements","hide-count"])]))),128))],64)):(f(),b("div",os," Нет значимых достижений ")),_(R,{ref_key:"detailsRef",ref:g,modelValue:r(k).currentMedal,"onUpdate:modelValue":h[3]||(h[3]=C=>r(k).currentMedal=C)},null,8,["modelValue"])])):(f(),b("div",is," Нет достижений "))],512)}}}),ls={class:"account-infographics"},cs={class:"account-infographics__filters"},rs={class:"account-infographics__filters-chips"},us={class:"account-infographics__chart-list"},ds={class:"account-infographics__chart-label"},ms={class:"account-infographics__line-icon"},_s={key:2},fs={key:"battles",class:"account-infographics__line-value"},ps={key:"damagePerBattle",class:"account-infographics__line-value"},vs=N({__name:"AccountInfographics",props:{tanks:{type:Array,default:()=>[],required:!0}},setup(a){const c=a,u=z("battles"),v=[{value:"battles",label:B.stat.accountProp("battles")},{value:"winRate",label:B.stat.accountProp("winRate")},{value:"damagePerBattle",label:B.stat.accountProp("damagePerBattle")}],o=M(()=>[{label:"По уровню",key:"tier",value:l("tier")},{label:"По нации",key:"nation",value:l("nation")},{label:"По типу",key:"type",value:l("type")}]);function l(k){var t;const p={};if(!((t=c.tanks)!=null&&t.length))return p;c.tanks.forEach(w=>{const T=w[k];w.tier&&(T in p||(p[T]={key:T,battles:0,winRate:0,damagePerBattle:0,lineHeight:0}),p[T].battles+=w.all.battles,p[T].winRate+=w.all.wins,p[T].damagePerBattle+=w.all.damage_dealt)});for(const w in p){const T=p[w].battles;p[w].winRate=T?p[w].winRate/(T/100):0,p[w].damagePerBattle=T?p[w].damagePerBattle/T:0}for(const w in p){const i=Math.min(...Object.values(p).map(n=>n[u.value])),e=Math.max(...Object.values(p).map(n=>n[u.value]))-i/1.1;p[w].lineHeight=(p[w][u.value]-i/1.1)/(e/100)}return p}function g(k){u.value=k}return(k,p)=>{const t=rt,w=_t,T=ie,i=ft;return f(),b("div",ls,[s("div",cs,[s("div",rs,[(f(),b(K,null,at(v,e=>_(t,{key:e.value,"model-value":e.value===r(u),onChange:n=>g(e.value)},{default:A(()=>[I(y(e.label),1)]),_:2},1032,["model-value","onChange"])),64))])]),s("div",us,[(f(!0),b(K,null,at(r(o),e=>(f(),b("div",{key:e.key,class:X(["account-infographics__chart",[`account-infographics__chart--${e.key}`]])},[s("span",ds,y(e.label),1),(f(!0),b(K,null,at(e.value,n=>(f(),b("div",{key:n.key,class:"account-infographics__line"},[s("span",ms,[e.key==="type"?(f(),L(w,{key:0,type:n.key},null,8,["type"])):e.key==="nation"?(f(),L(T,{key:1,nation:n.key,size:"22"},null,8,["nation"])):e.key==="tier"?(f(),b("span",_s,y(k.$formatter.encyclopedia.tier(n.key)),1)):(f(),b(K,{key:3},[I(y(n.key),1)],64))]),_(ee,{tag:"span",name:"account-infographics__line-value-",class:"account-infographics__line-progress",style:Ge({"--chart-line-width":n.lineHeight/100})},{default:A(()=>[r(u)==="battles"?(f(),b("span",fs,y(k.$formatter.number.toInteger(n.battles)),1)):P("",!0),r(u)==="winRate"?(f(),L(i,{key:"winRate","win-rate":n.winRate,class:"account-infographics__line-value"},null,8,["win-rate"])):P("",!0),r(u)==="damagePerBattle"?(f(),b("span",ps,y(k.$formatter.number.toInteger(n.damagePerBattle)),1)):P("",!0)]),_:2},1032,["style"])]))),128))],2))),128))])])}}}),hs=N({__name:"AccountDailyStatTable",props:{summary:{type:Object,required:!0,default:()=>({})},items:{type:Array,required:!0,default:()=>[]}},emits:["sort","row-click"],setup(a,{emit:c}){const u=[{key:"position",label:"№"},{key:"date",label:"Дата"},{key:"tanks",label:"Танков"},{key:"tier",label:"I-X",formatter:o=>J(o)?B.number.toFloatNumber(o):"---"},{key:"battles",label:"Бои",formatter:o=>J(o)?B.number.toInteger(o):"---"},{key:"winRate",label:"Победы",formatter:o=>J(o)?B.number.toFloatPercent(o):"---"},{key:"damagePerBattle",label:"Урон",formatter:o=>J(o)?B.number.toInteger(o):"---"},{key:"xpPerBattle",label:"Опыт",formatter:o=>J(o)?B.number.toInteger(o):"---"},{key:"fragPerBattle",label:"Уничт.",tooltip:"Уничтожено За Бой",formatter:o=>J(o)?B.number.toFloatNumber(o):"---"},{key:"hitRate",label:"Точн.",tooltip:"Точность стрельбы",formatter:o=>J(o)?B.number.toFloatPercent(o):"---"},{key:"surviveRate",label:"Выж.",tooltip:"Выживаемость",formatter:o=>J(o)?B.number.toFloatPercent(o):"---"},{key:"spottedPerBattle",label:"Обн.",tooltip:"Обнаружено за бой",formatter:o=>J(o)?B.number.toFloatNumber(o):"---"}],v=c;return(o,l)=>{const g=tt,k=ft,p=ce;return f(),L(p,{class:"account-daily-stat-table",headers:u,data:a.items,summary:a.summary,"scroll-auto-disabling":"","no-wrap":"","row-key":"timestamp","max-height":"378px",onSort:l[0]||(l[0]=t=>v("sort",t))},{"position-summary":A(()=>[I(y(a.items.length||0),1)]),position:A(({index:t})=>[I(y(t+1),1)]),date:A(({row:t})=>[_(g,{"is-text":"",onClick:w=>v("row-click",t)},{default:A(()=>[I(y(t.date),1)]),_:2},1032,["onClick"])]),tanks:A(({row:t})=>[I(y(t.tanks?o.$formatter.number.toInteger(t.tanks.length):"---"),1)]),winRate:A(({row:t})=>[_(k,{"win-rate":t.winRate},null,8,["win-rate"])]),_:1},8,["data","summary"])}}}),de=N({__name:"MarkOfMastery",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(a){const c={1:kt(()=>yt(()=>import("./qhzwaMnq.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),2:kt(()=>yt(()=>import("./CMNy-woT.js"),__vite__mapDeps([6,1,2,3,4,5]),import.meta.url)),3:kt(()=>yt(()=>import("./CSLC2_Ak.js"),__vite__mapDeps([7,1,2,3,4,5]),import.meta.url)),4:kt(()=>yt(()=>import("./D0cYrKZZ.js"),__vite__mapDeps([8,1,2,3,4,5]),import.meta.url))},u=Mt(a,"modelValue");return(v,o)=>(f(),L(ae(u.value?c[u.value]:"span"),{filled:!0,"font-controlled":!1,class:X(["mark-of-mastery",[u.value?"mark-of-mastery--"+u.value:""]])},null,8,["class"]))}}),ks={class:"account-tanks-table-mobile"},ys=["onClick"],gs={class:"account-tanks-table-mobile__img-wrapper"},bs={class:"account-tanks-table-mobile__description"},ws={class:"account-tanks-table-mobile__description-row"},$s={class:"account-tanks-table-mobile__name"},As={class:"account-tanks-table-mobile__name-text"},Rs={class:"account-tanks-table-mobile__description-row"},Ts={class:"account-tanks-table-mobile__props"},Is={class:"account-tanks-table-mobile__prop"},Ss={class:"account-tanks-table-mobile__prop-value"},Cs={key:0,class:"account-tanks-table-mobile__prop-sub"},Ds={class:"account-tanks-table-mobile__prop"},Ps={class:"account-tanks-table-mobile__prop-value"},Bs={key:0,class:"account-tanks-table-mobile__prop-sub"},Os={class:"account-tanks-table-mobile__prop"},xs={class:"account-tanks-table-mobile__prop-value"},Ms={key:0,class:"account-tanks-table-mobile__prop-sub"},Us=N({__name:"AccountTanksTableMobile",props:{items:{type:Array,default:()=>[],required:!0},headers:{type:Array,default:()=>[],required:!0},defaultSort:{type:Object,default:null},height:{type:String,default:void 0},maxHeight:{type:String,default:void 0}},emits:["row-click"],setup(a,{expose:c,emit:u}){const v=z(null),o=u;return c({sortItems(){var l;(l=v.value)==null||l.sortItems()}}),(l,g)=>{const k=$t,p=de,t=_t,w=lt,T=ft,i=re;return f(),b("div",ks,[_(i,{ref_key:"tableRef",ref:v,data:a.items,headers:a.headers,"row-key":"tank_id",height:a.height,"default-sort":a.defaultSort,"max-height":a.maxHeight,"scroll-auto-disabling":""},{default:A(({row:e})=>[s("div",{class:"account-tanks-table-mobile__item",onClick:n=>o("row-click",e.tank_id)},[s("div",gs,[_(k,{class:"account-tanks-table-mobile__nation-img",src:`/img/nations/nation-${e.nation}.svg`,alt:e.nation},null,8,["src","alt"]),_(k,{class:"account-tanks-table-mobile__tank-img",src:e.images.preview,alt:e.name},null,8,["src","alt"]),_(ua,{class:"account-tanks-table-mobile__tier",tier:e.tier},null,8,["tier"]),e.markOfMastery.value&&e.markOfMastery.count?(f(),L(p,{key:0,class:"account-tanks-table-mobile__master","model-value":e.markOfMastery.value,title:"Знак классности"},null,8,["model-value"])):P("",!0)]),s("div",bs,[s("div",ws,[s("div",$s,[_(t,{type:e.type,class:"account-tanks-table-mobile__type","is-premium":e.is_premium,"is-collectible":e.is_collectible},null,8,["type","is-premium","is-collectible"]),s("span",As,y(e.name??`Tank ID: ${e.tank_id}`),1)])]),s("div",Rs,[s("div",Ts,[s("span",Is,[_(w,{name:"sword-cross",size:"18"}),s("span",Ss,[I(y(l.$formatter.number.toInteger(e.all.battles))+" ",1),e.diff?(f(),b("span",Cs,y(l.$formatter.number.toInteger(e.diff.battles,!0)),1)):P("",!0)])]),s("span",Ds,[_(w,{name:"flag-variant",size:"18"}),s("span",Ps,[_(T,{"win-rate":e.all.winRate},null,8,["win-rate"]),e.diff?(f(),b("span",Bs,y(l.$formatter.number.toFloatPercent(e.diff.winRate,!0)),1)):P("",!0)])]),s("span",Os,[_(w,{name:"destruction",size:"18"}),s("span",xs,[I(y(l.$formatter.number.toInteger(e.all.damagePerBattle))+" ",1),e.diff?(f(),b("span",Ms,y(l.$formatter.number.toInteger(e.diff.damagePerBattle,!0)),1)):P("",!0)])])])])])],8,ys)]),_:1},8,["data","headers","height","default-sort","max-height"])])}}}),Ls={class:"account-tanks-table-desktop"},qs={class:"account-tanks-table-desktop__table"},Fs=["title"],Es={class:"account-tanks-table-desktop__name-text"},Ns={key:0,class:"account-tanks-table-desktop__diff"},Vs={key:0,class:"account-tanks-table-desktop__diff"},js={key:0,class:"account-tanks-table-desktop__diff"},Hs={key:0,class:"account-tanks-table-desktop__diff"},Gs={key:0,class:"account-tanks-table-desktop__diff"},zs={key:0,class:"account-tanks-table-desktop__diff"},Zs={key:0,class:"account-tanks-table-desktop__diff"},Ks={key:0,class:"account-tanks-table-desktop__diff"},Ws={class:"account-tanks-table-desktop__mark"},Xs={key:0,class:"account-tanks-table-desktop__diff"},Qs={class:"account-tanks-table-desktop__diff"},Ys=N({__name:"AccountTanksTableDesktop",props:{items:{type:Array,default:()=>[],required:!0},headers:{type:Array,default:()=>[],required:!0},summary:{type:Object,default:()=>({}),required:!0},height:{type:String,default:void 0},maxHeight:{type:String,default:void 0},sort:{type:Object,default:null},defaultSort:{type:Object,default:null},showDiff:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["row-click"],setup(a,{expose:c,emit:u}){const v=z(null),o=u;return c({sortItems(){var l;(l=v.value)==null||l.sortItems()}}),(l,g)=>{const k=_t,p=tt,t=ft,w=de,T=ce,i=ct;return f(),b("div",Ls,[s("div",qs,[_(T,{ref_key:"tableRef",ref:v,headers:a.headers,data:a.items,summary:a.summary,"default-sort":a.defaultSort,"scroll-auto-disabling":"","no-wrap":"","row-key":"tank_id",height:a.height,"max-height":a.maxHeight},{"position-summary":A(()=>[I(y(a.items.length||0),1)]),position:A(({index:e})=>[I(y(e+1),1)]),type:A(({row:e})=>[s("div",{class:"account-tanks-table-desktop__type",title:e.is_premium?"Премиум танк":""},[_(k,{type:e.type,"is-premium":e.is_premium,"is-collectible":e.is_collectible},null,8,["type","is-premium","is-collectible"])],8,Fs)]),name:A(({row:e})=>[_(p,{class:"account-tanks-table-desktop__name","is-text":"",onClick:n=>o("row-click",e.tank_id)},{default:A(()=>[s("span",Es,y(e.name??`Tank ID: ${e.tank_id}`),1)]),_:2},1032,["onClick"])]),battles:A(({row:e})=>{var n;return[I(y(e.all.battles)+" ",1),a.showDiff?(f(),b("div",Ns,y(l.$formatter.number.toInteger((n=e.diff)==null?void 0:n.battles,!0)),1)):P("",!0)]}),winRate:A(({row:e})=>{var n;return[_(t,{"win-rate":e.all.winRate,class:"account-tanks-table-desktop__win-rate"},null,8,["win-rate"]),a.showDiff?(f(),b("div",Vs,y(l.$formatter.number.toFloatPercent((n=e.diff)==null?void 0:n.winRate,!0)),1)):P("",!0)]}),damagePerBattle:A(({row:e})=>{var n;return[I(y(e.all.damagePerBattle)+" ",1),a.showDiff?(f(),b("div",js,y(l.$formatter.number.toInteger((n=e.diff)==null?void 0:n.damagePerBattle,!0)),1)):P("",!0)]}),xpPerBattle:A(({row:e})=>{var n;return[I(y(e.all.xpPerBattle)+" ",1),a.showDiff?(f(),b("div",Hs,y(l.$formatter.number.toInteger((n=e.diff)==null?void 0:n.xpPerBattle,!0)),1)):P("",!0)]}),fragPerBattle:A(({row:e})=>{var n;return[I(y(e.all.fragPerBattle)+" ",1),a.showDiff?(f(),b("div",Gs,y(l.$formatter.number.toInteger((n=e.diff)==null?void 0:n.fragPerBattle,!0)),1)):P("",!0)]}),hitRate:A(({row:e})=>{var n;return[I(y(l.$formatter.number.toFloatPercent(e.all.hitRate))+" ",1),a.showDiff?(f(),b("div",zs,y(l.$formatter.number.toFloatNumber((n=e.diff)==null?void 0:n.hitRate,!0)),1)):P("",!0)]}),surviveRate:A(({row:e})=>{var n;return[I(y(l.$formatter.number.toFloatPercent(e.all.surviveRate))+" ",1),a.showDiff?(f(),b("div",Zs,y(l.$formatter.number.toFloatNumber((n=e.diff)==null?void 0:n.surviveRate,!0)),1)):P("",!0)]}),spottedPerBattle:A(({row:e})=>{var n;return[I(y(e.all.spottedPerBattle)+" ",1),a.showDiff?(f(),b("div",Ks,y(l.$formatter.number.toInteger((n=e.diff)==null?void 0:n.spottedPerBattle,!0)),1)):P("",!0)]}),mark_of_mastery:A(({row:e})=>[s("div",Ws,[e.markOfMastery.value&&e.markOfMastery.count?(f(),L(w,{key:0,"model-value":e.markOfMastery.value,title:"Знак классности",width:"20",height:"20"},null,8,["model-value"])):P("",!0),I(" "+y(e.markOfMastery.count||"---"),1)]),a.showDiff?(f(),b("div",Xs,y(e.markOfMastery.diff),1)):P("",!0)]),last_battle_time:A(({row:e})=>[I(y(l.$formatter.date.toRelativeTime(e.last_battle_time*1e3)||"---")+" ",1),s("div",Qs,y(l.$formatter.date.toDateTime(e.last_battle_time*1e3)||"---"),1)]),_:1},8,["headers","data","summary","default-sort","height","max-height"]),_(i,{loading:a.loading},null,8,["loading"])])])}}}),me=N({__name:"AccountTanksTable",props:{tanks:{type:Array,default:()=>[],required:!0},tanksDiff:{type:[Array,null],default:null,required:!0},height:{type:String,default:void 0},maxHeight:{type:String,default:void 0},sort:{type:Object,default:null},defaultSort:{type:Object,default:null},showDiff:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["row-click"],setup(a,{expose:c,emit:u}){const v=M(()=>g.isTablet?Us:Ys),o=a,l=z(null),g=Ut(),k=u,p=M(()=>[{key:"position",label:"№",width:60},{key:"type",label:"Тип",width:60,sortable:!0},{key:"name",label:"Название",sortable:!0},{key:"tier",label:"I-X",sortable:!0},{key:"battles",label:"Бои",sortable:!0,sortMethod(i,e){return i.all.battles-e.all.battles},formatter:i=>B.number.toInteger(i)},{key:"winRate",label:"Победы",sortable:!0,sortMethod(i,e){const n=i,h=e;return n.all.winRate-h.all.winRate},formatter:i=>B.number.toFloatPercent(i)},{key:"damagePerBattle",label:"Урон",sortable:!0,sortMethod(i,e){return i.all.damagePerBattle-e.all.damagePerBattle},formatter:i=>B.number.toInteger(i)},{key:"xpPerBattle",label:"Опыт",sortable:!0,sortMethod(i,e){return i.all.xpPerBattle-e.all.xpPerBattle},formatter:i=>B.number.toInteger(i)},{key:"fragPerBattle",label:"Уничт.",tooltip:"Уничтожено За Бой",sortable:!0,sortMethod(i,e){return i.all.fragPerBattle-e.all.fragPerBattle},formatter:i=>B.number.toFloatNumber(i)},{key:"hitRate",label:"Точн.",tooltip:"Точность стрельбы",sortable:!0,sortMethod(i,e){return i.all.hitRate-e.all.hitRate},formatter:i=>B.number.toPercent(i)},{key:"surviveRate",label:"Выж.",tooltip:"Выживаемость",sortable:!0,sortMethod(i,e){return i.all.surviveRate-e.all.surviveRate},formatter:i=>B.number.toPercent(i)},{key:"spottedPerBattle",label:"Обн.",tooltip:"Обнаружено за бой",sortable:!0,sortMethod(i,e){return i.all.spottedPerBattle-e.all.spottedPerBattle},formatter:i=>B.number.toFloatNumber(i)},{key:"mark_of_mastery",label:"M",tooltip:"Знак классности",sortable:!0,sortMethod(i,e){const n=i.markOfMastery.count+i.markOfMastery.value*1e4,h=e.markOfMastery.count+e.markOfMastery.value*1e4;return n-h},formatter:i=>B.stat.markOfMastery(Number(i))},{key:"last_battle_time",label:"Последний бой",sortable:!0}].filter(i=>{const e=["battles","winRate","damagePerBattle","type","tier","last_battle_time"];return g.isTablet?e.includes(i.key):!0})),t=M(()=>{let i={};return o.tanks.forEach((e,n)=>{n?i=q.sum(i,e.all):i=e.all}),q.tank(i)}),w={1:"markOfMasteryIII",2:"markOfMasteryII",3:"markOfMasteryI",4:"markOfMastery"},T=M(()=>o.tanks.map(i=>{var S;const e=(S=o.tanksDiff)==null?void 0:S.find($=>$.tank_id===i.tank_id),n=i.achievements.achievements[w[i.mark_of_mastery]]??0,h=(e==null?void 0:e.achievements.achievements[w[i.mark_of_mastery]])??0;return{...i,diff:(e==null?void 0:e.all)??null,markOfMastery:{value:i.mark_of_mastery,count:n,diff:B.number.toInteger(h,!0)||"---"}}}));return c({sortItems(){var i;(i=l.value)==null||i.sortItems()}}),(i,e)=>(f(),L(ae(r(v)),{items:r(T),headers:r(p),"show-diff":a.showDiff,summary:r(t),"max-height":a.maxHeight,height:a.height,loading:a.loading,"default-sort":a.defaultSort,onRowClick:e[0]||(e[0]=n=>k("row-click",n))},null,40,["items","headers","show-diff","summary","max-height","height","loading","default-sort"]))}}),Js={class:"account-daily-stat-table-mobile"},to={class:"account-daily-stat-table-mobile__summary"},eo={class:"account-daily-stat-table-mobile__props"},ao={class:"account-daily-stat-table-mobile__prop"},no={class:"account-daily-stat-table-mobile__prop-icon"},so={class:"account-daily-stat-table-mobile__prop"},oo={class:"account-daily-stat-table-mobile__prop-icon"},io={class:"account-daily-stat-table-mobile__prop"},lo={class:"account-daily-stat-table-mobile__prop-icon"},co={class:"account-daily-stat-table-mobile__prop"},ro=["onClick","onKeydown"],uo={class:"account-daily-stat-table-mobile__props"},mo={class:"account-daily-stat-table-mobile__prop"},_o={class:"account-daily-stat-table-mobile__prop-icon"},fo={class:"account-daily-stat-table-mobile__prop"},po={class:"account-daily-stat-table-mobile__props"},vo={class:"account-daily-stat-table-mobile__prop"},ho={class:"account-daily-stat-table-mobile__prop-icon"},ko={class:"account-daily-stat-table-mobile__prop"},yo={class:"account-daily-stat-table-mobile__prop-icon"},go={class:"account-daily-stat-table-mobile__prop"},bo={class:"account-daily-stat-table-mobile__prop-icon"},wo={class:"account-daily-stat-table-mobile__prop"},$o=N({__name:"AccountDailyStatTableMobile",props:{summary:{type:Object,required:!0,default:()=>({})},items:{type:Array,required:!0,default:()=>[]}},emits:["row-click"],setup(a,{emit:c}){const u=c;return(v,o)=>{const l=lt,g=ft,k=re;return f(),b("div",Js,[_(k,{data:a.items,"scroll-auto-disabling":"","no-wrap":"","row-key":"timestamp","max-height":"calc(100vh - 160px)"},{header:A(()=>[s("div",to,[s("div",eo,[s("span",ao,[s("span",no,[_(l,{name:"sword-cross",size:"18"})]),I(" "+y(v.$formatter.number.toInteger(a.summary.battles)),1)]),s("span",so,[s("span",oo,[_(l,{name:"flag-variant",size:"18"})]),_(g,{"win-rate":a.summary.winRate},null,8,["win-rate"])]),s("span",io,[s("span",lo,[_(l,{name:"destruction",size:"18"})]),I(" "+y(v.$formatter.number.toInteger(a.summary.damagePerBattle)),1)]),s("span",co,[o[0]||(o[0]=s("span",{class:"account-daily-stat-table-mobile__prop-icon",style:{"font-weight":"500","font-size":"14px"}}," # ",-1)),I(" "+y(a.items.length),1)])])])]),default:A(({row:p,index:t})=>[s("div",{tabindex:"0",role:"button",class:"account-daily-stat-table-mobile__item",onClick:w=>u("row-click",p),onKeydown:[Nt(w=>u("row-click",p),["enter"]),Nt(w=>u("row-click",p),["space"])]},[s("div",uo,[s("span",mo,[s("span",_o,[_(l,{name:"event",size:"18"})]),s("b",{class:X(["account-daily-stat-table-mobile__prop-value",["account-daily-stat-table-mobile__prop-value--bold"]])},y(p.date),1)]),s("span",fo,[o[1]||(o[1]=s("span",{class:"account-daily-stat-table-mobile__prop-icon",style:{"font-weight":"500","font-size":"14px"}}," # ",-1)),s("b",{class:X(["account-daily-stat-table-mobile__prop-value",["account-daily-stat-table-mobile__prop-value--bold"]])},y(t+1),1)])]),s("div",po,[s("span",vo,[s("span",ho,[_(l,{name:"sword-cross",size:"18"})]),I(" "+y(v.$formatter.number.toInteger(p.battles)),1)]),s("span",ko,[s("span",yo,[_(l,{name:"flag-variant",size:"18"})]),_(g,{"win-rate":p.winRate},null,8,["win-rate"])]),s("span",go,[s("span",bo,[_(l,{name:"destruction",size:"18"})]),I(" "+y(v.$formatter.number.toInteger(p.damagePerBattle)),1)]),s("span",wo,[o[2]||(o[2]=s("span",{class:"account-daily-stat-table-mobile__prop-icon",style:{"font-weight":"500","font-size":"14px"}}," I-X ",-1)),I(" "+y(v.$formatter.number.toInteger(p.tier)),1)])])],40,ro)]),_:1},8,["data"])])}}}),Ao={class:"account-daily-stat"},Ro={class:"account-daily-stat__filters"},To={class:"account-daily-stat__filters-item"},Io={class:"account-daily-stat__filters-item"},So={class:"account-daily-stat__table"},Co={style:{display:"flex","justify-content":"flex-end"}},Do=N({__name:"AccountDailyStat",props:{accountId:{type:[Number,String],default:0,required:!0},vehicles:{type:Object,default:()=>({}),required:!0}},emits:["sort"],setup(a,{emit:c}){const u=a,v=Ut(),o=z(null),l=Q({loading:0,summary:{},items:[],currentItem:null,accounts:[],tanks:[]}),g=[7,14,30,60,90].map($=>({value:$,label:new Intl.NumberFormat("ru",{style:"unit",unit:"day",unitDisplay:"long"}).format($)})),k=[0,7,14,30,60,90,180].map($=>({value:$,label:new Intl.NumberFormat("ru",{style:"unit",unit:"day",unitDisplay:"long"}).format($)})),p=Q({period:7,periodOffset:0}),t=M(()=>{const $=new Date,R=new Date;return $.setDate($.getDate()-(p.periodOffset+p.period+1)),R.setDate(R.getDate()-p.periodOffset),{dateStart:$.toISOString(),dateEnd:R.toISOString()}}),w={order:"desc",prop:"last_battle_time"},T=M(()=>l.currentItem?l.currentItem.tanks.map($=>{var R;return ot.accountTank($,((R=u.vehicles)==null?void 0:R[$.tank_id])??null,null)}):[]);xt(async()=>{u.accountId&&(await e(u.accountId),n())}),Dt(t,async()=>{u.accountId&&(await e(u.accountId),n())});const i=c;async function e($){const R={...t.value,id:$};l.loading++;try{const[C,O]=await Promise.all([dt.stat.accounts.getDiff(R),dt.stat.tanks.getDiff(R)]);l.tanks=O.data,l.accounts=C.data}catch(C){F(C,{title:"Получение дневной статистики"})}l.loading--}function n(){let $=null;l.items=[],l.accounts.forEach(R=>{var U;const C=q.accountAll(R.raw.statistics.all),O=(U=l.tanks.find(H=>{const E=B.date.toDate(H.timestamp),Y=B.date.toDate(R.timestamp);return E===Y}))==null?void 0:U.raw,V=()=>{const H=(O==null?void 0:O.length)??0;return((O==null?void 0:O.reduce((E,Y)=>{var Z;return E+((Z=u.vehicles[Y.tank_id])==null?void 0:Z.tier)||0},0))??0)/H};l.items.push({id:R.id,date:B.date.toDate(R.timestamp),battles:C.battles,winRate:C.winRate,damagePerBattle:C.damagePerBattle,xpPerBattle:C.xpPerBattle,fragPerBattle:C.fragPerBattle,hitRate:C.hitRate,surviveRate:C.surviveRate,spottedPerBattle:C.spottedPerBattle,tanks:O||[],tier:V()}),$=$?q.sum($,C):C}),l.summary=$?q.accountAll($):{}}async function h($){var R;l.currentItem=$,await Pt(),(R=o.value)==null||R.doOpen()}function S(){var $;l.currentItem=null,($=o.value)==null||$.doClose()}return($,R)=>{var Y;const C=le,O=hs,V=ct,U=me,H=tt,E=mt;return f(),b("div",Ao,[s("div",Ro,[s("div",To,[R[5]||(R[5]=I(" Период ")),_(C,{modelValue:r(p).period,"onUpdate:modelValue":R[0]||(R[0]=Z=>r(p).period=Z),width:"120px",options:r(g),class:"account-daily-stat__filters-item"},null,8,["modelValue","options"])]),s("div",Io,[R[6]||(R[6]=I(" Смещение ")),_(C,{modelValue:r(p).periodOffset,"onUpdate:modelValue":R[1]||(R[1]=Z=>r(p).periodOffset=Z),width:"120px",options:r(k)},null,8,["modelValue","options"])])]),s("div",So,[r(v).isTablet?(f(),L($o,{key:0,items:r(l).items,summary:r(l).summary,onSort:R[2]||(R[2]=Z=>i("sort",Z)),onRowClick:h},null,8,["items","summary"])):(f(),L(O,{key:1,items:r(l).items,summary:r(l).summary,onSort:R[3]||(R[3]=Z=>i("sort",Z)),onRowClick:h},null,8,["items","summary"])),_(V,{loading:r(l).loading>0},null,8,["loading"])]),_(E,{ref_key:"tanksDetailsRef",ref:o,width:"1280px",title:"Статистика за "+((Y=r(l).currentItem)==null?void 0:Y.date),onClosed:R[4]||(R[4]=Z=>r(l).currentItem=null)},{footer:A(()=>[s("div",Co,[_(H,{onClick:S},{default:A(()=>R[7]||(R[7]=[I(" Закрыть ")])),_:1})])]),default:A(()=>[r(l).currentItem?(f(),L(U,{key:0,tanks:r(T),"default-sort":w,"max-height":"calc(100vh - 200px)"},null,8,["tanks"])):P("",!0)]),_:1},8,["title"])])}}});var Po="__lodash_hash_undefined__";function Bo(a){return this.__data__.set(a,Po),this}var Oo=Bo;function xo(a){return this.__data__.has(a)}var Mo=xo,Uo=ze,Lo=Oo,qo=Mo;function wt(a){var c=-1,u=a==null?0:a.length;for(this.__data__=new Uo;++c<u;)this.add(a[c])}wt.prototype.add=wt.prototype.push=Lo;wt.prototype.has=qo;var Fo=wt;function Eo(a,c){for(var u=-1,v=a==null?0:a.length;++u<v;)if(c(a[u],u,a))return!0;return!1}var No=Eo;function Vo(a,c){return a.has(c)}var jo=Vo,Ho=Fo,Go=No,zo=jo,Zo=1,Ko=2;function Wo(a,c,u,v,o,l){var g=u&Zo,k=a.length,p=c.length;if(k!=p&&!(g&&p>k))return!1;var t=l.get(a),w=l.get(c);if(t&&w)return t==c&&w==a;var T=-1,i=!0,e=u&Ko?new Ho:void 0;for(l.set(a,c),l.set(c,a);++T<k;){var n=a[T],h=c[T];if(v)var S=g?v(h,n,T,c,a,l):v(n,h,T,a,c,l);if(S!==void 0){if(S)continue;i=!1;break}if(e){if(!Go(c,function($,R){if(!zo(e,R)&&(n===$||o(n,$,u,v,l)))return e.push(R)})){i=!1;break}}else if(!(n===h||o(n,h,u,v,l))){i=!1;break}}return l.delete(a),l.delete(c),i}var _e=Wo;function Xo(a){var c=-1,u=Array(a.size);return a.forEach(function(v,o){u[++c]=[o,v]}),u}var Qo=Xo;function Yo(a){var c=-1,u=Array(a.size);return a.forEach(function(v){u[++c]=v}),u}var Jo=Yo,Ht=Ze,Gt=Ke,ti=We,ei=_e,ai=Qo,ni=Jo,si=1,oi=2,ii="[object Boolean]",li="[object Date]",ci="[object Error]",ri="[object Map]",ui="[object Number]",di="[object RegExp]",mi="[object Set]",_i="[object String]",fi="[object Symbol]",pi="[object ArrayBuffer]",vi="[object DataView]",zt=Ht?Ht.prototype:void 0,St=zt?zt.valueOf:void 0;function hi(a,c,u,v,o,l,g){switch(u){case vi:if(a.byteLength!=c.byteLength||a.byteOffset!=c.byteOffset)return!1;a=a.buffer,c=c.buffer;case pi:return!(a.byteLength!=c.byteLength||!l(new Gt(a),new Gt(c)));case ii:case li:case ui:return ti(+a,+c);case ci:return a.name==c.name&&a.message==c.message;case di:case _i:return a==c+"";case ri:var k=ai;case mi:var p=v&si;if(k||(k=ni),a.size!=c.size&&!p)return!1;var t=g.get(a);if(t)return t==c;v|=oi,g.set(a,c);var w=ei(k(a),k(c),v,o,l,g);return g.delete(a),w;case fi:if(St)return St.call(a)==St.call(c)}return!1}var ki=hi,Zt=Xe,yi=1,gi=Object.prototype,bi=gi.hasOwnProperty;function wi(a,c,u,v,o,l){var g=u&yi,k=Zt(a),p=k.length,t=Zt(c),w=t.length;if(p!=w&&!g)return!1;for(var T=p;T--;){var i=k[T];if(!(g?i in c:bi.call(c,i)))return!1}var e=l.get(a),n=l.get(c);if(e&&n)return e==c&&n==a;var h=!0;l.set(a,c),l.set(c,a);for(var S=g;++T<p;){i=k[T];var $=a[i],R=c[i];if(v)var C=g?v(R,$,i,c,a,l):v($,R,i,a,c,l);if(!(C===void 0?$===R||o($,R,u,v,l):C)){h=!1;break}S||(S=i=="constructor")}if(h&&!S){var O=a.constructor,V=c.constructor;O!=V&&"constructor"in a&&"constructor"in c&&!(typeof O=="function"&&O instanceof O&&typeof V=="function"&&V instanceof V)&&(h=!1)}return l.delete(a),l.delete(c),h}var $i=wi,Ct=Qe,Ai=_e,Ri=ki,Ti=$i,Kt=Ye,Wt=ea,Xt=Je,Ii=ta,Si=1,Qt="[object Arguments]",Yt="[object Array]",bt="[object Object]",Ci=Object.prototype,Jt=Ci.hasOwnProperty;function Di(a,c,u,v,o,l){var g=Wt(a),k=Wt(c),p=g?Yt:Kt(a),t=k?Yt:Kt(c);p=p==Qt?bt:p,t=t==Qt?bt:t;var w=p==bt,T=t==bt,i=p==t;if(i&&Xt(a)){if(!Xt(c))return!1;g=!0,w=!1}if(i&&!w)return l||(l=new Ct),g||Ii(a)?Ai(a,c,u,v,o,l):Ri(a,c,p,u,v,o,l);if(!(u&Si)){var e=w&&Jt.call(a,"__wrapped__"),n=T&&Jt.call(c,"__wrapped__");if(e||n){var h=e?a.value():a,S=n?c.value():c;return l||(l=new Ct),o(h,S,u,v,l)}}return i?(l||(l=new Ct),Ti(a,c,u,v,o,l)):!1}var Pi=Di,Bi=Pi,te=aa;function fe(a,c,u,v,o){return a===c?!0:a==null||c==null||!te(a)&&!te(c)?a!==a&&c!==c:Bi(a,c,u,v,fe,o)}var Oi=fe,xi=Oi;function Mi(a,c){return xi(a,c)}var Ui=Mi;const Li=na(Ui),qi={class:"account-tanks-filters"},Fi={class:"account-tanks-filters__inner"},Ei={class:"account-tanks-filters__list"},Ni={key:0,class:"account-tanks-filters__item"},Vi={class:"account-tanks-filters__item"},ji={class:"account-tanks-filters__item"},Hi=N({__name:"AccountTanksFilters",props:{defaultFilters:{type:Object,default:null,required:!0},filters:{type:Object,default:null,required:!0},isPrivate:{type:Boolean,default:!1,required:!0}},emits:["change","clear"],setup(a,{emit:c}){const u=a,v=["ussr","germany","usa","uk","japan","china","france","european","other"],o=["lightTank","mediumTank","heavyTank","AT-SPG"],l=[{value:null,label:"Премиум: показать"},{value:!0,label:"Премиум: только"},{value:!1,label:"Премиум: спрятать"}],g=[{value:null,label:"В ангаре: все"},{value:1,label:"В ангаре: есть"},{value:0,label:"В ангаре: нет"}],k=M(()=>!Li(u.filters,u.defaultFilters)),p=c;function t(e){let n=u.filters.tankNation;n.includes(e)?n=n.filter(h=>h!==e):n.push(e),p("change",{...u.filters,tankNation:n})}function w(e){let n=u.filters.tankType;n.includes(e)?n=n.filter(h=>h!==e):n.push(e),p("change",{...u.filters,tankType:n})}function T(e){p("change",{...u.filters,tankInGarage:e})}function i(e){p("change",{...u.filters,tankIsPremium:e})}return(e,n)=>{const h=ie,S=rt,$=_t,R=da,C=le,O=lt,V=tt;return f(),b("div",qi,[s("div",Fi,[s("ul",Ei,[s("li",{class:X(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[(f(),b(K,null,at(v,U=>_(S,{key:U,"model-value":a.filters.tankNation.includes(U),class:"account-tanks-filters__btn",title:e.$formatter.encyclopedia.nation(U),onChange:H=>t(U)},{default:A(()=>[_(h,{nation:U},null,8,["nation"])]),_:2},1032,["model-value","title","onChange"])),64))]),s("li",{class:X(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[(f(),b(K,null,at(o,U=>_(S,{key:U,"model-value":a.filters.tankType.includes(U),class:"account-tanks-filters__btn",title:"Тип",onChange:H=>w(U)},{default:A(()=>[_($,{type:U},null,8,["type"])]),_:2},1032,["model-value","onChange"])),64))]),s("li",{class:X(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[_(R,{modelValue:a.filters.tankTire,"onUpdate:modelValue":n[0]||(n[0]=U=>a.filters.tankTire=U)},null,8,["modelValue"])]),a.isPrivate?(f(),b("li",Ni,[_(C,{"model-value":a.filters.tankInGarage,options:g,onChange:T},null,8,["model-value"])])):P("",!0),s("li",Vi,[_(C,{"model-value":a.filters.tankIsPremium,options:l,onChange:i},null,8,["model-value"])]),s("li",ji,[_(V,{title:"Очистить фильтры",disabled:!r(k),onClick:n[1]||(n[1]=U=>p("clear"))},{default:A(()=>[_(O,{name:"clear"})]),_:1},8,["disabled"])])])])])}}}),Gi={key:0,class:"account-tank"},zi={class:"account-tank__header"},Zi={class:"account-tank__img-wrapper"},Ki={class:"account-tank__tier"},Wi={class:"account-tank__props"},Xi={class:"account-tank__prop"},Qi={class:"account-tank__prop"},Yi=N({__name:"AccountTank",props:{tank:{type:Object,default:()=>({}),required:!0},tankDiff:{type:Object,default:null,required:!0},achievementsInfo:{type:Object,default:()=>({}),required:!0}},setup(a){const c=["battles","winRate","damagePerBattle","surviveRate","fragPerBattle","winsInPlatoon"],u=a,v=Q({showAllMetrics:!1,filters:ra()}),o=M(()=>{const g=nt.tank({tank:u.tank,tankDiff:u.tankDiff});return v.showAllMetrics?g:g.filter(k=>c.includes(k.key))});function l(g){v.filters=g}return(g,k)=>{var e;const p=$t,t=_t,w=rt,T=se,i=ue;return a.tank?(f(),b("div",Gi,[s("div",zi,[s("div",Zi,[_(p,{class:"account-tank__img account-tank__img--nation",alt:"tank.nation",src:`/img/nations/nation-${a.tank.nation}.svg`},null,8,["src"]),_(p,{class:"account-tank__img account-tank__img--tank",alt:a.tank.name,src:(e=a.tank.images)==null?void 0:e.preview},null,8,["alt","src"]),_(t,{size:28,class:"account-tank__type",type:a.tank.type,"is-premium":a.tank.is_premium,"is-collectible":a.tank.is_collectible},null,8,["type","is-premium","is-collectible"]),s("div",Ki,y(g.$formatter.encyclopedia.tier(a.tank.tier)),1)]),s("div",Wi,[s("div",Xi,[k[1]||(k[1]=s("span",{class:"account-tank__prop-name"}," Нация: ",-1)),I(" "+y(g.$formatter.encyclopedia.nation(a.tank.nation)),1)]),s("div",Qi,[k[2]||(k[2]=s("span",{class:"account-tank__prop-name"}," Последний бой: ",-1)),I(" "+y(g.$formatter.date.toDateTime(a.tank.last_battle_time*1e3)),1)])])]),k[4]||(k[4]=s("h4",null,"Статистика",-1)),_(w,{modelValue:r(v).showAllMetrics,"onUpdate:modelValue":k[0]||(k[0]=n=>r(v).showAllMetrics=n),class:"account-tank__show-all-metrics"},{default:A(()=>k[3]||(k[3]=[I(" Все показатели ")])),_:1},8,["modelValue"]),_(T,{items:r(o)},null,8,["items"]),k[5]||(k[5]=s("h4",null,"Достижения",-1)),_(i,{achievements:a.tank.achievements,"achievements-info":a.achievementsInfo,filters:r(v).filters,onFiltersChanged:l},null,8,["achievements","achievements-info","filters"])])):P("",!0)}}}),Ji={key:0,class:"account-view"},tl={class:"account-view__private"},el={key:1,class:"account-view--no-data"},al={key:0,class:"content-area"},nl={style:{display:"flex","justify-content":"flex-end"}},Cl=N({__name:"AccountView",setup(a){const c=z(null),u=z(null),v=oe.makeAccountFilters({tankInGarage:1,tankIsPremium:null}),o=sa(),l=ma(),g=_a(),k={order:"desc",prop:"last_battle_time"},p=Q(et(k)),t=Q({tanks:[],tanksDiff:[],tanksSessions:[],tanksSnapshot:[],tanksTableItems:[],sessionUpdateAt:0,sessionActive:!1,currentTank:null,currentTankDiff:null,loading:0,filters:et(v),accountRaw:null,accountRawSnapshot:null,accountAchievementsRaw:null,accountAchievementsRawSnapshot:null,tanksRaw:null,tanksRawSnapshot:null,tanksAchievementsRaw:null,tanksAchievementsRawSnapshot:null}),w=M(()=>g.vehicles),T=M(()=>g.achievements),i=M(()=>{var d;return l.accountId===((d=t.accountRaw)==null?void 0:d.account_id)}),e=M(()=>Number(o.params.id)||l.accountId),n=M(()=>!t.accountAchievementsRaw||!t.accountAchievementsRawSnapshot||!T.value?null:q.accountAchievementsDiff(t.accountAchievementsRaw,t.accountAchievementsRawSnapshot,T.value)),h=M(()=>t.sessionActive?n.value:t.accountAchievementsRaw),S=M(()=>{if(!t.accountRaw)return null;const d=t.accountRaw.statistics.all,m=t.accountRaw.statistics.rating;return{...t.accountRaw,statistics:{all:q.accountAll(d),rating:m?q.accountRating(m):null}}}),$=M(()=>{if(!t.accountRaw||!t.accountRawSnapshot)return null;const d=t.accountRaw.statistics.all,m=t.accountRaw.statistics.rating,D=t.accountRawSnapshot.statistics.all,x=t.accountRawSnapshot.statistics.rating;return{...t.accountRaw,statistics:{all:q.accountAll(q.diff(d,D)),rating:m&&x?q.accountRating(q.diff(m,x)):null}}}),R=M(()=>{if(!t.accountRaw||!t.accountRawSnapshot)return null;const d=t.accountRaw.statistics.all,m=t.accountRaw.statistics.rating,D=t.accountRawSnapshot.statistics.all,x=t.accountRawSnapshot.statistics.rating,G=q.diff(q.accountAll(d),q.accountAll(D)),j=m&&x?q.diff(q.accountRating(m),q.accountRating(x)):null;return{...t.accountRaw,statistics:{all:G,rating:j}}}),C=M(()=>{var d,m,D,x;return!S.value||!$.value||!h.value?nt.account():t.sessionActive?nt.account({stat:(d=$.value)==null?void 0:d.statistics.all,achievements:n.value,tanks:t.tanksSessions,createAt:new Date(t.sessionUpdateAt).valueOf()}):nt.account({stat:(m=S.value)==null?void 0:m.statistics.all,statDiff:(D=R.value)==null?void 0:D.statistics.all,achievements:t.accountAchievementsRaw,achievementsDiff:n.value,tanks:t.tanks,tanksDiff:t.tanksDiff.filter(G=>G.all.battles),createAt:((x=S.value)==null?void 0:x.created_at)*1e3,createAtSnapshot:new Date(t.sessionUpdateAt).valueOf()})}),O=M(()=>{var d,m,D;return!S.value||!$.value?nt.accountRating():t.sessionActive?nt.accountRating({stat:(d=$.value)==null?void 0:d.statistics.rating}):nt.accountRating({stat:(m=S.value)==null?void 0:m.statistics.rating,diff:(D=R.value)==null?void 0:D.statistics.rating})}),V=M(()=>t.filters.battleMode==="random"?C.value:O.value);Dt(()=>t.sessionActive,()=>{pt(t.filters)}),Dt(()=>t.filters,async()=>{var d;Lt(t.filters),await Pt(),(d=c.value)==null||d.sortItems()});const U=z(!1);function H(){var d;return((d=t.tanksRaw)==null?void 0:d.map(m=>{var x,G;const D=(x=t.tanksAchievementsRaw)==null?void 0:x.find(j=>j.tank_id===m.tank_id);return ot.accountTank(m,((G=w.value)==null?void 0:G[m.tank_id])??null,D??null)}))??[]}function E(){var d;return((d=t.tanksRawSnapshot)==null?void 0:d.map(m=>{var x,G;const D=(x=t.tanksAchievementsRawSnapshot)==null?void 0:x.find(j=>j.tank_id===m.tank_id);return ot.accountTank(m,((G=w.value)==null?void 0:G[m.tank_id])??null,D??null)}))??[]}function Y(d,m=!1){var it,vt,ht;const D=((it=t.tanksAchievementsRaw)==null?void 0:it.find(ut=>ut.tank_id===d.tank_id))??null,x=((vt=t.tanksAchievementsRawSnapshot)==null?void 0:vt.find(ut=>ut.tank_id===d.tank_id))??null,G=D&&x?q.tankAchievementsDiff(D,x):null,j=((ht=w.value)==null?void 0:ht[d.tank_id])??null;return ot.accountTank(d,j,m?D:G)}function Z(){var d;return((d=t.tanksRaw)==null?void 0:d.reduce((m,D)=>{var j;const x=(j=t.tanksRawSnapshot)==null?void 0:j.find(it=>it.tank_id===D.tank_id);if(!x)return m.push(Y(D,!0)),m;if(D.all.battles===x.all.battles)return m;const G=D.battle_life_time-x.battle_life_time;return m.push(Y({...D,battle_life_time:G,all:q.diff(D.all,x.all)})),m},[]))??[]}function pe(){return t.tanks.map(d=>{const m=t.tanksSnapshot.find(x=>d.tank_id===x.tank_id);if(!m)return d;const D=d.battle_life_time-m.battle_life_time;return{...d,all:q.diff(d.all,m.all),battle_life_time:D,achievements:q.tankAchievementsDiff(d.achievements,m.achievements)}})}function ve(){t.tanks=H(),t.tanksSnapshot=E(),t.tanksSessions=Z(),t.tanksDiff=pe()}async function he(d){t.loading++;try{const{data:m}=await st.tanks.getAchievements({account_id:d});t.tanksAchievementsRaw=m[d]??null}catch(m){F(m,{title:"Получение достижений по технике игрока"})}t.loading--}async function ke(d){t.loading++;try{const{data:m}=await st.account.getAchievements({account_id:d});t.accountAchievementsRaw=m[d]??null}catch(m){F(m,{title:"Получение достижений по аккаунту игрока"})}t.loading--}async function ye(d){t.loading++;try{const{data:m}=await st.account.getInfo({account_id:d,extra:"statistics.rating"});t.accountRaw=(m==null?void 0:m[d])??null}catch(m){F(m,{title:"Получение данных аккаунта"})}t.loading--}async function ge(d){w.value||await we(),await be(d)}async function be(d){t.loading++;try{const{data:m}=await st.tanks.getStats({account_id:d});t.tanksRaw=m?m[d]:null}catch(m){F(m,{title:"Получение статистики по технике игрока"})}t.loading--}async function we(){if(!w.value){t.loading++;try{await g.getTanksVehicles()}catch(d){F(d,{title:"Получение данных описания техники"})}t.loading--}}async function $e(){if(!T.value){t.loading++;try{await g.getAchievements()}catch(d){F(d,{title:"Получение описания достижений"})}t.loading--}}async function At(d=!1){var m;e.value&&(await Promise.all([$e(),ye(e.value),ge(e.value),he(e.value),ke(e.value)]),d||await Oe(),(d||!t.accountRawSnapshot)&&await xe(),ve(),Lt(t.filters),await Pt(),(m=c.value)==null||m.sortItems())}xt(async()=>{await At(),U.value=!0});function Lt(d){let m=t.sessionActive?t.tanksSessions:t.tanks;d.tankInGarage!==null&&(m=m.filter(D=>typeof D.in_garage!="boolean"?!0:D.in_garage===(d.tankInGarage===1))),d.tankNation.length&&(m=m.filter(D=>d.tankNation.includes(D.nation))),d.tankTire.length&&(m=m.filter(D=>d.tankTire.includes(D.tier))),m=m.filter(D=>{const x=d.tankIsPremium;return x===!0?D.is_premium:x===!1?!D.is_premium:!0}),d.tankType.length&&(m=m.filter(D=>d.tankType.includes(D.type))),t.tanksTableItems=m}function pt(d){t.filters=et(d)}function Ae(){t.filters=et(v)}async function Re(){if(t.accountRaw){t.loading++;try{const{$indexedDB:d}=W(),m=await d.accountsInfo.get(t.accountRaw.account_id);t.accountRawSnapshot=(m==null?void 0:m.data)??null,t.sessionUpdateAt=(m==null?void 0:m.timestamp)??0}catch(d){F(d,{title:"Загрузка локальных данных аккаунта"})}t.loading--}}async function Te(){if(t.accountRaw){t.loading++;try{const{$indexedDB:d}=W();await d.accountsInfo.set(t.accountRaw.account_id,gt(t.accountRaw)),t.accountRawSnapshot=et(t.accountRaw),t.sessionUpdateAt=Date.now()}catch(d){F(d,{title:"Сохранение локальных данных аккаунта"})}t.loading--}}async function Ie(){if(t.accountRaw){t.loading++;try{const{$indexedDB:d}=W(),m=await d.accountsAchievements.get(t.accountRaw.account_id);t.accountAchievementsRawSnapshot=(m==null?void 0:m.data)??null,t.sessionUpdateAt=(m==null?void 0:m.timestamp)??0}catch(d){F(d,{title:"Загрузка локальных данных достижений аккаунта"})}t.loading--}}async function Se(){if(!(!t.accountRaw||!t.accountAchievementsRaw)){t.loading++;try{const{$indexedDB:d}=W();await d.accountsAchievements.set(t.accountRaw.account_id,gt(t.accountAchievementsRaw)),t.accountAchievementsRawSnapshot=et(t.accountAchievementsRaw)}catch(d){F(d,{title:"Сохранение локальных данных достижений аккаунта"})}t.loading--}}async function Ce(){if(t.accountRaw){t.loading++;try{const{$indexedDB:d}=W(),m=await d.tanksStat.get(t.accountRaw.account_id);t.tanksRawSnapshot=(m==null?void 0:m.data)??null}catch(d){F(d,{title:"Загрузка локальных данных техники"})}t.loading--}}async function De(){if(!(!t.accountRaw||!t.tanksRaw)){t.loading++;try{const{$indexedDB:d}=W();await d.tanksStat.set(t.accountRaw.account_id,gt(t.tanksRaw)),t.tanksRawSnapshot=et(t.tanksRaw),t.sessionUpdateAt=Date.now()}catch(d){F(d,{title:"Сохранение локальных данных техники"})}t.loading--}}async function Pe(){if(t.accountRaw){t.loading++;try{const{$indexedDB:d}=W(),m=await d.tanksAchievements.get(t.accountRaw.account_id);t.tanksAchievementsRawSnapshot=(m==null?void 0:m.data)??null}catch(d){F(d,{title:"Загрузка локальных данных достижений техники"})}t.loading--}}async function Be(){if(!(!t.accountRaw||!t.tanksAchievementsRaw)){t.loading++;try{const{$indexedDB:d}=W();await d.tanksAchievements.set(t.accountRaw.account_id,gt(t.tanksAchievementsRaw)),t.tanksAchievementsRawSnapshot=et(t.tanksAchievementsRaw),t.sessionUpdateAt=Date.now()}catch(d){F(d,{title:"Сохранение локальных данных достижений техники"})}t.loading--}}async function Oe(){await Promise.all([Re(),Ie(),Ce(),Pe()])}async function xe(){await Promise.all([Te(),Se(),De(),Be()])}async function Me(){await At(!0)}function Ue(){At()}function Le(d){var m;t.sessionActive?(t.currentTank=t.tanksSessions.find(D=>d===D.tank_id)??null,t.currentTankDiff=null):(t.currentTank=t.tanks.find(D=>d===D.tank_id)??null,t.currentTankDiff=t.tanksDiff.find(D=>d===D.tank_id)??null),(m=u.value)==null||m.doOpen()}return(d,m)=>{var qt;const D=Ba,x=wn,G=Pn,j=ca,it=Ln,vt=ue,ht=vs,ut=Do,qe=Hi,Fe=me,Ee=ct,Ne=Yi,Ve=tt,je=mt;return f(),b(K,null,[r(t).accountRaw?(f(),b("div",Ji,[_(j,{identity:"preview"},{default:A(()=>[s("div",tl,[r(t).accountRaw.private?(f(),L(D,{key:0,resources:r(t).accountRaw.private},null,8,["resources"])):P("",!0)]),_(x,{loading:r(t).loading>0,class:"account-view__preview",account:r(t).accountRaw},null,8,["loading","account"]),_(G,{modelValue:r(t).sessionActive,"onUpdate:modelValue":m[0]||(m[0]=Rt=>r(t).sessionActive=Rt),class:"account-view__session",loading:r(t).loading>0,"update-at":r(t).sessionUpdateAt,onReset:Me,onUpdate:Ue},null,8,["modelValue","loading","update-at"])]),_:1}),_(j,{title:"Статистика",identity:"statistic"},{default:A(()=>[_(it,{filters:r(t).filters,metrics:r(V),loading:r(t).loading>0,onFilters:pt},null,8,["filters","metrics","loading"])]),_:1}),Tt(_(j,{title:"Достижения",identity:"achievements"},{default:A(()=>[r(h)&&r(T)?(f(),L(vt,{key:0,filters:r(t).filters,"achievements-info":r(T),achievements:r(h),onFiltersChanged:pt},null,8,["filters","achievements-info","achievements"])):P("",!0)]),_:1},512),[[It,r(t).filters.battleMode==="random"]]),!r(t).sessionActive&&r(t).filters.battleMode==="random"?(f(),L(j,{key:0,title:"Инфографика",identity:"tanksBattles"},{default:A(()=>[_(ht,{tanks:r(t).tanks},null,8,["tanks"])]),_:1})):P("",!0),!r(t).sessionActive&&r(w)?Tt((f(),L(j,{key:1,title:"Статистика по дням",identity:"dailyStat"},{default:A(()=>[_(ut,{vehicles:r(w),"account-id":r(t).accountRaw.account_id},null,8,["vehicles","account-id"])]),_:1},512)),[[It,r(t).filters.battleMode==="random"]]):P("",!0),Tt(_(j,{title:"Техника",identity:"tanks"},{default:A(()=>[_(qe,{class:"account-view__filters",filters:r(t).filters,"default-filters":r(v),"is-private":r(i),onChange:pt,onClear:Ae},null,8,["filters","default-filters","is-private"]),_(Fe,{ref_key:"tableRef",ref:c,sort:r(p),loading:r(t).loading>0,"default-sort":k,tanks:r(t).tanksTableItems,"tanks-diff":r(t).tanksDiff,"achievements-info":r(T),"show-diff":!r(t).sessionActive,height:"calc(100vh - 90px)",onRowClick:Le},null,8,["sort","loading","tanks","tanks-diff","achievements-info","show-diff"])]),_:1},512),[[It,r(t).filters.battleMode==="random"]])])):(f(),b("div",el,[r(U)?(f(),b("div",al,m[3]||(m[3]=[s("p",null,"Нет данных.",-1),s("p",null,"Возможно аккаунт удалён.",-1)]))):P("",!0),_(Ee,{loading:!r(U)},null,8,["loading"])])),_(je,{ref_key:"tankDetailsRef",ref:u,width:"1100px",title:(qt=r(t).currentTank)==null?void 0:qt.name,onClosed:m[2]||(m[2]=Rt=>r(t).currentTank=null)},{footer:A(()=>[s("div",nl,[_(Ve,{onClick:m[1]||(m[1]=Rt=>{var Ft;return(Ft=r(u))==null?void 0:Ft.doClose()})},{default:A(()=>m[4]||(m[4]=[I(" Закрыть ")])),_:1})])]),default:A(()=>[r(T)&&r(t).currentTank?(f(),L(Ne,{key:0,tank:r(t).currentTank,"tank-diff":r(t).currentTankDiff,"achievements-info":r(T)},null,8,["tank","tank-diff","achievements-info"])):P("",!0)]),_:1},8,["title"])],64)}}});export{Cl as _};
