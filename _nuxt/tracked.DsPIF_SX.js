import{_ as T}from"./CImage.vue.CvwyBujS.js";import{u as j,_ as L,a as V}from"./disableScroll.DYMxvxot.js";import{_ as q}from"./TablePagination.vue.BZ-wrSe6.js";import{_ as A}from"./CTable.vue.DunflFFB.js";import{_ as F}from"./ContentLoader.vue.5R4WWV0u.js";import{n as O}from"./notEmpty.BxBPJGBn.js";import{a as P,s as u}from"./request.CetvaxyE.js";import{f as R,n as _,i as M,q as U,c as y,a as r,b as l,w as i,k as d,s as h,o as p,j as G,t as k,C as H,D as J,F as K,d as Q}from"./entry.C5iIeEMf.js";import"./image-broken.O8TKxjfx.js";import"./nuxt-icon.BveY_ybo.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const W={class:"clan-tracked-page"},X=r("div",{class:"clan-tracked__description content-area",style:{"max-width":"800px"}},[r("p",null,"Список кланов, отслеживаемых в конкретном браузере."),r("p",null," Отслеживание начинается с момента просмотра клана на данном ресурсе. После удаления из списка - отслеживание прекращается. ")],-1),Y={class:"clan-tracked-page__inner"},Z={class:"clan-tracked-page__name"},_a=R({__name:"tracked",setup(w){const g=j(),t=_({items:[],clans:[],localClans:null,loading:0}),c=_({total:0,page:1,pageSize:100}),C=_({order:"desc",prop:"updated_at"}),b=[{key:"tag",label:"Название"},{key:"members_count",align:"center",label:"Уч-ков"},{key:"updated_at",label:"Обновлён",formatter:a=>a&&typeof a=="number"?h.date.toRelativeTime(a*1e3):"---"},{key:"created_at",label:"Создан",formatter:a=>a?h.date.toDate(Number(a)*1e3):"---"},{key:"actions",width:60}],f=M(()=>{const a=c.page*c.pageSize,e=a-c.pageSize;return(t.localClans??[]).slice(e,a)});U(()=>{m()});function x(a){return`https://wotblitz-gc.gcdn.co/icons/clanEmblems1x/clan-icon-v2-${a}.png`}async function v(a){t.loading++;let e=[];try{const{data:s}=await P.clan.getInfo({clan_id:a.join(",")});e=Object.values(s).filter(O)??[]}catch(s){console.error(s),g.add({type:"error",title:"Получение данных клана",message:s instanceof Error?s.message:"Неизвестная ошибка"})}return t.loading--,e}async function E(){t.loading++;try{const a=await u.indexedDB.clansInfo.getAll();t.localClans=(a??[]).map(e=>e.data),c.total=t.localClans.length}catch(a){console.error(a),g.add({type:"error",title:"Получение локальных данных клана",message:a instanceof Error?a.message:"Неизвестная ошибка"})}t.loading--}function B(a){t.items=f.value.map(e=>a.find(o=>(o==null?void 0:o.clan_id)===e.clan_id)??{...e,updated_at:0,created_at:0,members_count:0,notExists:!0})}async function m(){var s;if(t.localClans||await E(),!((s=t.localClans)!=null&&s.length))return;const a=f.value.map(o=>o.clan_id),e=await v(a);B(e)}async function $(a){await u.indexedDB.clansInfo.remove(a),t.items.length<c.total?t.items=t.items.filter(e=>e.clan_id!==a):await m()}async function I(){await m()}return(a,e)=>{const s=T,o=L,S=V,D=q,z=A,N=F;return p(),y("div",W,[X,r("div",Y,[l(z,{"no-wrap":"","scroll-to-top":"","scroll-auto-disabling":"",headers:b,data:d(t).items,"default-sort":d(C),height:"calc(100vh - 112px)"},{tag:i(({row:n})=>[n!=null&&n.tag&&(n!=null&&n.name)?(p(),G(J(n.notExists?"span":"nuxt-link"),{key:0,class:H([[n.notExists?"":"link"],"clan-tracked-page__details"]),to:{name:"clan-id",params:{id:n.clan_id}}},{default:i(()=>[l(s,{class:"clan-tracked-page__emblem",alt:"Эмблема клана",src:x(n.emblem_set_id)},null,8,["src"]),r("span",Z," ["+k(n.tag)+"] "+k(n.name),1)]),_:2},1032,["class","to"])):(p(),y(K,{key:1},[Q(" Удалён ")],64))]),actions:i(({row:n})=>[l(S,{title:"Удалить","is-text":"","is-square":"",onClick:aa=>$(n.clan_id)},{default:i(()=>[l(o,{"icon-name":"delete"})]),_:2},1032,["onClick"])]),footer:i(()=>[l(D,{pagination:d(c),onChange:I},null,8,["pagination"])]),_:1},8,["data","default-sort"]),l(N,{loading:d(t).loading>0},null,8,["loading"])])])}}});export{_a as default};
