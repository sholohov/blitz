function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./CLUhr88i.js","./-p8L5eN0.js","./DlAUqK2U.js","./C1pZ3Ysy.js","./nuxt-icon.MfBulapQ.css","./CM4rjZrb.js","./Dyp_Wyvs.js","./CfZSxFC9.js","./DIy2ncyx.js","./Cl8lwJPt.js","./D17qV2Vf.js","./CpeqrCAT.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{N as Ee}from"./-p8L5eN0.js";import{J as qe,o as d,c as v,a as s,f as j,i as E,s as V,b as h,C as Q,k as c,t as $,m as P,r as K,n as Z,j as q,w as R,d as I,F as z,A as Y,q as Se,v as Re,x as pe,y as it,T as lt,D as Fe,E as ne,_ as se,K as Ne,L as Kt,G as ue,M as Wt,z as Ve,N as te,O as Le,g as Xt,P as Oe,Q as Be,H as $e}from"./C1pZ3Ysy.js";import{_ as Jt,m as ce}from"./3YsmnF-1.js";import{_ as ct}from"./dAvVLxv5.js";import{_ as he,h as H,u as Qt,t as Me,d as ze}from"./C2BuzcM2.js";import{_ as oe}from"./BfF4LBiS.js";import{_ as de,a as le,s as ee}from"./DIwkXMey.js";import{_ as ve,a as Yt,i as Zt,g as ea}from"./DYVPuHM_.js";import{a as fe}from"./CEfgnHem.js";import{c as ta}from"./ZnSD-95i.js";import{a as _e,_ as rt}from"./CnQv4oo3.js";import{u as ut}from"./Ba3yjCYF.js";import{_ as aa}from"./CRLgDY2X.js";import{_ as dt,m as ie}from"./CIRgc-9e.js";import{_ as Ce}from"./BVbz9zww.js";import{f as _t,m as na}from"./DzhOpHWC.js";import{_ as Ie}from"./DZd8ySUx.js";import{_ as mt,i as sa}from"./DsHWkLU8.js";import{_ as oa}from"./CT3UIwUl.js";import{s as N}from"./BwpGAOBT.js";import{_ as ia,a as la,b as ca,d as ra,e as ua,i as da,f as _a,g as ma,c as ae}from"./BQfcXNWw.js";import{e as fa}from"./BJRgOVf2.js";import{u as pa}from"./YOq-_6aY.js";import{u as ha}from"./BR5uHrNA.js";const va={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"},ka=s("path",{fill:"currentColor","fill-rule":"evenodd",d:"M28.5 43c8.56 0 15.5-3.134 15.5-7v6c0 3.866-6.94 7-15.5 7S13 45.866 13 42v-6c0 3.866 6.94 7 15.5 7","clip-rule":"evenodd"},null,-1),ya=s("path",{fill:"currentColor","fill-rule":"evenodd",d:"M34.5 36c8.56 0 15.5-3.134 15.5-7v6c0 3.866-6.94 7-15.5 7S19 38.866 19 35v-6c0 3.866 6.94 7 15.5 7","clip-rule":"evenodd"},null,-1),ga=s("path",{fill:"currentColor","fill-rule":"evenodd",d:"M44 19c0 3.866-6.94 7-15.5 7S13 22.866 13 19v6c0 3.866 6.94 7 15.5 7S44 28.866 44 25zm-1 0c0 1.296-1.21 2.8-3.951 4.038C36.4 24.234 32.672 25 28.5 25s-7.9-.766-10.549-1.962C15.211 21.801 14 20.296 14 19s1.21-2.8 3.951-4.038C20.6 13.766 24.328 13 28.5 13s7.9.766 10.549 1.962C41.789 16.199 43 17.704 43 19","clip-rule":"evenodd"},null,-1),ba=[ka,ya,ga];function wa(t,r){return d(),v("svg",va,[...ba])}const Ke={render(){return qe(Ee,{icon:{render:wa},name:"gold"})}},$a={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"},Aa=s("path",{stroke:"currentColor","stroke-width":"4",d:"m31 13.472 3.486 10.73.45 1.382H47.67l-9.127 6.63-1.176.855.45 1.382 3.486 10.73-9.127-6.632L31 37.695l-1.176.854-9.127 6.631 3.487-10.73.449-1.381-1.176-.854-9.127-6.631h12.735l.449-1.382z"},null,-1),Ra=[Aa];function Ta(t,r){return d(),v("svg",$a,[...Ra])}const Sa={render(){return qe(Ee,{icon:{render:Ta},name:"xp"})}},Ca={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"},Ia=s("path",{fill:"currentColor","fill-rule":"evenodd",d:"M49.306 27.104 44.133 9l9.483 11.574zm-14.426 25L56 23.654v13.793l-14.655 7.759h12.069l-7.759 5.172zm-21.552-25L18.5 9 9.017 20.574zm13.793 25L6 23.656v13.793l14.655 7.758H8.586l7.759 5.173zM21 20l10-4 10 4v16l-10 8-10-8zm6 12.5L29 22l5.5-1-2 7 4-.5-7 11 2-8z","clip-rule":"evenodd"},null,-1),Da=[Ia];function Pa(t,r){return d(),v("svg",Ca,[...Da])}const Oa={render(){return qe(Ee,{icon:{render:Pa},name:"prem"})}},Ba={class:"account-resources"},Ma={class:"account-resources__inner"},xa={key:0,class:"account-resources__item"},Ua={class:"account-resources__text"},Va={class:"account-resources__item"},La={class:"account-resources__text"},Ea={class:"account-resources__item"},qa={class:"account-resources__text"},Fa={class:"account-resources__item"},Na={class:"account-resources__text"},ja=j({__name:"AccountResources",props:{resources:{type:Object,required:!0,default:()=>({})}},setup(t){const r=t,l=E(()=>{const f=r.resources.premium_expires_at*1e3;return f-Date.now()<=0?"":V.date.toTimePassed(f,Date.now(),!0)});return(f,o)=>(d(),v("div",Ba,[s("div",Ma,[t.resources.is_premium.toLocaleString()?(d(),v("div",xa,[h(c(Oa),{filled:!0,"font-controlled":!1,class:Q(["account-resources__icon",[{"account-resources__icon--prem":c(l)}]])},null,8,["class"]),s("div",Ua,$(c(l)||"0 дн."),1)])):P("",!0),s("div",Va,[h(c(Ke),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--gold"}),s("div",La,$(t.resources.gold.toLocaleString()),1)]),s("div",Ea,[h(c(Ke),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--credits"}),s("div",qa,$(t.resources.credits.toLocaleString()),1)]),s("div",Fa,[h(c(Sa),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--xp"}),s("div",Na,$(t.resources.free_xp.toLocaleString()),1)])])]))}}),Ha={class:"account-preview-details__body"},Ga={class:"account-preview-details__section"},za={class:"account-preview-details__props-title"},Ka={class:"account-preview-details__props"},Wa={class:"account-preview-details__prop"},Xa=s("span",{class:"account-preview-details__prop-title"}," Дата создания ",-1),Ja={class:"account-preview-details__prop"},Qa=s("span",{class:"account-preview-details__prop-title"}," Дата обновления ",-1),Ya={key:0,class:"account-preview-details__section"},Za={class:"account-preview-details__props-title"},en={class:"account-preview-details__props"},tn={class:"account-preview-details__prop"},an=s("span",{class:"account-preview-details__prop-title"}," Зарегистрирован ",-1),nn={class:"account-preview-details__prop"},sn=s("span",{class:"account-preview-details__prop-title"}," Последний визит ",-1),on={class:"account-preview-details__section"},ln={class:"account-preview-details__props-title"},cn={key:0,class:"account-preview-details__props"},rn={class:"account-preview-details__prop"},un=s("span",{class:"account-preview-details__prop-title"}," Командир ",-1),dn={class:"account-preview-details__prop"},_n=s("span",{class:"account-preview-details__prop-title"}," Участников ",-1),mn={class:"account-preview-details__prop"},fn=s("span",{class:"account-preview-details__prop-title"}," Создан ",-1),pn={class:"account-preview-details__prop"},hn=s("span",{class:"account-preview-details__prop-title"}," Роль ",-1),vn={class:"account-preview-details__prop"},kn=s("span",{class:"account-preview-details__prop-title"}," Вступил ",-1),yn={key:1,class:"account-preview-details__props"},gn=s("div",{class:"account-preview-details__prop"}," Не состоит в клане ",-1),bn=[gn],wn={key:1,class:"account-preview-details__section"},$n={class:"account-preview-details__props-title"},An={class:"account-preview-details__props"},Rn={class:"account-preview-details__prop"},Tn=s("span",{class:"account-preview-details__prop-title"}," Отражаются только те дни в которые произошла смена клана или должности. Данные собираются со дня регистрации на сайте. ",-1),Sn={key:0,class:"account-preview-details__clan-history"},Cn={class:"account-preview-details__clan-history-date"},In={key:1,class:"account-preview-details__clan-history-link"},Dn={style:{display:"flex","justify-content":"space-between"}},Pn=s("span",null,null,-1),On=j({__name:"AccountPreviewDetails",props:{account:{type:[Object,null],required:!0},clanAccount:{type:[Object,null],required:!0}},setup(t,{expose:r}){const l=t,f=K(null),o=Z({user:null,clan:null,clanHistory:[],loading:0,isOpened:!1});async function p(a){o.loading++;try{const{data:i}=await le.clan.getInfo({clan_id:a});o.clan=i?i[a]:null}catch(i){H(i,{title:"Получение данных клана"})}o.loading--}async function b(a){o.loading++;try{const{data:i}=await fe.user.get(a);o.user=i}catch(i){if(fe.isResponse(i)&&i.status===404)return;H(i,{title:"Получение данных пользователя"})}finally{o.loading--}}async function y(a){o.loading++;try{const{data:i}=await le.clan.getInfo({clan_id:a.join(","),fields:"clan_id,name,tag"});return i??null}catch(i){return H(i,{title:"Получение данных кланов"}),null}finally{o.loading--}}function A(a,i){o.clanHistory=a.map((_,g,m)=>{const{raw:C,timestamp:k}=_,D=C&&i?i[C.clan_id]:null,M=`[${(D==null?void 0:D.tag)??"Deleted"}]`,x=m.length-1===g,B=a[g-1],U=V.date.toDaysPassed(k,B==null?void 0:B.timestamp);return{key:k,date:`${V.date.toDate(k)} (${x?" ... ":U})`,info:C?`${M} ${V.clan.role(C.role)}`:"Не в клане",clanId:(C==null?void 0:C.clan_id)??null}})}async function e(a){o.loading++;try{const{data:i}=await fe.stat.clansAccounts.getActivityList({id:a});return i??[]}catch(i){return H(i,{title:"Получение данных пользователя"}),[]}finally{o.loading--}}async function T(){var i;if(o.isOpened||!l.account||(o.isOpened=!0,(i=l.clanAccount)!=null&&i.clan_id&&await p(l.clanAccount.clan_id),await b(l.account.account_id),!o.user))return;const a=await e(l.account.account_id);if(a.length){const _=a.filter(({raw:m})=>m==null?void 0:m.clan_id).map(({raw:m})=>m==null?void 0:m.clan_id),g=await y(_);A(a,g)}}function S(){var a;(a=f.value)==null||a.doClose()}async function n(){var a;await T(),await((a=f.value)==null?void 0:a.doOpen())}return r({close:S,open:n}),(a,i)=>{const _=he,g=ct,m=de,C=oe,k=ve;return t.account?(d(),q(k,{key:0,ref_key:"detailedDialogRef",ref:f,class:"account-preview-details",title:"Дополнительная информация",width:"600px"},{footer:R(()=>[s("div",Dn,[Pn,h(C,{onClick:S},{default:R(()=>[I(" Закрыть ")]),_:1})])]),default:R(()=>{var D,M,x,B;return[s("div",Ha,[s("div",Ga,[s("h5",za,[h(_,{class:"account-preview-details__prop-title-icon",name:"sports-esports"}),I(" Аккаунт игрока ")]),s("div",Ka,[s("div",Wa,[Xa,I(" "+$(a.$formatter.date.toDate(t.account.created_at*1e3)),1)]),s("div",Ja,[Qa,I(" "+$(a.$formatter.date.toDate(t.account.updated_at*1e3)),1)])])]),c(o).user?(d(),v("div",Ya,[s("h5",Za,[h(_,{class:"account-preview-details__prop-title-icon",name:"person"}),I(" Пользователь ресурса ")]),s("div",en,[s("div",tn,[an,I(" "+$(a.$formatter.date.toDate(((D=c(o).user)==null?void 0:D.createAt)??0)),1)]),s("div",nn,[sn,I(" "+$(a.$formatter.date.toDate(((M=c(o).user)==null?void 0:M.visitedAt)??0)),1)])])])):P("",!0),s("div",on,[s("h5",ln,[h(_,{class:"account-preview-details__prop-title-icon",name:"groups"}),I(" Клан игрока ")]),c(o).clan&&t.clanAccount?(d(),v("div",cn,[s("div",rn,[un,c(o).clan.leader_id?(d(),q(g,{key:0,class:"account-preview-details__clan-history-link link",to:{name:"account-id",params:{id:c(o).clan.leader_id}}},{default:R(()=>{var U;return[I($((U=c(o).clan)==null?void 0:U.leader_name),1)]}),_:1},8,["to"])):P("",!0)]),s("div",dn,[_n,I(" "+$(a.$formatter.number.toInteger((x=c(o).clan)==null?void 0:x.members_count)),1)]),s("div",mn,[fn,I(" "+$(a.$formatter.date.toDate(((B=c(o).clan)==null?void 0:B.created_at)*1e3)),1)]),s("div",pn,[hn,I(" "+$(a.$formatter.clan.role(t.clanAccount.role)),1)]),s("div",vn,[kn,I(" "+$(a.$formatter.date.toDate(t.clanAccount.joined_at*1e3))+" ("+$(a.$formatter.date.toDaysPassed(t.clanAccount.joined_at*1e3))+") ",1)])])):(d(),v("div",yn,bn))]),c(o).user?(d(),v("div",wn,[s("h5",$n,[h(_,{class:"account-preview-details__prop-title-icon",name:"history"}),I(" Клановая история ")]),s("div",An,[s("div",Rn,[Tn,c(o).clanHistory.length?(d(),v("div",Sn,[(d(!0),v(z,null,Y(c(o).clanHistory,U=>(d(),v("div",{key:U.key,class:"account-preview-details__clan-history-item"},[s("span",Cn,$(U.date),1),U.clanId?(d(),q(g,{key:0,class:"account-preview-details__clan-history-link link",to:{name:"clan-id",params:{id:U.clanId}}},{default:R(()=>[I($(U.info),1)]),_:2},1032,["to"])):(d(),v("span",In,$(U.info),1))]))),128))])):(d(),v(z,{key:1},[I(" Данные собираются. ")],64))])])])):P("",!0)]),h(m,{"backdrop-light":"",loading:c(o).loading>0},null,8,["loading"])]}),_:1},512)):P("",!0)}}}),Bn={class:"account-preview"},Mn={key:0,class:"account-preview__inner"},xn={class:"account-preview__league"},Un={class:"account-preview__info"},Vn={class:"account-preview__nickname"},Ln={class:"account-preview__nickname-text"},En={class:"account-preview__clan-text"},qn={class:"account-preview__props"},Fn={class:"account-preview__prop"},Nn=s("span",{class:"account-preview__prop-title"}," Последний бой ",-1),jn={class:"account-preview__prop-value"},Hn={key:0,class:"account-preview__prop"},Gn=s("span",{class:"account-preview__prop-title"}," Должность ",-1),zn={class:"account-preview__prop-value"},Kn={class:"account-preview__actions"},Wn=j({__name:"AccountPreview",props:{account:{type:[Object,null],default:null,required:!0},loading:{type:Boolean,default:!1}},setup(t){const r=K(null),l=t,f=Qt(),o=Z({clanAccount:null,isFavorite:!0,clan:null,detailsLoading:!1}),p=E(()=>{var n;return(n=o.clanAccount)==null?void 0:n.clan});Se(()=>{var a,i;A(),((a=l.account)==null?void 0:a.account_id)&&b((i=l.account)==null?void 0:i.account_id)});async function b(n){try{const{data:a}=await le.clan.getAccountInfo({account_id:n,extra:"clan"});o.clanAccount=a?a[n]:null}catch(a){H(a,{title:"Получение данных клана"})}}async function y(){var n;o.detailsLoading=!0,await((n=r.value)==null?void 0:n.open()),o.detailsLoading=!1}async function A(){if(!l.account)return;const n=await ee.indexedDB.accountsFavorites.get(l.account.account_id);o.isFavorite=n?n==null?void 0:n.isFavorite:!1}async function e(){l.account&&(o.isFavorite=!o.isFavorite,await ee.indexedDB.accountsFavorites.set(l.account.account_id,{id:l.account.account_id,isFavorite:o.isFavorite}))}function T(){e()}async function S(){var a,i,_,g;await ta(`${(a=l.account)==null?void 0:a.nickname}/${(i=l.account)==null?void 0:i.account_id}`)?f.add({type:"success",title:"Скопировано",message:`${(_=l.account)==null?void 0:_.nickname}/${(g=l.account)==null?void 0:g.account_id}`,duration:3e3}):f.add({type:"error",message:"При копировании что-то пошло не так",duration:3e3})}return(n,a)=>{var D;const i=Jt,_=ct,g=he,m=oe,C=de,k=On;return d(),v("div",Bn,[t.account?(d(),v("div",Mn,[s("div",xn,[h(i,{large:"",rating:t.account.statistics.rating},null,8,["rating"])]),s("div",Un,[s("div",Vn,[s("span",Ln,$(t.account.nickname),1)]),c(o).clanAccount&&c(p)?(d(),q(_,{key:0,class:"account-preview__clan link",title:"Перейти к клану",to:{name:"clan-id",params:{id:c(p).clan_id}}},{default:R(()=>[s("span",En," ["+$(c(p).tag)+"] "+$(c(p).name),1)]),_:1},8,["to"])):P("",!0),s("div",qn,[s("div",Fn,[Nn,s("span",jn,$(n.$formatter.date.toRelativeTime(t.account.last_battle_time*1e3)),1)]),c(o).clanAccount?(d(),v("div",Hn,[Gn,s("span",zn,$(n.$formatter.clan.role((D=c(o).clanAccount)==null?void 0:D.role)),1)])):P("",!0)])]),s("div",Kn,[h(m,{"is-text":"",class:"account-preview__actions-btn",title:"Копировать (nickname/ID)",onClick:S},{default:R(()=>[h(g,{name:"content-copy"})]),_:1}),h(m,{"is-text":"",class:"account-preview__actions-btn",title:"Добавить в избранные",onClick:T},{default:R(()=>[c(o).isFavorite?(d(),q(g,{key:0,name:"star"})):(d(),q(g,{key:1,name:"star-border"}))]),_:1}),h(m,{"is-text":"",disabled:c(o).detailsLoading,class:"account-preview__actions-btn",title:"Дополнительная информация",onClick:y},{default:R(()=>[h(g,{name:"info"})]),_:1},8,["disabled"])])])):P("",!0),h(C,{loading:t.loading},null,8,["loading"]),h(k,{ref_key:"accountPreviewDetailsRef",ref:r,account:t.account,"clan-account":c(o).clanAccount},null,8,["account","clan-account"])])}}}),Xn=window.setInterval,Jn={class:"session-panel"},Qn={class:"session-panel__inner"},Yn={class:"session-panel__item"},Zn={class:"session-panel__buttons"},es={key:0,class:"session-panel__item session-panel__item--time"},ts={class:"session-panel__time"},as=s("span",{class:"session-panel__time-title"}," Время начала ",-1),ns=s("div",{style:{margin:"0 0 1em"}}," Вы уверены, что хотите сбросить сессию? ",-1),ss={style:{"text-align":"right"}},We=60,os=j({__name:"SessionPanel",props:Re({updateAt:{type:Number,required:!0,default:0},hideAutoUpdate:{type:[Boolean],default:!1},loading:{type:Boolean,required:!0,default:!1}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:Re(["reset","update","session-active"],["update:modelValue"]),setup(t,{emit:r}){const l=pe(t,"modelValue"),f=t,o=ut(),p=K(null),b=Z({autoUpdateChecked:!1,autoUpdateInterval:We,autoUpdateCounter:We,autoUpdateTimer:0}),y=E(()=>{const n=V.date.toDateTime(f.updateAt),a=V.date.toDaysPassed(f.updateAt,Date.now(),!0);return`${n} (${a})`});it(()=>{clearInterval(b.autoUpdateTimer)});const A=r;function e(){var n;(n=p.value)==null||n.doOpen()}function T(n){var a;n&&A("reset"),(a=p.value)==null||a.doClose()}function S(){if(b.autoUpdateChecked=!b.autoUpdateChecked,b.autoUpdateCounter=b.autoUpdateInterval,!b.autoUpdateChecked){clearInterval(b.autoUpdateTimer);return}const n=()=>{if(clearInterval(b.autoUpdateTimer),b.autoUpdateTimer=Xn(n,1e3),b.autoUpdateCounter>0){b.autoUpdateCounter--;return}b.autoUpdateCounter=b.autoUpdateInterval,A("update")};A("update"),n()}return(n,a)=>{const i=_e,_=he,g=oe,m=de,C=ve;return d(),v("div",Jn,[s("div",Qn,[s("div",Yn,[s("div",Zn,[h(i,{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=k=>l.value=k),class:"session-panel__btn",title:"Просмотр статистики за сессию"},{default:R(()=>[I(" Сессия ")]),_:1},8,["modelValue"]),t.hideAutoUpdate===!1?(d(),q(g,{key:0,class:"session-panel__btn",title:"Автоматическое обновление данных",onClick:S},{before:R(()=>[h(_,{name:"refresh-auto"})]),default:R(()=>[c(o).isTablet?P("",!0):(d(),v(z,{key:0},[I(" Обновление ")],64)),I(" "+$(c(b).autoUpdateCounter)+" сек. ",1)]),_:1})):P("",!0),h(g,{class:"session-panel__btn",title:"Сброс данных сессии",onClick:e},{default:R(()=>[h(_,{name:"close"})]),_:1})])]),c(y)?(d(),v("div",es,[s("span",ts,[as,I(" "+$(c(y)),1)])])):P("",!0)]),h(m,{loading:t.loading},null,8,["loading"]),h(C,{ref_key:"confirmDialogRef",ref:p,title:"Сброс сессии"},{default:R(()=>[ns,s("div",ss,[h(g,{align:"center",width:"80px",onClick:a[1]||(a[1]=k=>T(!0))},{default:R(()=>[I(" Да ")]),_:1}),h(g,{align:"center",width:"80px",onClick:a[2]||(a[2]=k=>T(!1))},{default:R(()=>[I(" Нет ")]),_:1})])]),_:1},512)])}}}),is={class:"accounts-metrics"},ls={class:"accounts-metrics__filters"},cs={class:"accounts-metrics__filters-item"},rs={class:"accounts-metrics__filters-item"},us={class:"accounts-metrics__plates"},ds=j({__name:"AccountsMetrics",props:{metrics:{type:Array,required:!0,default:()=>[]},filters:{type:Object,required:!0,default:()=>({})},loading:{type:Boolean,default:!1}},emits:["filters","is-open"],setup(t,{emit:r}){const l=["battles","winRate","damagePerBattle","winsInPlatoon","battlesPerDay","tanksWithMaster"],f=t,o=Z({isOpen:!1}),p=E(()=>o.isOpen?f.metrics:f.metrics.filter(A=>l.includes(A.key))),b=r;function y(){const A=f.filters.battleMode==="random"?"rating":"random";b("filters",{...f.filters,battleMode:A})}return(A,e)=>{const T=_e,S=dt;return d(),v("div",is,[s("div",ls,[s("div",cs,[h(T,{"model-value":t.filters.battleMode==="rating",onChange:y},{default:R(()=>[I(" Рейтинг ")]),_:1},8,["model-value"])]),s("div",rs,[h(T,{modelValue:c(o).isOpen,"onUpdate:modelValue":e[0]||(e[0]=n=>c(o).isOpen=n)},{default:R(()=>[I(" Все показатели ")]),_:1},8,["modelValue"])])]),s("div",us,[h(S,{loading:t.loading,items:c(p)},null,8,["loading","items"])])])}}}),_s=["onClick"],ms={class:"achievements-list__item-inner"},fs={class:"achievements-list__item-img-wrapper"},ps={key:0,class:"achievements-list__item-count"},hs={key:0,class:"achievements-list__item-series"},vs={key:1,class:"achievements-list__item-details"},ks=j({__name:"AchievementsList",props:{achievements:{type:Array,default:()=>[]},hideName:{type:[Boolean,String],default:!1}},emits:["medal-click"],setup(t,{emit:r}){const l=r;function f(o){l("medal-click",o)}return(o,p)=>{const b=Ce;return d(),v("div",{class:Q(["achievements-list",[t.hideName?"achievements-list--small":""]])},[t.achievements.length?(d(),q(lt,{key:0,tag:"ul",class:"achievements-list__list",name:"achievements-list__item-"},{default:R(()=>[(d(!0),v(z,null,Y(t.achievements,y=>(d(),v("li",{key:y.key,class:Q(["achievements-list__item",[!y.count&&!y.series?"achievements-list__item--no-count":""]])},[s("button",{class:"achievements-list__item-btn",onClick:A=>f(y)},[s("span",ms,[s("span",fs,[h(b,{class:"achievements-list__item-img",src:y.image,alt:y.key,"data-name":y.name},null,8,["src","alt","data-name"])]),y.count||y.series?(d(),v("span",ps,[I($(y.count)+" ",1),y.series?(d(),v("span",hs," / "+$(y.series),1)):P("",!0)])):P("",!0),t.hideName?P("",!0):(d(),v("span",vs,$(y.name),1))])],8,_s)],2))),128))]),_:1})):P("",!0)],2)}}}),ys={key:0,class:"achievements-block__details"},gs={class:"achievements-block__details-header"},bs={class:"achievements-block__details-name"},ws={class:"achievements-block__details-body"},$s=["textContent"],As=["textContent"],Rs={class:"achievements-block__details-footer"},Ts=j({__name:"AchievementsDetails",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(t,{expose:r}){const l=pe(t,"modelValue"),f=K(null),o=K(!1);function p(){o.value=!1}function b(){var y;(y=f.value)==null||y.doOpen()}return r({open:b}),(y,A)=>{const e=Ce,T=oe,S=ve;return d(),q(S,{ref_key:"detailsRef",ref:f,width:"640px",onOpen:p},{footer:R(()=>[s("div",Rs,[h(T,{onClick:A[0]||(A[0]=n=>{var a;return(a=c(f))==null?void 0:a.doClose()})},{default:R(()=>[I(" Закрыть ")]),_:1})])]),default:R(()=>{var n;return[l.value?(d(),v("div",ys,[s("div",gs,[h(e,{class:"achievements-block__details-img",src:l.value.image,alt:l.value.key},null,8,["src","alt"]),s("span",bs,$((n=l.value)==null?void 0:n.name),1),s("div",ws,[l.value.description?(d(),v("div",{key:0,textContent:$(l.value.description)},null,8,$s)):P("",!0),l.value.condition?(d(),v("div",{key:1,textContent:$(l.value.condition)},null,8,As)):P("",!0)])])])):P("",!0)]}),_:1},512)}}}),Ss={key:0,class:"achievements-block__inner"},Cs={class:"achievements-block__filter"},Is={class:"achievements-block__filter-item"},Ds={class:"achievements-block__filter-item"},Ps={class:"achievements-block__filter-item"},Os={class:"achievements-block__section-title"},Bs={key:1,class:"achievements-block__empty"},Ms={key:1,class:"achievements-block__empty"},ft=j({__name:"AchievementsBlock",props:{achievements:{type:Object,required:!0,default:()=>({})},achievementsInfo:{type:Object,required:!0,default:()=>({})},filters:{type:Object,required:!0,default:()=>_t.makeAccountFilters()}},emits:["filters-changed"],setup(t,{emit:r}){const l=["markOfMastery","markOfMasteryI","markOfMasteryII","markOfMasteryIII","heroesOfRassenay","medalLafayettePool","medalRadleyWalters","warrior","medalKolobanov","mainGun","sniper","camper","medalBrothersInArms","medalCrucialContribution"],f=["battle","epic","title","commemorative","step","platoon"],o=t,p=K(),b=K(),y=Z({currentMedal:null,showAll:!1}),A=E(()=>{const i=Object.keys(o.achievements.achievements),_=Object.keys(o.achievements.achievements);return i.length||_.length}),e=E(()=>{if(o.filters.achievementsShow==="important"){const _=[];return Object.keys(o.achievements.achievements).forEach(g=>{const m=ce.achievementsMedal({key:g,achievements:o.achievements,encyclopedia:o.achievementsInfo});_.push(m)}),l.reduce((g,m)=>{const C=_.find(k=>k.key===m);return C?[...g,C]:g},[])}const i=Object.keys(o.achievementsInfo);return o.filters.achievementsShow==="deserved"?i.map(_=>ce.achievementsMedal({key:_,achievements:o.achievements,encyclopedia:o.achievementsInfo})).filter(_=>o.achievements.achievements[_.key]||o.achievements.max_series[_.key]).sort((_,g)=>_.key.localeCompare(g.key)):i.map(_=>ce.achievementsMedal({key:_,achievements:o.achievements,encyclopedia:o.achievementsInfo})).toSorted((_,g)=>_.key.localeCompare(g.key))}),T=E(()=>{const i={};return e.value.forEach(_=>{i[_.section]||(i[_.section]={name:_.section,items:[]}),i[_.section].items.push(_)}),Object.values(i).sort((_,g)=>f.indexOf(_.name)-f.indexOf(g.name))}),S=r;function n({key:i}){var _;y.currentMedal=e.value.find(g=>g.key===i)??null,(_=b.value)==null||_.open()}function a(i){S("filters-changed",{...o.filters,achievementsShow:i})}return(i,_)=>{const g=_e,m=ks,C=Ts;return d(),v("div",{ref_key:"mainRef",ref:p,class:"achievements-block"},[c(A)?(d(),v("div",Ss,[s("div",Cs,[s("div",Is,[h(g,{"model-value":t.filters.achievementsShow==="important",onChange:_[0]||(_[0]=k=>a("important"))},{default:R(()=>[I(" Значимые ")]),_:1},8,["model-value"])]),s("div",Ds,[h(g,{"model-value":t.filters.achievementsShow==="deserved",onChange:_[1]||(_[1]=k=>a("deserved"))},{default:R(()=>[I(" Заслуженные ")]),_:1},8,["model-value"])]),s("div",Ps,[h(g,{"model-value":t.filters.achievementsShow===null,onChange:_[2]||(_[2]=k=>a(null))},{default:R(()=>[I(" Все ")]),_:1},8,["model-value"])])]),c(e).length?(d(),v(z,{key:0},[t.filters.achievementsShow==="important"?(d(),q(m,{key:0,achievements:c(e),"hide-name":!0,onMedalClick:n},null,8,["achievements"])):(d(!0),v(z,{key:1},Y(c(T),k=>(d(),v("div",{key:k.name,class:"achievements-block__section"},[s("div",Os,$(i.$formatter.achievements.section(k.name)),1),h(m,{achievements:k.items,"hide-count":c(y).showAll,onMedalClick:n},null,8,["achievements","hide-count"])]))),128))],64)):(d(),v("div",Bs," Нет значимых достижений ")),h(C,{ref_key:"detailsRef",ref:b,modelValue:c(y).currentMedal,"onUpdate:modelValue":_[3]||(_[3]=k=>c(y).currentMedal=k)},null,8,["modelValue"])])):(d(),v("div",Ms," Нет достижений "))],512)}}}),ke=j({__name:"TankType",props:Re({size:{type:Number,default:24},isPremium:{type:Boolean,default:!1},isCollectible:{type:[Boolean,String],default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const r={lightTank:ne(()=>se(()=>import("./CLUhr88i.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),mediumTank:ne(()=>se(()=>import("./CM4rjZrb.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url)),heavyTank:ne(()=>se(()=>import("./Dyp_Wyvs.js"),__vite__mapDeps([6,1,2,3,4]),import.meta.url)),"AT-SPG":ne(()=>se(()=>import("./CfZSxFC9.js"),__vite__mapDeps([7,1,2,3,4]),import.meta.url))},l=pe(t,"modelValue"),f=E(()=>["AT-SPG","heavyTank","lightTank","mediumTank"].includes(l.value)?l.value:(console.warn("Not valid tank type - ",l.value),"span"));return(o,p)=>(d(),q(Fe(r[c(f)]),{filled:!0,"font-controlled":!1,class:Q(["tank-type",[t.isPremium?"tank-type--is-premium":"",t.isCollectible?"tank-type--is-collectible":""]]),width:t.size,height:t.size},null,8,["class","width","height"]))}}),xs=["src","alt"],pt=j({__name:"TankNation",props:Re({size:{type:[Number,String],default:24}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const r=pe(t,"modelValue");return(l,f)=>(d(),v("img",{style:Ne({width:`${t.size}px`,height:`${t.size}px`}),src:`/img/nations/nation-${r.value}.svg`,alt:r.value,class:"tank-nation"},null,12,xs))}}),Us={class:"account-infographics"},Vs={class:"account-infographics__filters"},Ls={class:"account-infographics__filters-chips"},Es={class:"account-infographics__chart-list"},qs={class:"account-infographics__chart-label"},Fs={class:"account-infographics__line-icon"},Ns={key:2},js={key:"battles",class:"account-infographics__line-value"},Hs={key:"damagePerBattle",class:"account-infographics__line-value"},Gs=j({__name:"AccountInfographics",props:{tanks:{type:Array,default:()=>[],required:!0}},setup(t){const r=t,l=K("battles"),f=[{value:"battles",label:V.stat.accountProp("battles")},{value:"winRate",label:V.stat.accountProp("winRate")},{value:"damagePerBattle",label:V.stat.accountProp("damagePerBattle")}],o=E(()=>[{label:"По нации",key:"nation",value:p("nation")},{label:"По уровню",key:"tier",value:p("tier")},{label:"По типу",key:"type",value:p("type")}]);function p(y){var e;const A={};if(!((e=r.tanks)!=null&&e.length))return A;r.tanks.forEach(T=>{const S=T[y];T.tier&&(S in A||(A[S]={key:S,battles:0,winRate:0,damagePerBattle:0,lineHeight:0}),A[S].battles+=T.all.battles,A[S].winRate+=T.all.wins,A[S].damagePerBattle+=T.all.damage_dealt)});for(const T in A){const S=A[T].battles;A[T].winRate=S?A[T].winRate/(S/100):0,A[T].damagePerBattle=S?A[T].damagePerBattle/S:0}for(const T in A){const n=Math.min(...Object.values(A).map(i=>i[l.value])),a=Math.max(...Object.values(A).map(i=>i[l.value]))-n/1.1;A[T].lineHeight=(A[T][l.value]-n/1.1)/(a/100)}return A}function b(y){l.value=y}return(y,A)=>{const e=_e,T=ke,S=pt,n=Ie;return d(),v("div",Us,[s("div",Vs,[s("div",Ls,[(d(),v(z,null,Y(f,a=>h(e,{key:a.value,"model-value":a.value===c(l),onChange:i=>b(a.value)},{default:R(()=>[I($(a.label),1)]),_:2},1032,["model-value","onChange"])),64))])]),s("div",Es,[(d(!0),v(z,null,Y(c(o),a=>(d(),v("div",{key:a.key,class:Q(["account-infographics__chart",[`account-infographics__chart--${a.key}`]])},[s("span",qs,$(a.label),1),(d(!0),v(z,null,Y(a.value,i=>(d(),v("div",{key:i.key,class:"account-infographics__line"},[s("span",Fs,[a.key==="type"?(d(),q(T,{key:0,modelValue:i.key,"onUpdate:modelValue":_=>i.key=_},null,8,["modelValue","onUpdate:modelValue"])):a.key==="nation"?(d(),q(S,{key:1,modelValue:i.key,"onUpdate:modelValue":_=>i.key=_,size:"22"},null,8,["modelValue","onUpdate:modelValue"])):a.key==="tier"?(d(),v("span",Ns,$(y.$formatter.encyclopedia.tier(i.key)),1)):(d(),v(z,{key:3},[I($(i.key),1)],64))]),h(lt,{tag:"span",name:"account-infographics__line-value-",class:"account-infographics__line-progress",style:Ne({"--chart-line-width":i.lineHeight/100})},{default:R(()=>[c(l)==="battles"?(d(),v("span",js,$(y.$formatter.number.toInteger(i.battles)),1)):P("",!0),c(l)==="winRate"?(d(),q(n,{key:"winRate",modelValue:i.winRate,"onUpdate:modelValue":_=>i.winRate=_,class:"account-infographics__line-value"},null,8,["modelValue","onUpdate:modelValue"])):P("",!0),c(l)==="damagePerBattle"?(d(),v("span",Hs,$(y.$formatter.number.toInteger(i.damagePerBattle)),1)):P("",!0)]),_:2},1032,["style"])]))),128))],2))),128))])])}}}),ht=j({__name:"MarkOfMastery",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(t){const r={1:ne(()=>se(()=>import("./DIy2ncyx.js"),__vite__mapDeps([8,1,2,3,4]),import.meta.url)),2:ne(()=>se(()=>import("./Cl8lwJPt.js"),__vite__mapDeps([9,1,2,3,4]),import.meta.url)),3:ne(()=>se(()=>import("./D17qV2Vf.js"),__vite__mapDeps([10,1,2,3,4]),import.meta.url)),4:ne(()=>se(()=>import("./CpeqrCAT.js"),__vite__mapDeps([11,1,2,3,4]),import.meta.url))},l=pe(t,"modelValue");return(f,o)=>(d(),q(Fe(l.value?r[l.value]:"span"),{filled:!0,"font-controlled":!1,class:Q(["mark-of-mastery",[l.value?"mark-of-mastery--"+l.value:""]])},null,8,["class"]))}}),zs={class:"account-tanks-table-desktop"},Ks={class:"account-tanks-table-desktop__table"},Ws=["title"],Xs={class:"account-tanks-table-desktop__name-text"},Js={key:0,class:"account-tanks-table-desktop__diff"},Qs={key:0,class:"account-tanks-table-desktop__diff"},Ys={key:0,class:"account-tanks-table-desktop__diff"},Zs={key:0,class:"account-tanks-table-desktop__diff"},eo={key:0,class:"account-tanks-table-desktop__diff"},to={key:0,class:"account-tanks-table-desktop__diff"},ao={key:0,class:"account-tanks-table-desktop__diff"},no={key:0,class:"account-tanks-table-desktop__diff"},so={class:"account-tanks-table-desktop__mark"},oo={key:0,class:"account-tanks-table-desktop__diff"},io={class:"account-tanks-table-desktop__diff"},lo=j({__name:"AccountTanksTableDesktop",props:{items:{type:Array,default:()=>[],required:!0},headers:{type:Array,default:()=>[],required:!0},summary:{type:Object,default:()=>({}),required:!0},height:{type:String,default:void 0},maxHeight:{type:String,default:void 0},sort:{type:Object,default:null},defaultSort:{type:Object,default:null},showDiff:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["row-click"],setup(t,{expose:r,emit:l}){const f=K(null),o=l;return r({sortItems(){var p;(p=f.value)==null||p.sortItems()}}),(p,b)=>{const y=ke,A=oe,e=Ie,T=ht,S=mt,n=de;return d(),v("div",zs,[s("div",Ks,[h(S,{ref_key:"tableRef",ref:f,headers:t.headers,data:t.items,summary:t.summary,"default-sort":t.defaultSort,"scroll-auto-disabling":"","no-wrap":"","row-key":"tank_id",height:t.height,"max-height":t.maxHeight},{"position-summary":R(()=>[I($(t.items.length||0),1)]),position:R(({index:a})=>[I($(a+1),1)]),type:R(({row:a})=>[s("div",{class:"account-tanks-table-desktop__type",title:a.is_premium?"Премиум танк":""},[h(y,{modelValue:a.type,"onUpdate:modelValue":i=>a.type=i,"is-premium":a.is_premium,"is-collectible":a.is_collectible},null,8,["modelValue","onUpdate:modelValue","is-premium","is-collectible"])],8,Ws)]),name:R(({row:a})=>[h(A,{class:"account-tanks-table-desktop__name","is-text":"",onClick:i=>o("row-click",a.tank_id)},{default:R(()=>[s("span",Xs,$(a.name??`Tank ID: ${a.tank_id}`),1)]),_:2},1032,["onClick"])]),battles:R(({row:a})=>{var i;return[I($(a.all.battles)+" ",1),t.showDiff?(d(),v("div",Js,$(p.$formatter.number.toInteger((i=a.diff)==null?void 0:i.battles,!0)),1)):P("",!0)]}),winRate:R(({row:a})=>{var i;return[h(e,{"model-value":a.all.winRate,class:"account-tanks-table-desktop__win-rate"},null,8,["model-value"]),t.showDiff?(d(),v("div",Qs,$(p.$formatter.number.toFloatPercent((i=a.diff)==null?void 0:i.winRate,!0)),1)):P("",!0)]}),damagePerBattle:R(({row:a})=>{var i;return[I($(a.all.damagePerBattle)+" ",1),t.showDiff?(d(),v("div",Ys,$(p.$formatter.number.toInteger((i=a.diff)==null?void 0:i.damagePerBattle,!0)),1)):P("",!0)]}),xpPerBattle:R(({row:a})=>{var i;return[I($(a.all.xpPerBattle)+" ",1),t.showDiff?(d(),v("div",Zs,$(p.$formatter.number.toInteger((i=a.diff)==null?void 0:i.xpPerBattle,!0)),1)):P("",!0)]}),fragPerBattle:R(({row:a})=>{var i;return[I($(a.all.fragPerBattle)+" ",1),t.showDiff?(d(),v("div",eo,$(p.$formatter.number.toInteger((i=a.diff)==null?void 0:i.fragPerBattle,!0)),1)):P("",!0)]}),hitRate:R(({row:a})=>{var i;return[I($(p.$formatter.number.toFloatPercent(a.all.hitRate))+" ",1),t.showDiff?(d(),v("div",to,$(p.$formatter.number.toFloatNumber((i=a.diff)==null?void 0:i.hitRate,!0)),1)):P("",!0)]}),surviveRate:R(({row:a})=>{var i;return[I($(p.$formatter.number.toFloatPercent(a.all.surviveRate))+" ",1),t.showDiff?(d(),v("div",ao,$(p.$formatter.number.toFloatNumber((i=a.diff)==null?void 0:i.surviveRate,!0)),1)):P("",!0)]}),spottedPerBattle:R(({row:a})=>{var i;return[I($(a.all.spottedPerBattle)+" ",1),t.showDiff?(d(),v("div",no,$(p.$formatter.number.toInteger((i=a.diff)==null?void 0:i.spottedPerBattle,!0)),1)):P("",!0)]}),mark_of_mastery:R(({row:a})=>[s("div",so,[a.markOfMastery.value&&a.markOfMastery.count?(d(),q(T,{key:0,"model-value":a.markOfMastery.value,title:"Знак классности",width:"20",height:"20"},null,8,["model-value"])):P("",!0),I(" "+$(a.markOfMastery.count||"---"),1)]),t.showDiff?(d(),v("div",oo,$(a.markOfMastery.diff),1)):P("",!0)]),last_battle_time:R(({row:a})=>[I($(p.$formatter.date.toRelativeTime(a.last_battle_time*1e3)||"---")+" ",1),s("div",io,$(p.$formatter.date.toDateTime(a.last_battle_time*1e3)||"---"),1)]),_:1},8,["headers","data","summary","default-sort","height","max-height"]),h(n,{loading:t.loading},null,8,["loading"])])])}}}),co={key:0,class:"ui-table-mobile__header"},ro={class:"ui-table-mobile__head"},uo={class:"ui-table-mobile__sort"},_o=["title","onClick"],mo={key:0,class:"ui-table-mobile__sort-icons"},fo={key:0,class:"ui-table-mobile__summary"},po={key:1,class:"ui-table-mobile__no-data"},ho={key:2,class:"ui-table-mobile__footer"},vo=j({__name:"UiTableMobile",props:{data:{type:Array,required:!0,default:()=>[]},headers:{type:Array,required:!0,default:()=>[]},summary:{type:Object,default:void 0},defaultSort:{type:Object,default:void 0},scrollAutoDisabling:Boolean,scrollToTop:Boolean,height:{type:String,default:void 0},rowKey:{type:String,default:void 0},maxHeight:{type:String,default:void 0},minHeight:{type:String,default:void 0}},emits:["sort","row-click"],setup(t,{expose:r,emit:l}){var m,C;const f=t,o=K(),p=K([]),b=Z({order:((m=f.defaultSort)==null?void 0:m.order)??"",prop:((C=f.defaultSort)==null?void 0:C.prop)??""});Kt(()=>{var k;p.value=f.data,T(),Me(f.scrollToTop)&&((k=o.value)==null||k.scrollTo({top:0}))});let y=null;function A(){o.value&&(y=sa({target:[o.value],threshold:1,callback(k){const D=k.target;k.isIntersecting?ze(!1,D):(ze(!0,D),D.scrollTo({top:0}))}}))}Se(()=>{Me(f.scrollAutoDisabling)&&A()}),it(()=>{Me(f.scrollAutoDisabling)&&(y==null||y.disconnect())});const e=(k="default")=>!!Wt()[k];function T(){var x;let k=b.order,D=b.prop;k===""&&f.defaultSort&&(k=f.defaultSort.order,D=f.defaultSort.prop);const M=(x=f.headers)==null?void 0:x.find(B=>B.key===D);M&&(typeof M.sortMethod=="function"?p.value.sort((B,U)=>{var X,J;return k==="desc"?((X=M.sortMethod)==null?void 0:X.call(M,U,B))||0:((J=M.sortMethod)==null?void 0:J.call(M,B,U))||0}):M.sortable===!0&&p.value.sort((B,U)=>{const X=(k==="desc"?U:B)[D],J=(k==="desc"?B:U)[D];return String(X).localeCompare(String(J),void 0,{numeric:!0,sensitivity:"base"})}))}const S=l;function n(k){let D=k.key,M=b.order;b.prop!==D&&(M=""),M?M==="asc"?M="desc":(M="",D=""):M="asc",b.order=M,b.prop=D}function a(k){var D;k.sortable&&((D=o.value)==null||D.scrollTo({top:0}),n(k),T(),S("sort",{...b,column:k}))}function i(k,D){return typeof k.formatter=="function"?k.formatter(D):D}function _(k,D){return b.order===k&&b.prop===D}function g(k){return typeof f.summary!="object"||!Object.keys(f.summary).includes(k.key)?"":typeof k.formatter=="function"?k.formatter(f.summary[k.key]):f.summary[k.key]}return r({sortItems:T}),(k,D)=>{const M=he;return d(),v("div",{class:"ui-table-mobile",style:Ne({height:t.height,maxHeight:t.maxHeight,minHeight:t.minHeight})},[e("header")?(d(),v("div",co,[ue(k.$slots,"header")])):P("",!0),s("ul",ro,[(d(!0),v(z,null,Y(t.headers,x=>(d(),v("li",{key:x.key,class:"ui-table-mobile__head-item"},[s("div",uo,[s("button",{title:x.tooltip,class:Q(["ui-table-mobile__sort-btn",[x.sortable?"ui-table-mobile__sort-btn--has-sort":""]]),onClick:B=>a(x)},[ue(k.$slots,`${x.key}-header`,{},()=>[I($(x.label),1)])],10,_o),x.sortable?(d(),v("span",mo,[h(M,{size:"16",name:"arrow-up",class:Q(["ui-table-mobile__sort-icon",[_("asc",x.key)?"is-active":""]])},null,8,["class"]),h(M,{size:"16",name:"arrow-down",class:Q(["ui-table-mobile__sort-icon",[_("desc",x.key)?"is-active":""]])},null,8,["class"])])):P("",!0)]),t.summary?(d(),v("div",fo,[ue(k.$slots,`${x.key}-summary`,{},()=>[I($(g(x)),1)])])):P("",!0)]))),128))]),s("ul",{ref_key:"tableListRef",ref:o,class:"ui-table-mobile__list"},[(d(!0),v(z,null,Y(c(p),(x,B)=>(d(),v("li",{key:String(t.rowKey?x[t.rowKey]:B),class:"ui-table-mobile__row"},[e("default")?ue(k.$slots,"default",{key:0,row:x,index:B}):(d(!0),v(z,{key:1},Y(t.headers,U=>(d(),v("td",{key:U.key,class:"ui-table-mobile__cell"},[x?ue(k.$slots,`${U.key}`,{key:0,row:x,data:x[U.key],index:B},()=>[I($(i(U,x[U.key])),1)]):P("",!0)]))),128))]))),128))],512),Array.isArray(t.data)&&t.data.length?P("",!0):(d(),v("div",po," Нет данных ")),e("footer")?(d(),v("div",ho,[ue(k.$slots,"footer")])):P("",!0)],4)}}}),ko={class:"tank-tier"},yo=j({__name:"TankTier",props:{tier:{type:Number,required:!0}},setup(t){return(r,l)=>(d(),v("div",ko,$(r.$formatter.encyclopedia.tier(t.tier)),1))}}),go={class:"account-tanks-table-mobile"},bo=["onClick"],wo={class:"account-tank-preview__img-wrapper"},$o={class:"account-tank-preview__description"},Ao={class:"account-tank-preview__description-row"},Ro={class:"account-tank-preview__name"},To={class:"account-tank-preview__name-text"},So={class:"account-tank-preview__description-row"},Co={class:"account-tank-preview__props"},Io={class:"account-tank-preview__prop"},Do={key:0,class:"account-tank-preview__prop-sub"},Po={class:"account-tank-preview__prop"},Oo={key:0,class:"account-tank-preview__prop-sub"},Bo={class:"account-tank-preview__prop"},Mo={key:0,class:"account-tank-preview__prop-sub"},xo=j({__name:"AccountTanksTableMobile",props:{items:{type:Array,default:()=>[],required:!0},headers:{type:Array,default:()=>[],required:!0},defaultSort:{type:Object,default:null},height:{type:String,default:void 0},maxHeight:{type:String,default:void 0}},emits:["row-click"],setup(t,{expose:r,emit:l}){const f=K(null),o=l;return r({sortItems(){var p;(p=f.value)==null||p.sortItems()}}),(p,b)=>{const y=Ce,A=ht,e=ke,T=Ie,S=vo;return d(),v("div",go,[h(S,{ref_key:"tableRef",ref:f,data:t.items,headers:t.headers,"row-key":"tank_id",height:t.height,"default-sort":t.defaultSort,"max-height":t.maxHeight,"scroll-auto-disabling":""},{default:R(({row:n})=>[s("div",{class:"account-tank-preview",onClick:a=>o("row-click",n.tank_id)},[s("div",wo,[h(y,{class:"account-tank-preview__nation-img",src:`/img/nations/nation-${n.nation}.svg`,alt:n.nation},null,8,["src","alt"]),h(y,{class:"account-tank-preview__tank-img",src:n.images.preview,alt:n.name},null,8,["src","alt"]),h(yo,{class:"account-tank-preview__tier",tier:n.tier},null,8,["tier"]),n.markOfMastery.value&&n.markOfMastery.count?(d(),q(A,{key:0,class:"account-tank-preview__master","model-value":n.markOfMastery.value,title:"Знак классности"},null,8,["model-value"])):P("",!0)]),s("div",$o,[s("div",Ao,[s("div",Ro,[h(e,{modelValue:n.type,"onUpdate:modelValue":a=>n.type=a,class:"account-tank-preview__type","is-premium":n.is_premium,"is-collectible":n.is_collectible},null,8,["modelValue","onUpdate:modelValue","is-premium","is-collectible"]),s("span",To,$(n.name??`Tank ID: ${n.tank_id}`),1)])]),s("div",So,[s("div",Co,[s("span",Io,[I($(p.$formatter.number.toInteger(n.all.battles))+" ",1),n.diff?(d(),v("span",Do,$(p.$formatter.number.toInteger(n.diff.battles,!0)),1)):P("",!0)]),s("span",Po,[h(T,{"model-value":n.all.winRate},null,8,["model-value"]),n.diff?(d(),v("span",Oo,$(p.$formatter.number.toFloatPercent(n.diff.winRate,!0)),1)):P("",!0)]),s("span",Bo,[I($(p.$formatter.number.toInteger(n.all.damagePerBattle))+" ",1),n.diff?(d(),v("span",Mo,$(p.$formatter.number.toInteger(n.diff.damagePerBattle,!0)),1)):P("",!0)])])])])],8,bo)]),_:1},8,["data","headers","height","default-sort","max-height"])])}}}),vt=j({__name:"AccountTanksTable",props:{tanks:{type:Array,default:()=>[],required:!0},tanksDiff:{type:[Array,null],default:null,required:!0},noCount:{type:[Boolean,String],default:!1},height:{type:String,default:void 0},maxHeight:{type:String,default:void 0},sort:{type:Object,default:null},defaultSort:{type:Object,default:null},showDiff:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["row-click"],setup(t,{expose:r,emit:l}){const f=E(()=>b.isTablet?xo:lo),o=t,p=K(null),b=ut(),y=l,A=E(()=>[{key:"position",label:"№",width:60},{key:"type",label:"Тип",width:60,sortable:!0},{key:"name",label:"Название",sortable:!0},{key:"tier",label:"I-X",sortable:!0},{key:"battles",label:"Бои",sortable:!0,sortMethod(n,a){return n.all.battles-a.all.battles},formatter:n=>V.number.toInteger(n)},{key:"winRate",label:"Победы",sortable:!0,sortMethod(n,a){const i=n,_=a;return i.all.winRate-_.all.winRate},formatter:n=>V.number.toFloatPercent(n)},{key:"damagePerBattle",label:"Урон",sortable:!0,sortMethod(n,a){return n.all.damagePerBattle-a.all.damagePerBattle},formatter:n=>V.number.toInteger(n)},{key:"xpPerBattle",label:"Опыт",sortable:!0,sortMethod(n,a){return n.all.xpPerBattle-a.all.xpPerBattle},formatter:n=>V.number.toInteger(n)},{key:"fragPerBattle",label:"Уничт.",tooltip:"Уничтожено За Бой",sortable:!0,sortMethod(n,a){return n.all.fragPerBattle-a.all.fragPerBattle},formatter:n=>V.number.toFloatNumber(n)},{key:"hitRate",label:"Точн.",tooltip:"Точность стрельбы",sortable:!0,sortMethod(n,a){return n.all.hitRate-a.all.hitRate},formatter:n=>V.number.toPercent(n)},{key:"surviveRate",label:"Выж.",tooltip:"Выживаемость",sortable:!0,sortMethod(n,a){return n.all.surviveRate-a.all.surviveRate},formatter:n=>V.number.toPercent(n)},{key:"spottedPerBattle",label:"Обн.",tooltip:"Обнаружено за бой",sortable:!0,sortMethod(n,a){return n.all.spottedPerBattle-a.all.spottedPerBattle},formatter:n=>V.number.toFloatNumber(n)},{key:"mark_of_mastery",label:"M",tooltip:"Знак классности",sortable:!0,sortMethod(n,a){const i=n.markOfMastery.count+n.markOfMastery.value*1e4,_=a.markOfMastery.count+a.markOfMastery.value*1e4;return i-_},formatter:n=>V.stat.markOfMastery(Number(n))},{key:"last_battle_time",label:"Последний бой",sortable:!0}].filter(n=>{const a=["battles","winRate","damagePerBattle","type","tier","last_battle_time"];return b.isTablet?a.includes(n.key):!0})),e=E(()=>{let n={};return o.tanks.forEach((a,i)=>{i?n=N.sum(n,a.all):n=a.all}),N.tank(n)}),T={1:"markOfMasteryIII",2:"markOfMasteryII",3:"markOfMasteryI",4:"markOfMastery"},S=E(()=>o.tanks.map(n=>{var g;const a=(g=o.tanksDiff)==null?void 0:g.find(m=>m.tank_id===n.tank_id),i=n.achievements.achievements[T[n.mark_of_mastery]]??0,_=(a==null?void 0:a.achievements.achievements[T[n.mark_of_mastery]])??0;return{...n,diff:(a==null?void 0:a.all)??null,markOfMastery:{value:n.mark_of_mastery,count:i,diff:V.number.toInteger(_,!0)||"---"}}}));return r({sortItems(){var n;(n=p.value)==null||n.sortItems()}}),(n,a)=>{const i=oa;return d(),q(i,null,{default:R(()=>[(d(),q(Fe(c(f)),{items:c(S),headers:c(A),"show-diff":t.showDiff,summary:c(e),"max-height":t.maxHeight,height:t.height,loading:t.loading,"default-sort":t.defaultSort,onRowClick:a[0]||(a[0]=_=>y("row-click",_))},null,40,["items","headers","show-diff","summary","max-height","height","loading","default-sort"]))]),_:1})}}}),Uo={class:"account-daily-stat"},Vo={class:"account-daily-stat__filters"},Lo={class:"account-daily-stat__filters-item"},Eo={class:"account-daily-stat__filters-item"},qo={class:"account-daily-stat__table"},Fo={style:{display:"flex","justify-content":"flex-end"}},No=j({__name:"AccountDailyStat",props:{accountId:{type:[Number,String],default:0,required:!0},vehicles:{type:Object,default:()=>({}),required:!0}},emits:["sort"],setup(t,{emit:r}){const l=t,f=K(null),o=Z({loading:0,summary:{},items:[],currentItem:null,accounts:[],tanks:[]}),p=[7,14,30,60,90].map(m=>({value:m,label:new Intl.NumberFormat("ru",{style:"unit",unit:"day",unitDisplay:"long"}).format(m)})),b=[0,7,14,30,60,90,180].map(m=>({value:m,label:new Intl.NumberFormat("ru",{style:"unit",unit:"day",unitDisplay:"long"}).format(m)})),y=Z({period:7,periodOffset:0}),A=E(()=>{const m=new Date,C=new Date;return m.setDate(m.getDate()-(y.periodOffset+y.period+1)),C.setDate(C.getDate()-y.periodOffset),{dateStart:m.toISOString(),dateEnd:C.toISOString()}}),e={order:"desc",prop:"last_battle_time"},T=[{key:"position",label:"№"},{key:"date",label:"Дата"},{key:"tanks",label:"Танков"},{key:"tier",label:"I-X",formatter:m=>te(m)?V.number.toFloatNumber(m):"---"},{key:"battles",label:"Бои",formatter:m=>te(m)?V.number.toInteger(m):"---"},{key:"winRate",label:"Победы",formatter:m=>te(m)?V.number.toFloatPercent(m):"---"},{key:"damagePerBattle",label:"Урон",formatter:m=>te(m)?V.number.toInteger(m):"---"},{key:"xpPerBattle",label:"Опыт",formatter:m=>te(m)?V.number.toInteger(m):"---"},{key:"fragPerBattle",label:"Уничт.",tooltip:"Уничтожено За Бой",formatter:m=>te(m)?V.number.toFloatNumber(m):"---"},{key:"hitRate",label:"Точн.",tooltip:"Точность стрельбы",formatter:m=>te(m)?V.number.toFloatPercent(m):"---"},{key:"surviveRate",label:"Выж.",tooltip:"Выживаемость",formatter:m=>te(m)?V.number.toFloatPercent(m):"---"},{key:"spottedPerBattle",label:"Обн.",tooltip:"Обнаружено за бой",formatter:m=>te(m)?V.number.toFloatNumber(m):"---"}],S=E(()=>o.currentItem?o.currentItem.tanks.map(m=>{var C;return ce.accountTank(m,((C=l.vehicles)==null?void 0:C[m.tank_id])??null,null)}):[]);Se(async()=>{l.accountId&&(await a(l.accountId),i())}),Ve(A,async()=>{l.accountId&&(await a(l.accountId),i())});const n=r;async function a(m){const C={...A.value,id:m};o.loading++;try{const[k,D]=await Promise.all([fe.stat.accounts.getDiff(C),fe.stat.tanks.getDiff(C)]);o.tanks=D.data,o.accounts=k.data}catch(k){H(k,{title:"Получение дневной статистики"})}o.loading--}function i(){let m=null;o.items=[],o.accounts.forEach(C=>{var x;const k=N.accountAll(C.raw.statistics.all),D=(x=o.tanks.find(B=>{const U=V.date.toDate(B.timestamp),X=V.date.toDate(C.timestamp);return U===X}))==null?void 0:x.raw,M=()=>{const B=(D==null?void 0:D.length)??0;return((D==null?void 0:D.reduce((U,X)=>{var J;return U+((J=l.vehicles[X.tank_id])==null?void 0:J.tier)||0},0))??0)/B};o.items.push({id:C.id,date:V.date.toDate(C.timestamp),battles:k.battles,winRate:k.winRate,damagePerBattle:k.damagePerBattle,xpPerBattle:k.xpPerBattle,fragPerBattle:k.fragPerBattle,hitRate:k.hitRate,surviveRate:k.surviveRate,spottedPerBattle:k.spottedPerBattle,tanks:D||[],tier:M()}),m=m?N.sum(m,k):k}),o.summary=m?N.accountAll(m):{}}async function _(m){var C;o.currentItem=m,await Le(),(C=f.value)==null||C.doOpen()}function g(){var m;o.currentItem=null,(m=f.value)==null||m.doClose()}return(m,C)=>{var J;const k=rt,D=oe,M=Ie,x=mt,B=de,U=vt,X=ve;return d(),v("div",Uo,[s("div",Vo,[s("div",Lo,[I(" Период "),h(k,{modelValue:c(y).period,"onUpdate:modelValue":C[0]||(C[0]=F=>c(y).period=F),width:"120px",options:c(p),class:"account-daily-stat__filters-item"},null,8,["modelValue","options"])]),s("div",Eo,[I(" Смещение "),h(k,{modelValue:c(y).periodOffset,"onUpdate:modelValue":C[1]||(C[1]=F=>c(y).periodOffset=F),width:"120px",options:c(b)},null,8,["modelValue","options"])])]),s("div",qo,[h(x,{headers:T,data:c(o).items,summary:c(o).summary,"scroll-auto-disabling":"","no-wrap":"","row-key":"timestamp","max-height":"375px",onSort:C[2]||(C[2]=F=>n("sort",F))},{"position-summary":R(()=>{var F;return[I($(((F=c(o).items)==null?void 0:F.length)||0),1)]}),position:R(({index:F})=>[I($(F+1),1)]),date:R(({row:F})=>[h(D,{"is-text":"",onClick:ye=>_(F)},{default:R(()=>[I($(F.date),1)]),_:2},1032,["onClick"])]),tanks:R(({row:F})=>[I($(F.tanks?m.$formatter.number.toInteger(F.tanks.length):"---"),1)]),winRate:R(({row:F})=>[h(M,{modelValue:F.winRate,"onUpdate:modelValue":ye=>F.winRate=ye,class:"account-daily-stat__win-rate"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["data","summary"]),h(B,{loading:c(o).loading>0},null,8,["loading"])]),h(X,{ref_key:"tanksDetailsRef",ref:f,width:"1280px",title:"Статистика за "+((J=c(o).currentItem)==null?void 0:J.date),onClosed:C[3]||(C[3]=F=>c(o).currentItem=null)},{footer:R(()=>[s("div",Fo,[h(D,{onClick:g},{default:R(()=>[I(" Закрыть ")]),_:1})])]),default:R(()=>[c(o).currentItem?(d(),q(U,{key:0,tanks:c(S),"default-sort":e,"max-height":"calc(100vh - 200px)"},null,8,["tanks"])):P("",!0)]),_:1},8,["title"])])}}});var jo="__lodash_hash_undefined__";function Ho(t){return this.__data__.set(t,jo),this}var Go=Ho;function zo(t){return this.__data__.has(t)}var Ko=zo,Wo=ia,Xo=Go,Jo=Ko;function Te(t){var r=-1,l=t==null?0:t.length;for(this.__data__=new Wo;++r<l;)this.add(t[r])}Te.prototype.add=Te.prototype.push=Xo;Te.prototype.has=Jo;var Qo=Te;function Yo(t,r){for(var l=-1,f=t==null?0:t.length;++l<f;)if(r(t[l],l,t))return!0;return!1}var Zo=Yo;function ei(t,r){return t.has(r)}var ti=ei,ai=Qo,ni=Zo,si=ti,oi=1,ii=2;function li(t,r,l,f,o,p){var b=l&oi,y=t.length,A=r.length;if(y!=A&&!(b&&A>y))return!1;var e=p.get(t),T=p.get(r);if(e&&T)return e==r&&T==t;var S=-1,n=!0,a=l&ii?new ai:void 0;for(p.set(t,r),p.set(r,t);++S<y;){var i=t[S],_=r[S];if(f)var g=b?f(_,i,S,r,t,p):f(i,_,S,t,r,p);if(g!==void 0){if(g)continue;n=!1;break}if(a){if(!ni(r,function(m,C){if(!si(a,C)&&(i===m||o(i,m,l,f,p)))return a.push(C)})){n=!1;break}}else if(!(i===_||o(i,_,l,f,p))){n=!1;break}}return p.delete(t),p.delete(r),n}var kt=li;function ci(t){var r=-1,l=Array(t.size);return t.forEach(function(f,o){l[++r]=[o,f]}),l}var ri=ci;function ui(t){var r=-1,l=Array(t.size);return t.forEach(function(f){l[++r]=f}),l}var di=ui,Xe=Yt,Je=la,_i=fa,mi=kt,fi=ri,pi=di,hi=1,vi=2,ki="[object Boolean]",yi="[object Date]",gi="[object Error]",bi="[object Map]",wi="[object Number]",$i="[object RegExp]",Ai="[object Set]",Ri="[object String]",Ti="[object Symbol]",Si="[object ArrayBuffer]",Ci="[object DataView]",Qe=Xe?Xe.prototype:void 0,xe=Qe?Qe.valueOf:void 0;function Ii(t,r,l,f,o,p,b){switch(l){case Ci:if(t.byteLength!=r.byteLength||t.byteOffset!=r.byteOffset)return!1;t=t.buffer,r=r.buffer;case Si:return!(t.byteLength!=r.byteLength||!p(new Je(t),new Je(r)));case ki:case yi:case wi:return _i(+t,+r);case gi:return t.name==r.name&&t.message==r.message;case $i:case Ri:return t==r+"";case bi:var y=fi;case Ai:var A=f&hi;if(y||(y=pi),t.size!=r.size&&!A)return!1;var e=b.get(t);if(e)return e==r;f|=vi,b.set(t,r);var T=mi(y(t),y(r),f,o,p,b);return b.delete(t),T;case Ti:if(xe)return xe.call(t)==xe.call(r)}return!1}var Di=Ii,Ye=ca,Pi=1,Oi=Object.prototype,Bi=Oi.hasOwnProperty;function Mi(t,r,l,f,o,p){var b=l&Pi,y=Ye(t),A=y.length,e=Ye(r),T=e.length;if(A!=T&&!b)return!1;for(var S=A;S--;){var n=y[S];if(!(b?n in r:Bi.call(r,n)))return!1}var a=p.get(t),i=p.get(r);if(a&&i)return a==r&&i==t;var _=!0;p.set(t,r),p.set(r,t);for(var g=b;++S<A;){n=y[S];var m=t[n],C=r[n];if(f)var k=b?f(C,m,n,r,t,p):f(m,C,n,t,r,p);if(!(k===void 0?m===C||o(m,C,l,f,p):k)){_=!1;break}g||(g=n=="constructor")}if(_&&!g){var D=t.constructor,M=r.constructor;D!=M&&"constructor"in t&&"constructor"in r&&!(typeof D=="function"&&D instanceof D&&typeof M=="function"&&M instanceof M)&&(_=!1)}return p.delete(t),p.delete(r),_}var xi=Mi,Ue=ra,Ui=kt,Vi=Di,Li=xi,Ze=ua,et=ma,tt=da,Ei=_a,qi=1,at="[object Arguments]",nt="[object Array]",Ae="[object Object]",Fi=Object.prototype,st=Fi.hasOwnProperty;function Ni(t,r,l,f,o,p){var b=et(t),y=et(r),A=b?nt:Ze(t),e=y?nt:Ze(r);A=A==at?Ae:A,e=e==at?Ae:e;var T=A==Ae,S=e==Ae,n=A==e;if(n&&tt(t)){if(!tt(r))return!1;b=!0,T=!1}if(n&&!T)return p||(p=new Ue),b||Ei(t)?Ui(t,r,l,f,o,p):Vi(t,r,A,l,f,o,p);if(!(l&qi)){var a=T&&st.call(t,"__wrapped__"),i=S&&st.call(r,"__wrapped__");if(a||i){var _=a?t.value():t,g=i?r.value():r;return p||(p=new Ue),o(_,g,l,f,p)}}return n?(p||(p=new Ue),Li(t,r,l,f,o,p)):!1}var ji=Ni,Hi=ji,ot=Zt;function yt(t,r,l,f,o){return t===r?!0:t==null||r==null||!ot(t)&&!ot(r)?t!==t&&r!==r:Hi(t,r,l,f,yt,o)}var Gi=yt,zi=Gi;function Ki(t,r){return zi(t,r)}var Wi=Ki;const Xi=ea(Wi),Ji={class:"account-tanks-filters"},Qi={class:"account-tanks-filters__inner"},Yi={class:"account-tanks-filters__list"},Zi={style:{"font-weight":"500",width:"24px","text-align":"center"}},el={key:0,class:"account-tanks-filters__item"},tl={class:"account-tanks-filters__item"},al={class:"account-tanks-filters__item"},nl=j({__name:"AccountTanksFilters",props:{defaultFilters:{type:Object,default:null,required:!0},filters:{type:Object,default:null,required:!0},isPrivate:{type:[Boolean,String],default:!1,required:!0}},emits:["change","clear"],setup(t,{emit:r}){const l=t,f=["ussr","germany","usa","uk","japan","china","france","european","other"],o=[1,2,3,4,5,6,7,8,9,10].map(_=>({value:_,label:V.encyclopedia.tier(_)})),p=["lightTank","mediumTank","heavyTank","AT-SPG"],b=[{value:null,label:"Премиум: показать"},{value:!0,label:"Премиум: только"},{value:!1,label:"Премиум: спрятать"}],y=[{value:null,label:"В ангаре: все"},{value:1,label:"В ангаре: есть"},{value:0,label:"В ангаре: нет"}],A=E(()=>!Xi(l.filters,l.defaultFilters)),e=r;function T(_){let g=l.filters.tankNation;g.includes(_)?g=g.filter(m=>m!==_):g.push(_),e("change",{...l.filters,tankNation:g})}function S(_){let g=l.filters.tankTire;g.includes(_)?g=g.filter(m=>m!==_):g.push(_),e("change",{...l.filters,tankTire:g})}function n(_){let g=l.filters.tankType;g.includes(_)?g=g.filter(m=>m!==_):g.push(_),e("change",{...l.filters,tankType:g})}function a(_){e("change",{...l.filters,tankInGarage:_})}function i(_){e("change",{...l.filters,tankIsPremium:_})}return(_,g)=>{const m=pt,C=_e,k=ke,D=rt,M=he,x=oe;return d(),v("div",Ji,[s("div",Qi,[s("ul",Yi,[s("li",{class:Q(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[(d(),v(z,null,Y(f,B=>h(C,{key:B,"model-value":t.filters.tankNation.includes(B),class:"account-tanks-filters__btn",title:_.$formatter.encyclopedia.nation(B),onChange:U=>T(B)},{default:R(()=>[h(m,{"model-value":B},null,8,["model-value"])]),_:2},1032,["model-value","title","onChange"])),64))]),s("li",{class:Q(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[(d(),v(z,null,Y(p,B=>h(C,{key:B,"model-value":t.filters.tankType.includes(B),class:"account-tanks-filters__btn",title:"Тип",onChange:U=>n(B)},{default:R(()=>[h(k,{"model-value":B},null,8,["model-value"])]),_:2},1032,["model-value","onChange"])),64))]),s("li",{class:Q(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[(d(!0),v(z,null,Y(c(o),B=>(d(),q(C,{key:B.value,"model-value":t.filters.tankTire.includes(B.value),class:"account-tanks-filters__btn",title:"Уровень "+B,onChange:U=>S(B.value)},{default:R(()=>[s("span",Zi,$(B.label),1)]),_:2},1032,["model-value","title","onChange"]))),128))]),t.isPrivate?(d(),v("li",el,[h(D,{"model-value":t.filters.tankInGarage,options:y,onChange:a},null,8,["model-value"])])):P("",!0),s("li",tl,[h(D,{"model-value":t.filters.tankIsPremium,options:b,onChange:i},null,8,["model-value"])]),s("li",al,[h(x,{title:"Очистить фильтры",disabled:!c(A),onClick:g[0]||(g[0]=B=>e("clear"))},{default:R(()=>[h(M,{name:"clear"})]),_:1},8,["disabled"])])])])])}}}),sl={key:0,class:"account-tank"},ol={class:"account-tank__header"},il={class:"account-tank__img-wrapper"},ll={class:"account-tank__tier"},cl={class:"account-tank__props"},rl={class:"account-tank__prop"},ul=s("span",{class:"account-tank__prop-name"}," Нация: ",-1),dl={class:"account-tank__prop"},_l=s("span",{class:"account-tank__prop-name"}," Последний бой: ",-1),ml=s("h4",null,"Статистика",-1),fl=s("h4",null,"Достижения",-1),pl=j({__name:"AccountTank",props:{tank:{type:Object,default:()=>({}),required:!0},tankDiff:{type:Object,default:null,required:!0},achievementsInfo:{type:Object,default:()=>({}),required:!0}},setup(t){const r=["battles","winRate","damagePerBattle","surviveRate","fragPerBattle","winsInPlatoon"],l=t,f=Z({showAllMetrics:!1,filters:na()}),o=E(()=>{const b=ie.tank({tank:l.tank,tankDiff:l.tankDiff});return f.showAllMetrics?b:b.filter(y=>r.includes(y.key))});function p(b){f.filters=b}return(b,y)=>{var a;const A=Ce,e=ke,T=_e,S=dt,n=ft;return t.tank?(d(),v("div",sl,[s("div",ol,[s("div",il,[h(A,{class:"account-tank__img account-tank__img--nation",alt:"tank.nation",src:`/img/nations/nation-${t.tank.nation}.svg`},null,8,["src"]),h(A,{class:"account-tank__img account-tank__img--tank",alt:t.tank.name,src:(a=t.tank.images)==null?void 0:a.preview},null,8,["alt","src"]),h(e,{size:28,class:"account-tank__type","model-value":t.tank.type,"is-premium":t.tank.is_premium,"is-collectible":t.tank.is_collectible},null,8,["model-value","is-premium","is-collectible"]),s("div",ll,$(b.$formatter.encyclopedia.tier(t.tank.tier)),1)]),s("div",cl,[s("div",rl,[ul,I(" "+$(b.$formatter.encyclopedia.nation(t.tank.nation)),1)]),s("div",dl,[_l,I(" "+$(b.$formatter.date.toDateTime(t.tank.last_battle_time*1e3)),1)])])]),ml,h(T,{modelValue:c(f).showAllMetrics,"onUpdate:modelValue":y[0]||(y[0]=i=>c(f).showAllMetrics=i),class:"account-tank__show-all-metrics"},{default:R(()=>[I(" Все показатели ")]),_:1},8,["modelValue"]),h(S,{items:c(o)},null,8,["items"]),fl,h(n,{achievements:t.tank.achievements,"achievements-info":t.achievementsInfo,filters:c(f).filters,onFiltersChanged:p},null,8,["achievements","achievements-info","filters"])])):P("",!0)}}}),hl={key:0,class:"account-view"},vl={class:"account-view__private"},kl={key:1,class:"account-view--no-data"},yl={key:0,class:"content-area"},gl=s("p",null,"Нет данных.",-1),bl=s("p",null,"Возможно аккаунт удалён.",-1),wl=[gl,bl],$l={style:{display:"flex","justify-content":"flex-end"}},Wl=j({__name:"AccountView",setup(t){const r=K(null),l=K(null),f=_t.makeAccountFilters({tankInGarage:1,tankIsPremium:null}),o=Xt(),p=pa(),b=ha(),y={order:"desc",prop:"last_battle_time"},A=Z(ae(y)),e=Z({tanks:[],tanksDiff:[],tanksSessions:[],tanksSnapshot:[],tanksTableItems:[],sessionUpdateAt:0,sessionActive:!1,currentTank:null,currentTankDiff:null,loading:0,filters:ae(f),accountRaw:null,accountRawSnapshot:null,accountAchievementsRaw:null,accountAchievementsRawSnapshot:null,tanksRaw:null,tanksRawSnapshot:null,tanksAchievementsRaw:null,tanksAchievementsRawSnapshot:null}),T=E(()=>b.vehicles),S=E(()=>b.achievements),n=E(()=>{var u;return p.accountId===((u=e.accountRaw)==null?void 0:u.account_id)}),a=E(()=>Number(o.params.id)||p.accountId),i=E(()=>!e.accountAchievementsRaw||!e.accountAchievementsRawSnapshot||!S.value?null:N.accountAchievementsDiff(e.accountAchievementsRaw,e.accountAchievementsRawSnapshot,S.value)),_=E(()=>e.sessionActive?i.value:e.accountAchievementsRaw),g=E(()=>{if(!e.accountRaw)return null;const u=e.accountRaw.statistics.all,w=e.accountRaw.statistics.rating;return{...e.accountRaw,statistics:{all:N.accountAll(u),rating:w?N.accountRating(w):null}}}),m=E(()=>{if(!e.accountRaw||!e.accountRawSnapshot)return null;const u=e.accountRaw.statistics.all,w=e.accountRaw.statistics.rating,O=e.accountRawSnapshot.statistics.all,L=e.accountRawSnapshot.statistics.rating;return{...e.accountRaw,statistics:{all:N.accountAll(N.diff(u,O)),rating:w&&L?N.accountRating(N.diff(w,L)):null}}}),C=E(()=>{if(!e.accountRaw||!e.accountRawSnapshot)return null;const u=e.accountRaw.statistics.all,w=e.accountRaw.statistics.rating,O=e.accountRawSnapshot.statistics.all,L=e.accountRawSnapshot.statistics.rating,W=N.diff(N.accountAll(u),N.accountAll(O)),G=w&&L?N.diff(N.accountRating(w),N.accountRating(L)):null;return{...e.accountRaw,statistics:{all:W,rating:G}}}),k=E(()=>{var u,w,O,L;return!g.value||!m.value||!_.value?ie.account():e.sessionActive?ie.account({stat:(u=m.value)==null?void 0:u.statistics.all,achievements:i.value,tanks:e.tanksSessions,createAt:new Date(e.sessionUpdateAt).valueOf()}):ie.account({stat:(w=g.value)==null?void 0:w.statistics.all,statDiff:(O=C.value)==null?void 0:O.statistics.all,achievements:e.accountAchievementsRaw,achievementsDiff:i.value,tanks:e.tanks,tanksDiff:e.tanksDiff.filter(W=>W.all.battles),createAt:((L=g.value)==null?void 0:L.created_at)*1e3,createAtSnapshot:new Date(e.sessionUpdateAt).valueOf()})}),D=E(()=>{var u,w,O;return!g.value||!m.value?ie.accountRating():e.sessionActive?ie.accountRating({stat:(u=m.value)==null?void 0:u.statistics.rating}):ie.accountRating({stat:(w=g.value)==null?void 0:w.statistics.rating,diff:(O=C.value)==null?void 0:O.statistics.rating})}),M=E(()=>e.filters.battleMode==="random"?k.value:D.value);Ve(()=>e.sessionActive,()=>{ge(e.filters)}),Ve(()=>e.filters,async()=>{var u;je(e.filters),await Le(),(u=r.value)==null||u.sortItems()});const x=K(!1);Se(async()=>{await De(),x.value=!0});function B(){var u;return((u=e.tanksRaw)==null?void 0:u.map(w=>{var L,W;const O=(L=e.tanksAchievementsRaw)==null?void 0:L.find(G=>G.tank_id===w.tank_id);return ce.accountTank(w,((W=T.value)==null?void 0:W[w.tank_id])??null,O??null)}))??[]}function U(){var u;return((u=e.tanksRawSnapshot)==null?void 0:u.map(w=>{var L,W;const O=(L=e.tanksAchievementsRawSnapshot)==null?void 0:L.find(G=>G.tank_id===w.tank_id);return ce.accountTank(w,((W=T.value)==null?void 0:W[w.tank_id])??null,O??null)}))??[]}function X(u,w=!1){var re,be,we;const O=((re=e.tanksAchievementsRaw)==null?void 0:re.find(me=>me.tank_id===u.tank_id))??null,L=((be=e.tanksAchievementsRawSnapshot)==null?void 0:be.find(me=>me.tank_id===u.tank_id))??null,W=O&&L?N.tankAchievementsDiff(O,L):null,G=((we=T.value)==null?void 0:we[u.tank_id])??null;return ce.accountTank(u,G,w?O:W)}function J(){var u;return((u=e.tanksRaw)==null?void 0:u.reduce((w,O)=>{var G;const L=(G=e.tanksRawSnapshot)==null?void 0:G.find(re=>re.tank_id===O.tank_id);if(!L)return w.push(X(O,!0)),w;if(O.all.battles===L.all.battles)return w;const W=O.battle_life_time-L.battle_life_time;return w.push(X({...O,battle_life_time:W,all:N.diff(O.all,L.all)})),w},[]))??[]}function F(){return e.tanks.map(u=>{const w=e.tanksSnapshot.find(L=>u.tank_id===L.tank_id);if(!w)return u;const O=u.battle_life_time-w.battle_life_time;return{...u,all:N.diff(u.all,w.all),battle_life_time:O,achievements:N.tankAchievementsDiff(u.achievements,w.achievements)}})}function ye(){e.tanks=B(),e.tanksSnapshot=U(),e.tanksSessions=J(),e.tanksDiff=F()}async function gt(u){e.loading++;try{const{data:w}=await le.tanks.getAchievements({account_id:u});e.tanksAchievementsRaw=w[u]??null}catch(w){H(w,{title:"Получение достижений по технике игрока"})}e.loading--}async function bt(u){e.loading++;try{const{data:w}=await le.account.getAchievements({account_id:u});e.accountAchievementsRaw=w[u]??null}catch(w){H(w,{title:"Получение достижений по аккаунту игрока"})}e.loading--}async function wt(u){e.loading++;try{const{data:w}=await le.account.getInfo({account_id:u,extra:"statistics.rating"});e.accountRaw=(w==null?void 0:w[u])??null}catch(w){H(w,{title:"Получение данных аккаунта"})}e.loading--}async function $t(u){T.value||await Rt(),await At(u)}async function At(u){e.loading++;try{const{data:w}=await le.tanks.getStats({account_id:u});e.tanksRaw=w?w[u]:null}catch(w){H(w,{title:"Получение статистики по технике игрока"})}e.loading--}async function Rt(){if(!T.value){e.loading++;try{await b.getTanksVehicles()}catch(u){H(u,{title:"Получение данных описания техники"})}e.loading--}}async function Tt(){if(!S.value){e.loading++;try{await b.getAchievements()}catch(u){H(u,{title:"Получение описания достижений"})}e.loading--}}async function De(u=!1){var w;a.value&&(await Promise.all([Tt(),wt(a.value),$t(a.value),gt(a.value),bt(a.value)]),u||await Ut(),(u||!e.accountRawSnapshot)&&await Vt(),ye(),je(e.filters),await Le(),(w=r.value)==null||w.sortItems())}function je(u){let w=e.sessionActive?e.tanksSessions:e.tanks;u.tankInGarage!==null&&(w=w.filter(O=>typeof O.in_garage!="boolean"?!0:O.in_garage===(u.tankInGarage===1))),u.tankNation.length&&(w=w.filter(O=>u.tankNation.includes(O.nation))),u.tankTire.length&&(w=w.filter(O=>u.tankTire.includes(O.tier))),w=w.filter(O=>{const L=u.tankIsPremium;return L===!0?O.is_premium:L===!1?!O.is_premium:!0}),u.tankType.length&&(w=w.filter(O=>u.tankType.includes(O.type))),e.tanksTableItems=w}function ge(u){e.filters=ae(u)}function St(){e.filters=ae(f)}async function Ct(){if(e.accountRaw){e.loading++;try{const u=await ee.indexedDB.accountsInfo.get(e.accountRaw.account_id);e.accountRawSnapshot=(u==null?void 0:u.data)??null,e.sessionUpdateAt=(u==null?void 0:u.timestamp)??0}catch(u){H(u,{title:"Загрузка локальных данных аккаунта"})}e.loading--}}async function It(){if(e.accountRaw){e.loading++;try{await ee.indexedDB.accountsInfo.set(e.accountRaw.account_id,$e(e.accountRaw)),e.accountRawSnapshot=ae(e.accountRaw),e.sessionUpdateAt=Date.now()}catch(u){H(u,{title:"Сохранение локальных данных аккаунта"})}e.loading--}}async function Dt(){if(e.accountRaw){e.loading++;try{const u=await ee.indexedDB.accountsAchievements.get(e.accountRaw.account_id);e.accountAchievementsRawSnapshot=(u==null?void 0:u.data)??null,e.sessionUpdateAt=(u==null?void 0:u.timestamp)??0}catch(u){H(u,{title:"Загрузка локальных данных достижений аккаунта"})}e.loading--}}async function Pt(){if(!(!e.accountRaw||!e.accountAchievementsRaw)){e.loading++;try{await ee.indexedDB.accountsAchievements.set(e.accountRaw.account_id,$e(e.accountAchievementsRaw)),e.accountAchievementsRawSnapshot=ae(e.accountAchievementsRaw)}catch(u){H(u,{title:"Сохранение локальных данных достижений аккаунта"})}e.loading--}}async function Ot(){if(e.accountRaw){e.loading++;try{const u=await ee.indexedDB.tanksStat.get(e.accountRaw.account_id);e.tanksRawSnapshot=(u==null?void 0:u.data)??null}catch(u){H(u,{title:"Загрузка локальных данных техники"})}e.loading--}}async function Bt(){if(!(!e.accountRaw||!e.tanksRaw)){e.loading++;try{await ee.indexedDB.tanksStat.set(e.accountRaw.account_id,$e(e.tanksRaw)),e.tanksRawSnapshot=ae(e.tanksRaw),e.sessionUpdateAt=Date.now()}catch(u){H(u,{title:"Сохранение локальных данных техники"})}e.loading--}}async function Mt(){if(e.accountRaw){e.loading++;try{const u=await ee.indexedDB.tanksAchievements.get(e.accountRaw.account_id);e.tanksAchievementsRawSnapshot=(u==null?void 0:u.data)??null}catch(u){H(u,{title:"Загрузка локальных данных достижений техники"})}e.loading--}}async function xt(){if(!(!e.accountRaw||!e.tanksAchievementsRaw)){e.loading++;try{await ee.indexedDB.tanksAchievements.set(e.accountRaw.account_id,$e(e.tanksAchievementsRaw)),e.tanksAchievementsRawSnapshot=ae(e.tanksAchievementsRaw),e.sessionUpdateAt=Date.now()}catch(u){H(u,{title:"Сохранение локальных данных достижений техники"})}e.loading--}}async function Ut(){await Promise.all([Ct(),Dt(),Ot(),Mt()])}async function Vt(){await Promise.all([It(),Pt(),Bt(),xt()])}async function Lt(){await De(!0)}function Et(){De()}function qt(u){var w;e.sessionActive?(e.currentTank=e.tanksSessions.find(O=>u===O.tank_id)??null,e.currentTankDiff=null):(e.currentTank=e.tanks.find(O=>u===O.tank_id)??null,e.currentTankDiff=e.tanksDiff.find(O=>u===O.tank_id)??null),(w=l.value)==null||w.doOpen()}return(u,w)=>{var He;const O=ja,L=Wn,W=os,G=aa,re=ds,be=ft,we=Gs,me=No,Ft=nl,Nt=vt,jt=de,Ht=pl,Gt=oe,zt=ve;return d(),v(z,null,[c(e).accountRaw?(d(),v("div",hl,[h(G,{identity:"preview"},{default:R(()=>[s("div",vl,[c(e).accountRaw.private?(d(),q(O,{key:0,resources:c(e).accountRaw.private},null,8,["resources"])):P("",!0)]),h(L,{loading:c(e).loading>0,class:"account-view__preview",account:c(e).accountRaw},null,8,["loading","account"]),h(W,{modelValue:c(e).sessionActive,"onUpdate:modelValue":w[0]||(w[0]=Pe=>c(e).sessionActive=Pe),class:"account-view__session",loading:c(e).loading>0,"update-at":c(e).sessionUpdateAt,onReset:Lt,onUpdate:Et},null,8,["modelValue","loading","update-at"])]),_:1}),h(G,{title:"Статистика",identity:"statistic"},{default:R(()=>[h(re,{filters:c(e).filters,metrics:c(M),loading:c(e).loading>0,onFilters:ge},null,8,["filters","metrics","loading"])]),_:1}),Oe(h(G,{title:"Достижения",identity:"achievements"},{default:R(()=>[c(_)&&c(S)?(d(),q(be,{key:0,filters:c(e).filters,"achievements-info":c(S),achievements:c(_),onFiltersChanged:ge},null,8,["filters","achievements-info","achievements"])):P("",!0)]),_:1},512),[[Be,c(e).filters.battleMode==="random"]]),!c(e).sessionActive&&c(e).filters.battleMode==="random"?(d(),q(G,{key:0,title:"Инфографика",identity:"tanksBattles"},{default:R(()=>[h(we,{tanks:c(e).tanks},null,8,["tanks"])]),_:1})):P("",!0),c(e).sessionActive?P("",!0):Oe((d(),q(G,{key:1,title:"Статистика по дням",identity:"dailyStat"},{default:R(()=>[c(T)?(d(),q(me,{key:0,vehicles:c(T),"account-id":c(e).accountRaw.account_id},null,8,["vehicles","account-id"])):P("",!0)]),_:1},512)),[[Be,c(e).filters.battleMode==="random"]]),Oe(h(G,{title:"Техника",identity:"tanks"},{default:R(()=>[h(Ft,{class:"account-view__filters",filters:c(e).filters,"default-filters":c(f),"is-private":c(n),onChange:ge,onClear:St},null,8,["filters","default-filters","is-private"]),h(Nt,{ref_key:"tableRef",ref:r,sort:c(A),loading:c(e).loading>0,"default-sort":y,tanks:c(e).tanksTableItems,"tanks-diff":c(e).tanksDiff,"achievements-info":c(S),"show-diff":!c(e).sessionActive,height:"calc(100vh - 112px)",onRowClick:qt},null,8,["sort","loading","tanks","tanks-diff","achievements-info","show-diff"])]),_:1},512),[[Be,c(e).filters.battleMode==="random"]])])):(d(),v("div",kl,[c(x)?(d(),v("div",yl,wl)):P("",!0),h(jt,{loading:!c(x)},null,8,["loading"])])),h(zt,{ref_key:"tankDetailsRef",ref:l,width:"1100px",title:(He=c(e).currentTank)==null?void 0:He.name,onClosed:w[2]||(w[2]=Pe=>c(e).currentTank=null)},{footer:R(()=>[s("div",$l,[h(Gt,{onClick:w[1]||(w[1]=Pe=>{var Ge;return(Ge=c(l))==null?void 0:Ge.doClose()})},{default:R(()=>[I(" Закрыть ")]),_:1})])]),default:R(()=>[c(S)&&c(e).currentTank?(d(),q(Ht,{key:0,tank:c(e).currentTank,"tank-diff":c(e).currentTankDiff,"achievements-info":c(S)},null,8,["tank","tank-diff","achievements-info"])):P("",!0)]),_:1},8,["title"])],64)}}});export{Wl as _};
