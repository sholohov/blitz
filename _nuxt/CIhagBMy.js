import{_ as xt}from"./CqTryP6T.js";import{x as lt,R as z,r as O,S as Rt,T as Ut,U as Mt,B as Ot,C as X,V as kt,W as It,f as _,X as yt,Y as Wt,d as j,o as V,m as B,n as t,h as s,v as x,Z as Et,_ as G,c as q,e as Z,w as p,t as S,y as Q,z as ot,A as rt,F as H,D as dt,I as J,k as A,g as N,E as F,$ as Ht,a0 as jt,u as Nt,a1 as ht,l as zt,i as qt,H as vt,a2 as Kt}from"./CjZrE5Wh.js";import{_ as Ft}from"./qdLsBVkU.js";import{_ as ct}from"./Bn1JX7hh.js";import{_ as ut,a as tt,b as gt}from"./DjEv7Ds9.js";import{_ as bt}from"./Z7RafptJ.js";import{_ as Xt}from"./NbC4VhIM.js";import{_ as At}from"./Bx2A0I5R.js";import{u as mt}from"./DBvd0WFK.js";import{_ as Gt}from"./DFsy_17x.js";import{_ as wt}from"./D5c89INQ.js";import{_ as Lt}from"./BRok-xIX.js";import{_ as Yt}from"./Zt_43PKh.js";import{_ as Zt}from"./DrqyukFs.js";import{_ as _t}from"./CVTThTqB.js";import{d as Jt}from"./CKeGCx3Z.js";import{s as W}from"./lVSEt-VN.js";import{u as Qt}from"./wGjzNOYn.js";import{_ as te}from"./BRE2HOjV.js";import"./i0sd772w.js";import"./BBnSm2t4.js";import"./DlAUqK2U.js";import"./DD4asW33.js";import"./DMYS3RtA.js";import"./Qj2LaeAt.js";import"./08N2mJ2P.js";import"./BPrNtVlW.js";import"./DVWFMday.js";import"./f3e3m13b.js";import"./gCGvA3p7.js";import"./DSeEFkux.js";const ee=l=>l==="defer"||l===!1;function ae(...l){var R;const c=typeof l[l.length-1]=="string"?l.pop():void 0;typeof l[0]!="string"&&l.unshift(c);let[a,v,n={}]=l;if(typeof a!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof v!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const i=lt(),w=v,$=()=>z.value,m=()=>i.isHydrating?i.payload.data[a]:i.static.data[a];n.server=n.server??!0,n.default=n.default??$,n.getCachedData=n.getCachedData??m,n.lazy=n.lazy??!1,n.immediate=n.immediate??!0,n.deep=n.deep??z.deep,n.dedupe=n.dedupe??"cancel";const e=n.getCachedData(a,i),f=e!=null;if(!i._asyncData[a]||!n.immediate){(R=i.payload._errors)[a]??(R[a]=z.errorValue);const u=n.deep?O:Rt;i._asyncData[a]={data:u(f?e:n.default()),pending:O(!f),error:Ut(i.payload._errors,a),status:O("idle"),_default:n.default}}const d={...i._asyncData[a]};delete d._default,d.refresh=d.execute=(u={})=>{if(i._asyncDataPromises[a]){if(ee(u.dedupe??n.dedupe))return i._asyncDataPromises[a];i._asyncDataPromises[a].cancelled=!0}if(u._initial||i.isHydrating&&u._initial!==!1){const T=u._initial?e:n.getCachedData(a,i);if(T!=null)return Promise.resolve(T)}d.pending.value=!0,d.status.value="pending";const k=new Promise((T,g)=>{try{T(w(i))}catch(h){g(h)}}).then(async T=>{if(k.cancelled)return i._asyncDataPromises[a];let g=T;n.transform&&(g=await n.transform(T)),n.pick&&(g=ne(g,n.pick)),i.payload.data[a]=g,d.data.value=g,d.error.value=z.errorValue,d.status.value="success"}).catch(T=>{if(k.cancelled)return i._asyncDataPromises[a];d.error.value=It(T),d.data.value=_(n.default()),d.status.value="error"}).finally(()=>{k.cancelled||(d.pending.value=!1,delete i._asyncDataPromises[a])});return i._asyncDataPromises[a]=k,i._asyncDataPromises[a]},d.clear=()=>se(i,a);const b=()=>d.refresh({_initial:!0}),y=n.server!==!1&&i.payload.serverRendered;{const u=yt();if(u&&!u._nuxtOnBeforeMountCbs){u._nuxtOnBeforeMountCbs=[];const g=u._nuxtOnBeforeMountCbs;Mt(()=>{g.forEach(h=>{h()}),g.splice(0,g.length)}),Ot(()=>g.splice(0,g.length))}y&&i.isHydrating&&(d.error.value||e!=null)?(d.pending.value=!1,d.status.value=d.error.value?"error":"success"):u&&(i.payload.serverRendered&&i.isHydrating||n.lazy)&&n.immediate?u._nuxtOnBeforeMountCbs.push(b):n.immediate&&b();const k=Wt();if(n.watch){const g=X(n.watch,()=>d.refresh());k&&kt(g)}const T=i.hook("app:data:refresh",async g=>{(!g||g.includes(a))&&await d.refresh()});k&&kt(T)}const D=Promise.resolve(i._asyncDataPromises[a]).then(()=>d);return Object.assign(D,d),D}function se(l,c){c in l.payload.data&&(l.payload.data[c]=void 0),c in l.payload._errors&&(l.payload._errors[c]=z.errorValue),l._asyncData[c]&&(l._asyncData[c].data.value=void 0,l._asyncData[c].error.value=z.errorValue,l._asyncData[c].pending.value=!1,l._asyncData[c].status.value="idle"),c in l._asyncDataPromises&&(l._asyncDataPromises[c]&&(l._asyncDataPromises[c].cancelled=!0),l._asyncDataPromises[c]=void 0)}function ne(l,c){const a={};for(const v of c)a[v]=l[v];return a}const ie={class:"hand-statistic-tank-preview__img-wrapper"},le={class:"hand-statistic-tank-preview__description"},oe={class:"hand-statistic-tank-preview__description-tank"},re={class:"hand-statistic-tank-preview__name"},de={class:"hand-statistic-tank-preview__name-text"},ce={class:"hand-statistic-tank-preview__description-tank"},ue={class:"hand-statistic-tank-preview__props"},me={class:"hand-statistic-tank-preview__prop"},_e={class:"hand-statistic-tank-preview__prop-value"},pe={class:"hand-statistic-tank-preview__prop"},fe={class:"hand-statistic-tank-preview__prop-value"},ke={class:"hand-statistic-tank-preview__prop"},he={class:"hand-statistic-tank-preview__prop-value"},ve=j({__name:"HandStatisticTankPreview",props:{tank:{type:Object,default:()=>({}),required:!0}},setup(l){return(c,a)=>{const v=ct,n=tt,i=G,w=bt;return V(),B("div",Et({class:"hand-statistic-tank-preview"},c.$attrs),[t("div",ie,[s(v,{class:"hand-statistic-tank-preview__nation-img",src:`/img/nations/nation-${l.tank.nation}.svg`,alt:l.tank.nation},null,8,["src","alt"]),s(v,{class:"hand-statistic-tank-preview__tank-img",src:l.tank.images.preview,alt:l.tank.name},null,8,["src","alt"]),s(ut,{class:"hand-statistic-tank-preview__tier",tier:l.tank.tier},null,8,["tier"])]),t("div",le,[t("div",oe,[t("div",re,[s(n,{type:l.tank.type,class:"hand-statistic-tank-preview__type","is-premium":l.tank.is_premium,"is-collectible":l.tank.is_collectible},null,8,["type","is-premium","is-collectible"]),t("span",de,x(l.tank.name??`Tank ID: ${l.tank.tank_id}`),1)])]),t("div",ce,[t("div",ue,[t("span",me,[s(i,{name:"sword-cross",size:"18"}),t("span",_e,x(c.$formatter.number.toInteger(l.tank.stat.battles)),1)]),t("span",pe,[s(i,{name:"flag-variant",size:"18"}),t("span",fe,[s(w,{"win-rate":l.tank.stat.winRate},null,8,["win-rate"])])]),t("span",ke,[s(i,{name:"destruction",size:"18"}),t("span",he,x(c.$formatter.number.toInteger(l.tank.stat.damagePerBattle)),1)])])])])],16)}}}),ye={class:"hand-statistic-tank-table__row"},ge={class:"hand-statistic-tank-table__tank"},be={class:"hand-statistic-tank-table__name"},we={class:"hand-statistic-tank-table__diff"},$e={style:{display:"flex",gap:"10px"}},Te=j({__name:"HendStatisticTankTable",props:{items:{type:Array,default:()=>[],required:!0}},emits:["pressEdit"],setup(l,{emit:c}){const a={prop:"lastUpdateTime",order:"asc"},v=mt(),n=q(()=>v.isTablet),{$formatter:i}=lt(),w=[{key:"name",label:"Танк",sortable:!0},{key:"type",label:"Тип",sortable:!0},{key:"tier",label:"I-X",sortable:!0},{key:"battles",label:i.stat.accountProp("battles"),sortable:!0,sortMethod(e,f){const d=e,b=f;return d.stat.battles-b.stat.battles}},{key:"winRate",label:i.stat.accountProp("wins"),sortable:!0,sortMethod(e,f){const d=e,b=f;return d.stat.winRate-b.stat.winRate}},{key:"damagePerBattle",label:i.stat.accountProp("damage_dealt"),sortable:!0,sortMethod(e,f){const d=e,b=f;return d.stat.damagePerBattle-b.stat.damagePerBattle}},{key:"lastUpdateTime",label:"Дата обновления",sortable:!0,sortMethod(e,f){return f.lastUpdateTime-e.lastUpdateTime}},{key:"controls",label:"",width:100}],$=[{key:"battles",label:i.stat.accountProp("battles"),sortable:!0,sortMethod(e,f){const d=e,b=f;return d.stat.battles-b.stat.battles}},{key:"winRate",label:i.stat.accountProp("wins"),sortable:!0,sortMethod(e,f){const d=e,b=f;return d.stat.winRate-b.stat.winRate}},{key:"damagePerBattle",label:i.stat.accountProp("damage_dealt"),sortable:!0,sortMethod(e,f){const d=e,b=f;return d.stat.damagePerBattle-b.stat.damagePerBattle}},{key:"lastUpdateTime",label:"Дата обновления",sortable:!0,sortMethod(e,f){return f.lastUpdateTime-e.lastUpdateTime}}],m=c;return(e,f)=>{const d=ve,b=Xt,y=tt,D=ut,R=ct,u=bt,k=G,T=Q,g=At;return _(n)?(V(),Z(b,{key:0,class:"hand-statistic-tank-table",headers:$,data:l.items,"default-sort":a},{default:p(({row:h})=>[s(d,{tank:h,onClick:I=>m("pressEdit",h)},null,8,["tank","onClick"])]),_:1},8,["data"])):(V(),Z(g,{key:1,class:"hand-statistic-tank-table",headers:w,data:l.items,"default-sort":a},{type:p(({row:h})=>[s(y,{size:"24",type:h.type,"is-premium":h.is_premium,"is-collectible":h.is_collectible},null,8,["type","is-premium","is-collectible"])]),tier:p(({row:h})=>[s(D,{tier:h.tier},null,8,["tier"])]),name:p(({row:h})=>{var I;return[t("div",ye,[t("div",ge,[s(R,{class:"hand-statistic-tank-table__tank-nation",src:`/img/nations/nation-${h.nation}.svg`,alt:h.nation},null,8,["src","alt"]),s(R,{class:"hand-statistic-tank-table__tank-img",alt:h.name,src:(I=h.images)==null?void 0:I.preview},null,8,["alt","src"])]),t("span",be,x(h.name),1)])]}),battles:p(({row:h})=>[t("span",null,x(_(i).number.toInteger(h.stat.battles)),1)]),winRate:p(({row:h})=>[s(u,{"win-rate":h.stat.winRate},null,8,["win-rate"])]),damagePerBattle:p(({row:h})=>[S(x(_(i).number.toInteger(h.stat.damagePerBattle)),1)]),lastUpdateTime:p(({row:h})=>[S(x(_(i).date.toRelativeTime(h.lastUpdateTime)||"---")+" ",1),t("div",we,x(_(i).date.toDateTime(h.lastUpdateTime)||"---"),1)]),controls:p(({row:h})=>[t("div",$e,[s(T,{onClick:I=>m("pressEdit",h)},{before:p(()=>[s(k,{name:"edit"})]),default:p(()=>[f[0]||(f[0]=S(" Изменить "))]),_:2},1032,["onClick"]),f[1]||(f[1]=t("div",null,null,-1))])]),_:1},8,["data"]))}}}),Ve=j({__name:"NationSelect",props:ot({noWrap:{type:Boolean,default:!1,required:!1}},{modelValue:{required:!0,default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(l){const c=rt(l,"modelValue"),a=["ussr","germany","usa","uk","japan","china","france","european","other"];function v(n,i){i?c.value.push(n):c.value=[...c.value.filter(w=>w!==n)]}return(n,i)=>{const w=gt,$=_t;return V(),B("div",{class:J(["nation-select",[l.noWrap?"nation-select--no-wrap":""]])},[(V(),B(H,null,dt(a,m=>{var e;return s($,{key:m,"model-value":!!((e=c.value)!=null&&e.includes(m)),onChange:f=>v(m,f)},{default:p(()=>[s(w,{nation:m},null,8,["nation"])]),_:2},1032,["model-value","onChange"])}),64))],2)}}}),Ce=j({__name:"TypeSelect",props:ot({noWrap:{type:Boolean,default:!1,required:!1}},{modelValue:{required:!0,default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(l){const c=rt(l,"modelValue"),a=["lightTank","mediumTank","heavyTank","AT-SPG"];function v(n,i){i?c.value.push(n):c.value=[...c.value.filter(w=>w!==n)]}return(n,i)=>{const w=tt,$=_t;return V(),B("div",{class:J(["type-select",[l.noWrap?"type-select--no-wrap":""]])},[(V(),B(H,null,dt(a,m=>{var e;return s($,{key:m,"model-value":!!((e=c.value)!=null&&e.includes(m)),onChange:f=>v(m,f)},{default:p(()=>[s(w,{type:m},null,8,["type"])]),_:2},1032,["model-value","onChange"])}),64))],2)}}}),De={class:"hand-statistic-tank-select"},Be={class:"hand-statistic-tank-select__body"},Se={class:"hand-statistic-tank-select__filters"},Pe={class:"hand-statistic-tank-select__filters-item"},xe={class:"hand-statistic-tank-select__filters-item"},Re={class:"hand-statistic-tank-select__filters-item"},Ue={class:"hand-statistic-tank-select__filters-item"},Me={class:"hand-statistic-tank-select__count"},Oe={key:0,class:"hand-statistic-tank-select__list",style:{display:"flex","align-items":"center","justify-content":"center"}},Ie={key:1,class:"hand-statistic-tank-select__list"},We=["onClick","onKeyup"],Ee={class:"hand-statistic-tank-select__item-details"},He={class:"hand-statistic-tank-select__item-props"},je={key:2,class:"hand-statistic-tank-select__list",style:{display:"flex","align-items":"center","justify-content":"center"}},Ne={class:"hand-statistic-tank-select__controls"},ze={class:"hand-statistic-tank-select__controls-row"},qe=j({__name:"HandStatisticTankSelect",props:{items:{type:Object,default:()=>({}),required:!0},exclude:{type:Array,default:()=>[],required:!1}},emits:["select","cancel"],setup(l,{emit:c}){const a=O(),v=l,n=mt(),i=q(()=>n.isMobile),w=q(()=>Object.values(v.items).sort((u,k)=>k.tier-u.tier).filter(u=>[!u.name.startsWith("#"),!v.exclude.includes(u.tank_id),m.tiers.length?m.tiers.includes(u.tier):!0,m.types.length?m.types.includes(u.type):!0,m.nations.length?m.nations.includes(u.nation):!0].every(k=>k))),$=()=>({tiers:[],types:[],nations:[]}),m=A($()),e=q(()=>!Jt($(),m)),f=q(()=>m.tiers.length===0&&m.types.length===0&&m.nations.length===0),d=c;function b(u){let k="standard";return u.is_premium&&(k="premium"),u.is_collectible&&(k="collectible"),k}async function y(u,k){var T,g;d("select",u),await Ht(),(g=(T=a.value)==null?void 0:T[k+1])==null||g.focus()}function D(u){return v.exclude.includes(u.tank_id)}function R(){Object.assign(m,$())}return(u,k)=>{const T=Zt,g=Ve,h=Ce,I=G,K=Q,et=ct,at=gt,st=tt,nt=ut;return V(),B("div",De,[t("div",Be,[t("div",Se,[t("div",Pe,[s(T,{modelValue:_(m).tiers,"onUpdate:modelValue":k[0]||(k[0]=C=>_(m).tiers=C),"no-wrap":""},null,8,["modelValue"])]),t("div",xe,[s(g,{modelValue:_(m).nations,"onUpdate:modelValue":k[1]||(k[1]=C=>_(m).nations=C),"no-wrap":""},null,8,["modelValue"])]),t("div",Re,[s(h,{modelValue:_(m).types,"onUpdate:modelValue":k[2]||(k[2]=C=>_(m).types=C),"no-wrap":""},null,8,["modelValue"])]),t("div",Ue,[s(K,{title:"Сброс фильтров",disabled:!_(e),onClick:R},{before:p(()=>[s(I,{name:"close"})]),default:p(()=>[_(i)?N("",!0):(V(),B(H,{key:0},[S(" Сброс ")],64))]),_:1},8,["disabled"])])]),t("div",Me," Всего - "+x(Object.keys(v.items).length),1),_(f)?(V(),B("div",Oe," Выберите что-нибудь в фильтре... ")):_(w).length?(V(),B("div",Ie,[(V(!0),B(H,null,dt(_(w),(C,L)=>(V(),B("div",{key:C.tank_id,ref_for:!0,ref_key:"itemsRef",ref:a,role:"button","aria-pressed":"false",class:J(["hand-statistic-tank-select__item",[D(C)?"hand-statistic-tank-select__item--excluded":""]]),tabindex:"0",onClick:it=>y(C,L),onKeyup:F(it=>y(C,L),["enter"])},[s(et,{class:"hand-statistic-tank-select__item-img",alt:C.name,src:C.images.preview},null,8,["alt","src"]),t("div",Ee,[t("div",{class:J(["hand-statistic-tank-select__item-name",`hand-statistic-tank-select__item-name--${b(C)}`])},x(C.name),3),t("div",He,[s(at,{size:"18",nation:C.nation},null,8,["nation"]),s(st,{size:"24",type:C.type},null,8,["type"]),s(nt,{tier:C.tier},null,8,["tier"])])])],42,We))),128))])):(V(),B("div",je," Ничего не найдено... "))]),t("div",Ne,[k[5]||(k[5]=t("div",{class:"hand-statistic-tank-select__controls-row"},null,-1)),t("div",ze,[s(K,{onClick:k[3]||(k[3]=C=>d("cancel"))},{default:p(()=>k[4]||(k[4]=[S(" Закрыть ")])),_:1})])])])}}}),Ke={class:"hand-statistic-tank-edit"},Fe={class:"hand-statistic-tank-edit__body"},Xe={class:"hand-statistic-tank-edit__params"},Ae={class:"hand-statistic-tank-edit__params-item"},Ge={class:"hand-statistic-tank-edit__params-item"},Le={class:"hand-statistic-tank-edit__params"},Ye={class:"hand-statistic-tank-edit__params-item"},Ze={class:"hand-statistic-tank-edit__params-item"},Je={class:"hand-statistic-tank-edit__params"},Qe={class:"hand-statistic-tank-edit__params-item"},ta={class:"hand-statistic-tank-edit__params-item"},ea={class:"hand-statistic-tank-edit__params-item"},aa={class:"hand-statistic-tank-edit__controls"},sa={class:"hand-statistic-tank-edit__controls-row"},na=j({__name:"HandStatisticTankEdit",props:{modelValue:{required:!0,default:()=>({})},modelModifiers:{}},emits:ot(["close","save"],["update:modelValue"]),setup(l,{emit:c}){const a=rt(l,"modelValue"),v=A({isWin:!0}),n=A({damage_dealt:0,losses:0,wins:0});X(()=>[a.value.stat],()=>{const{losses:m,wins:e}=a.value.stat;a.value.stat.battles=m+e,a.value.stat.winRate=W.winRate(a.value.stat),a.value.stat.damagePerBattle=W.damagePerBattle(a.value.stat)},{deep:!0});const i=c;function w(){i("close")}function $(){v.isWin?n.wins+=1:n.losses+=1,a.value.lastUpdateTime=Date.now(),a.value.stat=W.sum(a.value.stat,{...n,battles:n.losses+n.wins}),i("save",a.value)}return(m,e)=>{const f=wt,d=_t,b=G,y=Q;return V(),B("div",Ke,[t("div",Fe,[t("div",Xe,[e[7]||(e[7]=t("div",{class:"hand-statistic-tank-edit__params-title"}," Информация ",-1)),t("div",Ae,[e[5]||(e[5]=t("span",{class:"hand-statistic-tank-edit__params-item-title"}," Название танка: ",-1)),S(" "+x(a.value.name),1)]),t("div",Ge,[e[6]||(e[6]=t("span",{class:"hand-statistic-tank-edit__params-item-title"}," Дата обновления: ",-1)),S(" "+x(m.$formatter.date.toDateTime(a.value.lastUpdateTime)||"---"),1)])]),t("div",Le,[e[11]||(e[11]=t("div",{class:"hand-statistic-tank-edit__params-title"}," Показатели за бой ",-1)),t("div",Ye,[e[8]||(e[8]=t("span",{class:"hand-statistic-tank-edit__params-item-title"}," Урон: ",-1)),s(f,{modelValue:_(n).damage_dealt,"onUpdate:modelValue":e[0]||(e[0]=D=>_(n).damage_dealt=D),width:"100px",min:"0",onKeyup:F($,["enter"])},null,8,["modelValue"])]),t("div",Ze,[e[10]||(e[10]=t("span",{class:"hand-statistic-tank-edit__params-item-title"}," Результат: ",-1)),s(d,{modelValue:_(v).isWin,"onUpdate:modelValue":e[1]||(e[1]=D=>_(v).isWin=D)},{default:p(()=>e[9]||(e[9]=[S(" Победа ")])),_:1},8,["modelValue"])])]),t("div",Je,[e[15]||(e[15]=t("div",{class:"hand-statistic-tank-edit__params-title"}," Суммарные показатели ",-1)),t("div",Qe,[e[12]||(e[12]=t("span",{class:"hand-statistic-tank-edit__params-item-title"}," Урон: ",-1)),s(f,{modelValue:a.value.stat.damage_dealt,"onUpdate:modelValue":e[2]||(e[2]=D=>a.value.stat.damage_dealt=D),width:"100px",min:"0",onKeyup:F($,["enter"])},null,8,["modelValue"])]),t("div",ta,[e[13]||(e[13]=t("span",{class:"hand-statistic-tank-edit__params-item-title"}," Побед: ",-1)),s(f,{modelValue:a.value.stat.wins,"onUpdate:modelValue":e[3]||(e[3]=D=>a.value.stat.wins=D),width:"100px",min:"0",onKeyup:F($,["enter"])},null,8,["modelValue"])]),t("div",ea,[e[14]||(e[14]=t("span",{class:"hand-statistic-tank-edit__params-item-title"}," Пораж.: ",-1)),s(f,{modelValue:a.value.stat.losses,"onUpdate:modelValue":e[4]||(e[4]=D=>a.value.stat.losses=D),width:"100px",min:"0",onKeyup:F($,["enter"])},null,8,["modelValue"])])])]),t("div",aa,[e[18]||(e[18]=t("div",{class:"hand-statistic-tank-edit__controls-row"},null,-1)),t("div",sa,[s(y,{onClick:w},{before:p(()=>[s(b,{name:"close"})]),default:p(()=>[e[16]||(e[16]=S(" Отмена "))]),_:1}),s(y,{onClick:$},{before:p(()=>[s(b,{name:"content-save"})]),default:p(()=>[e[17]||(e[17]=S(" Сохранить "))]),_:1})])])])}}});function ia(l){return jt(()=>{var a;const c=(a=yt())==null?void 0:a.appContext.app.$nuxt;return c?c.runWithContext(l):l()})}const la={class:"hand-statistic-page__settings"},oa={key:0},ra={class:"hand-statistic-page__params"},da={class:"hand-statistic-page__params-item"},ca={class:"hand-statistic-page__params-item-value"},ua={class:"hand-statistic-page__params-item"},ma={class:"hand-statistic-page__params-item-value"},_a={class:"hand-statistic-page__params-item"},pa={class:"hand-statistic-page__params-item-value link",style:{"font-weight":"500"}},fa={style:{display:"flex","justify-content":"space-between"}},ka={style:{display:"flex","justify-content":"space-between"}},ha={style:{display:"flex",gap:"10px","text-align":"center"}},La=j({__name:"index",async setup(l){let c,a;const{$formatter:v,$indexedDB:n}=lt();Nt({title:[v.route.getTitle("hand-statistic")].join(" - ")});const i=O(),w=O(),$=O(),m=O(),e=mt(),f=q(()=>e.isMobile),d=O([{key:"battles",label:v.stat.accountProp("battles"),value:0},{key:"winRate",label:v.stat.accountProp("winRate"),value:0},{key:"damagePerBattle",label:v.stat.accountProp("damagePerBattle"),value:0}]),b=Qt(),y=A({tanks:[],currentTank:null}),D=ht("handleStatMetricsOpacity"),R=ht("handleStatMetricsWidth"),u=A({metricsOpacity:+D.value,metricsWidth:R.value});X(()=>u.metricsOpacity,()=>{D.value=u.metricsOpacity}),X(()=>u.metricsWidth,()=>{R.value=u.metricsWidth}),X(()=>y.tanks,()=>{k()},{deep:!0,immediate:!0}),[c,a]=ia(async()=>ae("get-tanks-vehicles",async()=>await b.getTanksVehicles().then(()=>!0))),await c,a(),zt(async()=>{const o=await n.handStatistic.getAll();o==null||o.forEach(r=>{var M;const P=(M=b.vehicles)==null?void 0:M[r.id];P&&y.tanks.push(g({tank:P,stat:r.data,timestamp:r.timestamp}))})});function k(){var r;let o={};y.tanks.forEach(P=>{o=W.sum(o,P.stat)}),(r=d.value)==null||r.forEach(P=>{P.key==="winRate"?P.value=W.winRate(o):P.key==="damagePerBattle"?P.value=W.damagePerBattle(o):P.value=o.battles??0})}function T(o){return{...o,battles:(o.losses||0)+(o.wins||0),winRate:W.winRate(o),damagePerBattle:W.damagePerBattle(o)}}function g(o){const r={...o.tank,stat:o.stat};return r.stat=T(r.stat),r.lastUpdateTime=o.timestamp,r}function h(){var o;(o=i.value)==null||o.doOpen()}function I(){var o;(o=$.value)==null||o.doOpen()}function K(){return{battles:0,damage_dealt:0,losses:0,wins:0,winRate:0,damagePerBattle:0}}async function et(o){y.tanks.some(r=>r.tank_id===o.tank_id)||(await n.handStatistic.set(o.tank_id,K()),y.tanks=[{...o,lastUpdateTime:Date.now(),stat:K()},...y.tanks])}function at(){var o;(o=i.value)==null||o.doClose()}function st(o){var r;y.currentTank=vt(o),(r=w.value)==null||r.doOpen()}async function nt(){var o;await((o=w.value)==null?void 0:o.doClose()),y.currentTank=null}async function C(){var P;if(!y.currentTank)return;const o=vt(y.currentTank);o.stat=T(o.stat);const r=y.tanks.findIndex(M=>M.tank_id===o.tank_id);r>=0&&y.tanks.splice(r,1,o),await n.handStatistic.set(o.tank_id,o.stat),await((P=w.value)==null?void 0:P.doClose()),y.currentTank=null}function L(){var o;(o=m.value)==null||o.doOpen()}function it(){var o;(o=m.value)==null||o.doClose()}async function $t(){var o;y.tanks.length&&(await n.handStatistic.clear(),y.tanks=[]),(o=m.value)==null||o.doClose()}function Tt(){Kt("/hand-statistic/widget",{open:{target:"_blank"}})}return(o,r)=>{const P=xt,M=G,E=Q,pt=Ft,Vt=Te,Ct=Gt,Dt=wt,Bt=Lt,Y=Yt,St=qe,Pt=na;return V(),Z(te,{class:"hand-statistic-page"},{default:p(()=>[s(pt,{title:"Средние показатели"},{default:p(()=>[s(P,{modelValue:_(d),"onUpdate:modelValue":r[0]||(r[0]=U=>qt(d)?d.value=U:null),opacity:_(u).metricsOpacity,width:_(u).metricsWidth,class:"hand-statistic-page__average-list"},null,8,["modelValue","opacity","width"]),t("div",la,[s(E,{title:"Добавить танк",onClick:h},{before:p(()=>[s(M,{name:"add"})]),default:p(()=>[_(f)?N("",!0):(V(),B(H,{key:0},[S(" Добавить танк ")],64))]),_:1}),s(E,{title:"Сброс",onClick:L},{before:p(()=>[s(M,{name:"refresh"})]),default:p(()=>[_(f)?N("",!0):(V(),B(H,{key:0},[S(" Сброс ")],64))]),_:1}),s(E,{title:"Настройки",onClick:I},{before:p(()=>[s(M,{name:"tune"})]),default:p(()=>[_(f)?N("",!0):(V(),B(H,{key:0},[S(" Настройки ")],64))]),_:1}),s(E,{title:"К виджету",onClick:Tt},{before:p(()=>[s(M,{name:"open-in-new"})]),default:p(()=>[_(f)?N("",!0):(V(),B("span",oa," К виджету "))]),_:1})])]),_:1}),s(pt,{title:"Техника"},{default:p(()=>[s(Vt,{items:_(y).tanks,onPressEdit:st},null,8,["items"])]),_:1}),s(Y,{ref_key:"settingsDialogRef",ref:$,width:"480px",title:"Настройки"},{footer:p(()=>[t("div",fa,[r[9]||(r[9]=t("span",null,null,-1)),s(E,{onClick:r[3]||(r[3]=U=>{var ft;return(ft=_($))==null?void 0:ft.doClose()})},{default:p(()=>r[8]||(r[8]=[S(" Закрыть ")])),_:1})])]),default:p(()=>[t("div",ra,[t("div",da,[r[5]||(r[5]=t("div",{class:"hand-statistic-page__params-item-title"}," Прозрачность фона виджета ",-1)),t("div",ca,[s(Ct,{modelValue:_(u).metricsOpacity,"onUpdate:modelValue":r[1]||(r[1]=U=>_(u).metricsOpacity=U),width:"200px",min:0,max:1,step:.1},null,8,["modelValue"]),S(" "+x(_(v).number.toPercent((_(u).metricsOpacity||0)*100)),1)])]),t("div",ua,[r[6]||(r[6]=t("div",{class:"hand-statistic-page__params-item-title"}," Ширина виджета (200px - 1880px) ",-1)),t("div",ma,[s(Dt,{modelValue:_(u).metricsWidth,"onUpdate:modelValue":r[2]||(r[2]=U=>_(u).metricsWidth=U),width:"80px",min:0,max:1880,step:10},null,8,["modelValue"])])]),t("div",_a,[r[7]||(r[7]=t("div",{class:"hand-statistic-page__params-item-title"}," Выбор темы интерфейса ",-1)),t("label",pa,[s(Bt,{"is-large":""})])])])]),_:1},512),s(Y,{ref_key:"selectTankDialogRef",ref:i,width:"640px","no-scroll":"",title:"Добавление танка"},{default:p(()=>[_(b).vehicles?(V(),Z(St,{key:0,items:_(b).vehicles,exclude:_(y).tanks.map(U=>U.tank_id),onSelect:et,onCancel:at},null,8,["items","exclude"])):N("",!0)]),_:1},512),s(Y,{ref_key:"editTankDialogRef",ref:w,width:"480px","no-scroll":"",title:"Изменение показателей"},{default:p(()=>[s(Pt,{modelValue:_(y).currentTank,"onUpdate:modelValue":r[4]||(r[4]=U=>_(y).currentTank=U),onClose:nt,onSave:C},null,8,["modelValue"])]),_:1},512),s(Y,{ref_key:"confirmResetDialogRef",ref:m,width:"480px",title:"Сброс сессии"},{footer:p(()=>[t("div",ka,[r[12]||(r[12]=t("span",null,null,-1)),t("div",ha,[s(E,{width:"80px",align:"center",onClick:$t},{default:p(()=>r[10]||(r[10]=[S(" Да ")])),_:1}),s(E,{width:"80px",align:"center",onClick:it},{default:p(()=>r[11]||(r[11]=[S(" Нет ")])),_:1})])])]),default:p(()=>[r[13]||(r[13]=t("div",{class:"content-area"},[t("p",null," Вы уверены? Текущий прогресс будет утерян. ")],-1))]),_:1},512)]),_:1})}}});export{La as default};
