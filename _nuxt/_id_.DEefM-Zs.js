import{_ as lt}from"./CImage.vue.CVGEczTm.js";import{f as W,o as u,c as y,a as n,F as R,A as L,t as d,d as T,m as E,s as j,n as P,i as G,q as z,k as o,b as k,C as Q,w as D,j as F,r as mt,y as dt,g as gt,h as pt}from"./entry.CiLr91Wg.js";import{_ as et}from"./CSelect.vue.E537XfLD.js";import{u as J}from"./disableScroll.DUPiWzNJ.js";import{a as N}from"./request.DLwZlOwo.js";import{_ as ft}from"./CInput.vue.DjaOH7I-.js";import{_ as Z}from"./ContentLoader.vue.BtDSbBtQ.js";import{_ as ht}from"./WinRate.vue.CKMIcykD.js";import{_ as yt}from"./RoleIcon.vue.CQbH_X34.js";import{_ as bt}from"./nuxt-link.BEP6SH5y.js";import{n as rt}from"./notEmpty.BxBPJGBn.js";import{s as K}from"./index.DTksAsnL.js";import{_ as vt,b as $t,g as Tt}from"./CDialog.vue.CAe_H11n.js";import{d as wt,t as St}from"./debounce.B98QxhRz.js";import{_ as kt}from"./CTable.vue.qwsvrkI-.js";import{e as Ct,i as It,_ as xt}from"./isArrayLike.TIPxVOhQ.js";import{_ as At}from"./CTabs.vue.D_odVFc3.js";import{_ as Ot}from"./PageContent.vue.CLEy-xld.js";import"./image-broken.BY5yfqBl.js";import"./nuxt-icon.D6encLCw.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./ContentBox.vue.CXIsIDnv.js";import"./index.CCZU5IUk.js";import"./user.DP2m5fhC.js";import"./index.DckVOxso.js";import"./leader.BewdLDxQ.js";import"./client-only.BKegTxbq.js";import"./dark-mode.DXWXGq7Q.js";import"./light-mode.3ww4vHhL.js";const Rt={key:0,class:"tournaments-stages"},Et={class:"tournaments-stages__inner"},Gt={class:"tournaments-stages__list"},qt={class:"tournaments-stages__title"},Dt={class:"tournaments-stages__params"},Lt={class:"tournaments-stages__param"},Nt=n("span",{class:"tournaments-stages__param-title"}," Дата ",-1),Vt={class:"tournaments-stages__param"},Mt=n("span",{class:"tournaments-stages__param-title"}," Система ",-1),jt={class:"tournaments-stages__param"},Ft=n("span",{class:"tournaments-stages__param-title"}," Уровень ",-1),Pt={class:"tournaments-stages__param"},Bt=n("span",{class:"tournaments-stages__param-title"}," Условие ",-1),Ut=W({__name:"TournamentsStages",props:{stages:{type:Array,default:()=>[]}},setup(_){function s(m){const t=j.encyclopedia.tier(m.min_tier),e=j.encyclopedia.tier(m.max_tier);return t===e?t:`${t} - ${e}`}return(m,t)=>_.stages.length?(u(),y("div",Rt,[n("div",Et,[n("ul",Gt,[(u(!0),y(R,null,L(_.stages,e=>(u(),y("li",{key:e.stage_id,class:"tournaments-stages__stage"},[n("div",qt,d(e.title),1),n("div",Dt,[n("div",Lt,[Nt,e.start_at?(u(),y(R,{key:0},[T(d(m.$formatter.date.toDateTime(e.start_at*1e3)),1)],64)):(u(),y(R,{key:1},[T(" --- ")],64))]),n("div",Vt,[Mt,T(" "+d(m.$formatter.tournament.stageType(e.type)),1)]),n("div",jt,[Ft,T(" "+d(s(e)),1)]),n("div",Pt,[Bt,T(" до "+d(e.victory_limit)+" побед ",1)])])]))),128))])])])):E("",!0)}}),Ht={class:"tournaments-matches"},Wt={class:"tournaments-matches__filters"},Xt={class:"tournaments-matches__filters-item"},Yt={class:"tournaments-matches__filters-item"},zt={class:"tournaments-matches__list"},Jt={class:"tournaments-matches__round"},Kt={class:"tournaments-matches__teams"},Qt={class:"tournaments-matches__score"},Zt={class:"tournaments-matches__date"},te=W({__name:"TournamentsMatches",props:{stages:{type:Array,default:()=>[],required:!0},tournamentId:{type:Object,default:()=>({}),required:!0}},setup(_){const s=_,m=J(),t=P({loading:0,matches:[],selectedStage:null,selectedGroup:null}),e=P({page:1,pageSize:25,total:0}),$=G(()=>s.stages.map(i=>({label:i.title,value:i}))),w=G(()=>t.selectedStage?t.selectedStage.groups.map(i=>({label:`Группа ${i.group_order}`,value:i})):[]);z(()=>{var i;t.selectedStage=O(),t.selectedGroup=((i=t.selectedStage)==null?void 0:i.groups[0])??null,p()});function O(){const i=s.stages.findLast(v=>v.state==="complete");return s.stages.findLast(v=>v.state==="schedule_ready")??i??s.stages[0]}function p(){!t.selectedStage||!t.selectedGroup||b(s.tournamentId,t.selectedStage.stage_id,t.selectedGroup.group_id)}async function b(i,l,v){t.loading++;try{const{data:f,meta:h}=await N.tournaments.getMatches({tournament_id:i,stage_id:l,group_id:v,limit:e.pageSize,page_no:e.page});e.total=h.total,t.matches=f}catch(f){m.add({type:"error",title:"Получение списка матчей",message:f instanceof Error?f.message:"Неизвестная ошибка"}),console.error(f)}t.loading--}function I(i){t.selectedStage=i,t.selectedGroup=i.groups[0],e.page=1,p()}function x(i){t.selectedGroup=i,e.page=1,p()}return(i,l)=>{var f;const v=et;return u(),y("div",Ht,[n("div",Wt,[n("div",Xt,[T(" Этап ("+d(o(e).total??0)+") ",1),k(v,{value:o(t).selectedStage,"id-key":"stage_id",style:{width:"250px"},options:o($),onChange:I},null,8,["value","options"])]),n("div",Yt,[T(" Группа ("+d(((f=o(t).selectedStage)==null?void 0:f.groups.length)??0)+") ",1),k(v,{value:o(t).selectedGroup,"id-key":"group_id",style:{width:"170px"},options:o(w),onChange:x},null,8,["value","options"])])]),n("div",zt,[(u(!0),y(R,null,L(o(t).matches,h=>(u(),y("div",{key:h.id,class:"tournaments-matches__match"},[n("div",Jt," round: "+d(h.round),1),n("div",Kt,[(u(),y(R,null,L([1,2],A=>n("div",{key:A,class:Q(["tournaments-matches__team",["tournaments-matches__team--"]])},[T(d(h[`team_${A}_id`])+" ",1),n("span",Qt,d(h[`team_${A}_score`]||0),1)])),64))]),n("span",Zt,d(i.$formatter.date.toDateTime(h.start_time*1e3)),1)]))),128))])])}}}),ee={class:"tournament-team"},ae={class:"tournament-team__inner"},ne={class:"tournament-team__props-list"},se={class:"tournament-team__props"},oe=n("span",{class:"tournament-team__props-title"},"Статус",-1),re={class:"tournament-team__props"},ie=n("span",{class:"tournament-team__props-title"},"Ср. побед",-1),le={class:"tournament-team__props"},ce=n("span",{class:"tournament-team__props-title"},"Ср. боёв",-1),ue={class:"tournament-team__player-list"},_e={key:0,class:"tournament-team__details"},me={class:"tournament-team__player-name"},de={class:"tournament-team__player-stat"},ge={class:"tournament-team__stat-item"},pe={key:1,class:"tournament-team__empty"},fe=W({__name:"TournamentTeam",props:{tournament:{type:Object,default:()=>({}),required:!0},team:{type:Object,default:()=>({}),required:!0}},setup(_){const s=_,m=J(),t=P({loading:0,players:[],statisticsAll:null});z(()=>{const p=s.tournament.max_players_count;t.players=Array(p).fill(w({})),O()});async function e(p){t.loading++;try{const{data:b}=await N.clan.getAccountInfo({extra:"clan",account_id:p.join(",")});return Object.values(b).filter(rt)}catch(b){return m.add({type:"error",title:"Поучение списка клановых аккаунтов",message:b instanceof Error?b.message:"Неизвестная ошибка"}),console.error(b),[]}finally{t.loading--}}async function $(p){t.loading++;try{const{data:b}=await N.account.getInfo({extra:"statistics.rating",account_id:p.join(",")});return Object.values(b).filter(rt)}catch(b){return m.add({type:"error",title:"Поучение списка аккаунтов",message:b instanceof Error?b.message:"Неизвестная ошибка"}),console.error(b),[]}finally{t.loading--}}function w(p){var x,i,l,v,f,h,A,g;const b=(x=p.account)==null?void 0:x.statistics.all,I=(i=p.account)==null?void 0:i.statistics.rating;return{id:((l=p.player)==null?void 0:l.account_id)??0,name:((v=p.player)==null?void 0:v.name)??"",isOwner:((f=p.player)==null?void 0:f.role)==="owner",clan:(h=p.clanAccount)!=null&&h.clan?{id:p.clanAccount.clan_id,tag:((A=p.clanAccount.clan)==null?void 0:A.tag)??"",name:((g=p.clanAccount.clan)==null?void 0:g.name)??""}:null,statistic:{all:b?K.accountAll(b):null,rating:I?K.accountRating(I):null}}}async function O(){const p=s.team.players.map(l=>l.account_id),[b,I]=await Promise.all([$(p),e(p)]),x=b.reduce((l,v,f)=>f===0?b[0].statistics:K.sumFull(l,v.statistics),{});t.statisticsAll=K.accountAll(x.all,b.length);const i=s.tournament.max_players_count;t.players=Array(i).fill({}).map((l,v)=>{const f=s.team.players[v],h=b.find(g=>g.account_id===(f==null?void 0:f.account_id)),A=I.find(g=>g.account_id===(f==null?void 0:f.account_id));return w({player:f,account:h,clanAccount:A})}).sort(l=>l.isOwner?1:0)}return(p,b)=>{var v,f;const I=ht,x=yt,i=bt,l=Z;return u(),y("div",ee,[n("div",ae,[n("div",ne,[n("div",se,[oe,T(" "+d(p.$formatter.tournament.teamStatusDetails(_.team.status)),1)]),n("div",re,[ie,k(I,{"model-value":((v=o(t).statisticsAll)==null?void 0:v.winRate)||0},null,8,["model-value"])]),n("div",le,[ce,T(" "+d(p.$formatter.number.toInteger(((f=o(t).statisticsAll)==null?void 0:f.battles)||0)),1)])]),n("ul",ue,[(u(!0),y(R,null,L(o(t).players,(h,A)=>{var g;return u(),y("li",{key:h.id||A,class:"tournament-team__player"},[k(x,{width:"18",height:"18",class:"tournament-team__player-role",role:h.isOwner?"commander":"private"},null,8,["role"]),h.id?(u(),y("div",_e,[n("div",me,[k(i,{class:"tournament-team__player-link link",to:{name:"account-id",params:{id:h.id}}},{default:D(()=>[T(d(h.name),1)]),_:2},1032,["to"]),h.clan?(u(),F(i,{key:0,class:"tournament-team__player-link link",to:{name:"clan-id",params:{id:h.clan.id}}},{default:D(()=>{var S;return[T(d(`[${(S=h.clan)==null?void 0:S.tag}]`),1)]}),_:2},1032,["to"])):E("",!0)]),n("span",de,[h.statistic.all?(u(),F(I,{key:0,class:"tournament-team__stat-item","model-value":h.statistic.all.winRate},null,8,["model-value"])):E("",!0),n("span",ge,d((g=h.statistic.all)==null?void 0:g.battles),1)])])):(u(),y("span",pe," Место свободно "))])}),128))]),k(l,{"backdrop-light":"",loading:o(t).loading>0},null,8,["loading"])])])}}}),he={class:"tournaments-teams"},ye={class:"tournaments-teams__filters"},be={class:"tournaments-teams__filters-item"},ve={class:"tournaments-teams__filters-item"},$e={class:"tournaments-teams__count"},Te=n("div",{class:"tournaments-teams__count-title"}," Кол-во: ",-1),we={class:"tournaments-teams__list"},Se=["onClick"],ke={class:"tournaments-teams__team-description"},Ce={class:"tournaments-teams__team-name"},Ie={class:"tournaments-teams__team-owner"},xe={class:"tournaments-teams__team-owner-text"},Ae={class:"tournaments-teams__team-count"},Oe=W({__name:"TournamentsTeams",props:{tournament:{type:Object,default:()=>({}),required:!0}},setup(_){const s=[null,"confirmed","forming","disqualified"],m=_,t=J(),e=mt(null),$=P({loading:0,teams:[],currentTeam:null}),w=P({page:1,total:0,pageSize:50}),O=P({status:"confirmed",search:""}),p=s.map(g=>({label:g?j.tournament.teamStatus(g):"Все",value:g})),b=G(()=>w.total>w.page*w.pageSize);z(()=>{window.addEventListener("scroll",v),i()}),dt(()=>{window.removeEventListener("scroll",v)});function I(g){var S;return(S=g.players.find(q=>q.role==="owner"))==null?void 0:S.name}const x=wt(i,1e3,{leading:!0});async function i(){await l()}async function l(){$.loading++;try{const{data:g,meta:S}=await N.tournaments.getTeams({tournament_id:m.tournament.tournament_id,limit:w.pageSize,page_no:w.page,...O});w.total=S.total,$.teams.push(...g)}catch(g){t.add({type:"error",title:"Получение списка команд",message:g instanceof Error?g.message:"Неизвестная ошибка"}),console.error(g)}$.loading--}function v(){const{scrollTop:g,scrollHeight:S,clientHeight:q}=document.documentElement;$.loading===0&&b.value&&b.value&&g+q>=S-100&&(w.page+=1,l())}function f(){w.page=1,$.teams=[],i()}async function h(g=""){O.search=g=g.trim(),!(g.length<2&&g!=="")&&(w.page=1,$.teams=[],await x())}function A(g){var S;$.currentTeam=g,(S=e.value)==null||S.doOpen()}return(g,S)=>{var r;const q=et,X=ft,B=Z,H=fe,a=vt;return u(),y("div",he,[n("div",ye,[n("div",be,[T(" Статус "),k(q,{modelValue:o(O).status,"onUpdate:modelValue":S[0]||(S[0]=c=>o(O).status=c),style:{width:"220px"},options:o(p),onChange:f},null,8,["modelValue","options"])]),n("div",ve,[T(" Поиск "),k(X,{modelValue:o(O).search,"onUpdate:modelValue":S[1]||(S[1]=c=>o(O).search=c),type:"search",placeholder:"Введите название команды",style:{width:"300px"},onInput:h},null,8,["modelValue"])])]),n("div",$e,[Te,T(" "+d(o(w).total||0),1)]),n("div",we,[(u(!0),y(R,null,L(o($).teams,c=>(u(),y("button",{key:c.team_id,class:"tournaments-teams__team",onClick:C=>A(c)},[n("span",{class:Q(["tournaments-teams__status",[c.status?`tournaments-teams__status--${c.status}`:""]])},null,2),n("span",ke,[n("span",Ce,d(c.title),1),n("span",Ie,[n("span",xe,d(I(c)),1)])]),n("span",Ae,d(c.players.length)+" / "+d(_.tournament.max_players_count),1)],8,Se))),128)),k(B,{loading:o($).loading>0},null,8,["loading"])]),k(a,{ref_key:"teamDialogRef",ref:e,width:"500px","append-to-body":"",title:(r=o($).currentTeam)==null?void 0:r.title},{default:D(()=>[o($).currentTeam?(u(),F(H,{key:0,tournament:_.tournament,team:o($).currentTeam},null,8,["tournament","team"])):E("",!0)]),_:1},8,["title"])])}}});function Re(_,s,m){var t=-1,e=_.length;s<0&&(s=-s>e?0:e+s),m=m>e?e:m,m<0&&(m+=e),e=s>m?0:m-s>>>0,s>>>=0;for(var $=Array(e);++t<e;)$[t]=_[t+s];return $}var Ee=Re,Ge=Ct,qe=It,De=xt,Le=$t;function Ne(_,s,m){if(!Le(m))return!1;var t=typeof s;return(t=="number"?qe(m)&&De(s,m.length):t=="string"&&s in m)?Ge(m[s],_):!1}var Ve=Ne,Me=St,it=1/0,je=17976931348623157e292;function Fe(_){if(!_)return _===0?_:0;if(_=Me(_),_===it||_===-it){var s=_<0?-1:1;return s*je}return _===_?_:0}var Pe=Fe,Be=Pe;function Ue(_){var s=Be(_),m=s%1;return s===s?m?s-m:s:0}var He=Ue,We=Ee,Xe=Ve,Ye=He,ze=Math.ceil,Je=Math.max;function Ke(_,s,m){(m?Xe(_,s,m):s===void 0)?s=1:s=Je(Ye(s),0);var t=_==null?0:_.length;if(!t||s<1)return[];for(var e=0,$=0,w=Array(ze(t/s));e<t;)w[$++]=We(_,e,e+=s);return w}var Qe=Ke;const Ze=Tt(Qe),ta={class:"tournaments-tables"},ea={class:"tournaments-tables__filters"},aa={class:"tournaments-tables__filters-item"},na={class:"tournaments-tables__filters-item"},sa={class:"tournaments-tables__stage-state"},oa=n("span",{class:"tournaments-tables__stage-state-label"}," Состояние этапа ",-1),ra={key:0,class:"tournaments-tables__table-scroll"},ia={key:0,class:"tournaments-tables__table-round-title"},la=["onClick"],ca={class:"tournaments-tables__table-team-details"},ua={class:"tournaments-tables__table-team-title"},_a={class:"tournaments-tables__table-team-score"},ma={class:"tournaments-tables__table-team-details"},da={class:"tournaments-tables__table-team-title"},ga=W({__name:"TournamentsTables",props:{tournamentId:{type:[String,Number],default:"",required:!0},stages:{type:Array,default:()=>[],required:!0}},setup(_){const s=_,m=J(),t=P({loading:0,standings:[],tables:[],matches:[],selectedStage:null,selectedGroup:null,tableOne:[],tableTwo:[],highlightTeamId:null,total:0,standingsTotal:0}),e=G(()=>t.tables.filter(a=>{var r;return a.group_id===((r=t.selectedGroup)==null?void 0:r.group_id)})),$=G(()=>e.value.map(a=>{const r=t.standings.find(c=>a.team_id===c.team_id&&c.group_id===a.group_id);return{...a,wins:(r==null?void 0:r.wins)??0,draws:(r==null?void 0:r.draws)??0,losses:(r==null?void 0:r.losses)??0}})),w=[{key:"position",label:"#",width:40,align:"center"},{key:"name",label:"Команда"},{key:"matches_played",label:"Бои",width:60,align:"center"},{key:"wins",label:"Победы",width:60,align:"center"},{key:"draws",label:"Ничьи",width:60,align:"center"},{key:"losses",label:"Пораж.",width:60,align:"center"},{key:"team_points",label:"Очки",width:60,align:"center"}],O=G(()=>s.stages.map(a=>({label:a.title,value:a,disabled:!["complete","schedule_ready"].includes(a.state)}))),p=G(()=>t.selectedStage?t.selectedStage.groups.map(a=>({label:`Группа ${a.group_order}`,value:a})):[]),b=G(()=>{var a;switch((a=t.selectedStage)==null?void 0:a.state){case"draft":return"Проект создан";case"groups_ready":return"Группы сформированы";case"schedule_ready":return"График построен";case"complete":return"Этап завершён";default:return"..."}});z(async()=>{var a;t.selectedStage=l(),t.selectedGroup=((a=t.selectedStage)==null?void 0:a.groups[0])??null,await v(),x()});function I(a){var c;const r=(c=t.selectedStage)==null?void 0:c.type;if(r==="SE"){if(a===1)return"Финал";if(a===2)return"Полуфинал";if(a===3)return"Четвертьфинал";if(a===-1)return"Матч за третье место"}if(r==="DE"){if(a===3)return"Верхняя сетка | Четвертьфинал";if(a===2)return"Верхняя сетка | Полуфинал";if(a===1)return"Верхняя сетка | Финал";if(a===0)return"Гранд-Финал";if(a===-1)return"Нижняя сетка | Финал";if(a===-2)return"Нижняя сетка | Полуфинал";if(a===-3)return"Нижняя сетка | Четвертьфинал"}return""}function x(){t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.matches.forEach(a=>{const r=t.tables.find(V=>V.team_id===a.team_1_id),c=t.tables.find(V=>V.team_id===a.team_2_id);if(!r||!c)return;const C={...a,teams:[r,c]};a.round===3&&t.tableOne[0].push(C),a.round===2&&t.tableOne[1].push(C),a.round===1&&t.tableOne[2].push(C),a.round===-3&&t.tableTwo[0].push(C),a.round===-2&&t.tableTwo[1].push(C),a.round===-1&&t.tableTwo[2].push(C),a.round===0&&t.tableTwo[3].push(C)})}function i(a,r){return r.team_id===a.winner_team_id}function l(){const a=s.stages.findLast(c=>c.state==="schedule_ready"),r=s.stages.findLast(c=>c.state==="complete");return a??r??s.stages[0]}async function v(){var c,C,V;const a=(c=t.selectedStage)==null?void 0:c.stage_id,r=(C=t.selectedGroup)==null?void 0:C.group_id;!a||!r||(await g({tournament_id:s.tournamentId,group_id:r,stage_id:a}),((V=t.selectedStage)==null?void 0:V.type)==="RR"?await h({tournament_id:s.tournamentId,team_id:e.value.map(tt=>tt.team_id).join(",")}):await f({tournament_id:s.tournamentId,group_id:r,stage_id:a}))}async function f(a){t.loading++;try{const{data:r}=await N.tournaments.getMatches({...a,limit:25});t.matches=r}catch(r){m.add({type:"error",title:"Получение матчей",message:r instanceof Error?r.message:"Неизвестная ошибка"}),console.error(r)}t.loading--}async function h(a){const r=Ze(String(a.team_id).split(","),10);for(const c of r)await A({...a,team_id:c.join(",")})}async function A(a){t.loading++;try{const{data:r,meta:c}=await N.tournaments.getStandings({...a,limit:25});t.standings.push(...r),t.standingsTotal=c.total}catch(r){m.add({type:"error",title:"Получение результатов команд",message:r instanceof Error?r.message:"Неизвестная ошибка"}),console.error(r)}t.loading--}async function g(a){let r=1;const c=25,C=async()=>{await S({...a,page_no:r,limit:c}),t.total>r*c&&(r++,await C())};await C()}async function S(a){t.loading++;try{const{data:r,meta:c}=await N.tournaments.getTables(a);t.tables.push(...r),t.total=c.total}catch(r){m.add({type:"error",title:"Получение турнирной сетки",message:r instanceof Error?r.message:"Неизвестная ошибка"}),console.error(r)}t.loading--}async function q(a){t.selectedStage=a,t.selectedGroup=a.groups[0],t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.standings=[],t.tables=[],t.matches=[],await v(),t.selectedStage.type!=="RR"&&x()}async function X(a){t.selectedGroup=a,t.selectedStage&&(t.selectedStage.type==="RR"?(t.standings=[],await h({tournament_id:s.tournamentId,team_id:e.value.map(r=>r.team_id).join(",")})):(t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.matches=[],await f({tournament_id:s.tournamentId,group_id:a.group_id,stage_id:t.selectedStage.stage_id}),x()))}function B(a){return`https://wotblitz-gc.gcdn.co/icons/clanEmblems1x/clan-icon-v2-${a}.png`}function H(a){t.highlightTeamId=a.team_id}return(a,r)=>{var at,nt;const c=et,C=lt,V=kt,tt=Z;return u(),y("div",ta,[n("div",ea,[n("div",aa,[T(" Этап ("+d(o(t).total??0)+") ",1),k(c,{"model-value":o(t).selectedStage,"id-key":"stage_id",style:{width:"250px"},options:o(O),disabled:!o(O).length,onChange:q},null,8,["model-value","options","disabled"])]),n("div",na,[T(" Группа ("+d(((at=o(t).selectedStage)==null?void 0:at.groups.length)??"---")+") ",1),k(c,{"model-value":o(t).selectedGroup,"id-key":"group_id",style:{width:"170px"},disabled:!o(p).length,options:o(p),onChange:X},null,8,["model-value","disabled","options"])])]),n("div",sa,[oa,T(" "+d(o(b)),1)]),((nt=o(t).selectedStage)==null?void 0:nt.type)!=="RR"?(u(),y("div",ra,[(u(!0),y(R,null,L([o(t).tableOne,o(t).tableTwo],(U,st)=>(u(),y("div",{key:st,class:Q(["tournaments-tables__table",[`tournaments-tables__table--${st?"bottom":"top"}`]])},[(u(!0),y(R,null,L(U,(ct,ut)=>(u(),y("div",{key:ut,class:"tournaments-tables__table-round"},[(u(!0),y(R,null,L(ct,(Y,_t)=>(u(),y("div",{key:Y.id,class:"tournaments-tables__table-battle"},[_t===0?(u(),y("div",ia,d(I(Y.round)),1)):E("",!0),(u(!0),y(R,null,L(Y.teams,(M,ot)=>(u(),y("button",{key:ot,class:Q(["tournaments-tables__table-team",[i(Y,M)?"tournaments-tables__table-team--is-winner":"",M.team_id===o(t).highlightTeamId?"tournaments-tables__table-team--is-highlight":""]]),onClick:Oa=>H(M)},[n("span",ca,[k(C,{class:"tournaments-tables__table-team-clan-emblem","data-text":M.clan_id??"No image",alt:"Эмблема клана",src:B(M.clan_emblem_preset_id)},null,8,["data-text","src"]),n("span",ua,[M.clan_label?(u(),y(R,{key:0},[T(" ["+d(M.clan_label)+"] ",1)],64)):E("",!0),T(" "+d(M.title),1)])]),n("span",_a,d(Y[`team_${ot+1}_score`]??"-"),1)],10,la))),128))]))),128))]))),128))],2))),128))])):(u(),F(V,{key:1,"no-wrap":"","scroll-auto-disabling":"","row-key":"account_id",height:"calc(100vh - 112px)",headers:w,data:o($)},{name:D(({row:U})=>[n("div",ma,[k(C,{class:"tournaments-tables__table-team-clan-emblem","data-text":U.clan_id??"No image",alt:"Эмблема клана",src:B(U.clan_emblem_preset_id)},null,8,["data-text","src"]),n("span",da,[U.clan_label?(u(),y(R,{key:0},[T(" ["+d(U.clan_label)+"] ",1)],64)):E("",!0),T(" "+d(U.title),1)])])]),_:1},8,["data"])),k(tt,{loading:o(t).loading>0},null,8,["loading"])])}}}),pa={key:0,class:"tournaments-info-page__inner"},fa={class:"tournaments-info-page__header"},ha={class:"tournaments-info-page__details"},ya={class:"tournaments-info-page__title"},ba={class:"tournaments-info-page__props"},va={class:"tournaments-info-page__prop"},$a={class:"tournaments-info-page__prop-title"},Ta={class:"tournaments-info-page__props"},wa={class:"tournaments-info-page__prop"},Sa=n("div",{class:"tournaments-info-page__prop-title"}," Команд ",-1),ka={class:"tournaments-info-page__body"},Ca=["textContent"],Ia={class:"tournaments-info-page__body"},xa={class:"tournaments-info-page__body"},Aa={class:"tournaments-info-page__body"},rn=W({__name:"[id]",setup(_){const s=gt(),m=pt(),t=J(),e=P({loading:0,tournament:null,stages:[],activeTab:"info"}),$=G(()=>{var l,v;const i=[{label:"Описание",name:"info"},{label:"Команды",name:"teams",disabled:((l=e.tournament)==null?void 0:l.status)==="upcoming"}];return e.stages.length&&i.push({label:"Сетка",name:"tables",disabled:!["running","finished","complete"].includes(((v=e.tournament)==null?void 0:v.status)??"")}),i}),w=G(()=>{var i;switch((i=e.tournament)==null?void 0:i.status){case"upcoming":return{title:"Начало регистрации",date:j.date.toDateTime(e.tournament.registration_start_at*1e3)};case"registration_started":return{title:"Окончание регистрации",date:j.date.toDateTime(e.tournament.registration_end_at*1e3)};case"registration_finished":return{title:"Начало мачей",date:j.date.toDateTime(e.tournament.matches_start_at*1e3)};case"running":return{title:"Завершение",date:j.date.toDateTime(e.tournament.end_at*1e3)};case"finished":case"complete":return{title:"Завершен",date:j.date.toDateTime(e.tournament.end_at*1e3)}}return{title:"---",date:"---"}});z(async()=>{var l;const i=(l=s.query)==null?void 0:l.activeTab;I(i||$.value[0].name),await O()});async function O(){const i=s.params.id;i&&await Promise.all([p(i),b(i)])}async function p(i){e.loading++;try{const{data:l}=await N.tournaments.getInfo({tournament_id:i});e.tournament=l[i]??null}catch(l){t.add({type:"error",title:"Получение информации турнира",message:l instanceof Error?l.message:"Неизвестная ошибка"}),console.error(l)}e.loading--}async function b(i){e.loading++;try{const{data:l}=await N.tournaments.getStages({tournament_id:i});e.stages=l??[]}catch(l){t.add({type:"error",title:"Получение этапов турнира",message:l instanceof Error?l.message:"Неизвестная ошибка"}),console.error(l)}e.loading--}function I(i){var l;e.activeTab=i,((l=s.query)==null?void 0:l.activeTab)!==i&&m.replace({query:{...s.query,activeTab:i}})}function x({name:i}){I(i)}return(i,l)=>{const v=lt,f=Ut,h=te,A=Oe,g=ga,S=At,q=Z,X=Ot;return u(),F(X,{class:"tournaments-info-page"},{default:D(()=>{var B,H,a,r;return[o(e).tournament?(u(),y("div",pa,[n("div",fa,[k(v,{src:o(e).tournament.logo.original,alt:"Tournament IMG",class:"tournaments-info-page__img"},null,8,["src"]),n("div",ha,[n("h1",ya,d((B=o(e).tournament)==null?void 0:B.title),1),n("div",ba,[n("div",va,[n("div",$a,d(o(w).title),1),T(" "+d(o(w).date),1)])]),n("div",Ta,[n("div",wa,[Sa,T(" "+d(((H=o(e).tournament)==null?void 0:H.teams.confirmed)||0)+" / "+d(((a=o(e).tournament)==null?void 0:a.teams.total)||0)+" / "+d(((r=o(e).tournament)==null?void 0:r.teams.max)||0),1)])])])]),k(S,{modelValue:o(e).activeTab,"onUpdate:modelValue":l[0]||(l[0]=c=>o(e).activeTab=c),tabs:o($),onTabClick:x},{info:D(()=>[n("div",ka,[o(e).stages.length?(u(),F(f,{key:0,stages:o(e).stages,class:"tournaments-info-page__stages","tournament-id":o(e).tournament.tournament_id},null,8,["stages","tournament-id"])):E("",!0),n("div",{class:"tournaments-info-page__description",textContent:d(o(e).tournament.description)},null,8,Ca)])]),matches:D(()=>[n("div",Ia,[o(e).stages.length?(u(),F(h,{key:0,stages:o(e).stages,"tournament-id":o(e).tournament.tournament_id},null,8,["stages","tournament-id"])):E("",!0)])]),teams:D(()=>[n("div",xa,[k(A,{tournament:o(e).tournament},null,8,["tournament"])])]),tables:D(()=>[n("div",Aa,[o(e).stages.length?(u(),F(g,{key:0,"tournament-id":o(e).tournament.tournament_id,stages:o(e).stages},null,8,["tournament-id","stages"])):E("",!0)])]),_:1},8,["modelValue","tabs"])])):E("",!0),k(q,{loading:o(e).loading>0},null,8,["loading"])]}),_:1})}}});export{rn as default};
