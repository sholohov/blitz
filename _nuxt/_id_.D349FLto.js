import{_ as L,a as W,u as ie,h as q}from"./disableScroll.C0aRP9sA.js";import{_ as H}from"./nuxt-link.L0yXcBJ9.js";import{_ as te}from"./CDialog.vue.DWhS8OEK.js";import{n as S,r as J,s as R,o as d,c as f,a,b as _,w as m,x as c,J as K,t as o,d as u,F as O,H as U,z as A,v as P,K as oe,L as Z,_ as G,A as V,B as ae,M as ce,C as Q,u as re,N as _e,O as de}from"./entry.C7rsCkde.js";import{_ as ne}from"./ContentLoader.vue.CZ7Avnj8.js";import{c as ue,m as me,s as X,_ as pe}from"./index.Bn66i9NN.js";import{s as E,a as z}from"./request.2vtDDBdm.js";import{_ as ve}from"./ClanEmblem.vue.zFVRugMl.js";import{_ as fe}from"./PageSection.vue.CMtJcZy6.js";import{_ as he}from"./CInput.vue.zZzbFdHH.js";import{_ as be}from"./CSelect.vue.wFKzONck.js";import{f as j}from"./index.B0yFPb21.js";import{_ as ge}from"./RoleIcon.vue.D6hIQNAD.js";import{_ as we}from"./WinRate.vue.CRSh5IUU.js";import{_ as ye,m as Y}from"./RatingIcon.vue.4uO5v5Kn.js";import{_ as $e}from"./CTable.vue.Nq0ui9O0.js";import{s as T}from"./index.DVI7ejDe.js";import{n as ke}from"./notEmpty.BxBPJGBn.js";import{c as ee}from"./cloneDeep.6mdasiia.js";import{a as Ce}from"./index.CiYw46hj.js";import"./CImage.vue.ClFcMEow.js";import"./image-broken.CEw3Tp2H.js";import"./nuxt-icon.qIaVhdWh.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./index.DkVO-Tjf.js";import"./isArrayLike.ji7-7BFC.js";const De={class:"clan-events"},Ie={class:"clan-events__inner"},xe={class:"clan-events__count"},Be={class:"clan-events__prop"},Ae=a("span",{class:"clan-events__prop-title"}," События от ",-1),Pe={key:0,class:"clan-events__prop"},Re={class:"clan-events__prop-title"},Se={key:1,class:"clan-events__prop"},je={class:"clan-events__prop-title"},Fe={key:2},Me={style:{display:"flex","justify-content":"space-between"}},Ee=a("div",null,null,-1),Oe=S({__name:"ClanEvents",props:{savedAt:{type:Number,default:0,required:!0},clan:{type:Object,default:()=>({}),required:!0},savedClan:{type:Object,default:()=>({}),required:!0}},emits:["reset"],setup(n,{emit:h}){const e=n,p=J(null),v=R(()=>{const l=e.clan.members_ids??[],b=e.savedClan.members??[];return Object.values(b).filter(g=>!l.includes(g.account_id))}),$=R(()=>{var g,y;const l=((g=e.clan)==null?void 0:g.members)??[],b=((y=e.savedClan)==null?void 0:y.members_ids)??[];return Object.values(l).filter(I=>!b.includes(I.account_id))}),k=R(()=>$.value.length+v.value.length),D=h;function w(){var l;D("reset"),(l=p.value)==null||l.doClose()}function s(){var l;(l=p.value)==null||l.doOpen()}function i(){var l;(l=p.value)==null||l.doClose()}return(l,b)=>{const g=L,y=W,I=H,F=te;return d(),f("div",De,[a("div",Ie,[_(y,{disabled:!c(k),class:K(["clan-events__btn",[c(k)?"clan-events__btn--has-unread":""]]),"is-text":"","is-square":"",title:"События клана",onClick:s},{default:m(()=>[_(g,{name:"mail"})]),_:1},8,["disabled","class"]),a("div",xe,o(c(k)>99?"99+":c(k)),1)]),_(F,{ref_key:"dialogRef",ref:p,width:"640px",title:"События клана"},{title:m(()=>[a("div",Be,[Ae,u(" "+o(l.$formatter.date.toDateTime(n.savedAt))+" ("+o(l.$formatter.date.toDaysPassed(n.savedAt,Date.now()))+") ",1)])]),footer:m(()=>[a("div",Me,[Ee,a("div",null,[_(y,{onClick:w},{default:m(()=>[u(" Прочитано ")]),_:1}),_(y,{onClick:i},{default:m(()=>[u(" Закрыть ")]),_:1})])])]),default:m(()=>[c(v).length?(d(),f("div",Pe,[a("span",Re," Покинули ("+o(c(v).length)+") ",1),(d(!0),f(O,null,U(c(v),(t,r)=>(d(),f("span",{key:t.account_id,class:"clan-events__prop-value"},[_(I,{to:{name:"account-id",params:{id:t.account_id}},class:"link"},{default:m(()=>[u(o(t.account_name),1)]),_:2},1032,["to"]),u(o(r+1!==c(v).length?", ":""),1)]))),128))])):A("",!0),c($).length?(d(),f("div",Se,[a("span",je," Вступили ("+o(c($).length)+") ",1),(d(!0),f(O,null,U(c($),(t,r)=>(d(),f("span",{key:t.account_id,class:"clan-events__prop-value"},[_(I,{to:{name:"account-id",params:{id:t.account_id}},class:"link"},{default:m(()=>[u(o(t.account_name),1)]),_:2},1032,["to"]),u(o(r+1!==c($).length?", ":""),1)]))),128))])):A("",!0),c(k)?A("",!0):(d(),f("span",Fe," Пока всё тихо ... "))]),_:1},512)])}}}),qe={class:"social-links"},Te={class:"social-links__links"},Ve=["href","title"],Le=S({__name:"SocialLinks",props:{links:{type:Array,default:()=>[],required:!0}},setup(n){return(h,e)=>(d(),f("div",qe,[a("div",Te,[(d(!0),f(O,null,U(n.links,p=>(d(),f("a",{key:p.link,class:"link social-links__links-item",href:p.link,target:"_blank",title:p.title},[(d(),P(oe(p.icon)))],8,Ve))),128))])]))}}),Ne=/(https?:\/\/)?(www\.)?(discord\.(gg|io|me|li)|discordapp\.com\/invite)\/.+[a-z|0-9]/gi,ze=/(https?:\/\/)?(www\.)?((t|telegram)\.me)\/\+?[a-zA-Z0-9_]{5,32}/gi,Ue=n=>{const h=[],e=n.match(Ne),p=n.match(ze);return e!=null&&e.length&&h.push({title:"Discord",icon:Z(()=>G(()=>import("./discord.DdqmnAc8.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),link:e[0]}),p!=null&&p.length&&h.push({title:"Telegram",icon:Z(()=>G(()=>import("./telegram.BeLNOB8z.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url)),link:p[0]}),h},We={class:"clan-preview-details__body"},He={key:0,class:"clan-preview-details__section"},Je={class:"clan-preview-details__props-title"},Ke={class:"clan-preview-details__section"},Ze={class:"clan-preview-details__props-title"},Ge=["textContent"],Qe={key:1,class:"clan-preview-details__section"},Xe={class:"clan-preview-details__props-title"},Ye={class:"clan-preview-details__props"},et={class:"clan-preview-details__prop"},tt=a("span",{class:"clan-preview-details__prop-title"}," Создатель ",-1),at={class:"clan-preview-details__prop"},nt=a("span",{class:"clan-preview-details__prop-title"}," Дата создания ",-1),st={class:"clan-preview-details__prop"},lt=a("span",{class:"clan-preview-details__prop-title"}," Дата обновления ",-1),it={class:"clan-preview-details__prop"},ot=a("span",{class:"clan-preview-details__prop-title"}," Участников ",-1),ct={key:0,class:"clan-preview-details__prop"},rt=a("span",{class:"clan-preview-details__prop-title"}," Старое название ",-1),_t={class:"clan-preview-details__section"},dt={class:"clan-preview-details__props-title"},ut={class:"clan-preview-details__props"},mt={class:"clan-preview-details__prop"},pt=a("span",{class:"clan-preview-details__prop-title"}," Политика приёма. ",-1),vt=a("div",{class:"clan-preview-details__props-subtitle"}," Пороги статистики для вступления: ",-1),ft={class:"clan-preview-details__prop"},ht=a("span",{class:"clan-preview-details__prop-title"}," Боёв в день ",-1),bt={class:"clan-preview-details__prop"},gt=a("span",{class:"clan-preview-details__prop-title"}," Боёв всего ",-1),wt={class:"clan-preview-details__prop"},yt=a("span",{class:"clan-preview-details__prop-title"}," Урон ср. ",-1),$t={class:"clan-preview-details__prop"},kt=a("span",{class:"clan-preview-details__prop-title"}," Уровень ",-1),Ct={class:"clan-preview-details__prop"},Dt=a("span",{class:"clan-preview-details__prop-title"}," Побед ",-1),It={style:{display:"flex","justify-content":"space-between"}},xt=S({__name:"ClanPreviewDetails",props:{clan:{type:Object,default:()=>({}),required:!0}},setup(n,{expose:h}){const e=n,p=J(null),v=V({descExpended:!1}),$=R(()=>Ue(e.clan.description??""));function k(){var s;(s=p.value)==null||s.doOpen()}function D(){var s;(s=p.value)==null||s.doClose()}function w(){v.descExpended=!v.descExpended}return h({open:k,close:D}),(s,i)=>{const l=L,b=W,g=H,y=Le,I=te;return d(),P(I,{ref_key:"clanDetailsRef",ref:p,class:"clan-preview-details",title:`[${n.clan.tag}] ${n.clan.name}`,width:"640px"},{footer:m(()=>[a("div",It,[c($).length?(d(),P(y,{key:0,class:"clan-preview-details__links",links:c($)},null,8,["links"])):A("",!0),_(b,{onClick:D},{default:m(()=>[u(" Закрыть ")]),_:1})])]),default:m(()=>[a("div",We,[n.clan.motto?(d(),f("div",He,[a("h5",Je,[_(l,{class:"clan-preview-details__prop-title-icon",name:"format-quote"}),u(" Девиз ")]),a("i",null,o(n.clan.motto),1)])):A("",!0),a("div",Ke,[a("h5",Ze,[_(l,{class:"clan-preview-details__prop-title-icon",name:"description"}),u(" Описание ")]),n.clan.description?(d(),f("div",{key:0,class:K(["content-area clan-preview-details__desc",c(v).descExpended?"clan-preview-details__desc--expended":""]),textContent:o(n.clan.description)},null,10,Ge)):A("",!0),_(b,{"is-text":"",class:"clan-preview-details__desc-expend-btn",onClick:w},{default:m(()=>[u(o(c(v).descExpended?"Свернуть":"Развернуть"),1)]),_:1})]),n.clan.motto?(d(),f("div",Qe,[a("h5",Xe,[_(l,{class:"clan-preview-details__prop-title-icon",name:"info"}),u(" Информация ")]),a("div",Ye,[a("div",et,[tt,n.clan.creator_id?(d(),P(g,{key:0,class:"link",to:n.clan.creator_id?{name:"account-id",params:{id:n.clan.creator_id}}:{}},{default:m(()=>[u(o(n.clan.creator_name),1)]),_:1},8,["to"])):(d(),f(O,{key:1},[u(" Не известен ")],64))]),a("div",at,[nt,u(" "+o(s.$formatter.date.toDate(n.clan.created_at*1e3)),1)]),a("div",st,[lt,u(" "+o(s.$formatter.date.toDate(n.clan.updated_at*1e3)),1)]),a("div",it,[ot,u(" "+o(s.$formatter.number.toInteger(n.clan.members_count)),1)]),n.clan.old_tag?(d(),f("div",ct,[rt,u(" ["+o(n.clan.old_tag)+"] "+o(n.clan.old_name),1)])):A("",!0)])])):A("",!0),a("div",_t,[a("h5",dt,[_(l,{class:"clan-preview-details__prop-title-icon",name:"person-search"}),u(" Рекрутинг ")]),a("div",ut,[a("div",mt,[pt,u(" "+o(s.$formatter.clan.recruitingPolicy(n.clan.recruiting_policy))+". ",1)]),n.clan.recruiting_policy==="open"&&n.clan.recruiting_options?(d(),f(O,{key:0},[vt,a("div",ft,[ht,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.average_battles_per_day)),1)]),a("div",bt,[gt,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.battles)),1)]),a("div",wt,[yt,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.average_damage)),1)]),a("div",$t,[kt,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.vehicles_level)),1)]),a("div",Ct,[Dt,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.wins_ratio))+"% ",1)])],64)):A("",!0)])])])]),_:1},8,["title"])}}}),Bt={class:"clan-preview"},At={class:"clan-preview__inner"},Pt={class:"clan-preview__emblem"},Rt={class:"clan-preview__info"},St={class:"clan-preview__title"},jt={class:"clan-preview__tag"},Ft={class:"clan-preview__name"},Mt={class:"clan-preview__props"},Et={class:"clan-preview__prop"},Ot=a("span",{class:"clan-preview__prop-title"}," Участников ",-1),qt={class:"clan-preview__prop-value"},Tt={class:"clan-preview__prop"},Vt=a("span",{class:"clan-preview__prop-title"}," События ",-1),Lt={class:"clan-preview__prop-value"},Nt={class:"clan-preview__actions"},zt=S({__name:"ClanPreview",props:{clan:{type:Object,default:()=>({}),required:!0},hideDescription:{type:[Boolean,String],default:!1},loading:{type:Boolean,default:!1}},setup(n){const h=n,e=J(null),p=ie(),v=V({isFavorite:!1});ae(()=>{$()});async function $(){const i=await E.indexedDB.clansFavorites.get(h.clan.clan_id);v.isFavorite=i?i==null?void 0:i.isFavorite:!1}async function k(){h.clan&&(v.isFavorite=!v.isFavorite,await E.indexedDB.clansFavorites.set(h.clan.clan_id,{id:h.clan.clan_id,isFavorite:v.isFavorite}))}async function D(){await ue(`${h.clan.tag}/${h.clan.clan_id}`)?p.add({type:"success",title:"Скопировано",message:`${h.clan.tag}/${h.clan.clan_id}`,duration:3e3}):p.add({type:"error",message:"Клан копировании что-то пошло не так",duration:3e3})}function w(){var i;(i=e.value)==null||i.open()}function s(){k()}return(i,l)=>{const b=L,g=W,y=ne,I=xt;return d(),f("div",Bt,[a("div",At,[a("div",Pt,[_(ve,{class:"clan-preview__emblem-img",alt:n.clan.name,emblem:n.clan.emblem_set_id},null,8,["alt","emblem"])]),a("div",Rt,[a("div",St,[a("span",jt,"["+o(n.clan.tag??"...")+"]",1),a("span",Ft,o(n.clan.name??"..."),1)]),a("div",Mt,[a("div",Et,[Ot,a("span",qt,o(n.clan.members_count??"---"),1)]),a("div",Tt,[Vt,a("span",Lt,[ce(i.$slots,"events")])])])]),a("div",Nt,[_(g,{"is-text":"",class:"clan-preview__actions-btn",title:"Копировать (nickname/ID)",onClick:D},{default:m(()=>[_(b,{name:"content-copy"})]),_:1}),_(g,{"is-text":"",class:"clan-preview__actions-btn",title:"Добавить в избранные",onClick:s},{default:m(()=>[c(v).isFavorite?(d(),P(b,{key:0,name:"star"})):(d(),P(b,{key:1,name:"star-border"}))]),_:1}),_(g,{"is-text":"",class:"clan-preview__actions-btn",title:"Полная информация",onClick:w},{default:m(()=>[_(b,{name:"info"})]),_:1})])]),_(y,{loading:n.loading},null,8,["loading"]),_(I,{ref_key:"previewDetailsRef",ref:e,clan:n.clan},null,8,["clan"])])}}}),Ut={class:"clan-view-filters"},Wt={class:"clan-view-filters__list"},Ht={class:"clan-view-filters__item clan-view-filters__item--search"},Jt=a("div",{class:"clan-view-filters__item-title"}," Поиск в клане ",-1),Kt={class:"clan-view-filters__item"},Zt=a("div",{class:"clan-view-filters__item-title"}," Дней в клане ",-1),Gt={class:"clan-view-filters__item"},Qt=a("div",{class:"clan-view-filters__item-title"}," Дней отсутствовал ",-1),Xt=S({__name:"ClanViewFilter",props:{filters:{type:Object,required:!0,default:j.makeClanFilters}},emits:["filters-change"],setup(n,{emit:h}){const e=n,p=[{value:null,label:"Не выбрано"},{value:"<3",label:"Меньше чем 3"},{value:"<5",label:"Меньше чем 5"},{value:"<7",label:"Меньше чем 7"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],v=[{value:null,label:"Не выбрано"},{value:"<1",label:"Меньше чем 1"},{value:"<3",label:"Меньше чем 3"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],$=h;function k(D,w){$("filters-change",{...e.filters,[D]:w})}return(D,w)=>{const s=he,i=be;return d(),f("div",Ut,[a("div",Wt,[a("div",Ht,[Jt,_(s,{"model-value":n.filters.search,style:{width:"100%"},placeholder:"Введите ник",type:"search","onUpdate:modelValue":w[0]||(w[0]=l=>k("search",l))},null,8,["model-value"])]),a("div",Kt,[Zt,_(i,{"model-value":n.filters.joinedAtDays,style:{width:"150px"},options:p,onChange:w[1]||(w[1]=l=>k("joinedAtDays",l))},null,8,["model-value"])]),a("div",Gt,[Qt,_(i,{"model-value":n.filters.lastBattleDays,style:{width:"150px"},options:v,onChange:w[2]||(w[2]=l=>k("lastBattleDays",l))},null,8,["model-value"])])])])}}}),Yt={class:"clan-view-table"},ea={class:"clan-view-table__total"},ta={class:"clan-view-table__total-value"},aa={class:"clan-view-table__member"},na=["title"],sa={key:0,class:"clan-view-table__name clan-view-table__name--deleted"},la={class:"clan-view-table__sub"},ia={class:"clan-view-table__sub"},oa={class:"clan-view-table__sub"},ca={class:"clan-view-table__sub"},ra={class:"clan-view-table__sub"},_a={class:"clan-view-table__sub"},da=S({__name:"ClanViewMembersTable",props:{members:{type:Array,default:()=>[],required:!0},savedMembers:{type:Array,default:()=>[],required:!0},users:{type:Array,default:()=>[],required:!0},sort:{type:Object,default:()=>({}),required:!0}},emits:["sort"],setup(n,{emit:h}){const e=n,p=h,v=[{key:"account_name",label:"Ник",sortable:!0},{key:"battles",label:"Боёв",sortable:!0,sortMethod(s,i){return s.statistic.all.battles-i.statistic.all.battles}},{key:"winRate",label:"Побед",sortable:!0,sortMethod(s,i){return s.statistic.all.winRate-i.statistic.all.winRate}},{key:"damagePerBattle",label:"Урон",sortable:!0,sortMethod(s,i){return s.statistic.all.damagePerBattle-i.statistic.all.damagePerBattle}},{key:"rating",label:"Рейтинг",sortable:!0,sortMethod(s,i){var g,y;const l=((g=s.statistic.rating)==null?void 0:g.rating)??0,b=((y=i.statistic.rating)==null?void 0:y.rating)??0;return l-b}},{key:"battlesPerDay",label:"Боёв в день",sortable:!0},{key:"last_battle_time",label:"Последний бой",sortable:!0},{key:"joined_at",label:"В клане",sortable:!0}],$=R(()=>e.members.map(s=>{const i=e.savedMembers.find(y=>y.account_id===s.account_id),l=i?T.diff(s.statistic.all,i.statistic.all):null,b=T.battlesPerDay({createAt:s.create_at*1e3,battles:s.statistic.all.battles}),g=i?T.battlesPerDay({createAt:i.create_at,battles:(l==null?void 0:l.battles)||0})-b:null;return{...s,battlesPerDay:b,battlesPerDayDiff:g,diff:l}}));function k(s){const i=e.users.find(l=>l.id===s.account_id);return i?{found:!0,online:Date.now()-new Date(i.visitedAt).valueOf()<1e3*60*5}:{found:!1,online:!1}}function D(s){const i=s;return/^del_\d+$/.test(i.account_name)||!i.last_battle_time}function w(s,i){const l=i;return l.diff?s==="winRate"?Q.number.toFloatNumber(l.diff[s],!0):Q.number.toInteger(l.diff[s],!0):"---"}return(s,i)=>{const l=ge,b=L,g=H,y=we,I=ye,F=$e;return d(),f("div",Yt,[a("div",ea,[u(" Кол-во: "),a("span",ta,o(c($).length||0),1)]),c($)?(d(),P(F,{key:0,data:c($),"default-sort":n.sort,headers:v,"no-wrap":"","scroll-auto-disabling":"","row-key":"account_id",height:"calc(100vh - 112px)",class:"clan-view-table__table",onSort:i[0]||(i[0]=t=>p("sort",t))},{account_name:m(({row:t})=>[a("span",aa,[a("span",{class:K(["clan-view-table__role",["clan-view-table__role--"+t.role,k(t).found?"clan-view-table__role--is-user":"",k(t).online?"clan-view-table__role--is-online":""]]),title:s.$formatter.clan.role(t.role)??"Не известна"},[t.role?(d(),P(l,{key:0,width:"18",height:"18",class:"clan-view-table__role-icon",role:t.role},null,8,["role"])):(d(),P(b,{key:1,style:{width:"16px",color:"var(--color-text-light)"},name:"close"}))],10,na),D(t)?(d(),f("span",sa,o(t.account_name),1)):(d(),P(g,{key:1,class:"link clan-view-table__name",to:{name:"account-id",params:{id:t.account_id}}},{default:m(()=>[u(o(t.account_name),1)]),_:2},1032,["to"]))])]),battles:m(({row:t})=>[u(o(t.statistic.all.battles||"---")+" ",1),a("span",la,o(w("battles",t)||"---"),1)]),winRate:m(({row:t})=>[_(y,{"model-value":t.statistic.all.winRate,class:"clan-view-table__win-rate"},null,8,["model-value"]),a("span",ia,o(w("winRate",t)||"---"),1)]),rating:m(({row:t})=>[_(I,{rating:t.statistic.rating},null,8,["rating"])]),damagePerBattle:m(({row:t})=>[u(o(t.statistic.all.damagePerBattle||"---")+" ",1),a("span",oa,o(w("damagePerBattle",t)),1)]),battlesPerDay:m(({row:t})=>[u(o(t.battlesPerDay||"---")+" ",1),a("span",ca,o(s.$formatter.number.toInteger(t.battlesPerDayDiff,!0)||"---"),1)]),last_battle_time:m(({row:t})=>[u(o(s.$formatter.date.toRelativeTime(t.last_battle_time*1e3)||"---")+" ",1),a("span",ra,o(s.$formatter.date.toDateTime(t.last_battle_time*1e3)||"---"),1)]),joined_at:m(({row:t})=>[u(o(s.$formatter.date.toDaysPassed(t.joined_at*1e3)||"---")+" ",1),a("span",_a,o(s.$formatter.date.toDate(t.joined_at*1e3)||"---"),1)]),_:1},8,["data","default-sort"])):A("",!0)])}}}),ua={key:0,class:"clan-page"},ma={key:1,class:"clan-page--no-data"},pa={key:0,class:"content-area"},va=a("p",null,"Нет данных.",-1),fa=a("p",null,"Возможно клан удалён.",-1),ha=[va,fa],Ua=S({__name:"[id]",setup(n){const h=re(),e=V({loading:0,users:[],clanInfo:null,clan:null,filters:j.makeClanFilters(),statisticsSum:null,savedMembers:[],savedClan:null,metricsItems:[],clanSavedAt:0}),p=V({order:"desc",prop:""}),v=R(()=>{var t;return((t=e.clan)==null?void 0:t.members)||[]}),$=R(()=>{let t=v.value.filter(C=>{const B=C.account_name.toLowerCase(),M=e.filters.search.toLowerCase();return B.includes(M)});const r=Date.now(),x=1e3*60*60*24;if(e.filters.joinedAtDays){const C=j.parseParameter(e.filters.joinedAtDays);t=v.value.filter(B=>j.executeExpression(r-Number(C.value)*x,B.joined_at*1e3,C.operator))}if(e.filters.lastBattleDays){const C=j.parseParameter(e.filters.lastBattleDays);t=v.value.filter(B=>j.executeExpression(r-Number(C.value)*x,B.last_battle_time*1e3,C.operator))}return t});ae(()=>{const t=+h.params.id;t&&i(t)});async function k(t){e.loading++;try{const{data:r}=await z.clan.getAccountInfo({account_id:t.join(",")});return r}catch(r){return q(r,{title:"Получение данных участников клана"}),null}finally{e.loading--}}async function D(t){e.loading++;try{const{data:r}=await z.clan.getInfo({clan_id:t});e.clanInfo=r[t]??null}catch(r){q(r,{title:"Получение данных клана"})}e.loading--}async function w(t){e.loading++;try{const{data:r}=await Ce.user.getList({id:t});e.users=r}catch(r){q(r,{title:"Получение данных аккаунта"})}e.loading--}async function s(t){e.loading++;try{const{data:r}=await z.account.getInfo({extra:"statistics.rating",account_id:t.join(",")});return r}catch(r){return q(r,{title:"Получение данных аккаунта"}),null}finally{e.loading--}}async function i(t){if(await D(t),!e.clanInfo)return;const r=await k(e.clanInfo.members_ids);e.clanInfo.members=r,await Promise.all([w(e.clanInfo.members_ids),l(e.clanInfo),g(e.clanInfo)]),e.savedClan||await b(e.clanInfo);const x=await s(e.clanInfo.members_ids);if(!x)return;e.clan=Y.clan(e.clanInfo,x);const C=Object.values(x).filter(ke);e.statisticsSum=C.reduce((B,M,N)=>N===0?C[0].statistics:T.sumFull(B,M.statistics),{}),e.metricsItems=me.clan(C,e.statisticsSum),X.clanMembersDefault(v.value)}async function l(t){e.loading++;const r=[];for(const x in t.members){const C=await E.indexedDB.accountsInfo.get(x);C&&(C.data.created_at=C.timestamp,r.push(Y.clanMember(t.members[x],C.data)))}e.savedMembers=r,e.loading--}async function b(t){e.loading++,await E.indexedDB.clansInfo.set(t.clan_id,_e(t)),e.savedClan=ee(t),e.clanSavedAt=Date.now(),e.loading--}async function g(t){e.loading++;const r=await E.indexedDB.clansInfo.get(t.clan_id);e.savedClan=(r==null?void 0:r.data)??null,e.clanSavedAt=(r==null?void 0:r.timestamp)??0,e.loading--}function y(t){t.order||X.clanMembersDefault(v.value)}async function I(){e.clanInfo&&await b(e.clanInfo)}function F(t){console.log(t.search),e.filters=ee(t)}return(t,r)=>{const x=Oe,C=zt,B=fe,M=pe,N=Xt,se=da,le=ne;return c(e).clanInfo?(d(),f("div",ua,[_(B,{identity:"preview"},{default:m(()=>[_(C,{class:"clan-page__preview","hide-description":!0,clan:c(e).clanInfo,loading:c(e).loading>0},de({_:2},[c(e).clanInfo&&c(e).savedClan?{name:"events",fn:m(()=>[_(x,{clan:c(e).clanInfo,"saved-clan":c(e).savedClan,"saved-at":c(e).clanSavedAt,onReset:I},null,8,["clan","saved-clan","saved-at"])]),key:"0"}:void 0]),1032,["clan","loading"])]),_:1}),_(B,{title:"Статистика",identity:"statistic"},{default:m(()=>[_(M,{loading:c(e).loading>0,items:c(e).metricsItems},null,8,["loading","items"])]),_:1}),_(B,{title:"Участники",identity:"members"},{default:m(()=>[_(N,{class:"clan-page__filters",filters:c(e).filters,onFiltersChange:F},null,8,["filters"]),_(se,{sort:c(p),users:c(e).users,"saved-members":c(e).savedMembers,members:c($),onSort:y},null,8,["sort","users","saved-members","members"])]),_:1})])):(d(),f("div",ma,[c(e).loading?A("",!0):(d(),f("div",pa,ha)),_(le,{loading:c(e).loading>0},null,8,["loading"])]))}}});export{Ua as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./discord.DdqmnAc8.js","./nuxt-icon.qIaVhdWh.js","./_plugin-vue_export-helper.DlAUqK2U.js","./entry.C7rsCkde.js","./nuxt-icon.MfBulapQ.css","./telegram.BeLNOB8z.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
