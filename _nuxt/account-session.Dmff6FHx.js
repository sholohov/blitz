import{_ as N}from"./ContentLoader.vue.kCcbdDCf.js";import{f as w}from"./index.DVAFURtC.js";import{a as d}from"./request.CuV_NRrd.js";import{a as S}from"./index.Dsl6k6x1.js";import{f as P,n as T,r as y,q as V,s as o,o as l,c as f,a as p,F as W,A as q,k as m,C as O,K as j,t as A,b as z,g as L,j as M,m as $}from"./entry.FvyONZHj.js";import{s as r}from"./index.CPrYhzBm.js";const k={class:"widget-account-session__list"},E={class:"widget-account-session__label"},G={class:"widget-account-session__value"},K=P({__name:"WidgetAccountSession",props:{params:{type:Object,default:w.makeAccountSessionWidgetFilters,required:!0}},setup(c){const s=c,t=T({loading:0,accountSession:null,account:null,achievementsInfo:null,accountAchievements:null,accountAchievementsSession:null,tanksStat:null,tanksStatSession:null,updateTimerDuration:3e4}),u=y([]);V(()=>{R()});async function v(){t.loading++;try{const{data:n}=await d.encyclopedia.getAchievements();t.achievementsInfo=n??null}catch(n){console.error(n)}t.loading--}async function g(n){t.loading++;try{const{data:e}=await d.account.getInfo({account_id:n,extra:"statistics.rating"});t.account=(e==null?void 0:e[n])??null}catch(e){console.error(e)}t.loading--}async function B(n){t.loading++;try{const{data:e}=await S.session.account.get(n);t.accountSession=e.raw}catch(e){console.error(e)}t.loading--}async function I(n){t.loading++;try{const{data:e}=await d.account.getAchievements({account_id:n});t.accountAchievements=(e==null?void 0:e[n])??null}catch(e){console.error(e)}t.loading--}async function F(n){t.loading++;try{const{data:e}=await S.session.accountAchievements.get(n);t.accountAchievementsSession=e.raw}catch(e){console.error(e)}t.loading--}function x(n,e){switch(n){case"battles":return o.number.toInteger(e.battles);case"winRate":return o.number.toFloatPercent(e.winRate);case"damagePerBattle":return o.number.toInteger(e.damagePerBattle);case"fragPerBattle":return o.number.toFloatNumber(e.fragPerBattle);case"surviveRate":return o.number.toFloatPercent(e.spottedPerBattle);case"hitRate":return o.number.toFloatPercent(e.hitRate);case"spottedPerBattle":return o.number.toFloatNumber(e.spottedPerBattle);case"xpPerBattle":return"xpPerBattle"in e?o.number.toInteger(e.xpPerBattle):"---";default:return"---"}}function h(){if(!t.account||!t.accountSession)return;const n=r.diffFull(t.account.statistics,t.accountSession.statistics);let e;t.achievementsInfo&&t.accountAchievements&&t.accountAchievementsSession&&(e=r.achievementsDiff(t.accountAchievements,t.accountAchievementsSession,t.achievementsInfo)),u.value=s.params.attributes.map(a=>{var _,b;if(a==="teamGamePoints"&&e)return{key:a,label:o.stat.accountProp(a),value:String(r.teamPoints(n,e))};const i=(_=t.achievementsInfo)==null?void 0:_[a];if(i&&e)return{key:a,label:String(i.name).replace(/\([^)]+\)/gi,"")??a,value:String(((b=e.achievements)==null?void 0:b[a])??0)};const D=s.params.battleMode==="rating"&&n.rating?r.accountRating(n.rating):r.accountAll(n.all);return{key:a,label:o.stat.accountProp(a),value:x(a,D)}})}function C(n){h();let e;const a=async()=>{t.loading++,clearTimeout(e),await Promise.all([g(n),I(n)]),h(),e=setTimeout(a,t.updateTimerDuration),t.loading--};a()}async function R(){u.value=s.params.attributes.map(e=>({key:e,label:o.stat.accountProp(e),value:"---"})),console.log(s);const n=s.params.accountId;n&&(await Promise.all([v(),B(n),F(n)]),t.accountSession&&C(n))}return(n,e)=>{const a=N;return l(),f("div",{class:O(["widget-account-session",["widget-account-session--"+c.params.style]]),style:j({"--widget-account-session-bg-color":c.params.bgColor,"--widget-account-session-bg-opacity":c.params.bgColorOpacity,"--widget-account-session-text-color":c.params.textColor})},[p("div",k,[(l(!0),f(W,null,q(m(u),i=>(l(),f("div",{key:i.key,class:"widget-account-session__item"},[p("div",E,A(i.label),1),p("div",G,A(i.value),1),z(a,{loading:m(t).loading>0},null,8,["loading"])]))),128))])],6)}}}),Z=P({__name:"account-session",setup(c){const s=L(),t=y(w.makeAccountSessionWidgetFilters(s.query));return(u,v)=>{const g=K;return m(t)?(l(),M(g,{key:0,class:"widgets-account-session-page",params:m(t)},null,8,["params"])):$("",!0)}}});export{Z as default};
