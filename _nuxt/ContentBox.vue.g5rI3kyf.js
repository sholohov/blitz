import{_ as G}from"./CInput.vue.BzXPJvzC.js";import{f as R,h as H,r as l,i as I,q as J,y as Q,o as c,c as r,a as L,b as B,k as A,l as X,w as V,F as D,A as N,t as K,B as Y,m as Z,$ as ee,j as te,C as ne,E as ae,D as oe}from"./entry.C5iIeEMf.js";import{n as se}from"./notEmpty.BxBPJGBn.js";import{d as le}from"./debounce.BZWlxxZt.js";import{u as T}from"./disableScroll.DYMxvxot.js";import{a as E}from"./request.CetvaxyE.js";const ce=(u,_)=>{const h=T(),y=f=>f instanceof Error;h.add({type:"error",title:"Поиск клана",message:_.message??(y(u)?u.message:"Неизвестная ошибка")}),console.error(u)},ie={class:"main-search__inner"},re={class:"main-search__input"},ue={key:0,class:"main-search__dropdown"},de={key:0,class:"main-search__item-title"},me=["onKeydown","onClick","textContent"],ge=R({__name:"MainSearch",props:{context:{type:String,default:"account"}},setup(u){const _=H(),h=T(),y=l(null),f=l(null),i=l(""),w=l([]),k=l([]),x=l([]),v=l([]),d=l(0),p=l(-1),U=I(()=>[w.value,k.value,x.value]),j=I(()=>[w.value,k.value,x.value].some(e=>e.length>0));J(()=>{window.addEventListener("click",S)}),Q(()=>{window.removeEventListener("click",S)});function C(){w.value=[],k.value=[],x.value=[]}function S(e){var t;(t=y.value)!=null&&t.contains(e.target)||(C(),i.value="")}async function $(e){var t;C(),i.value=e.name??"",await _.push({name:e.context+"-id",params:{id:String(e.id)}}),(t=f.value)==null||t.focus()}function q(){var t;const e=(t=y.value)==null?void 0:t.querySelectorAll(".main-search__item-btn");return e?[...e]:[]}async function F(e){d.value++;try{const a=((await E.account.getList({search:e,limit:5})).data||[]).map(n=>({name:n.nickname,id:n.account_id,context:"account"}));if(a.length){const n=await E.clan.getAccountInfo({extra:"clan",account_id:a.map(s=>s.id).join(",")});n.data&&a.forEach(s=>{var m,g;const o=(g=(m=n.data[s.id])==null?void 0:m.clan)==null?void 0:g.tag;s.name+=o?` [${o}]`:""}),w.value=[{id:1,name:"Аккаунты",context:"title"},...a]}}catch(t){h.add({type:"error",message:"Поиск аккаунта"}),console.error(t)}d.value--}async function M(e){d.value++;try{const{data:t}=await E.clan.getList({search:e,limit:5}),a=(t.filter(se)??[]).map(n=>({name:`[${n.tag}] ${n.name}`,id:n.clan_id,context:"clan"}));a.length&&(k.value=[{id:2,name:"Кланы",context:"title"},...a])}catch(t){ce(t,{title:"Поиск клана"})}d.value--}async function O(e){d.value++;try{const a=((await E.tournaments.getList({search:e,limit:5})).data||[]).map(n=>({name:n.title,id:n.tournament_id,context:"tournaments"}));a.length&&(x.value=[{id:3,name:"Турниры",context:"title"},...a])}catch(t){h.add({type:"error",message:"Поиск турнира"}),console.error(t)}d.value--}async function z(e){e.length>=3&&await F(e),e.length>=2&&(await M(e),await O(e)),v.value=q()}const P=le(z,1e3,{leading:!0});async function W(e=""){i.value=e=e.replace(/\/\d+$/,"").trim(),i.value.length<2&&C(),await P(e)}function b(e){var a,n,s,o,m,g;const t=e.target;d.value>0||(e.key==="Escape"&&(C(),i.value="",p.value=-1,(a=f.value)==null||a.focus()),t.tagName==="INPUT"&&(p.value=-1),e.key==="ArrowUp"&&(e.preventDefault(),(n=v.value)!=null&&n.length&&p.value>0?(s=v.value[--p.value])==null||s.focus():(o=f.value)==null||o.focus()),e.key==="ArrowDown"&&(e.preventDefault(),(m=v.value)!=null&&m.length&&p.value<v.value.length-1&&((g=v.value[++p.value])==null||g.focus())))}return(e,t)=>{const a=G;return c(),r("div",{ref_key:"rootRef",ref:y,class:"main-search"},[L("div",ie,[L("div",re,[B(a,{ref_key:"inputRef",ref:f,modelValue:A(i),"onUpdate:modelValue":t[0]||(t[0]=n=>X(i)?i.value=n:null),placeholder:"Поиск игрока, клана или турнира",type:"search",onInput:W,onKeydown:b},null,8,["modelValue"])]),B(ee,null,{default:V(()=>[A(j)?(c(),r("div",ue,[(c(!0),r(D,null,N(A(U),(n,s)=>(c(),r("ul",{key:s,class:"main-search__list",onKeydown:b},[(c(!0),r(D,null,N(n,o=>(c(),r("li",{key:o.context+o.id,class:"main-search__item"},[o.context==="title"?(c(),r("div",de,K(o.name),1)):(c(),r("button",{key:1,class:"main-search__item-btn",onKeydown:Y(m=>$(o),["enter"]),onClick:m=>$(o),textContent:K(o.name)},null,40,me))]))),128))],32))),128))])):Z("",!0)]),_:1})])],512)}}}),we=R({__name:"ContentBox",props:{tag:{type:String,default:"div"},innerClass:{type:String,default:void 0}},setup(u){return(_,h)=>(c(),te(oe(u.tag),{class:"content-box"},{default:V(()=>[L("div",{class:ne(["content-box__inner",[u.innerClass]])},[ae(_.$slots,"default")],2)]),_:3}))}});export{we as _,ge as a};
