import{_ as H}from"./CInput.vue.zZzbFdHH.js";import{n as R,q as J,r as l,s as b,B as P,G as W,o as c,c as r,a as E,b as B,x as L,y as Q,w as V,F as K,H as D,t as N,I as X,z as Y,a4 as Z,v as ee,J as te,M as ne,K as ae}from"./entry.C7rsCkde.js";import{n as oe}from"./notEmpty.BxBPJGBn.js";import{d as se}from"./debounce.C9J8JV9z.js";import{a as x}from"./request.2vtDDBdm.js";import{h as A}from"./disableScroll.C0aRP9sA.js";const le={class:"main-search__inner"},ce={class:"main-search__input"},ie={key:0,class:"main-search__dropdown"},re={key:0,class:"main-search__item-title"},ue=["onKeydown","onClick","textContent"],he=R({__name:"MainSearch",props:{context:{type:String,default:"account"}},setup(k){const C=J(),_=l(null),p=l(null),i=l(""),h=l([]),y=l([]),g=l([]),m=l([]),u=l(0),f=l(-1),T=b(()=>[h.value,y.value,g.value]),U=b(()=>[h.value,y.value,g.value].some(e=>e.length>0));P(()=>{window.addEventListener("click",I)}),W(()=>{window.removeEventListener("click",I)});function w(){h.value=[],y.value=[],g.value=[]}function I(e){var t;(t=_.value)!=null&&t.contains(e.target)||(w(),i.value="")}async function S(e){var t;w(),i.value=e.name??"",await C.push({name:e.context+"-id",params:{id:String(e.id)}}),(t=p.value)==null||t.focus()}function M(){var t;const e=(t=_.value)==null?void 0:t.querySelectorAll(".main-search__item-btn");return e?[...e]:[]}async function q(e){u.value++;try{const a=((await x.account.getList({search:e,limit:5})).data||[]).map(n=>({name:n.nickname,id:n.account_id,context:"account"}));if(a.length){const n=await x.clan.getAccountInfo({extra:"clan",account_id:a.map(s=>s.id).join(",")});n.data&&a.forEach(s=>{var d,v;const o=(v=(d=n.data[s.id])==null?void 0:d.clan)==null?void 0:v.tag;s.name+=o?` [${o}]`:""}),h.value=[{id:1,name:"Аккаунты",context:"title"},...a]}}catch(t){A(t,{title:"Поиск аккаунта"})}u.value--}async function z(e){u.value++;try{const{data:t}=await x.clan.getList({search:e,limit:5}),a=(t.filter(oe)??[]).map(n=>({name:`[${n.tag}] ${n.name}`,id:n.clan_id,context:"clan"}));a.length&&(y.value=[{id:2,name:"Кланы",context:"title"},...a])}catch(t){A(t,{title:"Поиск клана"})}u.value--}async function F(e){u.value++;try{const a=((await x.tournaments.getList({search:e,limit:5})).data||[]).map(n=>({name:n.title,id:n.tournament_id,context:"tournaments"}));a.length&&(g.value=[{id:3,name:"Турниры",context:"title"},...a])}catch(t){A(t,{title:"Поиск турнира"})}u.value--}async function O(e){e.length>=3&&await q(e),e.length>=2&&(await z(e),await F(e)),m.value=M()}const j=se(O,1e3,{leading:!0});async function G(e=""){i.value=e=e.replace(/\/\d+$/,"").trim(),i.value.length<2&&w(),await j(e)}function $(e){var a,n,s,o,d,v;const t=e.target;u.value>0||(e.key==="Escape"&&(w(),i.value="",f.value=-1,(a=p.value)==null||a.focus()),t.tagName==="INPUT"&&(f.value=-1),e.key==="ArrowUp"&&(e.preventDefault(),(n=m.value)!=null&&n.length&&f.value>0?(s=m.value[--f.value])==null||s.focus():(o=p.value)==null||o.focus()),e.key==="ArrowDown"&&(e.preventDefault(),(d=m.value)!=null&&d.length&&f.value<m.value.length-1&&((v=m.value[++f.value])==null||v.focus())))}return(e,t)=>{const a=H;return c(),r("div",{ref_key:"rootRef",ref:_,class:"main-search"},[E("div",le,[E("div",ce,[B(a,{ref_key:"inputRef",ref:p,modelValue:L(i),"onUpdate:modelValue":t[0]||(t[0]=n=>Q(i)?i.value=n:null),placeholder:"Поиск игрока, клана или турнира",type:"search",onInput:G,onKeydown:$},null,8,["modelValue"])]),B(Z,null,{default:V(()=>[L(U)?(c(),r("div",ie,[(c(!0),r(K,null,D(L(T),(n,s)=>(c(),r("ul",{key:s,class:"main-search__list",onKeydown:$},[(c(!0),r(K,null,D(n,o=>(c(),r("li",{key:o.context+o.id,class:"main-search__item"},[o.context==="title"?(c(),r("div",re,N(o.name),1)):(c(),r("button",{key:1,class:"main-search__item-btn",onKeydown:X(d=>S(o),["enter"]),onClick:d=>S(o),textContent:N(o.name)},null,40,ue))]))),128))],32))),128))])):Y("",!0)]),_:1})])],512)}}}),ye=R({__name:"ContentBox",props:{tag:{type:String,default:"div"},innerClass:{type:String,default:void 0}},setup(k){return(C,_)=>(c(),ee(ae(k.tag),{class:"content-box"},{default:V(()=>[E("div",{class:te(["content-box__inner",[k.innerClass]])},[ne(C.$slots,"default")],2)]),_:3}))}});export{ye as _,he as a};
