import{_ as v}from"./ITqKCdnK.js";import{u as z,h as f,_ as T}from"./DtA1LByL.js";import{_ as j}from"./DGLDZ4cR.js";import{_ as D}from"./BkXTMpOT.js";import{_ as P}from"./BC3rzm_-.js";import{_ as E}from"./BOztkASC.js";import{_ as V}from"./DrqrCYu8.js";import{n as W}from"./BxBPJGBn.js";import{c as O}from"./ZnSD-95i.js";import{a as R}from"./DRW9HJMp.js";import{a as U}from"./wDhpCTVo.js";import{f as q,n as y,i as G,q as L,j as k,w as i,o as l,b as c,d as m,t as p,a as M,c as F,k as h,s as _}from"./ByGHtsLc.js";import"./g4g0RxE0.js";import"./CUl2OyUw.js";import"./C4sXLknC.js";import"./BQPDEBlD.js";import"./DFAQjZIE.js";import"./CMJjbvSz.js";import"./DuSj7eF3.js";import"./DyNKK-9z.js";import"./BKiIIqfs.js";import"./DTODm7N5.js";import"./CNezpHW2.js";import"./DlAUqK2U.js";import"./D-G4pc_H.js";import"./tpf4pI7Z.js";import"./x1I6SI8R.js";const H={class:"recruiting-page__name"},J={key:1},wt=q({__name:"recruiting",setup(K){const d=z(),e=y({loading:0,accounts:[],clanAccounts:[]}),o=y({page:1,pageSize:100,total:0});e.loading++;const b=[{label:"#",key:"position",width:40},{label:"Ник",key:"nickname"},{label:"Клан",key:"clan"},{label:"% Побед",key:"win_rate"},{label:"Бои",key:"battles",formatter(t){return _.number.toInteger(t)}},{label:"Урон/Бой",key:"damage_per_battle",formatter(t){return _.number.toInteger(t)}},{label:"Последний бой",key:"last_battle_time",formatter(t){return typeof t=="string"?_.date.toDateTime(t):"---"}}],S=G(()=>e.accounts.map(t=>{var s;const a=(s=e.clanAccounts.find(r=>r.account_id===t.id))==null?void 0:s.clan;return{...t,clan:a}}));L(()=>{u()});async function u(){var t;e.loading--,await C(),(t=e.accounts)!=null&&t.length&&await x(e.accounts.map(a=>a.id))}async function x(t){e.loading++;try{const{data:a}=await R.clan.getAccountInfo({extra:"clan",account_id:t.join(",")});e.clanAccounts=Object.values(a).filter(W)}catch(a){f(a,{title:"Ошибка поучения списка клановых аккаунтов"})}e.loading--}async function C(){var t;e.loading++;try{const a=await U.stat.accounts.getSolo({lastBattleInDays:2,minWinRate:58,minBattles:1e4,minDamagePerBattle:1800,page:o.page,pageSize:o.pageSize});e.accounts=a.data,o.total=(t=a.meta)!=null&&t.hasNext?o.page*o.pageSize+a.data.length:o.page*o.pageSize-1}catch(a){f(a,{title:"Запрос соло игроков"})}e.loading--}async function w(t){await O(t.nickname)?d.add({type:"success",title:"Скопировано",message:t.nickname,duration:3e3}):d.add({type:"error",message:"При копировании что-то пошло не так",duration:3e3})}function B(t){Object.assign(o,t),u()}return(t,a)=>{const s=v,r=T,A=j,g=D,N=P,$=E,I=V;return l(),k(I,{class:"recruiting-page"},{default:i(()=>[c($,{class:"recruiting-page__table","row-key":"id",data:h(S),headers:b,"scroll-to-top":"","max-height":"calc(100vh - 70px)"},{position:i(({index:n})=>[m(p(n+1),1)]),win_rate:i(({row:n})=>[c(s,{"win-rate":n.win_rate},null,8,["win-rate"])]),nickname:i(({row:n})=>[M("div",H,[c(A,{class:"recruiting-page__name-copy","is-text":"",title:"Копировать (nickname)",onClick:Q=>w(n)},{default:i(()=>[c(r,{name:"content-copy"})]),_:2},1032,["onClick"]),c(g,{class:"link",to:{name:"account-id",params:{id:n.id}}},{default:i(()=>[m(p(n.nickname),1)]),_:2},1032,["to"])])]),clan:i(({row:n})=>[n.clan?(l(),k(g,{key:0,title:n.clan.name,class:"recruiting-page__clan link",to:{name:"clan-id",params:{id:n.clan.clan_id}}},{default:i(()=>[m(p(n.clan.tag),1)]),_:2},1032,["title","to"])):(l(),F("span",J,"---"))]),footer:i(()=>[c(N,{pagination:h(o),onChange:B},null,8,["pagination"])]),_:1},8,["data"])]),_:1})}}});export{wt as default};
