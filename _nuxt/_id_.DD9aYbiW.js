import{_ as L,a as H,u as ie,h as q}from"./disableScroll.DHm38N0M.js";import{_ as W}from"./nuxt-link.CnjmgimZ.js";import{_ as te}from"./CDialog.vue.DCMX0sJA.js";import{f as R,r as G,i as j,o as d,c as f,a,b as _,w as m,k as c,C as Z,t as o,d as u,F as O,A as U,m as A,j as P,D as oe,E as J,_ as K,n as V,q as ae,G as ce,s as Q,u as re,g as _e,H as de,I as ue}from"./entry.DfoUuq3X.js";import{s as E,_ as ne,a as z}from"./request.KP0oJ4ww.js";import{c as me,m as pe,s as X,_ as ve}from"./index.Ct_WXTaI.js";import{_ as fe}from"./ClanEmblem.vue.Dygtiuzv.js";import{_ as he}from"./PageSection.vue.AXfPuMwQ.js";import{_ as be}from"./CInput.vue.2V38F1JB.js";import{_ as ge}from"./CSelect.vue.Bwjii43I.js";import{f as S}from"./index.BWbWLZlG.js";import{_ as we}from"./RoleIcon.vue.DJvRwfsX.js";import{_ as ye}from"./WinRate.vue.DcjgJuKe.js";import{_ as $e,m as Y}from"./RatingIcon.vue.CYdDUqcd.js";import{_ as ke}from"./CTable.vue.CwAFX5CL.js";import{s as T}from"./index.BSyz7AFW.js";import{n as Ce}from"./notEmpty.BxBPJGBn.js";import{c as ee}from"./cloneDeep.BVCeudWk.js";import{a as De}from"./index.Sqwnd-tJ.js";import"./CImage.vue.Bt9jYEX6.js";import"./image-broken.B1Egd7NA.js";import"./nuxt-icon.DIr-5axS.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./index.CyzYM5Sw.js";import"./isArrayLike.B3jD5J6Q.js";const Ie={class:"clan-events"},xe={class:"clan-events__inner"},Be={class:"clan-events__count"},Ae={class:"clan-events__prop"},Pe=a("span",{class:"clan-events__prop-title"}," События от ",-1),je={key:0,class:"clan-events__prop"},Re={class:"clan-events__prop-title"},Se={key:1,class:"clan-events__prop"},Fe={class:"clan-events__prop-title"},Me={key:2},Ee={style:{display:"flex","justify-content":"space-between"}},Oe=a("div",null,null,-1),qe=R({__name:"ClanEvents",props:{savedAt:{type:Number,default:0,required:!0},clan:{type:Object,default:()=>({}),required:!0},savedClan:{type:Object,default:()=>({}),required:!0}},emits:["reset"],setup(n,{emit:h}){const e=n,p=G(null),v=j(()=>{const l=e.clan.members_ids??[],b=e.savedClan.members??[];return Object.values(b).filter(g=>!l.includes(g.account_id))}),$=j(()=>{var g,y;const l=((g=e.clan)==null?void 0:g.members)??[],b=((y=e.savedClan)==null?void 0:y.members_ids)??[];return Object.values(l).filter(I=>!b.includes(I.account_id))}),k=j(()=>$.value.length+v.value.length),D=h;function w(){var l;D("reset"),(l=p.value)==null||l.doClose()}function s(){var l;(l=p.value)==null||l.doOpen()}function i(){var l;(l=p.value)==null||l.doClose()}return(l,b)=>{const g=L,y=H,I=W,F=te;return d(),f("div",Ie,[a("div",xe,[_(y,{disabled:!c(k),class:Z(["clan-events__btn",[c(k)?"clan-events__btn--has-unread":""]]),"is-text":"","is-square":"",title:"События клана",onClick:s},{default:m(()=>[_(g,{name:"mail"})]),_:1},8,["disabled","class"]),a("div",Be,o(c(k)>99?"99+":c(k)),1)]),_(F,{ref_key:"dialogRef",ref:p,width:"640px",title:"События клана"},{title:m(()=>[a("div",Ae,[Pe,u(" "+o(l.$formatter.date.toDateTime(n.savedAt))+" ("+o(l.$formatter.date.toDaysPassed(n.savedAt,Date.now()))+") ",1)])]),footer:m(()=>[a("div",Ee,[Oe,a("div",null,[_(y,{onClick:w},{default:m(()=>[u(" Прочитано ")]),_:1}),_(y,{onClick:i},{default:m(()=>[u(" Закрыть ")]),_:1})])])]),default:m(()=>[c(v).length?(d(),f("div",je,[a("span",Re," Покинули ("+o(c(v).length)+") ",1),(d(!0),f(O,null,U(c(v),(t,r)=>(d(),f("span",{key:t.account_id,class:"clan-events__prop-value"},[_(I,{to:{name:"account-id",params:{id:t.account_id}},class:"link"},{default:m(()=>[u(o(t.account_name),1)]),_:2},1032,["to"]),u(o(r+1!==c(v).length?", ":""),1)]))),128))])):A("",!0),c($).length?(d(),f("div",Se,[a("span",Fe," Вступили ("+o(c($).length)+") ",1),(d(!0),f(O,null,U(c($),(t,r)=>(d(),f("span",{key:t.account_id,class:"clan-events__prop-value"},[_(I,{to:{name:"account-id",params:{id:t.account_id}},class:"link"},{default:m(()=>[u(o(t.account_name),1)]),_:2},1032,["to"]),u(o(r+1!==c($).length?", ":""),1)]))),128))])):A("",!0),c(k)?A("",!0):(d(),f("span",Me," Пока всё тихо ... "))]),_:1},512)])}}}),Te={class:"social-links"},Ve={class:"social-links__links"},Le=["href","title"],Ne=R({__name:"SocialLinks",props:{links:{type:Array,default:()=>[],required:!0}},setup(n){return(h,e)=>(d(),f("div",Te,[a("div",Ve,[(d(!0),f(O,null,U(n.links,p=>(d(),f("a",{key:p.link,class:"link social-links__links-item",href:p.link,target:"_blank",title:p.title},[(d(),P(oe(p.icon)))],8,Le))),128))])]))}}),ze=/(https?:\/\/)?(www\.)?(discord\.(gg|io|me|li)|discordapp\.com\/invite)\/.+[a-z|0-9]/gi,Ue=/(https?:\/\/)?(www\.)?((t|telegram)\.me)\/\+?[a-zA-Z0-9_]{5,32}/gi,He=n=>{const h=[],e=n.match(ze),p=n.match(Ue);return e!=null&&e.length&&h.push({title:"Discord",icon:J(()=>K(()=>import("./discord.SgprH5LJ.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),link:e[0]}),p!=null&&p.length&&h.push({title:"Telegram",icon:J(()=>K(()=>import("./telegram.CXKRH5tI.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url)),link:p[0]}),h},We={class:"clan-preview-details__body"},Ge={key:0,class:"clan-preview-details__section"},Ze={class:"clan-preview-details__props-title"},Je={class:"clan-preview-details__section"},Ke={class:"clan-preview-details__props-title"},Qe=["textContent"],Xe={key:1,class:"clan-preview-details__section"},Ye={class:"clan-preview-details__props-title"},et={class:"clan-preview-details__props"},tt={class:"clan-preview-details__prop"},at=a("span",{class:"clan-preview-details__prop-title"}," Создатель ",-1),nt={class:"clan-preview-details__prop"},st=a("span",{class:"clan-preview-details__prop-title"}," Дата создания ",-1),lt={class:"clan-preview-details__prop"},it=a("span",{class:"clan-preview-details__prop-title"}," Дата обновления ",-1),ot={class:"clan-preview-details__prop"},ct=a("span",{class:"clan-preview-details__prop-title"}," Участников ",-1),rt={key:0,class:"clan-preview-details__prop"},_t=a("span",{class:"clan-preview-details__prop-title"}," Старое название ",-1),dt={class:"clan-preview-details__section"},ut={class:"clan-preview-details__props-title"},mt={class:"clan-preview-details__props"},pt={class:"clan-preview-details__prop"},vt=a("span",{class:"clan-preview-details__prop-title"}," Политика приёма. ",-1),ft=a("div",{class:"clan-preview-details__props-subtitle"}," Пороги статистики для вступления: ",-1),ht={class:"clan-preview-details__prop"},bt=a("span",{class:"clan-preview-details__prop-title"}," Боёв в день ",-1),gt={class:"clan-preview-details__prop"},wt=a("span",{class:"clan-preview-details__prop-title"}," Боёв всего ",-1),yt={class:"clan-preview-details__prop"},$t=a("span",{class:"clan-preview-details__prop-title"}," Урон ср. ",-1),kt={class:"clan-preview-details__prop"},Ct=a("span",{class:"clan-preview-details__prop-title"}," Уровень ",-1),Dt={class:"clan-preview-details__prop"},It=a("span",{class:"clan-preview-details__prop-title"}," Побед ",-1),xt={style:{display:"flex","justify-content":"space-between"}},Bt=R({__name:"ClanPreviewDetails",props:{clan:{type:Object,default:()=>({}),required:!0}},setup(n,{expose:h}){const e=n,p=G(null),v=V({descExpended:!1}),$=j(()=>He(e.clan.description??""));function k(){var s;(s=p.value)==null||s.doOpen()}function D(){var s;(s=p.value)==null||s.doClose()}function w(){v.descExpended=!v.descExpended}return h({open:k,close:D}),(s,i)=>{const l=L,b=H,g=W,y=Ne,I=te;return d(),P(I,{ref_key:"clanDetailsRef",ref:p,class:"clan-preview-details",title:`[${n.clan.tag}] ${n.clan.name}`,width:"640px"},{footer:m(()=>[a("div",xt,[c($).length?(d(),P(y,{key:0,class:"clan-preview-details__links",links:c($)},null,8,["links"])):A("",!0),_(b,{onClick:D},{default:m(()=>[u(" Закрыть ")]),_:1})])]),default:m(()=>[a("div",We,[n.clan.motto?(d(),f("div",Ge,[a("h5",Ze,[_(l,{class:"clan-preview-details__prop-title-icon",name:"format-quote"}),u(" Девиз ")]),a("i",null,o(n.clan.motto),1)])):A("",!0),a("div",Je,[a("h5",Ke,[_(l,{class:"clan-preview-details__prop-title-icon",name:"description"}),u(" Описание ")]),n.clan.description?(d(),f("div",{key:0,class:Z(["content-area clan-preview-details__desc",c(v).descExpended?"clan-preview-details__desc--expended":""]),textContent:o(n.clan.description)},null,10,Qe)):A("",!0),_(b,{"is-text":"",class:"clan-preview-details__desc-expend-btn",onClick:w},{default:m(()=>[u(o(c(v).descExpended?"Свернуть":"Развернуть"),1)]),_:1})]),n.clan.motto?(d(),f("div",Xe,[a("h5",Ye,[_(l,{class:"clan-preview-details__prop-title-icon",name:"info"}),u(" Информация ")]),a("div",et,[a("div",tt,[at,n.clan.creator_id?(d(),P(g,{key:0,class:"link",to:n.clan.creator_id?{name:"account-id",params:{id:n.clan.creator_id}}:{}},{default:m(()=>[u(o(n.clan.creator_name),1)]),_:1},8,["to"])):(d(),f(O,{key:1},[u(" Не известен ")],64))]),a("div",nt,[st,u(" "+o(s.$formatter.date.toDate(n.clan.created_at*1e3)),1)]),a("div",lt,[it,u(" "+o(s.$formatter.date.toDate(n.clan.updated_at*1e3)),1)]),a("div",ot,[ct,u(" "+o(s.$formatter.number.toInteger(n.clan.members_count)),1)]),n.clan.old_tag?(d(),f("div",rt,[_t,u(" ["+o(n.clan.old_tag)+"] "+o(n.clan.old_name),1)])):A("",!0)])])):A("",!0),a("div",dt,[a("h5",ut,[_(l,{class:"clan-preview-details__prop-title-icon",name:"person-search"}),u(" Рекрутинг ")]),a("div",mt,[a("div",pt,[vt,u(" "+o(s.$formatter.clan.recruitingPolicy(n.clan.recruiting_policy))+". ",1)]),n.clan.recruiting_policy==="open"&&n.clan.recruiting_options?(d(),f(O,{key:0},[ft,a("div",ht,[bt,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.average_battles_per_day)),1)]),a("div",gt,[wt,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.battles)),1)]),a("div",yt,[$t,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.average_damage)),1)]),a("div",kt,[Ct,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.vehicles_level)),1)]),a("div",Dt,[It,u(" "+o(s.$formatter.number.toInteger(n.clan.recruiting_options.wins_ratio))+"% ",1)])],64)):A("",!0)])])])]),_:1},8,["title"])}}}),At={class:"clan-preview"},Pt={class:"clan-preview__inner"},jt={class:"clan-preview__emblem"},Rt={class:"clan-preview__info"},St={class:"clan-preview__title"},Ft={class:"clan-preview__tag"},Mt={class:"clan-preview__name"},Et={class:"clan-preview__props"},Ot={class:"clan-preview__prop"},qt=a("span",{class:"clan-preview__prop-title"}," Участников ",-1),Tt={class:"clan-preview__prop-value"},Vt={class:"clan-preview__prop"},Lt=a("span",{class:"clan-preview__prop-title"}," События ",-1),Nt={class:"clan-preview__prop-value"},zt={class:"clan-preview__actions"},Ut=R({__name:"ClanPreview",props:{clan:{type:Object,default:()=>({}),required:!0},hideDescription:{type:[Boolean,String],default:!1},loading:{type:Boolean,default:!1}},setup(n){const h=n,e=G(null),p=ie(),v=V({isFavorite:!1});ae(()=>{$()});async function $(){const i=await E.indexedDB.clansFavorites.get(h.clan.clan_id);v.isFavorite=i?i==null?void 0:i.isFavorite:!1}async function k(){h.clan&&(v.isFavorite=!v.isFavorite,await E.indexedDB.clansFavorites.set(h.clan.clan_id,{id:h.clan.clan_id,isFavorite:v.isFavorite}))}async function D(){await me(`${h.clan.tag}/${h.clan.clan_id}`)?p.add({type:"success",title:"Скопировано",message:`${h.clan.tag}/${h.clan.clan_id}`,duration:3e3}):p.add({type:"error",message:"Клан копировании что-то пошло не так",duration:3e3})}function w(){var i;(i=e.value)==null||i.open()}function s(){k()}return(i,l)=>{const b=L,g=H,y=ne,I=Bt;return d(),f("div",At,[a("div",Pt,[a("div",jt,[_(fe,{class:"clan-preview__emblem-img",alt:n.clan.name,emblem:n.clan.emblem_set_id},null,8,["alt","emblem"])]),a("div",Rt,[a("div",St,[a("span",Ft,"["+o(n.clan.tag??"...")+"]",1),a("span",Mt,o(n.clan.name??"..."),1)]),a("div",Et,[a("div",Ot,[qt,a("span",Tt,o(n.clan.members_count??"---"),1)]),a("div",Vt,[Lt,a("span",Nt,[ce(i.$slots,"events")])])])]),a("div",zt,[_(g,{"is-text":"",class:"clan-preview__actions-btn",title:"Копировать (nickname/ID)",onClick:D},{default:m(()=>[_(b,{name:"content-copy"})]),_:1}),_(g,{"is-text":"",class:"clan-preview__actions-btn",title:"Добавить в избранные",onClick:s},{default:m(()=>[c(v).isFavorite?(d(),P(b,{key:0,name:"star"})):(d(),P(b,{key:1,name:"star-border"}))]),_:1}),_(g,{"is-text":"",class:"clan-preview__actions-btn",title:"Полная информация",onClick:w},{default:m(()=>[_(b,{name:"info"})]),_:1})])]),_(y,{loading:n.loading},null,8,["loading"]),_(I,{ref_key:"previewDetailsRef",ref:e,clan:n.clan},null,8,["clan"])])}}}),Ht={class:"clan-view-filters"},Wt={class:"clan-view-filters__list"},Gt={class:"clan-view-filters__item clan-view-filters__item--search"},Zt=a("div",{class:"clan-view-filters__item-title"}," Поиск в клане ",-1),Jt={class:"clan-view-filters__item"},Kt=a("div",{class:"clan-view-filters__item-title"}," Дней в клане ",-1),Qt={class:"clan-view-filters__item"},Xt=a("div",{class:"clan-view-filters__item-title"}," Дней отсутствовал ",-1),Yt=R({__name:"ClanViewFilter",props:{filters:{type:Object,required:!0,default:S.makeClanFilters}},emits:["filters-change"],setup(n,{emit:h}){const e=n,p=[{value:null,label:"Не выбрано"},{value:"<3",label:"Меньше чем 3"},{value:"<5",label:"Меньше чем 5"},{value:"<7",label:"Меньше чем 7"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],v=[{value:null,label:"Не выбрано"},{value:"<1",label:"Меньше чем 1"},{value:"<3",label:"Меньше чем 3"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],$=h;function k(D,w){$("filters-change",{...e.filters,[D]:w})}return(D,w)=>{const s=be,i=ge;return d(),f("div",Ht,[a("div",Wt,[a("div",Gt,[Zt,_(s,{"model-value":n.filters.search,style:{width:"100%"},placeholder:"Введите ник",type:"search","onUpdate:modelValue":w[0]||(w[0]=l=>k("search",l))},null,8,["model-value"])]),a("div",Jt,[Kt,_(i,{"model-value":n.filters.joinedAtDays,style:{width:"150px"},options:p,onChange:w[1]||(w[1]=l=>k("joinedAtDays",l))},null,8,["model-value"])]),a("div",Qt,[Xt,_(i,{"model-value":n.filters.lastBattleDays,style:{width:"150px"},options:v,onChange:w[2]||(w[2]=l=>k("lastBattleDays",l))},null,8,["model-value"])])])])}}}),ea={class:"clan-view-table"},ta={class:"clan-view-table__total"},aa={class:"clan-view-table__total-value"},na={class:"clan-view-table__member"},sa=["title"],la={key:0,class:"clan-view-table__name clan-view-table__name--deleted"},ia={class:"clan-view-table__sub"},oa={class:"clan-view-table__sub"},ca={class:"clan-view-table__sub"},ra={class:"clan-view-table__sub"},_a={class:"clan-view-table__sub"},da={class:"clan-view-table__sub"},ua=R({__name:"ClanViewMembersTable",props:{members:{type:Array,default:()=>[],required:!0},savedMembers:{type:Array,default:()=>[],required:!0},users:{type:Array,default:()=>[],required:!0},sort:{type:Object,default:()=>({}),required:!0}},emits:["sort"],setup(n,{emit:h}){const e=n,p=h,v=[{key:"account_name",label:"Ник",sortable:!0},{key:"battles",label:"Боёв",sortable:!0,sortMethod(s,i){return s.statistic.all.battles-i.statistic.all.battles}},{key:"winRate",label:"Побед",sortable:!0,sortMethod(s,i){return s.statistic.all.winRate-i.statistic.all.winRate}},{key:"damagePerBattle",label:"Урон",sortable:!0,sortMethod(s,i){return s.statistic.all.damagePerBattle-i.statistic.all.damagePerBattle}},{key:"rating",label:"Рейтинг",sortable:!0,sortMethod(s,i){var g,y;const l=((g=s.statistic.rating)==null?void 0:g.rating)??0,b=((y=i.statistic.rating)==null?void 0:y.rating)??0;return l-b}},{key:"battlesPerDay",label:"Боёв в день",sortable:!0},{key:"last_battle_time",label:"Последний бой",sortable:!0},{key:"joined_at",label:"В клане",sortable:!0}],$=j(()=>e.members.map(s=>{const i=e.savedMembers.find(y=>y.account_id===s.account_id),l=i?T.diff(s.statistic.all,i.statistic.all):null,b=T.battlesPerDay({createAt:s.create_at*1e3,battles:s.statistic.all.battles}),g=i?T.battlesPerDay({createAt:i.create_at,battles:(l==null?void 0:l.battles)||0})-b:null;return{...s,battlesPerDay:b,battlesPerDayDiff:g,diff:l}}));function k(s){const i=e.users.find(l=>l.id===s.account_id);return i?{found:!0,online:Date.now()-new Date(i.visitedAt).valueOf()<1e3*60*5}:{found:!1,online:!1}}function D(s){const i=s;return/^del_\d+$/.test(i.account_name)||!i.last_battle_time}function w(s,i){const l=i;return l.diff?s==="winRate"?Q.number.toFloatNumber(l.diff[s],!0):Q.number.toInteger(l.diff[s],!0):"---"}return(s,i)=>{const l=we,b=L,g=W,y=ye,I=$e,F=ke;return d(),f("div",ea,[a("div",ta,[u(" Кол-во: "),a("span",aa,o(c($).length||0),1)]),c($)?(d(),P(F,{key:0,data:c($),"default-sort":n.sort,headers:v,"no-wrap":"","scroll-auto-disabling":"","row-key":"account_id",height:"calc(100vh - 112px)",class:"clan-view-table__table",onSort:i[0]||(i[0]=t=>p("sort",t))},{account_name:m(({row:t})=>[a("span",na,[a("span",{class:Z(["clan-view-table__role",["clan-view-table__role--"+t.role,k(t).found?"clan-view-table__role--is-user":"",k(t).online?"clan-view-table__role--is-online":""]]),title:s.$formatter.clan.role(t.role)??"Не известна"},[t.role?(d(),P(l,{key:0,width:"18",height:"18",class:"clan-view-table__role-icon",role:t.role},null,8,["role"])):(d(),P(b,{key:1,style:{width:"16px",color:"var(--color-text-light)"},name:"close"}))],10,sa),D(t)?(d(),f("span",la,o(t.account_name),1)):(d(),P(g,{key:1,class:"link clan-view-table__name",to:{name:"account-id",params:{id:t.account_id}}},{default:m(()=>[u(o(t.account_name),1)]),_:2},1032,["to"]))])]),battles:m(({row:t})=>[u(o(t.statistic.all.battles||"---")+" ",1),a("span",ia,o(w("battles",t)||"---"),1)]),winRate:m(({row:t})=>[_(y,{"model-value":t.statistic.all.winRate,class:"clan-view-table__win-rate"},null,8,["model-value"]),a("span",oa,o(w("winRate",t)||"---"),1)]),rating:m(({row:t})=>[_(I,{rating:t.statistic.rating},null,8,["rating"])]),damagePerBattle:m(({row:t})=>[u(o(t.statistic.all.damagePerBattle||"---")+" ",1),a("span",ca,o(w("damagePerBattle",t)),1)]),battlesPerDay:m(({row:t})=>[u(o(t.battlesPerDay||"---")+" ",1),a("span",ra,o(s.$formatter.number.toInteger(t.battlesPerDayDiff,!0)||"---"),1)]),last_battle_time:m(({row:t})=>[u(o(s.$formatter.date.toRelativeTime(t.last_battle_time*1e3)||"---")+" ",1),a("span",_a,o(s.$formatter.date.toDateTime(t.last_battle_time*1e3)||"---"),1)]),joined_at:m(({row:t})=>[u(o(s.$formatter.date.toDaysPassed(t.joined_at*1e3)||"---")+" ",1),a("span",da,o(s.$formatter.date.toDate(t.joined_at*1e3)||"---"),1)]),_:1},8,["data","default-sort"])):A("",!0)])}}}),ma={key:0,class:"clan-page"},pa={key:1,class:"clan-page--no-data"},va={key:0,class:"content-area"},fa=a("p",null,"Нет данных.",-1),ha=a("p",null,"Возможно клан удалён.",-1),ba=[fa,ha],Ua=R({__name:"[id]",setup(n){re({title:"Инфо / Кланы"});const h=_e(),e=V({loading:0,users:[],clanInfo:null,clan:null,filters:S.makeClanFilters(),statisticsSum:null,savedMembers:[],savedClan:null,metricsItems:[],clanSavedAt:0}),p=V({order:"desc",prop:""}),v=j(()=>{var t;return((t=e.clan)==null?void 0:t.members)||[]}),$=j(()=>{let t=v.value.filter(C=>{const B=C.account_name.toLowerCase(),M=e.filters.search.toLowerCase();return B.includes(M)});const r=Date.now(),x=1e3*60*60*24;if(e.filters.joinedAtDays){const C=S.parseParameter(e.filters.joinedAtDays);t=v.value.filter(B=>S.executeExpression(r-Number(C.value)*x,B.joined_at*1e3,C.operator))}if(e.filters.lastBattleDays){const C=S.parseParameter(e.filters.lastBattleDays);t=v.value.filter(B=>S.executeExpression(r-Number(C.value)*x,B.last_battle_time*1e3,C.operator))}return t});ae(()=>{const t=+h.params.id;t&&i(t)});async function k(t){e.loading++;try{const{data:r}=await z.clan.getAccountInfo({account_id:t.join(",")});return r}catch(r){return q(r,{title:"Получение данных участников клана"}),null}finally{e.loading--}}async function D(t){e.loading++;try{const{data:r}=await z.clan.getInfo({clan_id:t});e.clanInfo=r[t]??null}catch(r){q(r,{title:"Получение данных клана"})}e.loading--}async function w(t){e.loading++;try{const{data:r}=await De.user.getList({id:t});e.users=r}catch(r){q(r,{title:"Получение данных аккаунта"})}e.loading--}async function s(t){e.loading++;try{const{data:r}=await z.account.getInfo({extra:"statistics.rating",account_id:t.join(",")});return r}catch(r){return q(r,{title:"Получение данных аккаунта"}),null}finally{e.loading--}}async function i(t){if(await D(t),!e.clanInfo)return;const r=await k(e.clanInfo.members_ids);e.clanInfo.members=r,await Promise.all([w(e.clanInfo.members_ids),l(e.clanInfo),g(e.clanInfo)]),e.savedClan||await b(e.clanInfo);const x=await s(e.clanInfo.members_ids);if(!x)return;e.clan=Y.clan(e.clanInfo,x);const C=Object.values(x).filter(Ce);e.statisticsSum=C.reduce((B,M,N)=>N===0?C[0].statistics:T.sumFull(B,M.statistics),{}),e.metricsItems=pe.clan(C,e.statisticsSum),X.clanMembersDefault(v.value)}async function l(t){e.loading++;const r=[];for(const x in t.members){const C=await E.indexedDB.accountsInfo.get(x);C&&(C.data.created_at=C.timestamp,r.push(Y.clanMember(t.members[x],C.data)))}e.savedMembers=r,e.loading--}async function b(t){e.loading++,await E.indexedDB.clansInfo.set(t.clan_id,de(t)),e.savedClan=ee(t),e.clanSavedAt=Date.now(),e.loading--}async function g(t){e.loading++;const r=await E.indexedDB.clansInfo.get(t.clan_id);e.savedClan=(r==null?void 0:r.data)??null,e.clanSavedAt=(r==null?void 0:r.timestamp)??0,e.loading--}function y(t){t.order||X.clanMembersDefault(v.value)}async function I(){e.clanInfo&&await b(e.clanInfo)}function F(t){console.log(t.search),e.filters=ee(t)}return(t,r)=>{const x=qe,C=Ut,B=he,M=ve,N=Yt,se=ua,le=ne;return c(e).clanInfo?(d(),f("div",ma,[_(B,{identity:"preview"},{default:m(()=>[_(C,{class:"clan-page__preview","hide-description":!0,clan:c(e).clanInfo,loading:c(e).loading>0},ue({_:2},[c(e).clanInfo&&c(e).savedClan?{name:"events",fn:m(()=>[_(x,{clan:c(e).clanInfo,"saved-clan":c(e).savedClan,"saved-at":c(e).clanSavedAt,onReset:I},null,8,["clan","saved-clan","saved-at"])]),key:"0"}:void 0]),1032,["clan","loading"])]),_:1}),_(B,{title:"Статистика",identity:"statistic"},{default:m(()=>[_(M,{loading:c(e).loading>0,items:c(e).metricsItems},null,8,["loading","items"])]),_:1}),_(B,{title:"Участники",identity:"members"},{default:m(()=>[_(N,{class:"clan-page__filters",filters:c(e).filters,onFiltersChange:F},null,8,["filters"]),_(se,{sort:c(p),users:c(e).users,"saved-members":c(e).savedMembers,members:c($),onSort:y},null,8,["sort","users","saved-members","members"])]),_:1})])):(d(),f("div",pa,[c(e).loading?A("",!0):(d(),f("div",va,ba)),_(le,{loading:c(e).loading>0},null,8,["loading"])]))}}});export{Ua as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./discord.SgprH5LJ.js","./nuxt-icon.DIr-5axS.js","./_plugin-vue_export-helper.DlAUqK2U.js","./entry.DfoUuq3X.js","./nuxt-icon.MfBulapQ.css","./telegram.CXKRH5tI.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
