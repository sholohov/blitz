import{_ as q}from"./DReJ8vQK.js";import{_ as N}from"./nNENDGj9.js";import{_ as R}from"./EAeUkgBq.js";import{_ as b}from"./W1n9aEx_.js";import{d as L,e as B,o as u,n as p,F as x,D as T,p as n,x as m,j as d,v as w,I as H,g as r,u as U,a as j,b as D,c as A,l as $,q as F,m as I,B as O,s as k,t as W,f as G,w as M}from"./BzQ49_ll.js";import{_ as P}from"./ClKgTggm.js";import{c as J}from"./B4FMxlHh.js";import"./3OUiC8Lt.js";import"./Dz0q-Wbl.js";import"./DD4asW33.js";import"./CXg2uAHC.js";import"./B3dZcLnw.js";import"./BxBPJGBn.js";import"./B6X_EJD7.js";import"./CBZ5Hpp1.js";import"./Dzhj1Yli.js";import"./CEk9wgDu.js";import"./BDnRw2QZ.js";import"./AxE_3BVK.js";import"./DlAUqK2U.js";import"./BLT2yTlJ.js";import"./D18XexEg.js";import"./CUW021nm.js";import"./DZCDALHE.js";import"./B4KzezSC.js";const K={class:"tournaments-list"},Q={class:"tournaments-list__section-title"},X={class:"tournaments-list__list"},Y={class:"tournaments-list__item-img-wrapper"},Z={class:"tournaments-list__item-content"},tt={class:"tournaments-list__item-title"},st={class:"tournaments-list__item-tier"},et={class:"tournaments-list__item-details"},nt={class:"tournaments-list__item-date"},ot=L({__name:"TournamentsList",props:{tournaments:{type:Array,default:()=>[],required:!0},loading:{type:Boolean,default:!1}},setup(g){const f=g,c=B(()=>{const i={running:[],registration_started:[],registration_finished:[],upcoming:[],finished:[],complete:[]};return f.tournaments.forEach(t=>{i[t.status].push(t)}),Object.entries(i).map(([t,s])=>({status:t,list:s})).filter(t=>t.list.length)});function h(i){const t=i.description.match(/Уровень техники: (.+?)\./i);return t!=null&&t[1]?t==null?void 0:t[1]:""}return(i,t)=>{const s=N,v=R,y=b;return u(),p("div",K,[(u(!0),p(x,null,T(r(c),l=>(u(),p("div",{key:l.status,class:"tournaments-list__section"},[n("div",Q,m(i.$formatter.tournament.status(l.status)),1),n("ul",X,[(u(!0),p(x,null,T(l.list,o=>(u(),p("li",{key:o.tournament_id,class:"tournaments-list__item"},[n("div",Y,[d(s,{class:"tournaments-list__item-img",loading:"lazy",src:o.logo.original,alt:"image"},null,8,["src"])]),n("div",Z,[n("div",tt,[w(m(o.title)+" ",1),n("div",st,m(h(o)),1)]),n("div",et,[n("div",nt,m(i.$formatter.date.toDateTime(o.start_at*1e3)),1),n("div",{class:H(["tournaments-list__item-status",["tournaments-list__item-status--"+o.status]])},m(i.$formatter.tournament.status(o.status)),3)])]),d(v,{class:"tournaments-list__item-link link",to:{name:"tournaments-id",params:{id:o.tournament_id}}},null,8,["to"])]))),128))])]))),128)),d(y,{loading:g.loading},null,8,["loading"])])}}}),at={class:"tournaments-page__filter"},it={class:"tournaments-page__count"},rt={class:"tournaments-page__list"},Nt=L({__name:"index",setup(g){const{$formatter:f}=U(),c=j();D({title:()=>f.route.getTitle(J.toString(c.name)??"")});const h=[null,"upcoming","registration_started","registration_finished","running","finished","complete"],i=A(),t=$({loading:0,tournaments:[],status:null}),s=$({page:1,pageSize:25,total:0}),v=$(h.map(e=>({label:e?F.tournament.status(e):"Все",value:e}))),y=B(()=>s.total>s.page*s.pageSize);I(async()=>{var e;t.status=((e=c.query)==null?void 0:e.status)??null,S(),await o(),window.addEventListener("scroll",l)}),O(()=>{window.removeEventListener("scroll",l)});function l(){const{scrollTop:e,scrollHeight:a,clientHeight:_}=document.documentElement;t.loading===0&&y.value&&e+_>=a-100&&(s.page+=1,o())}async function o(){t.loading++;try{if(t.status===null&&s.page===1){const _=await k.tournaments.getList({limit:s.pageSize,status:"running"});t.tournaments.push(..._.data)}const e=["upcoming","registration_started","registration_finished","finished","complete"].join(","),a=await k.tournaments.getList({limit:s.pageSize,page_no:s.page,status:t.status??e});s.total=a.meta.total,t.tournaments.push(...a.data)}catch(e){W(e,{title:"Получение списка турниров"})}t.loading--}function S(){i.replace({query:{...c.query,status:t.status||null}}).catch(()=>{})}function z(){s.page=1,t.tournaments=[],S(),o()}return(e,a)=>{const _=q,C=ot,E=P;return u(),G(E,{class:"tournaments-page"},{default:M(()=>[n("div",at,[a[1]||(a[1]=w(" По статусу: ")),d(_,{modelValue:r(t).status,"onUpdate:modelValue":a[0]||(a[0]=V=>r(t).status=V),style:{width:"200px"},options:r(v),onChange:z},null,8,["modelValue","options"])]),n("div",it,[a[2]||(a[2]=n("span",{class:"tournaments-page__count-title"}," Кол-во: ",-1)),w(" "+m(r(s).total),1)]),n("div",rt,[d(C,{tournaments:r(t).tournaments,loading:r(t).loading>0},null,8,["tournaments","loading"])])]),_:1})}}});export{Nt as default};
