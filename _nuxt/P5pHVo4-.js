import{_ as ct}from"./B2ejvlwh.js";import{d as H,o as u,l as b,m as n,F as O,B as E,t as _,q as w,g as R,n as U,j as P,c as G,k as X,p as M,f as o,h as S,E as K,w as D,e as F,r as ut,z as mt,Y as _t,ac as dt,ad as pt,ae as gt,a5 as ft,u as ht,a as bt,b as yt}from"./DJlEGeV1.js";import{_ as Z}from"./C93CMuTi.js";import{u as j}from"./j8H2iFUT.js";import{_ as vt}from"./NWUEeXks.js";import{_ as Q}from"./PfUKTOG5.js";import{_ as $t}from"./rxWbx8Xz.js";import{_ as Tt}from"./DrOSxoAn.js";import{_ as wt}from"./3lIG1lYq.js";import{n as nt}from"./BxBPJGBn.js";import{s as J}from"./CqK7YKqf.js";import{_ as kt}from"./D-TuSGJo.js";import{d as St,t as It}from"./RA3fBwkA.js";import{_ as Ct}from"./D_bDmjDt.js";import{_ as st}from"./DqK6BF4J.js";import{_ as At}from"./D7qzDtCI.js";import{_ as xt}from"./CAAaFnNp.js";import"./BV1GL1vA.js";import"./CpfoCNYP.js";import"./DlAUqK2U.js";import"./pQ9QSYKp.js";import"./C1V66jBN.js";import"./DD4asW33.js";import"./roZIKyQo.js";import"./RPJY7rI9.js";import"./B7WhaZnE.js";import"./YbE3Ovi3.js";import"./BE0zBel4.js";import"./BVA0GR3k.js";import"./btAca64B.js";import"./CIh7AwxB.js";import"./Dmx_wtdT.js";import"./BmHpWDuk.js";import"./HeP0UT03.js";import"./C35J47Ry.js";const Ot={key:0,class:"tournaments-stages"},Rt={class:"tournaments-stages__inner"},Gt={class:"tournaments-stages__list"},Lt={class:"tournaments-stages__title"},qt={class:"tournaments-stages__params"},Dt={class:"tournaments-stages__param"},Et={class:"tournaments-stages__param"},Mt={class:"tournaments-stages__param"},jt={class:"tournaments-stages__param"},Nt=H({__name:"TournamentsStages",props:{stages:{type:Array,default:()=>[]}},setup(m){function s(t){const e=U.encyclopedia.tier(t.min_tier),l=U.encyclopedia.tier(t.max_tier);return e===l?e:`${e} - ${l}`}return(t,e)=>m.stages.length?(u(),b("div",Ot,[n("div",Rt,[n("ul",Gt,[(u(!0),b(O,null,E(m.stages,l=>(u(),b("li",{key:l.stage_id,class:"tournaments-stages__stage"},[n("div",Lt,_(l.title),1),n("div",qt,[n("div",Dt,[e[0]||(e[0]=n("span",{class:"tournaments-stages__param-title"}," Дата ",-1)),l.start_at?(u(),b(O,{key:0},[w(_(t.$formatter.date.toDateTime(l.start_at*1e3)),1)],64)):(u(),b(O,{key:1},[w(" --- ")],64))]),n("div",Et,[e[1]||(e[1]=n("span",{class:"tournaments-stages__param-title"}," Система ",-1)),w(" "+_(t.$formatter.tournament.stageType(l.type)),1)]),n("div",Mt,[e[2]||(e[2]=n("span",{class:"tournaments-stages__param-title"}," Уровень ",-1)),w(" "+_(s(l)),1)]),n("div",jt,[e[3]||(e[3]=n("span",{class:"tournaments-stages__param-title"}," Условие ",-1)),w(" до "+_(l.victory_limit)+" побед ",1)])])]))),128))])])])):R("",!0)}}),Ut={class:"tournaments-matches"},Ft={class:"tournaments-matches__filters"},Pt={class:"tournaments-matches__filters-item"},Vt={class:"tournaments-matches__filters-item"},Bt={class:"tournaments-matches__list"},Ht={class:"tournaments-matches__round"},Wt={class:"tournaments-matches__teams"},Yt={class:"tournaments-matches__score"},Xt={class:"tournaments-matches__date"},zt=H({__name:"TournamentsMatches",props:{stages:{type:Array,default:()=>[],required:!0},tournamentId:{type:Object,default:()=>({}),required:!0}},setup(m){const s=m,t=P({loading:0,matches:[],selectedStage:null,selectedGroup:null}),e=P({page:1,pageSize:25,total:0}),l=G(()=>s.stages.map(i=>({label:i.title,value:i}))),$=G(()=>t.selectedStage?t.selectedStage.groups.map(i=>({label:`Группа ${i.group_order}`,value:i})):[]);X(()=>{var i;t.selectedStage=I(),t.selectedGroup=((i=t.selectedStage)==null?void 0:i.groups[0])??null,g()});function I(){const i=s.stages.findLast(y=>y.state==="complete");return s.stages.findLast(y=>y.state==="schedule_ready")??i??s.stages[0]}function g(){!t.selectedStage||!t.selectedGroup||f(s.tournamentId,t.selectedStage.stage_id,t.selectedGroup.group_id)}async function f(i,c,y){t.loading++;try{const{data:v,meta:h}=await M.tournaments.getMatches({tournament_id:i,stage_id:c,group_id:y,limit:e.pageSize,page_no:e.page});e.total=h.total,t.matches=v}catch(v){j(v,{title:"Получение списка матчей"})}t.loading--}function C(i){t.selectedStage=i,t.selectedGroup=i.groups[0],e.page=1,g()}function A(i){t.selectedGroup=i,e.page=1,g()}return(i,c)=>{var v;const y=Z;return u(),b("div",Ut,[n("div",Ft,[n("div",Pt,[w(" Этап ("+_(o(e).total??0)+") ",1),S(y,{value:o(t).selectedStage,"id-key":"stage_id",style:{width:"250px"},options:o(l),onChange:C},null,8,["value","options"])]),n("div",Vt,[w(" Группа ("+_(((v=o(t).selectedStage)==null?void 0:v.groups.length)??0)+") ",1),S(y,{value:o(t).selectedGroup,"id-key":"group_id",style:{width:"170px"},options:o($),onChange:A},null,8,["value","options"])])]),n("div",Bt,[(u(!0),b(O,null,E(o(t).matches,h=>(u(),b("div",{key:h.id,class:"tournaments-matches__match"},[n("div",Ht," round: "+_(h.round),1),n("div",Wt,[(u(),b(O,null,E([1,2],x=>n("div",{key:x,class:K(["tournaments-matches__team",["tournaments-matches__team--"]])},[w(_(h[`team_${x}_id`])+" ",1),n("span",Yt,_(h[`team_${x}_score`]||0),1)])),64))]),n("span",Xt,_(i.$formatter.date.toDateTime(h.start_time*1e3)),1)]))),128))])])}}}),Jt={class:"tournament-team"},Kt={class:"tournament-team__inner"},Qt={class:"tournament-team__props-list"},Zt={class:"tournament-team__props"},te={class:"tournament-team__props"},ee={class:"tournament-team__props"},ae={class:"tournament-team__player-list"},ne={key:0,class:"tournament-team__details"},se={class:"tournament-team__player-name"},oe={class:"tournament-team__player-stat"},ie={class:"tournament-team__stat-item"},re={key:1,class:"tournament-team__empty"},le=H({__name:"TournamentTeam",props:{tournament:{type:Object,default:()=>({}),required:!0},team:{type:Object,default:()=>({}),required:!0}},setup(m){const s=m,t=P({loading:0,players:[],statisticsAll:null});X(()=>{const g=s.tournament.max_players_count;t.players=Array(g).fill($({})),I()});async function e(g){t.loading++;try{const{data:f}=await M.clan.getAccountInfo({extra:"clan",account_id:g.join(",")});return Object.values(f).filter(nt)}catch(f){return j(f,{title:"Поучение списка клановых аккаунтов"}),[]}finally{t.loading--}}async function l(g){t.loading++;try{const{data:f}=await M.account.getInfo({extra:"statistics.rating",account_id:g.join(",")});return Object.values(f).filter(nt)}catch(f){return j(f,{title:"Поучение списка аккаунтов"}),[]}finally{t.loading--}}function $(g){var A,i,c,y,v,h,x,d;const f=(A=g.account)==null?void 0:A.statistics.all,C=(i=g.account)==null?void 0:i.statistics.rating;return{id:((c=g.player)==null?void 0:c.account_id)??0,name:((y=g.player)==null?void 0:y.name)??"",isOwner:((v=g.player)==null?void 0:v.role)==="owner",clan:(h=g.clanAccount)!=null&&h.clan?{id:g.clanAccount.clan_id,tag:((x=g.clanAccount.clan)==null?void 0:x.tag)??"",name:((d=g.clanAccount.clan)==null?void 0:d.name)??""}:null,statistic:{all:f?J.accountAll(f):null,rating:C?J.accountRating(C):null}}}async function I(){const g=s.team.players.map(c=>c.account_id),[f,C]=await Promise.all([l(g),e(g)]),A=f.reduce((c,y,v)=>v===0?f[0].statistics:J.sumFull(c,y.statistics),{});t.statisticsAll=J.accountAll(A.all,f.length);const i=s.tournament.max_players_count;t.players=Array(i).fill({}).map((c,y)=>{const v=s.team.players[y],h=f.find(d=>d.account_id===(v==null?void 0:v.account_id)),x=C.find(d=>d.account_id===(v==null?void 0:v.account_id));return $({player:v,account:h,clanAccount:x})}).sort(c=>c.isOwner?1:0)}return(g,f)=>{var y,v;const C=$t,A=Tt,i=wt,c=Q;return u(),b("div",Jt,[n("div",Kt,[n("div",Qt,[n("div",Zt,[f[0]||(f[0]=n("span",{class:"tournament-team__props-title"},"Статус",-1)),w(" "+_(g.$formatter.tournament.teamStatusDetails(m.team.status)),1)]),n("div",te,[f[1]||(f[1]=n("span",{class:"tournament-team__props-title"},"Ср. побед",-1)),S(C,{"win-rate":((y=o(t).statisticsAll)==null?void 0:y.winRate)||0},null,8,["win-rate"])]),n("div",ee,[f[2]||(f[2]=n("span",{class:"tournament-team__props-title"},"Ср. боёв",-1)),w(" "+_(g.$formatter.number.toInteger(((v=o(t).statisticsAll)==null?void 0:v.battles)||0)),1)])]),n("ul",ae,[(u(!0),b(O,null,E(o(t).players,(h,x)=>{var d;return u(),b("li",{key:h.id||x,class:"tournament-team__player"},[S(A,{width:"18",height:"18",class:"tournament-team__player-role",role:h.isOwner?"commander":"private"},null,8,["role"]),h.id?(u(),b("div",ne,[n("div",se,[S(i,{class:"tournament-team__player-link link",to:{name:"account-id",params:{id:h.id}}},{default:D(()=>[w(_(h.name),1)]),_:2},1032,["to"]),h.clan?(u(),F(i,{key:0,class:"tournament-team__player-link link",to:{name:"clan-id",params:{id:h.clan.id}}},{default:D(()=>{var k;return[w(_(`[${(k=h.clan)==null?void 0:k.tag}]`),1)]}),_:2},1032,["to"])):R("",!0)]),n("span",oe,[h.statistic.all?(u(),F(C,{key:0,class:"tournament-team__stat-item","win-rate":h.statistic.all.winRate},null,8,["win-rate"])):R("",!0),n("span",ie,_((d=h.statistic.all)==null?void 0:d.battles),1)])])):(u(),b("span",re," Место свободно "))])}),128))]),S(c,{"backdrop-light":"",loading:o(t).loading>0},null,8,["loading"])])])}}}),ce={class:"tournaments-teams"},ue={class:"tournaments-teams__filters"},me={class:"tournaments-teams__filters-item"},_e={class:"tournaments-teams__filters-item"},de={class:"tournaments-teams__count"},pe={class:"tournaments-teams__list"},ge=["onClick"],fe={class:"tournaments-teams__team-description"},he={class:"tournaments-teams__team-name"},be={class:"tournaments-teams__team-owner"},ye={class:"tournaments-teams__team-owner-text"},ve={class:"tournaments-teams__team-count"},$e=H({__name:"TournamentsTeams",props:{tournament:{type:Object,default:()=>({}),required:!0}},setup(m){const s=[null,"confirmed","forming","disqualified"],t=m,e=ut(null),l=P({loading:0,teams:[],currentTeam:null}),$=P({page:1,total:0,pageSize:50}),I=P({status:"confirmed",search:""}),g=s.map(d=>({label:d?U.tournament.teamStatus(d):"Все",value:d})),f=G(()=>$.total>$.page*$.pageSize);X(()=>{window.addEventListener("scroll",y)}),mt(()=>{window.removeEventListener("scroll",y)});function C(d){var k;return(k=d.players.find(L=>L.role==="owner"))==null?void 0:k.name}const A=St(i,1e3,{leading:!0});async function i(){await c()}async function c(){l.loading++;try{const{data:d,meta:k}=await M.tournaments.getTeams({tournament_id:t.tournament.tournament_id,limit:$.pageSize,page_no:$.page,...I});$.total=k.total,l.teams.push(...d)}catch(d){j(d,{title:"Получение списка команд"})}l.loading--}function y(){if(!l.teams.length)return;const{scrollTop:d,scrollHeight:k,clientHeight:L}=document.documentElement;l.loading===0&&f.value&&f.value&&d+L>=k-100&&($.page+=1,c())}function v(){$.page=1,l.teams=[],i()}async function h(d=""){I.search=d=d.trim(),!(d.length<2&&d!=="")&&($.page=1,l.teams=[],await A())}function x(d){var k;l.currentTeam=d,(k=e.value)==null||k.doOpen()}return(d,k)=>{var p;const L=Z,W=vt,B=Q,a=le,r=kt;return u(),b("div",ce,[n("div",ue,[n("div",me,[k[0]||(k[0]=w(" Статус ")),S(L,{"model-value":o(I).status,style:{width:"220px"},options:o(g),onChange:v},null,8,["model-value","options"])]),n("div",_e,[k[1]||(k[1]=w(" Поиск ")),S(W,{"model-value":o(I).search,type:"search",placeholder:"Введите название команды",style:{width:"300px"},onInput:h},null,8,["model-value"])])]),n("div",de,[k[2]||(k[2]=n("div",{class:"tournaments-teams__count-title"}," Кол-во: ",-1)),w(" "+_(o($).total||0),1)]),n("div",pe,[(u(!0),b(O,null,E(o(l).teams,T=>(u(),b("button",{key:T.team_id,class:"tournaments-teams__team",onClick:q=>x(T)},[n("span",{class:K(["tournaments-teams__status",[T.status?`tournaments-teams__status--${T.status}`:""]])},null,2),n("span",fe,[n("span",he,_(T.title),1),n("span",be,[n("span",ye,_(C(T)),1)])]),n("span",ve,_(T.players.length)+" / "+_(m.tournament.max_players_count),1)],8,ge))),128)),S(B,{loading:o(l).loading>0},null,8,["loading"])]),S(r,{ref_key:"teamDialogRef",ref:e,width:"500px","append-to-body":"",title:(p=o(l).currentTeam)==null?void 0:p.title},{default:D(()=>[o(l).currentTeam?(u(),F(a,{key:0,tournament:m.tournament,team:o(l).currentTeam},null,8,["tournament","team"])):R("",!0)]),_:1},8,["title"])])}}});function Te(m,s,t){var e=-1,l=m.length;s<0&&(s=-s>l?0:l+s),t=t>l?l:t,t<0&&(t+=l),l=s>t?0:t-s>>>0,s>>>=0;for(var $=Array(l);++e<l;)$[e]=m[e+s];return $}var we=Te,ke=_t,Se=dt,Ie=pt,Ce=gt;function Ae(m,s,t){if(!Ce(t))return!1;var e=typeof s;return(e=="number"?Se(t)&&Ie(s,t.length):e=="string"&&s in t)?ke(t[s],m):!1}var xe=Ae,Oe=It,ot=1/0,Re=17976931348623157e292;function Ge(m){if(!m)return m===0?m:0;if(m=Oe(m),m===ot||m===-ot){var s=m<0?-1:1;return s*Re}return m===m?m:0}var Le=Ge,qe=Le;function De(m){var s=qe(m),t=s%1;return s===s?t?s-t:s:0}var Ee=De,Me=we,je=xe,Ne=Ee,Ue=Math.ceil,Fe=Math.max;function Pe(m,s,t){(t?je(m,s,t):s===void 0)?s=1:s=Fe(Ne(s),0);var e=m==null?0:m.length;if(!e||s<1)return[];for(var l=0,$=0,I=Array(Ue(e/s));l<e;)I[$++]=Me(m,l,l+=s);return I}var Ve=Pe;const Be=ft(Ve),He={class:"tournaments-tables"},We={class:"tournaments-tables__filters"},Ye={class:"tournaments-tables__filters-item"},Xe={class:"tournaments-tables__filters-item"},ze={class:"tournaments-tables__stage-state"},Je={key:0,class:"tournaments-tables__table-scroll"},Ke={key:0,class:"tournaments-tables__table-round-title"},Qe=["onClick"],Ze={class:"tournaments-tables__table-team-details"},ta={class:"tournaments-tables__table-team-title"},ea={class:"tournaments-tables__table-team-score"},aa={class:"tournaments-tables__table-team-details"},na={class:"tournaments-tables__table-team-title"},sa=H({__name:"TournamentsTables",props:{tournamentId:{type:[String,Number],default:"",required:!0},stages:{type:Array,default:()=>[],required:!0}},setup(m){const s=m,t=P({loading:0,standings:[],tables:[],matches:[],selectedStage:null,selectedGroup:null,tableOne:[],tableTwo:[],highlightTeamId:null,total:0,standingsTotal:0}),e=G(()=>t.tables.filter(a=>{var r;return a.group_id===((r=t.selectedGroup)==null?void 0:r.group_id)})),l=G(()=>e.value.map(a=>{const r=t.standings.find(p=>a.team_id===p.team_id&&p.group_id===a.group_id);return{...a,wins:(r==null?void 0:r.wins)??0,draws:(r==null?void 0:r.draws)??0,losses:(r==null?void 0:r.losses)??0}})),$=[{key:"position",label:"#",width:40,align:"center"},{key:"name",label:"Команда"},{key:"matches_played",label:"Бои",width:60,align:"center"},{key:"wins",label:"Победы",width:60,align:"center"},{key:"draws",label:"Ничьи",width:60,align:"center"},{key:"losses",label:"Пораж.",width:60,align:"center"},{key:"team_points",label:"Очки",width:60,align:"center"}],I=G(()=>s.stages.map(a=>({label:a.title,value:a,disabled:!["complete","schedule_ready"].includes(a.state)}))),g=G(()=>t.selectedStage?t.selectedStage.groups.map(a=>({label:`Группа ${a.group_order}`,value:a})):[]),f=G(()=>{var a;switch((a=t.selectedStage)==null?void 0:a.state){case"draft":return"Проект создан";case"groups_ready":return"Группы сформированы";case"schedule_ready":return"График построен";case"complete":return"Этап завершён";default:return"..."}});X(async()=>{var a;t.selectedStage=c(),t.selectedGroup=((a=t.selectedStage)==null?void 0:a.groups[0])??null,await y(),A()});function C(a){var p;const r=(p=t.selectedStage)==null?void 0:p.type;if(r==="SE"){if(a===1)return"Финал";if(a===2)return"Полуфинал";if(a===3)return"Четвертьфинал";if(a===-1)return"Матч за третье место"}if(r==="DE"){if(a===3)return"Верхняя сетка | Четвертьфинал";if(a===2)return"Верхняя сетка | Полуфинал";if(a===1)return"Верхняя сетка | Финал";if(a===0)return"Гранд-Финал";if(a===-1)return"Нижняя сетка | Финал";if(a===-2)return"Нижняя сетка | Полуфинал";if(a===-3)return"Нижняя сетка | Четвертьфинал"}return""}function A(){t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.matches.forEach(a=>{const r=t.tables.find(q=>q.team_id===a.team_1_id),p=t.tables.find(q=>q.team_id===a.team_2_id);if(!r||!p)return;const T={...a,teams:[r,p]};a.round===3&&t.tableOne[0].push(T),a.round===2&&t.tableOne[1].push(T),a.round===1&&t.tableOne[2].push(T),a.round===-3&&t.tableTwo[0].push(T),a.round===-2&&t.tableTwo[1].push(T),a.round===-1&&t.tableTwo[2].push(T),a.round===0&&t.tableTwo[3].push(T)})}function i(a,r){return r.team_id===a.winner_team_id}function c(){const a=s.stages.findLast(p=>p.state==="schedule_ready"),r=s.stages.findLast(p=>p.state==="complete");return a??r??s.stages[0]}async function y(){var p,T,q;const a=(p=t.selectedStage)==null?void 0:p.stage_id,r=(T=t.selectedGroup)==null?void 0:T.group_id;!a||!r||(await d({tournament_id:s.tournamentId,group_id:r,stage_id:a}),((q=t.selectedStage)==null?void 0:q.type)==="RR"?await h({tournament_id:s.tournamentId,team_id:e.value.map(z=>z.team_id).join(",")}):await v({tournament_id:s.tournamentId,group_id:r,stage_id:a}))}async function v(a){t.loading++;try{const{data:r}=await M.tournaments.getMatches({...a,limit:25});t.matches=r}catch(r){j(r,{title:"Получение матчей"})}t.loading--}async function h(a){const r=Be(String(a.team_id).split(","),10);for(const p of r)await x({...a,team_id:p.join(",")})}async function x(a){t.loading++;try{const{data:r,meta:p}=await M.tournaments.getStandings({...a,limit:25});t.standings.push(...r),t.standingsTotal=p.total}catch(r){j(r,{title:"Получение результатов команд"})}t.loading--}async function d(a){let r=1;const p=25,T=async()=>{await k({...a,page_no:r,limit:p}),t.total>r*p&&(r++,await T())};await T()}async function k(a){t.loading++;try{const{data:r,meta:p}=await M.tournaments.getTables(a);t.tables.push(...r),t.total=p.total}catch(r){j(r,{title:"Получение турнирной сетки"})}t.loading--}async function L(a){t.selectedStage=a,t.selectedGroup=a.groups[0],t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.standings=[],t.tables=[],t.matches=[],await y(),t.selectedStage.type!=="RR"&&A()}async function W(a){t.selectedGroup=a,t.selectedStage&&(t.selectedStage.type==="RR"?(t.standings=[],await h({tournament_id:s.tournamentId,team_id:e.value.map(r=>r.team_id).join(",")})):(t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.matches=[],await v({tournament_id:s.tournamentId,group_id:a.group_id,stage_id:t.selectedStage.stage_id}),A()))}function B(a){t.highlightTeamId=a.team_id}return(a,r)=>{var z,tt;const p=Z,T=Ct,q=Q;return u(),b("div",He,[n("div",We,[n("div",Ye,[w(" Этап ("+_(o(t).total??0)+") ",1),S(p,{"model-value":o(t).selectedStage,"id-key":"stage_id",style:{width:"250px"},options:o(I),disabled:!o(I).length,onChange:L},null,8,["model-value","options","disabled"])]),n("div",Xe,[w(" Группа ("+_(((z=o(t).selectedStage)==null?void 0:z.groups.length)??"---")+") ",1),S(p,{"model-value":o(t).selectedGroup,"id-key":"group_id",style:{width:"170px"},disabled:!o(g).length,options:o(g),onChange:W},null,8,["model-value","disabled","options"])])]),n("div",ze,[r[0]||(r[0]=n("span",{class:"tournaments-tables__stage-state-label"}," Состояние этапа ",-1)),w(" "+_(o(f)),1)]),((tt=o(t).selectedStage)==null?void 0:tt.type)!=="RR"?(u(),b("div",Je,[(u(!0),b(O,null,E([o(t).tableOne,o(t).tableTwo],(V,et)=>(u(),b("div",{key:et,class:K(["tournaments-tables__table",[`tournaments-tables__table--${et?"bottom":"top"}`]])},[(u(!0),b(O,null,E(V,(it,rt)=>(u(),b("div",{key:rt,class:"tournaments-tables__table-round"},[(u(!0),b(O,null,E(it,(Y,lt)=>(u(),b("div",{key:Y.id,class:"tournaments-tables__table-battle"},[lt===0?(u(),b("div",Ke,_(C(Y.round)),1)):R("",!0),(u(!0),b(O,null,E(Y.teams,(N,at)=>(u(),b("button",{key:at,class:K(["tournaments-tables__table-team",[i(Y,N)?"tournaments-tables__table-team--is-winner":"",N.team_id===o(t).highlightTeamId?"tournaments-tables__table-team--is-highlight":""]]),onClick:ya=>B(N)},[n("span",Ze,[S(st,{class:"tournaments-tables__table-team-clan-emblem",alt:N.clan_label,emblem:N.clan_emblem_preset_id},null,8,["alt","emblem"]),n("span",ta,[N.clan_label?(u(),b(O,{key:0},[w(" ["+_(N.clan_label)+"] ",1)],64)):R("",!0),w(" "+_(N.title),1)])]),n("span",ea,_(Y[`team_${at+1}_score`]??"-"),1)],10,Qe))),128))]))),128))]))),128))],2))),128))])):(u(),F(T,{key:1,"no-wrap":"","scroll-auto-disabling":"","row-key":"account_id",height:"calc(100vh - 112px)",headers:$,data:o(l)},{name:D(({row:V})=>[n("div",aa,[S(st,{class:"tournaments-tables__table-team-clan-emblem",alt:V.clan_label,emblem:V.clan_emblem_preset_id},null,8,["alt","emblem"]),n("span",na,[V.clan_label?(u(),b(O,{key:0},[w(" ["+_(V.clan_label)+"] ",1)],64)):R("",!0),w(" "+_(V.title),1)])])]),_:1},8,["data"])),S(q,{loading:o(t).loading>0},null,8,["loading"])])}}}),oa={key:0,class:"tournaments-info-page__inner"},ia={class:"tournaments-info-page__header"},ra={class:"tournaments-info-page__details"},la={class:"tournaments-info-page__title"},ca={class:"tournaments-info-page__props"},ua={class:"tournaments-info-page__prop"},ma={class:"tournaments-info-page__prop-title"},_a={class:"tournaments-info-page__props"},da={class:"tournaments-info-page__prop"},pa={class:"tournaments-info-page__body"},ga=["textContent"],fa={class:"tournaments-info-page__body"},ha={class:"tournaments-info-page__body"},ba={class:"tournaments-info-page__body"},en=H({__name:"[id]",setup(m){ht({title:"Турнир"});const s=bt(),t=yt(),e=P({loading:0,tournament:null,stages:[],activeTab:"info"}),l=G(()=>{var c,y;const i=[{label:"Описание",name:"info"},{label:"Команды",name:"teams",disabled:((c=e.tournament)==null?void 0:c.status)==="upcoming"}];return e.stages.length&&i.push({label:"Сетка",name:"tables",disabled:!["running","finished","complete"].includes(((y=e.tournament)==null?void 0:y.status)??"")}),i}),$=G(()=>{var i;switch((i=e.tournament)==null?void 0:i.status){case"upcoming":return{title:"Начало регистрации",date:U.date.toDateTime(e.tournament.registration_start_at*1e3)};case"registration_started":return{title:"Окончание регистрации",date:U.date.toDateTime(e.tournament.registration_end_at*1e3)};case"registration_finished":return{title:"Начало мачей",date:U.date.toDateTime(e.tournament.matches_start_at*1e3)};case"running":return{title:"Завершение",date:U.date.toDateTime(e.tournament.end_at*1e3)};case"finished":case"complete":return{title:"Завершен",date:U.date.toDateTime(e.tournament.end_at*1e3)}}return{title:"---",date:"---"}});X(async()=>{var c;const i=(c=s.query)==null?void 0:c.activeTab;C(i||l.value[0].name),await I()});async function I(){const i=s.params.id;i&&await Promise.all([g(i),f(i)])}async function g(i){e.loading++;try{const{data:c}=await M.tournaments.getInfo({tournament_id:i});e.tournament=c[i]??null}catch(c){j(c,{title:"Получение информации турнира"})}e.loading--}async function f(i){e.loading++;try{const{data:c}=await M.tournaments.getStages({tournament_id:i});e.stages=c??[]}catch(c){j(c,{title:"Получение этапов турнира"})}e.loading--}function C(i){var c;e.activeTab=i,((c=s.query)==null?void 0:c.activeTab)!==i&&t.replace({query:{...s.query,activeTab:i}})}function A({name:i}){C(i)}return(i,c)=>{const y=ct,v=Nt,h=zt,x=$e,d=sa,k=At,L=Q,W=xt;return u(),F(W,{class:"tournaments-info-page"},{default:D(()=>{var B,a,r,p;return[o(e).tournament?(u(),b("div",oa,[n("div",ia,[S(y,{src:o(e).tournament.logo.original,alt:"Tournament IMG",class:"tournaments-info-page__img"},null,8,["src"]),n("div",ra,[n("h1",la,_((B=o(e).tournament)==null?void 0:B.title),1),n("div",ca,[n("div",ua,[n("div",ma,_(o($).title),1),w(" "+_(o($).date),1)])]),n("div",_a,[n("div",da,[c[1]||(c[1]=n("div",{class:"tournaments-info-page__prop-title"}," Команд ",-1)),w(" "+_(((a=o(e).tournament)==null?void 0:a.teams.confirmed)||0)+" / "+_(((r=o(e).tournament)==null?void 0:r.teams.total)||0)+" / "+_(((p=o(e).tournament)==null?void 0:p.teams.max)||0),1)])])])]),S(k,{modelValue:o(e).activeTab,"onUpdate:modelValue":c[0]||(c[0]=T=>o(e).activeTab=T),tabs:o(l),onTabClick:A},{info:D(()=>[n("div",pa,[o(e).stages.length?(u(),F(v,{key:0,stages:o(e).stages,class:"tournaments-info-page__stages","tournament-id":o(e).tournament.tournament_id},null,8,["stages","tournament-id"])):R("",!0),n("div",{class:"tournaments-info-page__description",textContent:_(o(e).tournament.description)},null,8,ga)])]),matches:D(()=>[n("div",fa,[o(e).stages.length?(u(),F(h,{key:0,stages:o(e).stages,"tournament-id":o(e).tournament.tournament_id},null,8,["stages","tournament-id"])):R("",!0)])]),teams:D(()=>[n("div",ha,[S(x,{tournament:o(e).tournament},null,8,["tournament"])])]),tables:D(()=>[n("div",ba,[o(e).stages.length?(u(),F(d,{key:0,"tournament-id":o(e).tournament.tournament_id,stages:o(e).stages},null,8,["tournament-id","stages"])):R("",!0)])]),_:1},8,["modelValue","tabs"])])):R("",!0),S(L,{loading:o(e).loading>0},null,8,["loading"])]}),_:1})}}});export{en as default};
