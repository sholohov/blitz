import{f as A,r,q as R,ae as G,c as u,h as H,i as I,y as J,o as d,a as E,b as B,k as S,l as Q,w as V,F as D,A as N,t as K,B as X,m as Y,Z as ee,j as te,C as ne,E as ae,D as oe}from"./entry.DP5yAQ98.js";import{_ as se}from"./CInput.vue.OZgMIOZf.js";import{n as le}from"./notEmpty.BxBPJGBn.js";import{d as ce}from"./debounce.C9kaufHr.js";import{u as O}from"./disableScroll.DjVa_9z0.js";import{a as C}from"./request.5IkpOjNq.js";const re=Symbol.for("nuxt:client-only"),we=A({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(f,{slots:s,attrs:v}){const m=r(!1);return R(()=>{m.value=!0}),G(re,!0),l=>{var p;if(m.value)return(p=s.default)==null?void 0:p.call(s);const c=s.fallback||s.placeholder;if(c)return c();const y=l.fallback||l.placeholder||"",g=l.fallbackTag||l.placeholderTag||"span";return u(g,v,y)}}}),ie=(f,s)=>{const v=O(),m=l=>l instanceof Error;v.add({type:"error",title:"Поиск клана",message:s.message??(m(f)?f.message:"Неизвестная ошибка")}),console.error(f)},ue={class:"main-search__inner"},de={class:"main-search__input"},fe={key:0,class:"main-search__dropdown"},me={key:0,class:"main-search__item-title"},ve=["onKeydown","onClick","textContent"],xe=A({__name:"MainSearch",props:{context:{type:String,default:"account"}},setup(f){const s=H(),v=O(),m=r(null),l=r(null),c=r(""),y=r([]),g=r([]),p=r([]),k=r([]),_=r(0),w=r(-1),U=I(()=>[y.value,g.value,p.value]),j=I(()=>[y.value,g.value,p.value].some(e=>e.length>0));R(()=>{window.addEventListener("click",L)}),J(()=>{window.removeEventListener("click",L)});function b(){y.value=[],g.value=[],p.value=[]}function L(e){var t;(t=m.value)!=null&&t.contains(e.target)||(b(),c.value="")}async function T(e){var t;b(),c.value=e.name??"",await s.push({name:e.context+"-id",params:{id:String(e.id)}}),(t=l.value)==null||t.focus()}function q(){var t;const e=(t=m.value)==null?void 0:t.querySelectorAll(".main-search__item-btn");return e?[...e]:[]}async function F(e){_.value++;try{const a=((await C.account.getList({search:e,limit:5})).data||[]).map(n=>({name:n.nickname,id:n.account_id,context:"account"}));if(a.length){const n=await C.clan.getAccountInfo({extra:"clan",account_id:a.map(i=>i.id).join(",")});n.data&&a.forEach(i=>{var h,x;const o=(x=(h=n.data[i.id])==null?void 0:h.clan)==null?void 0:x.tag;i.name+=o?` [${o}]`:""}),y.value=[{id:1,name:"Аккаунты",context:"title"},...a]}}catch(t){v.add({type:"error",message:"Поиск аккаунта"}),console.error(t)}_.value--}async function M(e){_.value++;try{const{data:t}=await C.clan.getList({search:e,limit:5}),a=(t.filter(le)??[]).map(n=>({name:`[${n.tag}] ${n.name}`,id:n.clan_id,context:"clan"}));a.length&&(g.value=[{id:2,name:"Кланы",context:"title"},...a])}catch(t){ie(t,{title:"Поиск клана"})}_.value--}async function z(e){_.value++;try{const a=((await C.tournaments.getList({search:e,limit:5})).data||[]).map(n=>({name:n.title,id:n.tournament_id,context:"tournaments"}));a.length&&(p.value=[{id:3,name:"Турниры",context:"title"},...a])}catch(t){v.add({type:"error",message:"Поиск турнира"}),console.error(t)}_.value--}async function P(e){e.length>=3&&await F(e),e.length>=2&&(await M(e),await z(e)),k.value=q()}const W=ce(P,1e3,{leading:!0});async function Z(e=""){c.value=e=e.replace(/\/\d+$/,"").trim(),c.value.length<2&&b(),await W(e)}function $(e){var a,n,i,o,h,x;const t=e.target;_.value>0||(e.key==="Escape"&&(b(),c.value="",w.value=-1,(a=l.value)==null||a.focus()),t.tagName==="INPUT"&&(w.value=-1),e.key==="ArrowUp"&&(e.preventDefault(),(n=k.value)!=null&&n.length&&w.value>0?(i=k.value[--w.value])==null||i.focus():(o=l.value)==null||o.focus()),e.key==="ArrowDown"&&(e.preventDefault(),(h=k.value)!=null&&h.length&&w.value<k.value.length-1&&((x=k.value[++w.value])==null||x.focus())))}return(e,t)=>{const a=se;return d(),u("div",{ref_key:"rootRef",ref:m,class:"main-search"},[E("div",ue,[E("div",de,[B(a,{ref_key:"inputRef",ref:l,modelValue:S(c),"onUpdate:modelValue":t[0]||(t[0]=n=>Q(c)?c.value=n:null),placeholder:"Поиск игрока, клана или турнира",type:"search",onInput:Z,onKeydown:$},null,8,["modelValue"])]),B(ee,null,{default:V(()=>[S(j)?(d(),u("div",fe,[(d(!0),u(D,null,N(S(U),(n,i)=>(d(),u("ul",{key:i,class:"main-search__list",onKeydown:$},[(d(!0),u(D,null,N(n,o=>(d(),u("li",{key:o.context+o.id,class:"main-search__item"},[o.context==="title"?(d(),u("div",me,K(o.name),1)):(d(),u("button",{key:1,class:"main-search__item-btn",onKeydown:X(h=>T(o),["enter"]),onClick:h=>T(o),textContent:K(o.name)},null,40,ve))]))),128))],32))),128))])):Y("",!0)]),_:1})])],512)}}}),be=A({__name:"ContentBox",props:{tag:{type:String,default:"div"},innerClass:{type:String,default:void 0}},setup(f){return(s,v)=>(d(),te(oe(f.tag),{class:"content-box"},{default:V(()=>[E("div",{class:ne(["content-box__inner",[f.innerClass]])},[ae(s.$slots,"default")],2)]),_:3}))}});export{be as _,xe as a,we as b};
