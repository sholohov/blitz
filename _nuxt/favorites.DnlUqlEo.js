import{_ as S}from"./nuxt-link.L0yXcBJ9.js";import{h as N,_ as D,a as E}from"./disableScroll.C0aRP9sA.js";import{_ as T}from"./TablePagination.vue.YWKQ08UD.js";import{_ as z}from"./CTable.vue.Nq0ui9O0.js";import{_ as A}from"./ContentLoader.vue.CZ7Avnj8.js";import{n as V}from"./notEmpty.BxBPJGBn.js";import{n as j,A as m,s as O,B as P,c as d,a as l,b as o,w as i,x as r,C as p,o as _,v as R,t as f,F as q,d as L}from"./entry.C7rsCkde.js";import{a as M,s as g}from"./request.2vtDDBdm.js";import{_ as W}from"./ClanEmblem.vue.zFVRugMl.js";import"./CImage.vue.ClFcMEow.js";import"./image-broken.CEw3Tp2H.js";import"./nuxt-icon.qIaVhdWh.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const G={class:"clan-favorites-page"},H=l("div",{class:"clan-favorites-page__description content-area",style:{"max-width":"800px"}},[l("p",null,' Список кланов добавленных в "Избранные". Данные хранятся в браузере. '),l("p",null,' Добавить в избранное, можно нажав "Звёздочку" превью на странице клана. ')],-1),J={class:"clan-favorites-page__inner"},K={class:"clan-favorites-page__name"},ra=j({__name:"favorites",setup(Q){const t=m({clans:[],favoritesIds:null,loading:0}),s=m({total:0,page:1,pageSize:100}),u=[{key:"tag",label:"Название"},{key:"members_count",align:"center",label:"Уч-ков"},{key:"updated_at",label:"Обновлён",formatter:a=>a&&typeof a=="number"?p.date.toRelativeTime(a*1e3):"---"},{key:"created_at",label:"Создан",formatter:a=>a?p.date.toDate(Number(a)*1e3):"---"},{key:"actions",width:60}],v=O(()=>{const a=s.page*s.pageSize,n=a-s.pageSize;return(t.favoritesIds??[]).slice(n,a)});P(()=>{c()});async function h(a){t.loading++;try{const{data:n}=await M.clan.getInfo({clan_id:a.join(",")});t.clans=Object.values(n).filter(V)??[]}catch(n){N(n,{title:"Получение данных клана"})}t.loading--}async function y(){const a=await g.indexedDB.clansFavorites.getAll();t.favoritesIds=(a??[]).filter(n=>n.isFavorite).map(n=>n.id),s.total=t.favoritesIds.length}async function c(){var a;t.favoritesIds||await y(),(a=t.favoritesIds)!=null&&a.length&&await h(v.value)}async function b(a){await g.indexedDB.clansFavorites.remove(a),t.clans.length<s.total?t.clans=t.clans.filter(n=>n.clan_id!==a):await c()}async function k(){await c()}return(a,n)=>{const x=S,C=D,I=E,B=T,$=z,F=A;return _(),d("div",G,[H,l("div",J,[o($,{"no-wrap":"","scroll-to-top":"","scroll-auto-disabling":"",headers:u,data:r(t).clans,height:"calc(100vh - 112px)"},{tag:i(({row:e})=>[e!=null&&e.tag&&(e!=null&&e.name)?(_(),R(x,{key:0,class:"clan-favorites-page__details link",to:{name:"clan-id",params:{id:e.clan_id}}},{default:i(()=>[o(W,{class:"clan-favorites-page__emblem",alt:e.tag,emblem:e.emblem_set_id},null,8,["alt","emblem"]),l("span",K," ["+f(e.tag)+"] "+f(e.name),1)]),_:2},1032,["to"])):(_(),d(q,{key:1},[L(" Удалён ")],64))]),actions:i(({row:e})=>[o(I,{title:"Удалить","is-text":"","is-square":"",onClick:U=>b(e.clan_id)},{default:i(()=>[o(C,{name:"delete"})]),_:2},1032,["onClick"])]),footer:i(()=>[o(B,{pagination:r(s),onChange:k},null,8,["pagination"])]),_:1},8,["data"]),o(F,{loading:r(t).loading>0},null,8,["loading"])])])}}});export{ra as default};
