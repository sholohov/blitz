import{d as P,o as b,l as w,m as s,h as n,t as T,M as $t,_ as F,x as G,y as K,F as D,B as q,w as i,E as W,c as A,j as I,f as d,T as Tt,A as et,q as $,v as at,N as Vt,s as Ct,u as Bt,r as M,k as xt,g as N,e as z}from"./CKv8GwDH.js";import{_ as Rt}from"./CkZTH_3a.js";import{_ as st}from"./BTqHWCus.js";import{_ as L,a as E,b as nt}from"./E9Vjkpav.js";import{_ as it}from"./Bm14zLTW.js";import{_ as St}from"./BYgbaSb1.js";import{_ as Pt}from"./CKJ7yeoF.js";import{_ as Ut}from"./CtQ0xotG.js";import{_ as Mt}from"./l1yfm2Y8.js";import{_ as Dt}from"./C3Jxsgfw.js";import{_ as It}from"./GiDsdhdt.js";import{_ as J}from"./SiXtYWfA.js";import{_ as Ot}from"./D0jXi0i1.js";import{s as B}from"./C4oTPxE3.js";import{u as jt}from"./Bi8rSdHQ.js";import{u as Nt}from"./CwIQ7yox.js";import{c as tt}from"./DSHhIHB-.js";import"./DLqusGpQ.js";import"./DJ9YZuTQ.js";import"./DlAUqK2U.js";import"./DD4asW33.js";import"./RPJY7rI9.js";const Wt={class:"hand-statistic-tank-preview__img-wrapper"},qt={class:"hand-statistic-tank-preview__description"},Et={class:"hand-statistic-tank-preview__description-tank"},Ht={class:"hand-statistic-tank-preview__name"},zt={class:"hand-statistic-tank-preview__name-text"},At={class:"hand-statistic-tank-preview__description-tank"},Ft={class:"hand-statistic-tank-preview__props"},Gt={class:"hand-statistic-tank-preview__prop"},Kt={class:"hand-statistic-tank-preview__prop-value"},Lt={class:"hand-statistic-tank-preview__prop"},Jt={class:"hand-statistic-tank-preview__prop-value"},Qt={class:"hand-statistic-tank-preview__prop"},Xt={class:"hand-statistic-tank-preview__prop-value"},Yt=P({__name:"HandStatisticTankPreview",props:{tank:{type:Object,default:()=>({}),required:!0}},setup(k){return(l,r)=>{const y=st,o=E,v=F,h=it;return b(),w("div",$t({class:"hand-statistic-tank-preview"},l.$attrs),[s("div",Wt,[n(y,{class:"hand-statistic-tank-preview__nation-img",src:`/img/nations/nation-${k.tank.nation}.svg`,alt:k.tank.nation},null,8,["src","alt"]),n(y,{class:"hand-statistic-tank-preview__tank-img",src:k.tank.images.preview,alt:k.tank.name},null,8,["src","alt"]),n(L,{class:"hand-statistic-tank-preview__tier",tier:k.tank.tier},null,8,["tier"])]),s("div",qt,[s("div",Et,[s("div",Ht,[n(o,{type:k.tank.type,class:"hand-statistic-tank-preview__type","is-premium":k.tank.is_premium,"is-collectible":k.tank.is_collectible},null,8,["type","is-premium","is-collectible"]),s("span",zt,T(k.tank.name??`Tank ID: ${k.tank.tank_id}`),1)])]),s("div",At,[s("div",Ft,[s("span",Gt,[n(v,{name:"sword-cross",size:"18"}),s("span",Kt,T(l.$formatter.number.toInteger(k.tank.stat.battles)),1)]),s("span",Lt,[n(v,{name:"flag-variant",size:"18"}),s("span",Jt,[n(h,{"win-rate":k.tank.stat.winRate},null,8,["win-rate"])])]),s("span",Qt,[n(v,{name:"destruction",size:"18"}),s("span",Xt,T(l.$formatter.number.toInteger(k.tank.stat.damagePerBattle)),1)])])])])],16)}}}),Zt=P({__name:"NationSelect",props:G({noWrap:{type:Boolean,default:!1,required:!1}},{modelValue:{required:!0,default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(k){const l=K(k,"modelValue"),r=["ussr","germany","usa","uk","japan","china","france","european","other"];function y(o,v){v?l.value.push(o):l.value=[...l.value.filter(h=>h!==o)]}return(o,v)=>{const h=nt,V=J;return b(),w("div",{class:W(["nation-select",[k.noWrap?"nation-select--no-wrap":""]])},[(b(),w(D,null,q(r,f=>{var e;return n(V,{key:f,"model-value":!!((e=l.value)!=null&&e.includes(f)),onChange:m=>y(f,m)},{default:i(()=>[n(h,{nation:f},null,8,["nation"])]),_:2},1032,["model-value","onChange"])}),64))],2)}}}),te=P({__name:"TypeSelect",props:G({noWrap:{type:Boolean,default:!1,required:!1}},{modelValue:{required:!0,default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(k){const l=K(k,"modelValue"),r=["lightTank","mediumTank","heavyTank","AT-SPG"];function y(o,v){v?l.value.push(o):l.value=[...l.value.filter(h=>h!==o)]}return(o,v)=>{const h=E,V=J;return b(),w("div",{class:W(["type-select",[k.noWrap?"type-select--no-wrap":""]])},[(b(),w(D,null,q(r,f=>{var e;return n(V,{key:f,"model-value":!!((e=l.value)!=null&&e.includes(f)),onChange:m=>y(f,m)},{default:i(()=>[n(h,{type:f},null,8,["type"])]),_:2},1032,["model-value","onChange"])}),64))],2)}}}),ee={class:"hand-statistic-tank-select"},ae={class:"hand-statistic-tank-select__filters"},se={class:"hand-statistic-tank-select__filters-item"},ne={class:"hand-statistic-tank-select__filters-item"},ie={class:"hand-statistic-tank-select__filters-item"},le=["onClick"],oe={class:"hand-statistic-tank-select__item-details"},de={class:"hand-statistic-tank-select__item-props"},re=P({__name:"HandStatisticTankSelect",props:{items:{type:Object,default:()=>({}),required:!0},exclude:{type:Array,default:()=>[],required:!1}},emits:["select"],setup(k,{emit:l}){const r=k,y=A(()=>Object.values(r.items).sort((e,m)=>m.tier-e.tier).filter(e=>[!e.name.startsWith("#"),!r.exclude.includes(e.tank_id),o.tiers.length?o.tiers.includes(e.tier):!0,o.types.length?o.types.includes(e.type):!0,o.nations.length?o.nations.includes(e.nation):!0].every(m=>m))),o=I({tiers:[],types:[],nations:[]}),v=l;function h(e){let m="standard";return e.is_premium&&(m="premium"),e.is_collectible&&(m="collectible"),m}function V(e){v("select",e)}function f(e){return r.exclude.includes(e.tank_id)}return(e,m)=>{const U=It,x=Zt,C=te,c=st,S=nt,H=E,O=L;return b(),w("div",ee,[s("div",ae,[s("div",se,[n(U,{modelValue:d(o).tiers,"onUpdate:modelValue":m[0]||(m[0]=g=>d(o).tiers=g),"no-wrap":""},null,8,["modelValue"])]),s("div",ne,[n(x,{modelValue:d(o).nations,"onUpdate:modelValue":m[1]||(m[1]=g=>d(o).nations=g),"no-wrap":""},null,8,["modelValue"])]),s("div",ie,[n(C,{modelValue:d(o).types,"onUpdate:modelValue":m[2]||(m[2]=g=>d(o).types=g),"no-wrap":""},null,8,["modelValue"])])]),n(Tt,{tag:"div",name:"hand-statistic-tank-select__item-",class:"hand-statistic-tank-select__list"},{default:i(()=>[(b(!0),w(D,null,q(d(y),g=>(b(),w("div",{key:g.tank_id,role:"button","aria-pressed":"false",class:W(["hand-statistic-tank-select__item",[f(g)?"hand-statistic-tank-select__item--excluded":""]]),tabindex:"0",onClick:Q=>V(g)},[n(c,{class:"hand-statistic-tank-select__item-img",alt:g.name,src:g.images.preview},null,8,["alt","src"]),s("div",oe,[s("div",{class:W(["hand-statistic-tank-select__item-name",`hand-statistic-tank-select__item-name--${h(g)}`])},T(g.name),3),s("div",de,[n(S,{size:"18",nation:g.nation},null,8,["nation"]),n(H,{size:"24",type:g.type},null,8,["type"]),n(O,{tier:g.tier},null,8,["tier"])])])],10,le))),128))]),_:1})])}}}),ce={class:"hand-statistic-tank-edit"},ue={class:"hand-statistic-tank-edit__body"},_e={class:"hand-statistic-tank-edit__params"},me={class:"hand-statistic-tank-edit__params-item"},pe={class:"hand-statistic-tank-edit__params-item"},ke={class:"hand-statistic-tank-edit__params"},fe={class:"hand-statistic-tank-edit__params-item"},ve={class:"hand-statistic-tank-edit__params-item"},he={class:"hand-statistic-tank-edit__params"},ge={class:"hand-statistic-tank-edit__params-item"},be={class:"hand-statistic-tank-edit__params-item"},ye={class:"hand-statistic-tank-edit__params-item"},we={style:{display:"flex","justify-content":"space-between"}},$e=P({__name:"HandStatisticTankEdit",props:{modelValue:{required:!0,default:()=>({})},modelModifiers:{}},emits:G(["close","save"],["update:modelValue"]),setup(k,{emit:l}){const r=K(k,"modelValue"),y=I({isWin:!0}),o=I({damage_dealt:0,losses:0,wins:0});et(()=>[r.value.stat],()=>{const{losses:f,wins:e}=r.value.stat;r.value.stat.battles=f+e,r.value.stat.winRate=B.winRate(r.value.stat),r.value.stat.damagePerBattle=B.damagePerBattle(r.value.stat)},{deep:!0});const v=l;function h(){v("close")}function V(){y.isWin?o.wins+=1:o.losses+=1,r.value.lastUpdateTime=Date.now(),r.value.stat=B.sum(r.value.stat,{...o,battles:o.losses+o.wins}),v("save",r.value)}return(f,e)=>{const m=Ot,U=J,x=F,C=at;return b(),w("div",ce,[s("div",ue,[s("div",_e,[e[7]||(e[7]=s("div",{class:"hand-statistic-tank-edit__params-title"}," Информация ",-1)),s("div",me,[e[5]||(e[5]=s("span",{class:"hand-statistic-tank-edit__params-item-title"}," Название танка: ",-1)),$(" "+T(r.value.name),1)]),s("div",pe,[e[6]||(e[6]=s("span",{class:"hand-statistic-tank-edit__params-item-title"}," Дата обновления: ",-1)),$(" "+T(f.$formatter.date.toDateTime(r.value.lastUpdateTime)||"---"),1)])]),s("div",ke,[e[11]||(e[11]=s("div",{class:"hand-statistic-tank-edit__params-title"}," Показатели за бой ",-1)),s("div",fe,[e[8]||(e[8]=s("span",{class:"hand-statistic-tank-edit__params-item-title"}," Урон: ",-1)),n(m,{modelValue:d(o).damage_dealt,"onUpdate:modelValue":e[0]||(e[0]=c=>d(o).damage_dealt=c),width:"100px",min:"0"},null,8,["modelValue"])]),s("div",ve,[e[10]||(e[10]=s("span",{class:"hand-statistic-tank-edit__params-item-title"}," Результат: ",-1)),n(U,{modelValue:d(y).isWin,"onUpdate:modelValue":e[1]||(e[1]=c=>d(y).isWin=c)},{default:i(()=>e[9]||(e[9]=[$(" Победа ")])),_:1},8,["modelValue"])])]),s("div",he,[e[15]||(e[15]=s("div",{class:"hand-statistic-tank-edit__params-title"}," Суммарные показатели ",-1)),s("div",ge,[e[12]||(e[12]=s("span",{class:"hand-statistic-tank-edit__params-item-title"}," Урон: ",-1)),n(m,{modelValue:r.value.stat.damage_dealt,"onUpdate:modelValue":e[2]||(e[2]=c=>r.value.stat.damage_dealt=c),width:"100px",min:"0"},null,8,["modelValue"])]),s("div",be,[e[13]||(e[13]=s("span",{class:"hand-statistic-tank-edit__params-item-title"}," Побед: ",-1)),n(m,{modelValue:r.value.stat.wins,"onUpdate:modelValue":e[3]||(e[3]=c=>r.value.stat.wins=c),width:"100px",min:"0"},null,8,["modelValue"])]),s("div",ye,[e[14]||(e[14]=s("span",{class:"hand-statistic-tank-edit__params-item-title"}," Пораж.: ",-1)),n(m,{modelValue:r.value.stat.losses,"onUpdate:modelValue":e[4]||(e[4]=c=>r.value.stat.losses=c),width:"100px",min:"0"},null,8,["modelValue"])])])]),s("div",we,[n(C,{onClick:h},{before:i(()=>[n(x,{name:"close"})]),default:i(()=>[e[16]||(e[16]=$(" Отмена "))]),_:1}),n(C,{onClick:V},{before:i(()=>[n(x,{name:"content-save"})]),default:i(()=>[e[17]||(e[17]=$(" Сохранить "))]),_:1})])])}}}),Te={class:"hand-statistic-page"},Ve={class:"hand-statistic-page__average-list"},Ce={class:"hand-statistic-page__average-label"},Be={class:"hand-statistic-page__average-value"},xe={class:"hand-statistic-page__settings"},Re={key:0},Se={key:0},Pe={key:0},Ue={class:"hand-statistic-page__table-row"},Me={class:"hand-statistic-page__diff"},De={style:{display:"flex",gap:"10px"}},Ie={class:"hand-statistic-page__params"},Oe={class:"hand-statistic-page__param"},je={style:{margin:"0 0 0 10px"}},Ne={style:{display:"flex","justify-content":"space-between"}},We={style:{display:"flex","justify-content":"space-between"}},qe={style:{display:"flex","justify-content":"space-between"}},ra=P({__name:"hand-statistic",setup(k){Vt(t=>({e6d5cb40:d(S).bgColorOpacity}));const{$formatter:l,$indexedDB:r}=Ct();Bt({title:[l.route.getTitle("hand-statistic")].join(" - ")});const y=M(),o=M(),v=M(),h=M(),V=jt(),f=A(()=>V.isMobile),e=A(()=>V.isTablet),m=[{key:"name",label:"Танк",sortable:!0},{key:"battles",label:l.stat.accountProp("battles"),sortable:!0,sortMethod(t,a){const u=t,p=a;return u.stat.battles-p.stat.battles}},{key:"winRate",label:l.stat.accountProp("wins"),sortable:!0,sortMethod(t,a){const u=t,p=a;return u.stat.winRate-p.stat.winRate}},{key:"damagePerBattle",label:l.stat.accountProp("damage_dealt"),sortable:!0,sortMethod(t,a){const u=t,p=a;return u.stat.damagePerBattle-p.stat.damagePerBattle}},{key:"lastUpdateTime",label:"Дата обновления",sortable:!0,sortMethod(t,a){return new Date(a).valueOf()-new Date(t).valueOf()}},{key:"controls",label:"",width:100}],U=[{key:"battles",label:l.stat.accountProp("battles"),sortable:!0,sortMethod(t,a){const u=t,p=a;return u.stat.battles-p.stat.battles}},{key:"winRate",label:l.stat.accountProp("wins"),sortable:!0,sortMethod(t,a){const u=t,p=a;return u.stat.winRate-p.stat.winRate}},{key:"damagePerBattle",label:l.stat.accountProp("damage_dealt"),sortable:!0,sortMethod(t,a){const u=t,p=a;return u.stat.damagePerBattle-p.stat.damagePerBattle}}],x=M([{key:"battles",label:l.stat.accountProp("battles"),value:"0"},{key:"winRate",label:l.stat.accountProp("winRate"),value:"0"},{key:"damagePerBattle",label:l.stat.accountProp("damagePerBattle"),value:"0"}]),C=Nt(),c=I({tanks:[],currentTank:null}),S=I({bgColorOpacity:1});et(()=>c.tanks,()=>H(),{deep:!0,immediate:!0}),xt(async()=>{await C.getTanksVehicles();const t=await r.handStatistic.getAll();t==null||t.forEach(a=>{var p;const u=(p=C.vehicles)==null?void 0:p[a.id];u&&c.tanks.push(g({tank:u,stat:a.data,timestamp:a.timestamp}))})});function H(){var a;let t={};c.tanks.forEach(u=>{t=B.sum(t,u.stat)}),(a=x.value)==null||a.forEach(u=>{u.key==="battles"&&(u.value=l.number.toInteger(t.battles??0)),u.key==="winRate"&&(u.value=l.number.toFloatPercent(B.winRate(t))),u.key==="damagePerBattle"&&(u.value=l.number.toInteger(B.damagePerBattle(t)))})}function O(t){return{...t,battles:(t.losses||0)+(t.wins||0),winRate:B.winRate(t),damagePerBattle:B.damagePerBattle(t)}}function g(t){const a={...t.tank,stat:t.stat};return a.stat=O(a.stat),a.lastUpdateTime=t.timestamp,a}function Q(){var t;(t=y.value)==null||t.doOpen()}function lt(){var t;(t=v.value)==null||t.doOpen()}function X(){return{battles:0,damage_dealt:0,losses:0,wins:0,winRate:0,damagePerBattle:0}}async function ot(t){c.tanks.some(a=>a.tank_id===t.tank_id)||(await r.handStatistic.set(t.tank_id,X()),c.tanks.push({...t,stat:X()}))}function Y(t){var a;c.currentTank=tt(t),(a=o.value)==null||a.doOpen()}async function dt(){var t;await((t=o.value)==null?void 0:t.doClose()),c.currentTank=null}async function rt(){var u;if(!c.currentTank)return;const t=tt(c.currentTank);t.stat=O(t.stat);const a=c.tanks.findIndex(p=>p.tank_id===t.tank_id);a>=0&&c.tanks.splice(a,1,t),await r.handStatistic.set(t.tank_id,t.stat),await((u=o.value)==null?void 0:u.doClose()),c.currentTank=null}function ct(){var t;(t=h.value)==null||t.doOpen()}function ut(){var t;(t=h.value)==null||t.doClose()}async function _t(){var t;c.tanks.length&&(await r.handStatistic.clear(),c.tanks=[]),(t=h.value)==null||t.doClose()}return(t,a)=>{const u=F,p=at,Z=Rt,mt=Yt,pt=St,kt=E,ft=L,vt=it,ht=Pt,gt=Ut,bt=Mt,j=Dt,yt=re,wt=$e;return b(),w(D,null,[s("div",Te,[n(gt,{class:"hand-statistic-page__inner"},{default:i(()=>[n(Z,{title:"Средние показатели"},{default:i(()=>[s("div",Ve,[(b(!0),w(D,null,q(d(x),_=>(b(),w("div",{key:_.key,class:"hand-statistic-page__average-item"},[s("div",Ce,T(_.label),1),s("div",Be,T(_.value),1)]))),128))]),s("div",xe,[n(p,{onClick:Q},{before:i(()=>[n(u,{name:"add"})]),default:i(()=>[d(f)?N("",!0):(b(),w("span",Re," Добавить танк "))]),_:1}),n(p,{onClick:lt},{before:i(()=>[n(u,{name:"tune"})]),default:i(()=>[d(f)?N("",!0):(b(),w("span",Se," Настройки "))]),_:1}),n(p,{onClick:ct},{before:i(()=>[n(u,{name:"refresh"})]),default:i(()=>[d(f)?N("",!0):(b(),w("span",Pe," Сброс "))]),_:1})])]),_:1}),n(Z,{title:"Техника"},{default:i(()=>[d(e)?(b(),z(pt,{key:0,headers:U,data:d(c).tanks},{default:i(({row:_})=>[n(mt,{tank:_,onClick:R=>Y(_)},null,8,["tank","onClick"])]),_:1},8,["data"])):(b(),z(ht,{key:1,headers:m,data:d(c).tanks},{name:i(({row:_})=>[s("div",Ue,[n(kt,{size:"24",type:_.type},null,8,["type"]),n(ft,{tier:_.tier},null,8,["tier"]),$(" "+T(_.name),1)])]),battles:i(({row:_})=>[$(T(d(l).number.toInteger(_.stat.battles)),1)]),winRate:i(({row:_})=>[n(vt,{"win-rate":_.stat.winRate},null,8,["win-rate"])]),damagePerBattle:i(({row:_})=>[$(T(d(l).number.toInteger(_.stat.damagePerBattle)),1)]),lastUpdateTime:i(({row:_})=>[$(T(d(l).date.toRelativeTime(_.lastUpdateTime)||"---")+" ",1),s("div",Me,T(d(l).date.toDateTime(_.lastUpdateTime)||"---"),1)]),controls:i(({row:_})=>[s("div",De,[n(p,{onClick:R=>Y(_)},{before:i(()=>[n(u,{name:"edit"})]),default:i(()=>[a[4]||(a[4]=$(" Изменить "))]),_:2},1032,["onClick"]),a[5]||(a[5]=s("div",null,null,-1))])]),_:1},8,["data"]))]),_:1})]),_:1})]),n(j,{ref_key:"settingsDialogRef",ref:v,width:"480px",title:"Настройки"},{footer:i(()=>[s("div",Ne,[a[8]||(a[8]=s("span",null,null,-1)),n(p,{onClick:a[1]||(a[1]=_=>{var R;return(R=d(v))==null?void 0:R.doClose()})},{default:i(()=>a[7]||(a[7]=[$(" Закрыть ")])),_:1})])]),default:i(()=>[s("div",Ie,[s("div",Oe,[a[6]||(a[6]=s("div",{class:"hand-statistic-page__param-title"}," Прозрачность фона показателей ",-1)),n(bt,{modelValue:d(S).bgColorOpacity,"onUpdate:modelValue":a[0]||(a[0]=_=>d(S).bgColorOpacity=_),width:"200px",min:0,max:1,step:.1},null,8,["modelValue"]),s("span",je,T(d(l).number.toPercent((d(S).bgColorOpacity||0)*100)),1)])])]),_:1},512),n(j,{ref_key:"addTankDialogRef",ref:y,width:"640px",title:"Добавление танка"},{footer:i(()=>[s("div",We,[a[10]||(a[10]=s("span",null,null,-1)),n(p,{onClick:a[2]||(a[2]=_=>{var R;return(R=d(y))==null?void 0:R.doClose()})},{default:i(()=>a[9]||(a[9]=[$(" Закрыть ")])),_:1})])]),default:i(()=>[d(C).vehicles?(b(),z(yt,{key:0,items:d(C).vehicles,exclude:d(c).tanks.map(_=>_.tank_id),onSelect:ot},null,8,["items","exclude"])):N("",!0)]),_:1},512),n(j,{ref_key:"editTankDialogRef",ref:o,width:"480px",title:"Изменение показателей"},{default:i(()=>[n(wt,{modelValue:d(c).currentTank,"onUpdate:modelValue":a[3]||(a[3]=_=>d(c).currentTank=_),onClose:dt,onSave:rt},null,8,["modelValue"])]),_:1},512),n(j,{ref_key:"confirmResetDialogRef",ref:h,width:"480px",title:"Сброс сессии"},{footer:i(()=>[s("div",qe,[n(p,{onClick:ut},{default:i(()=>a[11]||(a[11]=[$(" Нет ")])),_:1}),n(p,{onClick:_t},{default:i(()=>a[12]||(a[12]=[$(" Да ")])),_:1})])]),default:i(()=>[a[13]||(a[13]=s("div",{class:"content-area"},[s("p",null," Вы уверены? Текущий прогресс будет утерян. ")],-1))]),_:1},512)],64)}}});export{ra as default};
