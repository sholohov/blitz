import{_ as M}from"./UiSelect.vue.D77OGgu9.js";import{_ as j}from"./nuxt-link.04FmkAu-.js";import{_ as R}from"./WinRate.vue.CFuWW5lr.js";import{_ as T}from"./UiTable.vue.DwQ_iDIQ.js";import{_ as D,a as B}from"./request.hZoxRoxp.js";import{f as E,u as W,n as $,s as r,q,c as v,k as d,d as c,a as s,t as l,m as z,b as u,w as i,o as y,j as H,F as G}from"./entry.DPNISXbu.js";import{u as J}from"./user.DwTc9bEk.js";import{s as K}from"./index.CaqNhiay.js";import{a as N}from"./index.2Ql63jum.js";import{h as k}from"./disableScroll.DWKNMT60.js";import{_ as Q}from"./LeaderboardPosition.vue.ayM3hzZu.js";import"./UiButton.vue.Bm7hv4rP.js";import"./index.B5Lqs8x3.js";const X={class:"leaderboards-accounts-page"},Y=s("div",{class:"leaderboards-accounts-page__description content-area"},[s("h2",null,"Топ «Опытных» игроков"),s("p",null,'Чем выше средний "Опыт", тем выше ваша позиция в рейтинге.'),s("p",null,"Условия участия:"),s("ol",null,[s("li",null,"Быть авторизованным на ресурсе не менее 3-х дней"),s("li",null,'Провести суммарно не менее 10 "обычных" боёв в сутки')])],-1),Z={key:0,class:"leaderboards-accounts-page__user-position"},tt={class:"leaderboards-accounts-page__filters"},at={class:"leaderboards-accounts-page__filters-item"},et={class:"leaderboards-accounts-page__filters-item"},ot={class:"leaderboards-accounts-page__sub"},nt={class:"leaderboards-accounts-page__sub"},st={class:"leaderboards-accounts-page__sub"},lt={class:"leaderboards-accounts-page__sub"},rt={class:"leaderboards-accounts-page__sub"},ct={class:"leaderboards-accounts-page__sub"},Lt=E({__name:"accounts",setup(it){W({title:"Рейтинги / Техника"});const P=J(),e=$({loading:0,tanks:[],accountsLeaderboard:[],userOnLeaderboard:null,items:[],clanAccounts:null,accounts:null}),_=$({page:1,pageSize:100,period:7,battlesPerDay:10,battlesMin:1e4}),V=[{label:"7 дней",value:7},{label:"14 дней",value:14},{label:"30 дней",value:30},{label:"90 дней",value:90}],w=[{label:"От 1к",value:1e3},{label:"от 5к",value:5e3},{label:"от 10к",value:1e4},{label:"от 30к",value:3e4}],x=[{key:"position",label:"#",width:40,align:"center"},{key:"nickname",label:"Ник"},{key:"clan",label:"Клан"},{key:"battles",label:"Бои",tooltip:r.stat.accountProp("battles"),formatter:t=>r.number.toInteger(t)},{key:"win_rate",label:"Победы",tooltip:r.stat.accountProp("winRate"),formatter:t=>r.number.toFloatNumber(t)},{key:"damage_per_battle",label:"Урон",tooltip:r.stat.accountProp("damagePerBattle"),formatter:t=>r.number.toInteger(t)},{key:"frags_per_battle",label:"Уничт. / ур. >= 8",tooltip:r.stat.accountProp("fragPerBattle"),formatter:t=>r.number.toFloatNumber(t)},{key:"xp_per_battle",label:"Опыт",tooltip:r.stat.accountProp("xp"),formatter:t=>r.number.toInteger(t)},{key:"spotted_per_battle",label:"Обн.",tooltip:r.stat.accountProp("spotted"),formatter:t=>r.number.toFloatNumber(t)}];q(()=>{L()});async function F(t){e.loading++;try{const{data:o}=await B.account.getInfo({extra:"statistics.rating",account_id:t.join(",")});e.accounts=o??null}catch(o){e.accounts=null,k(o,{title:"Поучение списка аккаунтов"})}e.loading--}async function C(t){e.loading++;try{const{data:o}=await B.clan.getAccountInfo({extra:"clan",account_id:t.join(",")});e.clanAccounts=o??null}catch(o){e.clanAccounts=null,k(o,{title:"Ошибка поучения списка клановых аккаунтов"})}e.loading--}async function O(){e.loading++;try{const{data:t}=await N.leaderboards.getAccounts(_);e.accountsLeaderboard=t}catch(t){e.accountsLeaderboard=[],k(t,{title:"Получение рейтинга игроков"})}e.loading--}async function S(){e.loading++;try{const{data:t}=await N.leaderboards.getAccounts({..._,ids:[P.accountId]});e.userOnLeaderboard=t[0]}catch(t){e.userOnLeaderboard=null,k(t,{title:"Получение рейтинга пользователя"})}e.loading--}async function U(){const t=e.accountsLeaderboard.map(o=>o.id);t.length&&(await Promise.allSettled([C(t),F(t)]),e.items=e.accountsLeaderboard.map(o=>{var g,f,h,m;const b=(f=(g=e.clanAccounts)==null?void 0:g[o.id])==null?void 0:f.clan,p=(m=(h=e.accounts)==null?void 0:h[o.id])==null?void 0:m.statistics;return{...o,stat:p?K.accountAll(p.all):null,clan:b??null}}))}async function L(){await Promise.all([O(),P.accountId?S():null]),await U()}function I(){L()}return(t,o)=>{var m;const b=M,p=j,g=R,f=T,h=D;return y(),v("div",X,[Y,d(e).userOnLeaderboard?(y(),v("div",Z,[c(" Ваша позиция в рейтинге: "),s("b",null,l((m=d(e).userOnLeaderboard)==null?void 0:m.position),1),c(". ")])):z("",!0),s("div",tt,[s("div",at,[c(" За период: "),u(b,{modelValue:d(_).period,"onUpdate:modelValue":o[0]||(o[0]=a=>d(_).period=a),style:{width:"120px"},options:V,onChange:I},null,8,["modelValue"])]),s("div",et,[c(" Боёв: "),u(b,{modelValue:d(_).battlesMin,"onUpdate:modelValue":o[1]||(o[1]=a=>d(_).battlesMin=a),style:{width:"120px"},options:w,onChange:I},null,8,["modelValue"])])]),u(f,{ref:"accountsTable","no-wrap":"","row-key":"id","scroll-to-top":"","scroll-auto-disabling":"",headers:x,data:d(e).items,height:"calc(100vh - 112px)"},{position:i(({row:a})=>[u(Q,{position:a.position},null,8,["position"])]),nickname:i(({row:a})=>[u(p,{class:"leaderboards-accounts-page__nickname link",to:{name:"account-id",params:{id:a.id}}},{default:i(()=>[c(l(a.nickname),1)]),_:2},1032,["to"])]),clan:i(({row:a})=>[a.clan?(y(),H(p,{key:0,class:"leaderboards-accounts-page__clan link",to:{name:"clan-id",params:{id:a.clan.clan_id}}},{default:i(()=>[c(l(a.clan.tag),1)]),_:2},1032,["to"])):(y(),v(G,{key:1},[c(" --- ")],64))]),battles:i(({row:a})=>{var n;return[c(l(a.battles)+" ",1),s("div",ot,l(t.$formatter.number.toInteger((n=a.stat)==null?void 0:n.battles)||"---"),1)]}),win_rate:i(({row:a})=>{var n;return[u(g,{"model-value":a.win_rate,class:"leaderboards-accounts-page__win-rate"},null,8,["model-value"]),s("div",nt,l(t.$formatter.number.toFloatPercent((n=a.stat)==null?void 0:n.winRate)||"---"),1)]}),damage_per_battle:i(({row:a})=>{var n;return[c(l(a.damage_per_battle)+" ",1),s("div",st,l(t.$formatter.number.toInteger((n=a.stat)==null?void 0:n.damagePerBattle)||"---"),1)]}),frags_per_battle:i(({row:a})=>{var n,A;return[c(l(a.frags_per_battle)+" / "+l(a.frags8p_per_battle)+" ",1),s("div",lt,l(t.$formatter.number.toFloatNumber((n=a.stat)==null?void 0:n.fragPerBattle)||"---")+" / "+l(t.$formatter.number.toFloatNumber((A=a.stat)==null?void 0:A.frag8pPerBattle)||"---"),1)]}),xp_per_battle:i(({row:a})=>{var n;return[c(l(a.xp_per_battle)+" ",1),s("div",rt,l(t.$formatter.number.toInteger((n=a.stat)==null?void 0:n.xpPerBattle)||"---"),1)]}),spotted_per_battle:i(({row:a})=>{var n;return[c(l(a.spotted_per_battle)+" ",1),s("div",ct,l(t.$formatter.number.toInteger((n=a.stat)==null?void 0:n.spottedPerBattle)||"---"),1)]}),_:1},8,["data"]),u(h,{loading:d(e).loading>0},null,8,["loading"])])}}});export{Lt as default};
