import{N as Ie}from"./nuxt-icon.j5VLktT_.js";import{J as Pe,o as _,c as y,a as o,f as j,i as U,s as B,b as g,C as J,k as d,t as $,m as D,r as K,n as Y,j as L,w as T,d as I,F as z,A as Q,q as De,v as ke,x as de,y as Ft,T as Ye,D as Ze,E as ee,_ as te,K as et,L as X,M as Se,g as qt,z as Le,N as Ae,O as Re,H as ve}from"./entry.BCxoBdpj.js";import{_ as Nt,m as oe}from"./RatingIcon.vue.CO1OsjyK.js";import{_ as tt}from"./nuxt-link.vBf0PoaZ.js";import{_ as ye,a as ae,h as q,u as jt,t as Ht}from"./disableScroll.BMhynJqB.js";import{_ as ce,a as se,s as W}from"./request.DYurK6w5.js";import{_ as _e,a as Gt,i as zt,g as Kt}from"./UiDialog.vue.BESQZ_pt.js";import{a as ue}from"./index.BxyEh5Dy.js";import{c as Wt,_ as at,m as ne}from"./index.BqSqJ_4f.js";import{a as le,_ as Xt}from"./UiSelect.vue.D2eRQWvm.js";import{u as Jt}from"./index.R4QztNYD.js";import{_ as Qt}from"./PageSection.vue.s6l2bVZ8.js";import{_ as Be}from"./UiImage.vue.DS0P_sJE.js";import{f as nt,m as Yt}from"./index.DXinyEXL.js";import{_ as Oe}from"./WinRate.vue.BzptdZEm.js";import{_ as st}from"./UiTable.vue.BVfjirGu.js";import{s as E}from"./index.Bti3NMCI.js";import{_ as Zt,a as ea,b as ta,d as aa,e as na,i as sa,f as oa,g as ia,c as Z}from"./cloneDeep.DYYq5SQT.js";import{e as ca}from"./isArrayLike.B41ObuhJ.js";import{u as la}from"./user.BXGQUIUO.js";import{u as ra}from"./index.54BYZypU.js";const ua={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"},da=o("path",{fill:"currentColor","fill-rule":"evenodd",d:"M28.5 43c8.56 0 15.5-3.134 15.5-7v6c0 3.866-6.94 7-15.5 7S13 45.866 13 42v-6c0 3.866 6.94 7 15.5 7","clip-rule":"evenodd"},null,-1),_a=o("path",{fill:"currentColor","fill-rule":"evenodd",d:"M34.5 36c8.56 0 15.5-3.134 15.5-7v6c0 3.866-6.94 7-15.5 7S19 38.866 19 35v-6c0 3.866 6.94 7 15.5 7","clip-rule":"evenodd"},null,-1),ma=o("path",{fill:"currentColor","fill-rule":"evenodd",d:"M44 19c0 3.866-6.94 7-15.5 7S13 22.866 13 19v6c0 3.866 6.94 7 15.5 7S44 28.866 44 25zm-1 0c0 1.296-1.21 2.8-3.951 4.038C36.4 24.234 32.672 25 28.5 25s-7.9-.766-10.549-1.962C15.211 21.801 14 20.296 14 19s1.21-2.8 3.951-4.038C20.6 13.766 24.328 13 28.5 13s7.9.766 10.549 1.962C41.789 16.199 43 17.704 43 19","clip-rule":"evenodd"},null,-1),fa=[da,_a,ma];function pa(t,r){return _(),y("svg",ua,[...fa])}const Ee={render(){return Pe(Ie,{icon:{render:pa},name:"gold"})}},va={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"},ha=o("path",{stroke:"currentColor","stroke-width":"4",d:"m31 13.472 3.486 10.73.45 1.382H47.67l-9.127 6.63-1.176.855.45 1.382 3.486 10.73-9.127-6.632L31 37.695l-1.176.854-9.127 6.631 3.487-10.73.449-1.381-1.176-.854-9.127-6.631h12.735l.449-1.382z"},null,-1),ka=[ha];function ga(t,r){return _(),y("svg",va,[...ka])}const ya={render(){return Pe(Ie,{icon:{render:ga},name:"xp"})}},wa={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"},ba=o("path",{fill:"currentColor","fill-rule":"evenodd",d:"M49.306 27.104 44.133 9l9.483 11.574zm-14.426 25L56 23.654v13.793l-14.655 7.759h12.069l-7.759 5.172zm-21.552-25L18.5 9 9.017 20.574zm13.793 25L6 23.656v13.793l14.655 7.758H8.586l7.759 5.173zM21 20l10-4 10 4v16l-10 8-10-8zm6 12.5L29 22l5.5-1-2 7 4-.5-7 11 2-8z","clip-rule":"evenodd"},null,-1),$a=[ba];function Aa(t,r){return _(),y("svg",wa,[...$a])}const Ra={render(){return Pe(Ie,{icon:{render:Aa},name:"prem"})}},Ta={class:"account-resources"},Ca={class:"account-resources__inner"},Sa={key:0,class:"account-resources__item"},Ia={class:"account-resources__text"},Pa={class:"account-resources__item"},Da={class:"account-resources__text"},Ba={class:"account-resources__item"},Oa={class:"account-resources__text"},xa={class:"account-resources__item"},Ma={class:"account-resources__text"},Ua=j({__name:"AccountResources",props:{resources:{type:Object,required:!0,default:()=>({})}},setup(t){const r=t,u=U(()=>{const v=r.resources.premium_expires_at*1e3;return v-Date.now()<=0?"":B.date.toTimePassed(v,Date.now(),!0)});return(v,s)=>(_(),y("div",Ta,[o("div",Ca,[t.resources.is_premium.toLocaleString()?(_(),y("div",Sa,[g(d(Ra),{filled:!0,"font-controlled":!1,class:J(["account-resources__icon",[{"account-resources__icon--prem":d(u)}]])},null,8,["class"]),o("div",Ia,$(d(u)||"0 дн."),1)])):D("",!0),o("div",Pa,[g(d(Ee),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--gold"}),o("div",Da,$(t.resources.gold.toLocaleString()),1)]),o("div",Ba,[g(d(Ee),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--credits"}),o("div",Oa,$(t.resources.credits.toLocaleString()),1)]),o("div",xa,[g(d(ya),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--xp"}),o("div",Ma,$(t.resources.free_xp.toLocaleString()),1)])])]))}}),Va={class:"account-preview-details__body"},La={class:"account-preview-details__section"},Ea={class:"account-preview-details__props-title"},Fa={class:"account-preview-details__props"},qa={class:"account-preview-details__prop"},Na=o("span",{class:"account-preview-details__prop-title"}," Дата создания ",-1),ja={class:"account-preview-details__prop"},Ha=o("span",{class:"account-preview-details__prop-title"}," Дата обновления ",-1),Ga={key:0,class:"account-preview-details__section"},za={class:"account-preview-details__props-title"},Ka={class:"account-preview-details__props"},Wa={class:"account-preview-details__prop"},Xa=o("span",{class:"account-preview-details__prop-title"}," Зарегистрирован ",-1),Ja={class:"account-preview-details__prop"},Qa=o("span",{class:"account-preview-details__prop-title"}," Последний визит ",-1),Ya={class:"account-preview-details__section"},Za={class:"account-preview-details__props-title"},en={key:0,class:"account-preview-details__props"},tn={class:"account-preview-details__prop"},an=o("span",{class:"account-preview-details__prop-title"}," Командир ",-1),nn={class:"account-preview-details__prop"},sn=o("span",{class:"account-preview-details__prop-title"}," Участников ",-1),on={class:"account-preview-details__prop"},cn=o("span",{class:"account-preview-details__prop-title"}," Создан ",-1),ln={class:"account-preview-details__prop"},rn=o("span",{class:"account-preview-details__prop-title"}," Роль ",-1),un={class:"account-preview-details__prop"},dn=o("span",{class:"account-preview-details__prop-title"}," Вступил ",-1),_n={key:1,class:"account-preview-details__props"},mn=o("div",{class:"account-preview-details__prop"}," Не состоит в клане ",-1),fn=[mn],pn={key:1,class:"account-preview-details__section"},vn={class:"account-preview-details__props-title"},hn={class:"account-preview-details__props"},kn={class:"account-preview-details__prop"},gn=o("span",{class:"account-preview-details__prop-title"}," Отражаются только те дни в которые произошла смена клана или должности. Данные собираются со дня регистрации на сайте. ",-1),yn={key:0,class:"account-preview-details__clan-history"},wn={class:"account-preview-details__clan-history-date"},bn={key:1,class:"account-preview-details__clan-history-link"},$n={style:{display:"flex","justify-content":"space-between"}},An=o("span",null,null,-1),Rn=j({__name:"AccountPreviewDetails",props:{account:{type:[Object,null],required:!0},clanAccount:{type:[Object,null],required:!0}},setup(t,{expose:r}){const u=t,v=K(null),s=Y({user:null,clan:null,clanHistory:[],loading:0,isOpened:!1});async function w(a){s.loading++;try{const{data:i}=await se.clan.getInfo({clan_id:a});s.clan=i?i[a]:null}catch(i){q(i,{title:"Получение данных клана"})}s.loading--}async function A(a){s.loading++;try{const{data:i}=await ue.user.get(a);s.user=i}catch(i){if(ue.isResponse(i)&&i.status===404)return;q(i,{title:"Получение данных пользователя"})}finally{s.loading--}}async function b(a){s.loading++;try{const{data:i}=await se.clan.getInfo({clan_id:a.join(","),fields:"clan_id,name,tag"});return i??null}catch(i){return q(i,{title:"Получение данных кланов"}),null}finally{s.loading--}}function R(a,i){s.clanHistory=a.map((c,m,S)=>{const{raw:f,timestamp:C}=c,V=f&&i?i[f.clan_id]:null,F=`[${(V==null?void 0:V.tag)??"Deleted"}]`,M=S.length-1===m,x=a[m-1],H=B.date.toDaysPassed(C,x==null?void 0:x.timestamp);return{key:C,date:`${B.date.toDate(C)} (${M?" ... ":H})`,info:f?`${F} ${B.clan.role(f.role)}`:"Не в клане",clanId:(f==null?void 0:f.clan_id)??null}})}async function e(a){s.loading++;try{const{data:i}=await ue.stat.clansAccounts.getActivityList({id:a});return i??[]}catch(i){return q(i,{title:"Получение данных пользователя"}),[]}finally{s.loading--}}async function n(){var i;if(s.isOpened||!u.account||(s.isOpened=!0,(i=u.clanAccount)!=null&&i.clan_id&&await w(u.clanAccount.clan_id),await A(u.account.account_id),!s.user))return;const a=await e(u.account.account_id);if(a.length){const c=a.filter(({raw:S})=>S==null?void 0:S.clan_id).map(({raw:S})=>S==null?void 0:S.clan_id),m=await b(c);R(a,m)}}function p(){var a;(a=v.value)==null||a.doClose()}async function h(){var a;await n(),await((a=v.value)==null?void 0:a.doOpen())}return r({close:p,open:h}),(a,i)=>{const c=ye,m=tt,S=ce,f=ae,C=_e;return t.account?(_(),L(C,{key:0,ref_key:"detailedDialogRef",ref:v,class:"account-preview-details",title:"Дополнительная информация",width:"600px"},{footer:T(()=>[o("div",$n,[An,g(f,{onClick:p},{default:T(()=>[I(" Закрыть ")]),_:1})])]),default:T(()=>{var V,F,M,x;return[o("div",Va,[o("div",La,[o("h5",Ea,[g(c,{class:"account-preview-details__prop-title-icon",name:"sports-esports"}),I(" Аккаунт игрока ")]),o("div",Fa,[o("div",qa,[Na,I(" "+$(a.$formatter.date.toDate(t.account.created_at*1e3)),1)]),o("div",ja,[Ha,I(" "+$(a.$formatter.date.toDate(t.account.updated_at*1e3)),1)])])]),d(s).user?(_(),y("div",Ga,[o("h5",za,[g(c,{class:"account-preview-details__prop-title-icon",name:"person"}),I(" Пользователь ресурса ")]),o("div",Ka,[o("div",Wa,[Xa,I(" "+$(a.$formatter.date.toDate(((V=d(s).user)==null?void 0:V.createAt)??0)),1)]),o("div",Ja,[Qa,I(" "+$(a.$formatter.date.toDate(((F=d(s).user)==null?void 0:F.visitedAt)??0)),1)])])])):D("",!0),o("div",Ya,[o("h5",Za,[g(c,{class:"account-preview-details__prop-title-icon",name:"groups"}),I(" Клан игрока ")]),d(s).clan&&t.clanAccount?(_(),y("div",en,[o("div",tn,[an,d(s).clan.leader_id?(_(),L(m,{key:0,class:"account-preview-details__clan-history-link link",to:{name:"account-id",params:{id:d(s).clan.leader_id}}},{default:T(()=>{var H;return[I($((H=d(s).clan)==null?void 0:H.leader_name),1)]}),_:1},8,["to"])):D("",!0)]),o("div",nn,[sn,I(" "+$(a.$formatter.number.toInteger((M=d(s).clan)==null?void 0:M.members_count)),1)]),o("div",on,[cn,I(" "+$(a.$formatter.date.toDate(((x=d(s).clan)==null?void 0:x.created_at)*1e3)),1)]),o("div",ln,[rn,I(" "+$(a.$formatter.clan.role(t.clanAccount.role)),1)]),o("div",un,[dn,I(" "+$(a.$formatter.date.toDate(t.clanAccount.joined_at*1e3))+" ("+$(a.$formatter.date.toDaysPassed(t.clanAccount.joined_at*1e3))+") ",1)])])):(_(),y("div",_n,fn))]),d(s).user?(_(),y("div",pn,[o("h5",vn,[g(c,{class:"account-preview-details__prop-title-icon",name:"history"}),I(" Клановая история ")]),o("div",hn,[o("div",kn,[gn,d(s).clanHistory.length?(_(),y("div",yn,[(_(!0),y(z,null,Q(d(s).clanHistory,H=>(_(),y("div",{key:H.key,class:"account-preview-details__clan-history-item"},[o("span",wn,$(H.date),1),H.clanId?(_(),L(m,{key:0,class:"account-preview-details__clan-history-link link",to:{name:"clan-id",params:{id:H.clanId}}},{default:T(()=>[I($(H.info),1)]),_:2},1032,["to"])):(_(),y("span",bn,$(H.info),1))]))),128))])):(_(),y(z,{key:1},[I(" Данные собираются. ")],64))])])])):D("",!0)]),g(S,{"backdrop-light":"",loading:d(s).loading>0},null,8,["loading"])]}),_:1},512)):D("",!0)}}}),Tn={class:"account-preview"},Cn={key:0,class:"account-preview__inner"},Sn={class:"account-preview__league"},In={class:"account-preview__info"},Pn={class:"account-preview__nickname"},Dn={class:"account-preview__nickname-text"},Bn={class:"account-preview__clan-text"},On={class:"account-preview__props"},xn={class:"account-preview__prop"},Mn=o("span",{class:"account-preview__prop-title"}," Последний бой ",-1),Un={class:"account-preview__prop-value"},Vn={key:0,class:"account-preview__prop"},Ln=o("span",{class:"account-preview__prop-title"}," Должность ",-1),En={class:"account-preview__prop-value"},Fn={class:"account-preview__actions"},qn=j({__name:"AccountPreview",props:{account:{type:[Object,null],default:null,required:!0},loading:{type:Boolean,default:!1}},setup(t){const r=K(null),u=t,v=jt(),s=Y({clanAccount:null,isFavorite:!0,clan:null,detailsLoading:!1}),w=U(()=>{var h;return(h=s.clanAccount)==null?void 0:h.clan});De(()=>{var a,i;R(),((a=u.account)==null?void 0:a.account_id)&&A((i=u.account)==null?void 0:i.account_id)});async function A(h){try{const{data:a}=await se.clan.getAccountInfo({account_id:h,extra:"clan"});s.clanAccount=a?a[h]:null}catch(a){q(a,{title:"Получение данных клана"})}}async function b(){var h;s.detailsLoading=!0,await((h=r.value)==null?void 0:h.open()),s.detailsLoading=!1}async function R(){if(!u.account)return;const h=await W.indexedDB.accountsFavorites.get(u.account.account_id);s.isFavorite=h?h==null?void 0:h.isFavorite:!1}async function e(){u.account&&(s.isFavorite=!s.isFavorite,await W.indexedDB.accountsFavorites.set(u.account.account_id,{id:u.account.account_id,isFavorite:s.isFavorite}))}function n(){e()}async function p(){var a,i,c,m;await Wt(`${(a=u.account)==null?void 0:a.nickname}/${(i=u.account)==null?void 0:i.account_id}`)?v.add({type:"success",title:"Скопировано",message:`${(c=u.account)==null?void 0:c.nickname}/${(m=u.account)==null?void 0:m.account_id}`,duration:3e3}):v.add({type:"error",message:"При копировании что-то пошло не так",duration:3e3})}return(h,a)=>{var V;const i=Nt,c=tt,m=ye,S=ae,f=ce,C=Rn;return _(),y("div",Tn,[t.account?(_(),y("div",Cn,[o("div",Sn,[g(i,{large:"",rating:t.account.statistics.rating},null,8,["rating"])]),o("div",In,[o("div",Pn,[o("span",Dn,$(t.account.nickname),1)]),d(s).clanAccount&&d(w)?(_(),L(c,{key:0,class:"account-preview__clan link",title:"Перейти к клану",to:{name:"clan-id",params:{id:d(w).clan_id}}},{default:T(()=>[o("span",Bn," ["+$(d(w).tag)+"] "+$(d(w).name),1)]),_:1},8,["to"])):D("",!0),o("div",On,[o("div",xn,[Mn,o("span",Un,$(h.$formatter.date.toRelativeTime(t.account.last_battle_time*1e3)),1)]),d(s).clanAccount?(_(),y("div",Vn,[Ln,o("span",En,$(h.$formatter.clan.role((V=d(s).clanAccount)==null?void 0:V.role)),1)])):D("",!0)])]),o("div",Fn,[g(S,{"is-text":"",class:"account-preview__actions-btn",title:"Копировать (nickname/ID)",onClick:p},{default:T(()=>[g(m,{name:"content-copy"})]),_:1}),g(S,{"is-text":"",class:"account-preview__actions-btn",title:"Добавить в избранные",onClick:n},{default:T(()=>[d(s).isFavorite?(_(),L(m,{key:0,name:"star"})):(_(),L(m,{key:1,name:"star-border"}))]),_:1}),g(S,{"is-text":"",disabled:d(s).detailsLoading,class:"account-preview__actions-btn",title:"Дополнительная информация",onClick:b},{default:T(()=>[g(m,{name:"info"})]),_:1},8,["disabled"])])])):D("",!0),g(f,{loading:t.loading},null,8,["loading"]),g(C,{ref_key:"accountPreviewDetailsRef",ref:r,account:t.account,"clan-account":d(s).clanAccount},null,8,["account","clan-account"])])}}}),Nn=window.setInterval,jn={class:"session-panel"},Hn={class:"session-panel__inner"},Gn={class:"session-panel__item"},zn={class:"session-panel__buttons"},Kn={key:0,class:"session-panel__item session-panel__item--time"},Wn={class:"session-panel__time"},Xn=o("span",{class:"session-panel__time-title"}," Время начала ",-1),Jn=o("div",{style:{margin:"0 0 1em"}}," Вы уверены, что хотите сбросить сессию? ",-1),Qn={style:{"text-align":"right"}},Fe=60,Yn=j({__name:"SessionPanel",props:ke({updateAt:{type:Number,required:!0,default:0},hideAutoUpdate:{type:[Boolean],default:!1},loading:{type:Boolean,required:!0,default:!1}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:ke(["reset","update","session-active"],["update:modelValue"]),setup(t,{emit:r}){const u=de(t,"modelValue"),v=t,s=Jt(),w=K(null),A=Y({autoUpdateChecked:!1,autoUpdateInterval:Fe,autoUpdateCounter:Fe,autoUpdateTimer:0}),b=U(()=>{const h=B.date.toDateTime(v.updateAt),a=B.date.toDaysPassed(v.updateAt,Date.now(),!0);return`${h} (${a})`});Ft(()=>{clearInterval(A.autoUpdateTimer)});const R=r;function e(){var h;(h=w.value)==null||h.doOpen()}function n(h){var a;h&&R("reset"),(a=w.value)==null||a.doClose()}function p(){if(A.autoUpdateChecked=!A.autoUpdateChecked,A.autoUpdateCounter=A.autoUpdateInterval,!A.autoUpdateChecked){clearInterval(A.autoUpdateTimer);return}const h=()=>{if(clearInterval(A.autoUpdateTimer),A.autoUpdateTimer=Nn(h,1e3),A.autoUpdateCounter>0){A.autoUpdateCounter--;return}A.autoUpdateCounter=A.autoUpdateInterval,R("update")};R("update"),h()}return(h,a)=>{const i=le,c=ye,m=ae,S=ce,f=_e;return _(),y("div",jn,[o("div",Hn,[o("div",Gn,[o("div",zn,[g(i,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=C=>u.value=C),class:"session-panel__btn",title:"Просмотр статистики за сессию"},{default:T(()=>[I(" Сессия ")]),_:1},8,["modelValue"]),t.hideAutoUpdate===!1?(_(),L(m,{key:0,class:"session-panel__btn",title:"Автоматическое обновление данных",onClick:p},{before:T(()=>[g(c,{name:"refresh-auto"})]),default:T(()=>[d(s).isTablet?D("",!0):(_(),y(z,{key:0},[I(" Обновление ")],64)),I(" "+$(d(A).autoUpdateCounter)+" сек. ",1)]),_:1})):D("",!0),g(m,{class:"session-panel__btn",title:"Сброс данных сессии",onClick:e},{default:T(()=>[g(c,{name:"close"})]),_:1})])]),d(b)?(_(),y("div",Kn,[o("span",Wn,[Xn,I(" "+$(d(b)),1)])])):D("",!0)]),g(S,{loading:t.loading},null,8,["loading"]),g(f,{ref_key:"confirmDialogRef",ref:w,title:"Сброс сессии"},{default:T(()=>[Jn,o("div",Qn,[g(m,{align:"center",width:"80px",onClick:a[1]||(a[1]=C=>n(!0))},{default:T(()=>[I(" Да ")]),_:1}),g(m,{align:"center",width:"80px",onClick:a[2]||(a[2]=C=>n(!1))},{default:T(()=>[I(" Нет ")]),_:1})])]),_:1},512)])}}}),Zn={class:"accounts-metrics"},es={class:"accounts-metrics__filters"},ts={class:"accounts-metrics__filters-item"},as={class:"accounts-metrics__filters-item"},ns={class:"accounts-metrics__plates"},ss=j({__name:"AccountsMetrics",props:{metrics:{type:Array,required:!0,default:()=>[]},filters:{type:Object,required:!0,default:()=>({})},loading:{type:Boolean,default:!1}},emits:["filters","is-open"],setup(t,{emit:r}){const u=["battles","winRate","damagePerBattle","winsInPlatoon","battlesPerDay","tanksWithMaster"],v=t,s=Y({isOpen:!1}),w=U(()=>s.isOpen?v.metrics:v.metrics.filter(R=>u.includes(R.key))),A=r;function b(){const R=v.filters.battleMode==="random"?"rating":"random";A("filters",{...v.filters,battleMode:R})}return(R,e)=>{const n=le,p=at;return _(),y("div",Zn,[o("div",es,[o("div",ts,[g(n,{"model-value":t.filters.battleMode==="rating",onChange:b},{default:T(()=>[I(" Рейтинг ")]),_:1},8,["model-value"])]),o("div",as,[g(n,{modelValue:d(s).isOpen,"onUpdate:modelValue":e[0]||(e[0]=h=>d(s).isOpen=h)},{default:T(()=>[I(" Все показатели ")]),_:1},8,["modelValue"])])]),o("div",ns,[g(p,{loading:t.loading,items:d(w)},null,8,["loading","items"])])])}}}),os=["onClick"],is={class:"achievements-list__item-inner"},cs={class:"achievements-list__item-img-wrapper"},ls={key:0,class:"achievements-list__item-count"},rs={key:0,class:"achievements-list__item-series"},us={key:1,class:"achievements-list__item-details"},ds=j({__name:"AchievementsList",props:{achievements:{type:Array,default:()=>[]},hideName:{type:[Boolean,String],default:!1}},emits:["medal-click"],setup(t,{emit:r}){const u=r;function v(s){u("medal-click",s)}return(s,w)=>{const A=Be;return _(),y("div",{class:J(["achievements-list",[t.hideName?"achievements-list--small":""]])},[t.achievements.length?(_(),L(Ye,{key:0,tag:"ul",class:"achievements-list__list",name:"achievements-list__item-"},{default:T(()=>[(_(!0),y(z,null,Q(t.achievements,b=>(_(),y("li",{key:b.key,class:J(["achievements-list__item",[!b.count&&!b.series?"achievements-list__item--no-count":""]])},[o("button",{class:"achievements-list__item-btn",onClick:R=>v(b)},[o("span",is,[o("span",cs,[g(A,{class:"achievements-list__item-img",src:b.image,alt:b.key,"data-name":b.name},null,8,["src","alt","data-name"])]),b.count||b.series?(_(),y("span",ls,[I($(b.count)+" ",1),b.series?(_(),y("span",rs," / "+$(b.series),1)):D("",!0)])):D("",!0),t.hideName?D("",!0):(_(),y("span",us,$(b.name),1))])],8,os)],2))),128))]),_:1})):D("",!0)],2)}}}),_s={key:0,class:"achievements-block__details"},ms={class:"achievements-block__details-header"},fs={class:"achievements-block__details-name"},ps={class:"achievements-block__details-body"},vs=["textContent"],hs=["textContent"],ks={class:"achievements-block__details-footer"},gs=j({__name:"AchievementsDetails",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(t,{expose:r}){const u=de(t,"modelValue"),v=K(null),s=K(!1);function w(){s.value=!1}function A(){var b;(b=v.value)==null||b.doOpen()}return r({open:A}),(b,R)=>{const e=Be,n=ae,p=_e;return _(),L(p,{ref_key:"detailsRef",ref:v,width:"640px",onOpen:w},{footer:T(()=>[o("div",ks,[g(n,{onClick:R[0]||(R[0]=h=>{var a;return(a=d(v))==null?void 0:a.doClose()})},{default:T(()=>[I(" Закрыть ")]),_:1})])]),default:T(()=>{var h;return[u.value?(_(),y("div",_s,[o("div",ms,[g(e,{class:"achievements-block__details-img",src:u.value.image,alt:u.value.key},null,8,["src","alt"]),o("span",fs,$((h=u.value)==null?void 0:h.name),1),o("div",ps,[u.value.description?(_(),y("div",{key:0,textContent:$(u.value.description)},null,8,vs)):D("",!0),u.value.condition?(_(),y("div",{key:1,textContent:$(u.value.condition)},null,8,hs)):D("",!0)])])])):D("",!0)]}),_:1},512)}}}),ys={key:0,class:"achievements-block__inner"},ws={class:"achievements-block__filter"},bs={class:"achievements-block__filter-item"},$s={class:"achievements-block__filter-item"},As={class:"achievements-block__filter-item"},Rs={class:"achievements-block__section-title"},Ts={key:1,class:"achievements-block__empty"},Cs={key:1,class:"achievements-block__empty"},ot=j({__name:"AchievementsBlock",props:{achievements:{type:Object,required:!0,default:()=>({})},achievementsInfo:{type:Object,required:!0,default:()=>({})},filters:{type:Object,required:!0,default:()=>nt.makeAccountFilters()}},emits:["filters-changed"],setup(t,{emit:r}){const u=["markOfMastery","markOfMasteryI","markOfMasteryII","markOfMasteryIII","heroesOfRassenay","medalLafayettePool","medalRadleyWalters","warrior","medalKolobanov","mainGun","sniper","camper","medalBrothersInArms","medalCrucialContribution"],v=["battle","epic","title","commemorative","step","platoon"],s=t,w=K(),A=K(),b=Y({currentMedal:null,showAll:!1}),R=U(()=>{const i=Object.keys(s.achievements.achievements),c=Object.keys(s.achievements.achievements);return i.length||c.length}),e=U(()=>{if(s.filters.achievementsShow==="important"){const c=[];return Object.keys(s.achievements.achievements).forEach(m=>{const S=oe.achievementsMedal({key:m,achievements:s.achievements,encyclopedia:s.achievementsInfo});c.push(S)}),u.reduce((m,S)=>{const f=c.find(C=>C.key===S);return f?[...m,f]:m},[])}const i=Object.keys(s.achievementsInfo);return s.filters.achievementsShow==="deserved"?i.map(c=>oe.achievementsMedal({key:c,achievements:s.achievements,encyclopedia:s.achievementsInfo})).filter(c=>s.achievements.achievements[c.key]||s.achievements.max_series[c.key]).sort((c,m)=>c.key.localeCompare(m.key)):i.map(c=>oe.achievementsMedal({key:c,achievements:s.achievements,encyclopedia:s.achievementsInfo})).toSorted((c,m)=>c.key.localeCompare(m.key))}),n=U(()=>{const i={};return e.value.forEach(c=>{i[c.section]||(i[c.section]={name:c.section,items:[]}),i[c.section].items.push(c)}),Object.values(i).sort((c,m)=>v.indexOf(c.name)-v.indexOf(m.name))}),p=r;function h({key:i}){var c;b.currentMedal=e.value.find(m=>m.key===i)??null,(c=A.value)==null||c.open()}function a(i){p("filters-changed",{...s.filters,achievementsShow:i})}return(i,c)=>{const m=le,S=ds,f=gs;return _(),y("div",{ref_key:"mainRef",ref:w,class:"achievements-block"},[d(R)?(_(),y("div",ys,[o("div",ws,[o("div",bs,[g(m,{"model-value":t.filters.achievementsShow==="important",onChange:c[0]||(c[0]=C=>a("important"))},{default:T(()=>[I(" Значимые ")]),_:1},8,["model-value"])]),o("div",$s,[g(m,{"model-value":t.filters.achievementsShow==="deserved",onChange:c[1]||(c[1]=C=>a("deserved"))},{default:T(()=>[I(" Заслуженные ")]),_:1},8,["model-value"])]),o("div",As,[g(m,{"model-value":t.filters.achievementsShow===null,onChange:c[2]||(c[2]=C=>a(null))},{default:T(()=>[I(" Все ")]),_:1},8,["model-value"])])]),d(e).length?(_(),y(z,{key:0},[t.filters.achievementsShow==="important"?(_(),L(S,{key:0,achievements:d(e),"hide-name":!0,onMedalClick:h},null,8,["achievements"])):(_(!0),y(z,{key:1},Q(d(n),C=>(_(),y("div",{key:C.name,class:"achievements-block__section"},[o("div",Rs,$(i.$formatter.achievements.section(C.name)),1),g(S,{achievements:C.items,"hide-count":d(b).showAll,onMedalClick:h},null,8,["achievements","hide-count"])]))),128))],64)):(_(),y("div",Ts," Нет значимых достижений ")),g(f,{ref_key:"detailsRef",ref:A,modelValue:d(b).currentMedal,"onUpdate:modelValue":c[3]||(c[3]=C=>d(b).currentMedal=C)},null,8,["modelValue"])])):(_(),y("div",Cs," Нет достижений "))],512)}}}),we=j({__name:"TankType",props:ke({size:{type:Number,default:24},isPremium:{type:Boolean,default:!1},isCollectible:{type:[Boolean,String],default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const r={lightTank:ee(()=>te(()=>import("./light-tank.BRjIc5Z1.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),mediumTank:ee(()=>te(()=>import("./medium-tank.2BeJ-qVA.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url)),heavyTank:ee(()=>te(()=>import("./heavy-tank.CIxTF5tA.js"),__vite__mapDeps([6,1,2,3,4]),import.meta.url)),"AT-SPG":ee(()=>te(()=>import("./at-spg.DqJ5xv0L.js"),__vite__mapDeps([7,1,2,3,4]),import.meta.url))},u=de(t,"modelValue"),v=U(()=>["AT-SPG","heavyTank","lightTank","mediumTank"].includes(u.value)?u.value:(console.warn("Not valid tank type - ",u.value),"span"));return(s,w)=>(_(),L(Ze(r[d(v)]),{filled:!0,"font-controlled":!1,class:J(["tank-type",[t.isPremium?"tank-type--is-premium":"",t.isCollectible?"tank-type--is-collectible":""]]),width:t.size,height:t.size},null,8,["class","width","height"]))}}),Ss=["src","alt"],it=j({__name:"TankNation",props:ke({size:{type:[Number,String],default:24}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const r=de(t,"modelValue");return(u,v)=>(_(),y("img",{style:et({width:`${t.size}px`,height:`${t.size}px`}),src:`/img/nations/nation-${r.value}.svg`,alt:r.value,class:"tank-nation"},null,12,Ss))}}),Is={class:"account-infographics"},Ps={class:"account-infographics__filters"},Ds={class:"account-infographics__filters-chips"},Bs={class:"account-infographics__chart-list"},Os={class:"account-infographics__chart-label"},xs={class:"account-infographics__line-icon"},Ms={key:2},Us={key:"battles",class:"account-infographics__line-value"},Vs={key:"damagePerBattle",class:"account-infographics__line-value"},Ls=j({__name:"AccountInfographics",props:{tanks:{type:Array,default:()=>[],required:!0}},setup(t){const r=t,u=K("battles"),v=[{value:"battles",label:B.stat.accountProp("battles")},{value:"winRate",label:B.stat.accountProp("winRate")},{value:"damagePerBattle",label:B.stat.accountProp("damagePerBattle")}],s=U(()=>[{label:"По нации",key:"nation",value:w("nation")},{label:"По уровню",key:"tier",value:w("tier")},{label:"По типу",key:"type",value:w("type")}]);function w(b){var e;const R={};if(!((e=r.tanks)!=null&&e.length))return R;r.tanks.forEach(n=>{const p=n[b];n.tier&&(p in R||(R[p]={key:p,battles:0,winRate:0,damagePerBattle:0,lineHeight:0}),R[p].battles+=n.all.battles,R[p].winRate+=n.all.wins,R[p].damagePerBattle+=n.all.damage_dealt)});for(const n in R){const p=R[n].battles;R[n].winRate=p?R[n].winRate/(p/100):0,R[n].damagePerBattle=p?R[n].damagePerBattle/p:0}for(const n in R){const h=Math.min(...Object.values(R).map(i=>i[u.value])),a=Math.max(...Object.values(R).map(i=>i[u.value]))-h/1.1;R[n].lineHeight=(R[n][u.value]-h/1.1)/(a/100)}return R}function A(b){u.value=b}return(b,R)=>{const e=le,n=we,p=it,h=Oe;return _(),y("div",Is,[o("div",Ps,[o("div",Ds,[(_(),y(z,null,Q(v,a=>g(e,{key:a.value,"model-value":a.value===d(u),onChange:i=>A(a.value)},{default:T(()=>[I($(a.label),1)]),_:2},1032,["model-value","onChange"])),64))])]),o("div",Bs,[(_(!0),y(z,null,Q(d(s),a=>(_(),y("div",{key:a.key,class:J(["account-infographics__chart",[`account-infographics__chart--${a.key}`]])},[o("span",Os,$(a.label),1),(_(!0),y(z,null,Q(a.value,i=>(_(),y("div",{key:i.key,class:"account-infographics__line"},[o("span",xs,[a.key==="type"?(_(),L(n,{key:0,modelValue:i.key,"onUpdate:modelValue":c=>i.key=c},null,8,["modelValue","onUpdate:modelValue"])):a.key==="nation"?(_(),L(p,{key:1,modelValue:i.key,"onUpdate:modelValue":c=>i.key=c,size:"22"},null,8,["modelValue","onUpdate:modelValue"])):a.key==="tier"?(_(),y("span",Ms,$(b.$formatter.encyclopedia.tier(i.key)),1)):(_(),y(z,{key:3},[I($(i.key),1)],64))]),g(Ye,{tag:"span",name:"account-infographics__line-value-",class:"account-infographics__line-progress",style:et({"--chart-line-width":i.lineHeight/100})},{default:T(()=>[d(u)==="battles"?(_(),y("span",Us,$(b.$formatter.number.toInteger(i.battles)),1)):D("",!0),d(u)==="winRate"?(_(),L(h,{key:"winRate",modelValue:i.winRate,"onUpdate:modelValue":c=>i.winRate=c,class:"account-infographics__line-value"},null,8,["modelValue","onUpdate:modelValue"])):D("",!0),d(u)==="damagePerBattle"?(_(),y("span",Vs,$(b.$formatter.number.toInteger(i.damagePerBattle)),1)):D("",!0)]),_:2},1032,["style"])]))),128))],2))),128))])])}}}),Es=j({__name:"MarkOfMastery",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(t){const r={1:ee(()=>te(()=>import("./3.CG7JxfyD.js"),__vite__mapDeps([8,1,2,3,4]),import.meta.url)),2:ee(()=>te(()=>import("./2.DP2TmEex.js"),__vite__mapDeps([9,1,2,3,4]),import.meta.url)),3:ee(()=>te(()=>import("./1.CjXkvHzW.js"),__vite__mapDeps([10,1,2,3,4]),import.meta.url)),4:ee(()=>te(()=>import("./М.CjHf4_hs.js"),__vite__mapDeps([11,1,2,3,4]),import.meta.url))},u=de(t,"modelValue");return(v,s)=>(_(),L(Ze(u.value?r[u.value]:"span"),{filled:!0,"font-controlled":!1,class:J(["mark-of-mastery",[u.value?"mark-of-mastery--"+u.value:""]])},null,8,["class"]))}}),Fs={class:"account-tanks-table"},qs={key:0,class:"account-tanks-table__total"},Ns={class:"account-tanks-table__total-value"},js={class:"account-tanks-table__table"},Hs=["title"],Gs={class:"account-tanks-table__name-text"},zs={key:0,class:"account-tanks-table__diff"},Ks={key:0,class:"account-tanks-table__diff"},Ws={key:0,class:"account-tanks-table__diff"},Xs={key:0,class:"account-tanks-table__diff"},Js={key:0,class:"account-tanks-table__diff"},Qs={key:0,class:"account-tanks-table__diff"},Ys={key:0,class:"account-tanks-table__diff"},Zs={key:0,class:"account-tanks-table__diff"},eo={class:"account-tanks-table__mark"},to={key:0,class:"account-tanks-table__diff"},ao={class:"account-tanks-table__diff"},ct=j({__name:"AccountTanksTable",props:{tanks:{type:Array,default:()=>[],required:!0},tanksDiff:{type:[Array,null],default:null,required:!0},noCount:{type:[Boolean,String],default:!1},height:{type:String,default:void 0},maxHeight:{type:String,default:void 0},sort:{type:Object,default:null},defaultSort:{type:Object,default:null},showDiff:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["row-click"],setup(t,{expose:r,emit:u}){const v=t,s=K(null),w=u,A=[{key:"type",label:"Тип",width:60,sortable:!0},{key:"name",label:"Название",sortable:!0},{key:"tier",label:"I-X",sortable:!0},{key:"battles",label:"Бои",sortable:!0,sortMethod(n,p){return n.all.battles-p.all.battles},formatter:n=>B.number.toInteger(n)},{key:"winRate",label:"Победы",sortable:!0,sortMethod(n,p){const h=n,a=p;return h.all.winRate-a.all.winRate},formatter:n=>B.number.toFloatPercent(n)},{key:"damagePerBattle",label:"Урон",sortable:!0,sortMethod(n,p){return n.all.damagePerBattle-p.all.damagePerBattle},formatter:n=>B.number.toInteger(n)},{key:"xpPerBattle",label:"Опыт",sortable:!0,sortMethod(n,p){return n.all.xpPerBattle-p.all.xpPerBattle},formatter:n=>B.number.toInteger(n)},{key:"fragPerBattle",label:"Уничт.",tooltip:"Уничтожено За Бой",sortable:!0,sortMethod(n,p){return n.all.fragPerBattle-p.all.fragPerBattle},formatter:n=>B.number.toFloatNumber(n)},{key:"hitRate",label:"Точн.",tooltip:"Точность стрельбы",sortable:!0,sortMethod(n,p){return n.all.hitRate-p.all.hitRate},formatter:n=>B.number.toPercent(n)},{key:"surviveRate",label:"Выж.",tooltip:"Выживаемость",sortable:!0,sortMethod(n,p){return n.all.surviveRate-p.all.surviveRate},formatter:n=>B.number.toPercent(n)},{key:"spottedPerBattle",label:"Обн.",tooltip:"Обнаружено за бой",sortable:!0,sortMethod(n,p){return n.all.spottedPerBattle-p.all.spottedPerBattle},formatter:n=>B.number.toFloatNumber(n)},{key:"mark_of_mastery",label:"M",tooltip:"Знак классности",sortable:!0,sortMethod(n,p){const h=n.markOfMastery.count+n.markOfMastery.value*1e4,a=p.markOfMastery.count+p.markOfMastery.value*1e4;return h-a},formatter:n=>B.stat.markOfMastery(Number(n))},{key:"last_battle_time",label:"Последний бой",sortable:!0}],b=U(()=>{let n={};return v.tanks.forEach((p,h)=>{h?n=E.sum(n,p.all):n=p.all}),E.tank(n)}),R={1:"markOfMasteryIII",2:"markOfMasteryII",3:"markOfMasteryI",4:"markOfMastery"},e=U(()=>v.tanks.map(n=>{var i;const p=(i=v.tanksDiff)==null?void 0:i.find(c=>c.tank_id===n.tank_id),h=n.achievements.achievements[R[n.mark_of_mastery]]??0,a=(p==null?void 0:p.achievements.achievements[R[n.mark_of_mastery]])??0;return{...n,diff:(p==null?void 0:p.all)??null,markOfMastery:{value:n.mark_of_mastery,count:h,diff:B.number.toInteger(a,!0)||"---"}}}));return r({sortItems(){var n;(n=s.value)==null||n.sortItems()}}),(n,p)=>{const h=we,a=ae,i=Oe,c=Es,m=st,S=ce;return _(),y("div",Fs,[("toFlag"in n?n.toFlag:d(Ht))(t.noCount)?D("",!0):(_(),y("div",qs,[I(" Кол-во: "),o("span",Ns,$(t.tanks.length||0),1)])),o("div",js,[g(m,{ref_key:"tableRef",ref:s,headers:A,data:d(e),summary:d(b),"default-sort":t.defaultSort,"scroll-auto-disabling":"","no-wrap":"","row-key":"tank_id",height:t.height,"max-height":t.maxHeight},{index:T(({index:f})=>[I($(f+1),1)]),type:T(({row:f})=>[o("div",{class:"account-tanks-table__type",title:f.is_premium?"Премиум танк":""},[g(h,{modelValue:f.type,"onUpdate:modelValue":C=>f.type=C,"is-premium":f.is_premium,"is-collectible":f.is_collectible},null,8,["modelValue","onUpdate:modelValue","is-premium","is-collectible"])],8,Hs)]),name:T(({row:f})=>[g(a,{class:"account-tanks-table__name","is-text":"",onClick:C=>w("row-click",f.tank_id)},{default:T(()=>[o("span",Gs,$(f.name??`Tank ID: ${f.tank_id}`),1)]),_:2},1032,["onClick"])]),battles:T(({row:f})=>{var C;return[I($(f.all.battles)+" ",1),t.showDiff?(_(),y("div",zs,$(n.$formatter.number.toInteger((C=f.diff)==null?void 0:C.battles,!0)),1)):D("",!0)]}),winRate:T(({row:f})=>{var C;return[g(i,{"model-value":f.all.winRate,class:"account-tanks-table__win-rate"},null,8,["model-value"]),t.showDiff?(_(),y("div",Ks,$(n.$formatter.number.toFloatPercent((C=f.diff)==null?void 0:C.winRate,!0)),1)):D("",!0)]}),damagePerBattle:T(({row:f})=>{var C;return[I($(f.all.damagePerBattle)+" ",1),t.showDiff?(_(),y("div",Ws,$(n.$formatter.number.toInteger((C=f.diff)==null?void 0:C.damagePerBattle,!0)),1)):D("",!0)]}),xpPerBattle:T(({row:f})=>{var C;return[I($(f.all.xpPerBattle)+" ",1),t.showDiff?(_(),y("div",Xs,$(n.$formatter.number.toInteger((C=f.diff)==null?void 0:C.xpPerBattle,!0)),1)):D("",!0)]}),fragPerBattle:T(({row:f})=>{var C;return[I($(f.all.fragPerBattle)+" ",1),t.showDiff?(_(),y("div",Js,$(n.$formatter.number.toInteger((C=f.diff)==null?void 0:C.fragPerBattle,!0)),1)):D("",!0)]}),hitRate:T(({row:f})=>{var C;return[I($(n.$formatter.number.toFloatPercent(f.all.hitRate))+" ",1),t.showDiff?(_(),y("div",Qs,$(n.$formatter.number.toFloatNumber((C=f.diff)==null?void 0:C.hitRate,!0)),1)):D("",!0)]}),surviveRate:T(({row:f})=>{var C;return[I($(n.$formatter.number.toFloatPercent(f.all.surviveRate))+" ",1),t.showDiff?(_(),y("div",Ys,$(n.$formatter.number.toFloatNumber((C=f.diff)==null?void 0:C.surviveRate,!0)),1)):D("",!0)]}),spottedPerBattle:T(({row:f})=>{var C;return[I($(f.all.spottedPerBattle)+" ",1),t.showDiff?(_(),y("div",Zs,$(n.$formatter.number.toInteger((C=f.diff)==null?void 0:C.spottedPerBattle,!0)),1)):D("",!0)]}),mark_of_mastery:T(({row:f})=>[o("div",eo,[f.markOfMastery.value&&f.markOfMastery.count?(_(),L(c,{key:0,"model-value":f.markOfMastery.value,title:"Знак классности",width:"20",height:"20"},null,8,["model-value"])):D("",!0),I(" "+$(f.markOfMastery.count||"---"),1)]),t.showDiff?(_(),y("div",to,$(f.markOfMastery.diff),1)):D("",!0)]),last_battle_time:T(({row:f})=>[I($(n.$formatter.date.toRelativeTime(f.last_battle_time*1e3)||"---")+" ",1),o("div",ao,$(n.$formatter.date.toDateTime(f.last_battle_time*1e3)||"---"),1)]),_:1},8,["data","summary","default-sort","height","max-height"]),g(S,{loading:t.loading},null,8,["loading"])])])}}}),no={class:"account-daily-stat"},so={class:"account-daily-stat__count"},oo=o("span",{class:"account-daily-stat__count-title"}," Кол-во: ",-1),io={class:"account-daily-stat__table"},co={style:{display:"flex","justify-content":"flex-end"}},lo=j({__name:"AccountDailyStat",props:{accountId:{type:[Number,String],default:0,required:!0},vehicles:{type:Object,default:()=>({}),required:!0}},emits:["sort"],setup(t,{emit:r}){const u=t,v=K(null),s=Y({loading:0,summary:{},items:[],currentItem:null,accounts:[],tanks:[]}),w={order:"desc",prop:"last_battle_time"},A=[{key:"index",label:"#"},{key:"date",label:"Дата"},{key:"tanks",label:"Танков"},{key:"tier",label:"I-X",formatter:a=>X(a)?B.number.toFloatNumber(a):"---"},{key:"battles",label:"Бои",formatter:a=>X(a)?B.number.toInteger(a):"---"},{key:"winRate",label:"Победы",formatter:a=>X(a)?B.number.toFloatPercent(a):"---"},{key:"damagePerBattle",label:"Урон",formatter:a=>X(a)?B.number.toInteger(a):"---"},{key:"xpPerBattle",label:"Опыт",formatter:a=>X(a)?B.number.toInteger(a):"---"},{key:"fragPerBattle",label:"Уничт.",tooltip:"Уничтожено За Бой",formatter:a=>X(a)?B.number.toFloatNumber(a):"---"},{key:"hitRate",label:"Точн.",tooltip:"Точность стрельбы",formatter:a=>X(a)?B.number.toFloatPercent(a):"---"},{key:"surviveRate",label:"Выж.",tooltip:"Выживаемость",formatter:a=>X(a)?B.number.toFloatPercent(a):"---"},{key:"spottedPerBattle",label:"Обн.",tooltip:"Обнаружено за бой",formatter:a=>X(a)?B.number.toFloatNumber(a):"---"}],b=U(()=>s.currentItem?s.currentItem.tanks.map(a=>{var i;return oe.accountTank(a,((i=u.vehicles)==null?void 0:i[a.tank_id])??null,null)}):[]);De(async()=>{u.accountId&&(await e(u.accountId),n())});const R=r;async function e(a){const i=new Date,c=new Date;i.setDate(i.getDate()-90);const m={id:a,dateStart:i.toISOString(),dateEnd:c.toISOString()};try{const[S,f]=await Promise.all([ue.stat.accounts.getDiff(m),ue.stat.tanks.getDiff(m)]);s.tanks=f.data,s.accounts=S.data}catch(S){q(S,{title:"Получение дневной статистики"})}}function n(){let a=null;s.accounts.forEach(i=>{var f;const c=E.accountAll(i.raw.statistics.all),m=(f=s.tanks.find(C=>{const V=B.date.toDate(C.timestamp),F=B.date.toDate(i.timestamp);return V===F}))==null?void 0:f.raw,S=()=>{const C=(m==null?void 0:m.length)??0;return((m==null?void 0:m.reduce((V,F)=>{var M;return V+((M=u.vehicles[F.tank_id])==null?void 0:M.tier)||0},0))??0)/C};s.items.push({id:i.id,date:B.date.toDate(i.timestamp),battles:c.battles,winRate:c.winRate,damagePerBattle:c.damagePerBattle,xpPerBattle:c.xpPerBattle,fragPerBattle:c.fragPerBattle,hitRate:c.hitRate,surviveRate:c.surviveRate,spottedPerBattle:c.spottedPerBattle,tanks:m||[],tier:S()}),a=a?E.sum(a,c):c}),s.summary=a?E.accountAll(a):{}}async function p(a){var i;s.currentItem=a,await Se(),(i=v.value)==null||i.doOpen()}function h(){var a;s.currentItem=null,(a=v.value)==null||a.doClose()}return(a,i)=>{var F;const c=ae,m=Oe,S=st,f=ce,C=ct,V=_e;return _(),y("div",no,[o("div",so,[oo,I(" "+$(d(s).items.length),1)]),o("div",io,[g(S,{headers:A,data:d(s).items,summary:d(s).summary,"scroll-auto-disabling":"","no-wrap":"","row-key":"timestamp","max-height":"375px",onSort:i[0]||(i[0]=M=>R("sort",M))},{index:T(({index:M})=>[I($(M+1),1)]),date:T(({row:M})=>[g(c,{"is-text":"",onClick:x=>p(M)},{default:T(()=>[I($(M.date),1)]),_:2},1032,["onClick"])]),tanks:T(({row:M})=>[I($(M.tanks?a.$formatter.number.toInteger(M.tanks.length):"---"),1)]),winRate:T(({row:M})=>[g(m,{modelValue:M.winRate,"onUpdate:modelValue":x=>M.winRate=x,class:"account-daily-stat__win-rate"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["data","summary"])]),g(f,{loading:d(s).loading>0},null,8,["loading"]),g(V,{ref_key:"tanksDetailsRef",ref:v,width:"1280px",title:"Статистика за "+((F=d(s).currentItem)==null?void 0:F.date),onClosed:i[1]||(i[1]=M=>d(s).currentItem=null)},{footer:T(()=>[o("div",co,[g(c,{onClick:h},{default:T(()=>[I(" Закрыть ")]),_:1})])]),default:T(()=>[d(s).currentItem?(_(),L(C,{key:0,tanks:d(b),"default-sort":w,"max-height":"calc(100vh - 200px)"},null,8,["tanks"])):D("",!0)]),_:1},8,["title"])])}}});var ro="__lodash_hash_undefined__";function uo(t){return this.__data__.set(t,ro),this}var _o=uo;function mo(t){return this.__data__.has(t)}var fo=mo,po=Zt,vo=_o,ho=fo;function ge(t){var r=-1,u=t==null?0:t.length;for(this.__data__=new po;++r<u;)this.add(t[r])}ge.prototype.add=ge.prototype.push=vo;ge.prototype.has=ho;var ko=ge;function go(t,r){for(var u=-1,v=t==null?0:t.length;++u<v;)if(r(t[u],u,t))return!0;return!1}var yo=go;function wo(t,r){return t.has(r)}var bo=wo,$o=ko,Ao=yo,Ro=bo,To=1,Co=2;function So(t,r,u,v,s,w){var A=u&To,b=t.length,R=r.length;if(b!=R&&!(A&&R>b))return!1;var e=w.get(t),n=w.get(r);if(e&&n)return e==r&&n==t;var p=-1,h=!0,a=u&Co?new $o:void 0;for(w.set(t,r),w.set(r,t);++p<b;){var i=t[p],c=r[p];if(v)var m=A?v(c,i,p,r,t,w):v(i,c,p,t,r,w);if(m!==void 0){if(m)continue;h=!1;break}if(a){if(!Ao(r,function(S,f){if(!Ro(a,f)&&(i===S||s(i,S,u,v,w)))return a.push(f)})){h=!1;break}}else if(!(i===c||s(i,c,u,v,w))){h=!1;break}}return w.delete(t),w.delete(r),h}var lt=So;function Io(t){var r=-1,u=Array(t.size);return t.forEach(function(v,s){u[++r]=[s,v]}),u}var Po=Io;function Do(t){var r=-1,u=Array(t.size);return t.forEach(function(v){u[++r]=v}),u}var Bo=Do,qe=Gt,Ne=ea,Oo=ca,xo=lt,Mo=Po,Uo=Bo,Vo=1,Lo=2,Eo="[object Boolean]",Fo="[object Date]",qo="[object Error]",No="[object Map]",jo="[object Number]",Ho="[object RegExp]",Go="[object Set]",zo="[object String]",Ko="[object Symbol]",Wo="[object ArrayBuffer]",Xo="[object DataView]",je=qe?qe.prototype:void 0,Te=je?je.valueOf:void 0;function Jo(t,r,u,v,s,w,A){switch(u){case Xo:if(t.byteLength!=r.byteLength||t.byteOffset!=r.byteOffset)return!1;t=t.buffer,r=r.buffer;case Wo:return!(t.byteLength!=r.byteLength||!w(new Ne(t),new Ne(r)));case Eo:case Fo:case jo:return Oo(+t,+r);case qo:return t.name==r.name&&t.message==r.message;case Ho:case zo:return t==r+"";case No:var b=Mo;case Go:var R=v&Vo;if(b||(b=Uo),t.size!=r.size&&!R)return!1;var e=A.get(t);if(e)return e==r;v|=Lo,A.set(t,r);var n=xo(b(t),b(r),v,s,w,A);return A.delete(t),n;case Ko:if(Te)return Te.call(t)==Te.call(r)}return!1}var Qo=Jo,He=ta,Yo=1,Zo=Object.prototype,ei=Zo.hasOwnProperty;function ti(t,r,u,v,s,w){var A=u&Yo,b=He(t),R=b.length,e=He(r),n=e.length;if(R!=n&&!A)return!1;for(var p=R;p--;){var h=b[p];if(!(A?h in r:ei.call(r,h)))return!1}var a=w.get(t),i=w.get(r);if(a&&i)return a==r&&i==t;var c=!0;w.set(t,r),w.set(r,t);for(var m=A;++p<R;){h=b[p];var S=t[h],f=r[h];if(v)var C=A?v(f,S,h,r,t,w):v(S,f,h,t,r,w);if(!(C===void 0?S===f||s(S,f,u,v,w):C)){c=!1;break}m||(m=h=="constructor")}if(c&&!m){var V=t.constructor,F=r.constructor;V!=F&&"constructor"in t&&"constructor"in r&&!(typeof V=="function"&&V instanceof V&&typeof F=="function"&&F instanceof F)&&(c=!1)}return w.delete(t),w.delete(r),c}var ai=ti,Ce=aa,ni=lt,si=Qo,oi=ai,Ge=na,ze=ia,Ke=sa,ii=oa,ci=1,We="[object Arguments]",Xe="[object Array]",he="[object Object]",li=Object.prototype,Je=li.hasOwnProperty;function ri(t,r,u,v,s,w){var A=ze(t),b=ze(r),R=A?Xe:Ge(t),e=b?Xe:Ge(r);R=R==We?he:R,e=e==We?he:e;var n=R==he,p=e==he,h=R==e;if(h&&Ke(t)){if(!Ke(r))return!1;A=!0,n=!1}if(h&&!n)return w||(w=new Ce),A||ii(t)?ni(t,r,u,v,s,w):si(t,r,R,u,v,s,w);if(!(u&ci)){var a=n&&Je.call(t,"__wrapped__"),i=p&&Je.call(r,"__wrapped__");if(a||i){var c=a?t.value():t,m=i?r.value():r;return w||(w=new Ce),s(c,m,u,v,w)}}return h?(w||(w=new Ce),oi(t,r,u,v,s,w)):!1}var ui=ri,di=ui,Qe=zt;function rt(t,r,u,v,s){return t===r?!0:t==null||r==null||!Qe(t)&&!Qe(r)?t!==t&&r!==r:di(t,r,u,v,rt,s)}var _i=rt,mi=_i;function fi(t,r){return mi(t,r)}var pi=fi;const vi=Kt(pi),hi={class:"account-tanks-filters"},ki={class:"account-tanks-filters__inner"},gi={class:"account-tanks-filters__list"},yi={style:{"font-weight":"500",width:"24px","text-align":"center"}},wi={key:0,class:"account-tanks-filters__item"},bi={class:"account-tanks-filters__item"},$i={class:"account-tanks-filters__item"},Ai=j({__name:"AccountTanksFilters",props:{defaultFilters:{type:Object,default:null,required:!0},filters:{type:Object,default:null,required:!0},isPrivate:{type:[Boolean,String],default:!1,required:!0}},emits:["change","clear"],setup(t,{emit:r}){const u=t,v=["ussr","germany","usa","uk","japan","china","france","european","other"],s=[1,2,3,4,5,6,7,8,9,10].map(c=>({value:c,label:B.encyclopedia.tier(c)})),w=["lightTank","mediumTank","heavyTank","AT-SPG"],A=[{value:null,label:"Премиум: показать"},{value:!0,label:"Премиум: только"},{value:!1,label:"Премиум: спрятать"}],b=[{value:null,label:"В ангаре: все"},{value:1,label:"В ангаре: есть"},{value:0,label:"В ангаре: нет"}],R=U(()=>!vi(u.filters,u.defaultFilters)),e=r;function n(c){let m=u.filters.tankNation;m.includes(c)?m=m.filter(S=>S!==c):m.push(c),e("change",{...u.filters,tankNation:m})}function p(c){let m=u.filters.tankTire;m.includes(c)?m=m.filter(S=>S!==c):m.push(c),e("change",{...u.filters,tankTire:m})}function h(c){let m=u.filters.tankType;m.includes(c)?m=m.filter(S=>S!==c):m.push(c),e("change",{...u.filters,tankType:m})}function a(c){e("change",{...u.filters,tankInGarage:c})}function i(c){e("change",{...u.filters,tankIsPremium:c})}return(c,m)=>{const S=it,f=le,C=we,V=Xt,F=ye,M=ae;return _(),y("div",hi,[o("div",ki,[o("ul",gi,[o("li",{class:J(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[(_(),y(z,null,Q(v,x=>g(f,{key:x,"model-value":t.filters.tankNation.includes(x),class:"account-tanks-filters__btn",title:c.$formatter.encyclopedia.nation(x),onChange:H=>n(x)},{default:T(()=>[g(S,{"model-value":x},null,8,["model-value"])]),_:2},1032,["model-value","title","onChange"])),64))]),o("li",{class:J(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[(_(),y(z,null,Q(w,x=>g(f,{key:x,"model-value":t.filters.tankType.includes(x),class:"account-tanks-filters__btn",title:"Тип",onChange:H=>h(x)},{default:T(()=>[g(C,{"model-value":x},{default:T(()=>[I(" /> ")]),_:2},1032,["model-value"])]),_:2},1032,["model-value","onChange"])),64))]),o("li",{class:J(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[(_(!0),y(z,null,Q(d(s),x=>(_(),L(f,{key:x.value,"model-value":t.filters.tankTire.includes(x.value),class:"account-tanks-filters__btn",title:"Уровень "+x,onChange:H=>p(x.value)},{default:T(()=>[o("span",yi,$(x.label),1)]),_:2},1032,["model-value","title","onChange"]))),128))]),t.isPrivate?(_(),y("li",wi,[g(V,{"model-value":t.filters.tankInGarage,options:b,onChange:a},null,8,["model-value"])])):D("",!0),o("li",bi,[g(V,{"model-value":t.filters.tankIsPremium,options:A,onChange:i},null,8,["model-value"])]),o("li",$i,[g(M,{title:"Очистить фильтры",disabled:!d(R),onClick:m[0]||(m[0]=x=>e("clear"))},{default:T(()=>[g(F,{name:"clear"})]),_:1},8,["disabled"])])])])])}}}),Ri={key:0,class:"account-tank"},Ti={class:"account-tank__header"},Ci={class:"account-tank__img-wrapper"},Si={class:"account-tank__tier"},Ii={class:"account-tank__props"},Pi={class:"account-tank__prop"},Di=o("span",{class:"account-tank__prop-name"}," Нация: ",-1),Bi={class:"account-tank__prop"},Oi=o("span",{class:"account-tank__prop-name"}," Последний бой: ",-1),xi=o("h4",null,"Статистика",-1),Mi=o("h4",null,"Достижения",-1),Ui=j({__name:"AccountTank",props:{tank:{type:Object,default:()=>({}),required:!0},tankDiff:{type:Object,default:null,required:!0},achievementsInfo:{type:Object,default:()=>({}),required:!0}},setup(t){const r=["battles","winRate","damagePerBattle","surviveRate","fragPerBattle","winsInPlatoon"],u=t,v=Y({showAllMetrics:!1,filters:Yt()}),s=U(()=>{const A=ne.tank({tank:u.tank,tankDiff:u.tankDiff});return v.showAllMetrics?A:A.filter(b=>r.includes(b.key))});function w(A){v.filters=A}return(A,b)=>{var a;const R=Be,e=we,n=le,p=at,h=ot;return t.tank?(_(),y("div",Ri,[o("div",Ti,[o("div",Ci,[g(R,{class:"account-tank__img account-tank__img--nation",alt:"tank.nation",src:`/img/nations/nation-${t.tank.nation}.svg`},null,8,["src"]),g(R,{class:"account-tank__img account-tank__img--tank",alt:t.tank.name,src:(a=t.tank.images)==null?void 0:a.preview},null,8,["alt","src"]),g(e,{size:28,class:"account-tank__type","model-value":t.tank.type,"is-premium":t.tank.is_premium,"is-collectible":t.tank.is_collectible},null,8,["model-value","is-premium","is-collectible"]),o("div",Si,$(A.$formatter.encyclopedia.tier(t.tank.tier)),1)]),o("div",Ii,[o("div",Pi,[Di,I(" "+$(A.$formatter.encyclopedia.nation(t.tank.nation)),1)]),o("div",Bi,[Oi,I(" "+$(A.$formatter.date.toDateTime(t.tank.last_battle_time*1e3)),1)])])]),xi,g(n,{modelValue:d(v).showAllMetrics,"onUpdate:modelValue":b[0]||(b[0]=i=>d(v).showAllMetrics=i),class:"account-tank__show-all-metrics"},{default:T(()=>[I(" Все показатели ")]),_:1},8,["modelValue"]),g(p,{items:d(s)},null,8,["items"]),Mi,g(h,{achievements:t.tank.achievements,"achievements-info":t.achievementsInfo,filters:d(v).filters,onFiltersChanged:w},null,8,["achievements","achievements-info","filters"])])):D("",!0)}}}),Vi={key:0,class:"account-view"},Li={class:"account-view__private"},Ei={key:1,class:"account-view--no-data"},Fi={key:0,class:"content-area"},qi=o("p",null,"Нет данных.",-1),Ni=o("p",null,"Возможно аккаунт удалён.",-1),ji=[qi,Ni],Hi={style:{display:"flex","justify-content":"flex-end"}},_c=j({__name:"AccountView",setup(t){const r=K(null),u=K(null),v=nt.makeAccountFilters({tankInGarage:1,tankIsPremium:null}),s=qt(),w=la(),A=ra(),b={order:"desc",prop:"last_battle_time"},R=Y(Z(b)),e=Y({tanks:[],tanksDiff:[],tanksSessions:[],tanksSnapshot:[],tanksTableItems:[],sessionUpdateAt:0,sessionActive:!1,currentTank:null,currentTankDiff:null,loading:0,filters:Z(v),accountRaw:null,accountRawSnapshot:null,accountAchievementsRaw:null,accountAchievementsRawSnapshot:null,tanksRaw:null,tanksRawSnapshot:null,tanksAchievementsRaw:null,tanksAchievementsRawSnapshot:null}),n=U(()=>A.vehicles),p=U(()=>A.achievements),h=U(()=>{var l;return w.accountId===((l=e.accountRaw)==null?void 0:l.account_id)}),a=U(()=>Number(s.params.id)||w.accountId),i=U(()=>!e.accountAchievementsRaw||!e.accountAchievementsRawSnapshot||!p.value?null:E.accountAchievementsDiff(e.accountAchievementsRaw,e.accountAchievementsRawSnapshot,p.value)),c=U(()=>e.sessionActive?i.value:e.accountAchievementsRaw),m=U(()=>{if(!e.accountRaw)return null;const l=e.accountRaw.statistics.all,k=e.accountRaw.statistics.rating;return{...e.accountRaw,statistics:{all:E.accountAll(l),rating:k?E.accountRating(k):null}}}),S=U(()=>{if(!e.accountRaw||!e.accountRawSnapshot)return null;const l=e.accountRaw.statistics.all,k=e.accountRaw.statistics.rating,P=e.accountRawSnapshot.statistics.all,O=e.accountRawSnapshot.statistics.rating;return{...e.accountRaw,statistics:{all:E.accountAll(E.diff(l,P)),rating:k&&O?E.accountRating(E.diff(k,O)):null}}}),f=U(()=>{if(!e.accountRaw||!e.accountRawSnapshot)return null;const l=e.accountRaw.statistics.all,k=e.accountRaw.statistics.rating,P=e.accountRawSnapshot.statistics.all,O=e.accountRawSnapshot.statistics.rating,G=E.diff(E.accountAll(l),E.accountAll(P)),N=k&&O?E.diff(E.accountRating(k),E.accountRating(O)):null;return{...e.accountRaw,statistics:{all:G,rating:N}}}),C=U(()=>{var l,k,P,O;return!m.value||!S.value||!c.value?ne.account():e.sessionActive?ne.account({stat:(l=S.value)==null?void 0:l.statistics.all,achievements:i.value,tanks:e.tanksSessions,createAt:new Date(e.sessionUpdateAt).valueOf()}):ne.account({stat:(k=m.value)==null?void 0:k.statistics.all,statDiff:(P=f.value)==null?void 0:P.statistics.all,achievements:e.accountAchievementsRaw,achievementsDiff:i.value,tanks:e.tanks,tanksDiff:e.tanksDiff.filter(G=>G.all.battles),createAt:((O=m.value)==null?void 0:O.created_at)*1e3,createAtSnapshot:new Date(e.sessionUpdateAt).valueOf()})}),V=U(()=>{var l,k,P;return!m.value||!S.value?ne.accountRating():e.sessionActive?ne.accountRating({stat:(l=S.value)==null?void 0:l.statistics.rating}):ne.accountRating({stat:(k=S.value)==null?void 0:k.statistics.rating,diff:(P=f.value)==null?void 0:P.statistics.rating})}),F=U(()=>e.filters.battleMode==="random"?C.value:V.value);Le(()=>e.sessionActive,()=>{me(e.filters)}),Le(()=>e.filters,async()=>{var l;Me(e.filters),await Se(),(l=r.value)==null||l.sortItems()});const M=K(!1);De(async()=>{await be(),M.value=!0});function x(){var l;return((l=e.tanksRaw)==null?void 0:l.map(k=>{var O,G;const P=(O=e.tanksAchievementsRaw)==null?void 0:O.find(N=>N.tank_id===k.tank_id);return oe.accountTank(k,((G=n.value)==null?void 0:G[k.tank_id])??null,P??null)}))??[]}function H(){var l;return((l=e.tanksRawSnapshot)==null?void 0:l.map(k=>{var O,G;const P=(O=e.tanksAchievementsRawSnapshot)==null?void 0:O.find(N=>N.tank_id===k.tank_id);return oe.accountTank(k,((G=n.value)==null?void 0:G[k.tank_id])??null,P??null)}))??[]}function xe(l,k=!1){var ie,fe,pe;const P=((ie=e.tanksAchievementsRaw)==null?void 0:ie.find(re=>re.tank_id===l.tank_id))??null,O=((fe=e.tanksAchievementsRawSnapshot)==null?void 0:fe.find(re=>re.tank_id===l.tank_id))??null,G=P&&O?E.tankAchievementsDiff(P,O):null,N=((pe=n.value)==null?void 0:pe[l.tank_id])??null;return oe.accountTank(l,N,k?P:G)}function ut(){var l;return((l=e.tanksRaw)==null?void 0:l.reduce((k,P)=>{var N;const O=(N=e.tanksRawSnapshot)==null?void 0:N.find(ie=>ie.tank_id===P.tank_id);if(!O)return k.push(xe(P,!0)),k;if(P.all.battles===O.all.battles)return k;const G=P.battle_life_time-O.battle_life_time;return k.push(xe({...P,battle_life_time:G,all:E.diff(P.all,O.all)})),k},[]))??[]}function dt(){return e.tanks.map(l=>{const k=e.tanksSnapshot.find(O=>l.tank_id===O.tank_id);if(!k)return l;const P=l.battle_life_time-k.battle_life_time;return{...l,all:E.diff(l.all,k.all),battle_life_time:P,achievements:E.tankAchievementsDiff(l.achievements,k.achievements)}})}function _t(){e.tanks=x(),e.tanksSnapshot=H(),e.tanksSessions=ut(),e.tanksDiff=dt()}async function mt(l){e.loading++;try{const{data:k}=await se.tanks.getAchievements({account_id:l});e.tanksAchievementsRaw=k[l]??null}catch(k){q(k,{title:"Получение достижений по технике игрока"})}e.loading--}async function ft(l){e.loading++;try{const{data:k}=await se.account.getAchievements({account_id:l});e.accountAchievementsRaw=k[l]??null}catch(k){q(k,{title:"Получение достижений по аккаунту игрока"})}e.loading--}async function pt(l){e.loading++;try{const{data:k}=await se.account.getInfo({account_id:l,extra:"statistics.rating"});e.accountRaw=(k==null?void 0:k[l])??null}catch(k){q(k,{title:"Получение данных аккаунта"})}e.loading--}async function vt(l){n.value||await kt(),await ht(l)}async function ht(l){e.loading++;try{const{data:k}=await se.tanks.getStats({account_id:l});e.tanksRaw=k?k[l]:null}catch(k){q(k,{title:"Получение статистики по технике игрока"})}e.loading--}async function kt(){if(!n.value){e.loading++;try{await A.getTanksVehicles()}catch(l){q(l,{title:"Получение данных описания техники"})}e.loading--}}async function gt(){if(!p.value){e.loading++;try{await A.getAchievements()}catch(l){q(l,{title:"Получение описания достижений"})}e.loading--}}async function be(l=!1){var k;a.value&&(await Promise.all([gt(),pt(a.value),vt(a.value),mt(a.value),ft(a.value)]),l||await It(),(l||!e.accountRawSnapshot)&&await Pt(),_t(),Me(e.filters),await Se(),(k=r.value)==null||k.sortItems())}function Me(l){let k=e.sessionActive?e.tanksSessions:e.tanks;l.tankInGarage!==null&&(k=k.filter(P=>typeof P.in_garage!="boolean"?!0:P.in_garage===(l.tankInGarage===1))),l.tankNation.length&&(k=k.filter(P=>l.tankNation.includes(P.nation))),l.tankTire.length&&(k=k.filter(P=>l.tankTire.includes(P.tier))),k=k.filter(P=>{const O=l.tankIsPremium;return O===!0?P.is_premium:O===!1?!P.is_premium:!0}),l.tankType.length&&(k=k.filter(P=>l.tankType.includes(P.type))),e.tanksTableItems=k}function me(l){e.filters=Z(l)}function yt(){e.filters=Z(v)}async function wt(){if(e.accountRaw){e.loading++;try{const l=await W.indexedDB.accountsInfo.get(e.accountRaw.account_id);e.accountRawSnapshot=(l==null?void 0:l.data)??null,e.sessionUpdateAt=(l==null?void 0:l.timestamp)??0}catch(l){q(l,{title:"Загрузка локальных данных аккаунта"})}e.loading--}}async function bt(){if(e.accountRaw){e.loading++;try{await W.indexedDB.accountsInfo.set(e.accountRaw.account_id,ve(e.accountRaw)),e.accountRawSnapshot=Z(e.accountRaw),e.sessionUpdateAt=Date.now()}catch(l){q(l,{title:"Сохранение локальных данных аккаунта"})}e.loading--}}async function $t(){if(e.accountRaw){e.loading++;try{const l=await W.indexedDB.accountsAchievements.get(e.accountRaw.account_id);e.accountAchievementsRawSnapshot=(l==null?void 0:l.data)??null,e.sessionUpdateAt=(l==null?void 0:l.timestamp)??0}catch(l){q(l,{title:"Загрузка локальных данных достижений аккаунта"})}e.loading--}}async function At(){if(!(!e.accountRaw||!e.accountAchievementsRaw)){e.loading++;try{await W.indexedDB.accountsAchievements.set(e.accountRaw.account_id,ve(e.accountAchievementsRaw)),e.accountAchievementsRawSnapshot=Z(e.accountAchievementsRaw)}catch(l){q(l,{title:"Сохранение локальных данных достижений аккаунта"})}e.loading--}}async function Rt(){if(e.accountRaw){e.loading++;try{const l=await W.indexedDB.tanksStat.get(e.accountRaw.account_id);e.tanksRawSnapshot=(l==null?void 0:l.data)??null}catch(l){q(l,{title:"Загрузка локальных данных техники"})}e.loading--}}async function Tt(){if(!(!e.accountRaw||!e.tanksRaw)){e.loading++;try{await W.indexedDB.tanksStat.set(e.accountRaw.account_id,ve(e.tanksRaw)),e.tanksRawSnapshot=Z(e.tanksRaw),e.sessionUpdateAt=Date.now()}catch(l){q(l,{title:"Сохранение локальных данных техники"})}e.loading--}}async function Ct(){if(e.accountRaw){e.loading++;try{const l=await W.indexedDB.tanksAchievements.get(e.accountRaw.account_id);e.tanksAchievementsRawSnapshot=(l==null?void 0:l.data)??null}catch(l){q(l,{title:"Загрузка локальных данных достижений техники"})}e.loading--}}async function St(){if(!(!e.accountRaw||!e.tanksAchievementsRaw)){e.loading++;try{await W.indexedDB.tanksAchievements.set(e.accountRaw.account_id,ve(e.tanksAchievementsRaw)),e.tanksAchievementsRawSnapshot=Z(e.tanksAchievementsRaw),e.sessionUpdateAt=Date.now()}catch(l){q(l,{title:"Сохранение локальных данных достижений техники"})}e.loading--}}async function It(){await Promise.all([wt(),$t(),Rt(),Ct()])}async function Pt(){await Promise.all([bt(),At(),Tt(),St()])}async function Dt(){await be(!0)}function Bt(){be()}function Ot(l){var k;e.sessionActive?(e.currentTank=e.tanksSessions.find(P=>l===P.tank_id)??null,e.currentTankDiff=null):(e.currentTank=e.tanks.find(P=>l===P.tank_id)??null,e.currentTankDiff=e.tanksDiff.find(P=>l===P.tank_id)??null),(k=u.value)==null||k.doOpen()}return(l,k)=>{var Ue;const P=Ua,O=qn,G=Yn,N=Qt,ie=ss,fe=ot,pe=Ls,re=lo,xt=Ai,Mt=ct,Ut=ce,Vt=Ui,Lt=ae,Et=_e;return _(),y(z,null,[d(e).accountRaw?(_(),y("div",Vi,[g(N,{identity:"preview"},{default:T(()=>[o("div",Li,[d(e).accountRaw.private?(_(),L(P,{key:0,resources:d(e).accountRaw.private},null,8,["resources"])):D("",!0)]),g(O,{loading:d(e).loading>0,class:"account-view__preview",account:d(e).accountRaw},null,8,["loading","account"]),g(G,{modelValue:d(e).sessionActive,"onUpdate:modelValue":k[0]||(k[0]=$e=>d(e).sessionActive=$e),class:"account-view__session",loading:d(e).loading>0,"update-at":d(e).sessionUpdateAt,onReset:Dt,onUpdate:Bt},null,8,["modelValue","loading","update-at"])]),_:1}),g(N,{title:"Статистика",identity:"statistic"},{default:T(()=>[g(ie,{filters:d(e).filters,metrics:d(F),loading:d(e).loading>0,onFilters:me},null,8,["filters","metrics","loading"])]),_:1}),Ae(g(N,{title:"Достижения",identity:"achievements"},{default:T(()=>[d(c)?(_(),L(fe,{key:0,filters:d(e).filters,"achievements-info":d(p),achievements:d(c),onFiltersChanged:me},null,8,["filters","achievements-info","achievements"])):D("",!0)]),_:1},512),[[Re,d(e).filters.battleMode==="random"]]),!d(e).sessionActive&&d(e).filters.battleMode==="random"?(_(),L(N,{key:0,title:"Инфографика",identity:"tanksBattles"},{default:T(()=>[g(pe,{tanks:d(e).tanks},null,8,["tanks"])]),_:1})):D("",!0),d(e).sessionActive?D("",!0):Ae((_(),L(N,{key:1,title:"Статистика по дням",identity:"dailyStat"},{default:T(()=>[d(n)?(_(),L(re,{key:0,vehicles:d(n),"account-id":d(e).accountRaw.account_id},null,8,["vehicles","account-id"])):D("",!0)]),_:1},512)),[[Re,d(e).filters.battleMode==="random"]]),Ae(g(N,{title:"Техника",identity:"tanks"},{default:T(()=>[g(xt,{class:"account-view__filters",filters:d(e).filters,"default-filters":d(v),"is-private":d(h),onChange:me,onClear:yt},null,8,["filters","default-filters","is-private"]),g(Mt,{ref_key:"tableRef",ref:r,sort:d(R),loading:d(e).loading>0,"default-sort":b,tanks:d(e).tanksTableItems,"tanks-diff":d(e).tanksDiff,"achievements-info":d(p),"show-diff":!d(e).sessionActive,height:"calc(100vh - 112px)",onRowClick:Ot},null,8,["sort","loading","tanks","tanks-diff","achievements-info","show-diff"])]),_:1},512),[[Re,d(e).filters.battleMode==="random"]])])):(_(),y("div",Ei,[d(M)?(_(),y("div",Fi,ji)):D("",!0),g(Ut,{loading:!d(M)},null,8,["loading"])])),g(Et,{ref_key:"tankDetailsRef",ref:u,width:"1100px",title:(Ue=d(e).currentTank)==null?void 0:Ue.name,onClosed:k[2]||(k[2]=$e=>d(e).currentTank=null)},{footer:T(()=>[o("div",Hi,[g(Lt,{onClick:k[1]||(k[1]=$e=>{var Ve;return(Ve=d(u))==null?void 0:Ve.doClose()})},{default:T(()=>[I(" Закрыть ")]),_:1})])]),default:T(()=>[d(p)&&d(e).currentTank?(_(),L(Vt,{key:0,tank:d(e).currentTank,"tank-diff":d(e).currentTankDiff,"achievements-info":d(p)},null,8,["tank","tank-diff","achievements-info"])):D("",!0)]),_:1},8,["title"])],64)}}});export{_c as _};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./light-tank.BRjIc5Z1.js","./nuxt-icon.j5VLktT_.js","./_plugin-vue_export-helper.DlAUqK2U.js","./entry.BCxoBdpj.js","./nuxt-icon.MfBulapQ.css","./medium-tank.2BeJ-qVA.js","./heavy-tank.CIxTF5tA.js","./at-spg.DqJ5xv0L.js","./3.CG7JxfyD.js","./2.DP2TmEex.js","./1.CjXkvHzW.js","./М.CjHf4_hs.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
