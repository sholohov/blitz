import{_ as V}from"./DC0lf8Zi.js";import{d as k,m as S,r as b,e as E,u as $,b3 as F,b4 as O,o as d,f as x,w as u,g as v,n as y,j as r,p as i,v as m,x as C,h as D,aI as j,ar as H,t as P,_ as U,y as w,M as z,a7 as A,F as G,D as L,I as q,a as J,k as K,C as Q,an as W}from"./BzQ49_ll.js";import{_ as X}from"./D18XexEg.js";import{_ as N}from"./Dzhj1Yli.js";import{_ as Y}from"./CXg2uAHC.js";import{_ as Z}from"./DoRwVKzs.js";import{u as ee}from"./BLT2yTlJ.js";import{u as te}from"./Dz0q-Wbl.js";import"./DD4asW33.js";import"./B3dZcLnw.js";import"./W1n9aEx_.js";import"./BxBPJGBn.js";import"./B6X_EJD7.js";const ne={key:0,class:"update-message"},oe={class:"update-message__title"},se={class:"update-message__control"},ae=k({__name:"UpdateMessage",setup(B){S(()=>{f()});const _=b(!1),c=b(null),s=H(),p=E(()=>{const e=s.public.clientVersion;return!c.value||!e||_.value?!1:c.value!==e});function f(){const{$firebase:e}=$(),l=e.db();F(O(l,"app","info"),o=>{const t=o.data();c.value=(t==null?void 0:t.version)??null},o=>{P(o,{title:"Получение данных версии из Firebase"})})}function n(){location.reload()}function a(){_.value=!0}return(e,l)=>{const o=U,t=w,g=X;return d(),x(j,{name:"update-message-"},{default:u(()=>[v(p)?(d(),y("div",ne,[r(g,{class:"update-message__inner"},{default:u(()=>[i("div",oe,[r(o,{class:"update-message__icon",name:"new-releases"}),m(" Обновление v"+C(v(c)),1)]),l[2]||(l[2]=i("div",{class:"update-message__body"}," Что бы изменения вступили в силу, необходимо обновить страницу. ",-1)),i("div",se,[r(t,{class:"update-message__btn",onClick:n},{default:u(()=>l[0]||(l[0]=[m(" Обновить ")])),_:1}),r(t,{class:"update-message__btn",onClick:a},{default:u(()=>l[1]||(l[1]=[m(" Скрыть ")])),_:1})])]),_:1})])):D("",!0)]),_:1})}}}),ie={class:"update-db-dialog__header"},le={style:{display:"flex","justify-content":"flex-end"}},re=k({__name:"UpdateDBDialog",emits:["confirm"],setup(B,{expose:_,emit:c}){const s=b(null),p=c;function f(){var a;(a=s.value)==null||a.doClose(),p("confirm")}function n(){var a;(a=s.value)==null||a.doOpen()}return _({open:n}),(a,e)=>{const l=U,o=w,t=N;return d(),x(t,{ref_key:"dialogRef",ref:s,class:"update-db-dialog","modal-enabled":"",width:"480px"},{title:u(()=>[i("div",ie,[r(l,{class:"update-db-dialog__icon",name:"database-alert"}),e[0]||(e[0]=i("b",null,"База данных обновлена",-1))])]),footer:u(()=>[i("div",le,[r(o,{onClick:f},{default:u(()=>e[1]||(e[1]=[m(" Так точно ")])),_:1})])]),default:u(()=>[e[2]||(e[2]=m(" Для продолжения использования необходимо: ")),e[3]||(e[3]=i("br",null,null,-1)),e[4]||(e[4]=m(" 1. Закрыть все вкладки ресурса, кроме активной.")),e[5]||(e[5]=i("br",null,null,-1)),e[6]||(e[6]=m(" 2. Обновить текущую страницу.")),e[7]||(e[7]=i("br",null,null,-1)),e[8]||(e[8]=m(" 3. Готово.")),e[9]||(e[9]=i("br",null,null,-1))]),_:1},512)}}}),ue={class:"ui-notification"},ce={key:0,class:"ui-notification__item-title"},_e={class:"ui-notification__item-body"},de=["onClick"],pe=k({__name:"UiNotification",props:{appendToBody:{type:Boolean,default:!1}},setup(B){const _=z(),c=s=>{if(s.title)return s.title;switch(s.type){case"success":return"Успешно";case"error":return"Ошибка";case"info":return"Информация";case"warning":return"Внимание";default:return s.title}};return(s,p)=>{const f=Z;return d(),x(f,null,{default:u(()=>[i("div",ue,[r(A,{tag:"ul",class:"ui-notification__list",name:"ui-notification__item-"},{default:u(()=>[(d(!0),y(G,null,L(v(_).items,n=>(d(),y("li",{key:n.id,class:q(["ui-notification__item",[n.type?"ui-notification__item--"+n.type:""]])},[n.title||n.type?(d(),y("div",ce,C(c(n)),1)):D("",!0),i("div",_e,C(n.message),1),i("button",{class:"ui-notification__item-close",onClick:a=>v(_).remove(n)},null,8,de)],2))),128))]),_:1})])]),_:1})}}}),fe={class:"layout"},Ne=k({__name:"default",async setup(B){const{$storage:_}=$(),c=J(),s=K(),p=ee(),f=te(),n=_.user.get();n&&s.setUser({accountId:Number(n.account_id),name:n.nickname}),S(()=>{l(),f.init()});const a=b(null),e=b(null);Q(()=>c.fullPath,(o,t)=>{o!==t&&p.toggleMainSearch(!1)}),W(()=>{var o,t;p.mainSearchOpened?(o=a.value)==null||o.doOpen():(t=a.value)==null||t.doClose()});async function l(){const{$indexedDB:o}=$(),t=await o.getInstance();t.onBlocked=()=>{var g;return(g=e.value)==null?void 0:g.open()}}return(o,t)=>{const g=V,h=ae,M=re,R=Y,I=N,T=pe;return d(),y("div",fe,[r(g),r(h),r(M,{ref_key:"updateDBRef",ref:e},null,512),v(f).isTablet?(d(),x(I,{key:0,ref_key:"searchDialogRef",ref:a,title:"Поиск аккаунтов и кланов",width:"480px",position:"top",onClose:t[0]||(t[0]=me=>v(p).toggleMainSearch(!1))},{default:u(()=>[r(R,{style:{height:"270px"}})]),_:1},512)):D("",!0),r(T)])}}});export{Ne as default};
