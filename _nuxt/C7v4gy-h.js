const __vite__fileDeps=["./CXqewjHg.js","./CNezpHW2.js","./DlAUqK2U.js","./ByGHtsLc.js","./nuxt-icon.MfBulapQ.css","./Babr0IR-.js","./BWBczNIj.js","./CuvN3EmH.js","./BCkDcMF8.js","./XHaGIQcJ.js","./Cgg-sWyJ.js","./BOL-cYqq.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{N as xt}from"./CNezpHW2.js";import{K as Mt,o as d,c as v,a as n,f as N,i as F,s as L,b as p,C as Q,k as u,t as k,m as P,r as K,n as Y,j as q,w as S,d as I,F as G,A as J,q as Rt,v as jt,x as Ut,y as oe,T as ie,D as Lt,E as nt,_ as st,L as Et,M as tt,N as We,G as ut,P as Xe,B as Ht,z as Ot,Q as Bt,g as Qe,R as It,S as Ct,H as wt}from"./ByGHtsLc.js";import{_ as Je,m as lt}from"./BXDQEYei.js";import{_ as le}from"./BkXTMpOT.js";import{_ as ct,h as j,u as Ye,d as zt}from"./DtA1LByL.js";import{_ as et}from"./DGLDZ4cR.js";import{_ as dt,a as it,s as Z}from"./DRW9HJMp.js";import{_ as pt,a as Ze,i as ta,g as ea}from"./BQPDEBlD.js";import{a as ft}from"./wDhpCTVo.js";import{c as aa}from"./ZnSD-95i.js";import{a as _t,_ as ce}from"./1BDPnRas.js";import{u as qt}from"./CMJjbvSz.js";import{_ as na}from"./Cx7WkZlA.js";import{_ as re,m as ot}from"./BHFcUKq4.js";import{_ as ht}from"./BnTBaoKk.js";import{f as ue,m as sa}from"./zbK8vi2L.js";import{_ as vt}from"./ITqKCdnK.js";import{_ as de,i as oa}from"./BOztkASC.js";import{_ as ia}from"./D-G4pc_H.js";import{s as V}from"./CaFUdm79.js";import{_ as la,a as ca,b as ra,d as ua,e as da,i as _a,f as ma,g as fa,c as at}from"./BKkOXuMF.js";import{e as pa}from"./ecoX--FC.js";import{u as ha}from"./DFAQjZIE.js";import{u as va}from"./DyNKK-9z.js";const ya={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"},ka=n("path",{fill:"currentColor","fill-rule":"evenodd",d:"M28.5 43c8.56 0 15.5-3.134 15.5-7v6c0 3.866-6.94 7-15.5 7S13 45.866 13 42v-6c0 3.866 6.94 7 15.5 7","clip-rule":"evenodd"},null,-1),ga=n("path",{fill:"currentColor","fill-rule":"evenodd",d:"M34.5 36c8.56 0 15.5-3.134 15.5-7v6c0 3.866-6.94 7-15.5 7S19 38.866 19 35v-6c0 3.866 6.94 7 15.5 7","clip-rule":"evenodd"},null,-1),ba=n("path",{fill:"currentColor","fill-rule":"evenodd",d:"M44 19c0 3.866-6.94 7-15.5 7S13 22.866 13 19v6c0 3.866 6.94 7 15.5 7S44 28.866 44 25zm-1 0c0 1.296-1.21 2.8-3.951 4.038C36.4 24.234 32.672 25 28.5 25s-7.9-.766-10.549-1.962C15.211 21.801 14 20.296 14 19s1.21-2.8 3.951-4.038C20.6 13.766 24.328 13 28.5 13s7.9.766 10.549 1.962C41.789 16.199 43 17.704 43 19","clip-rule":"evenodd"},null,-1),wa=[ka,ga,ba];function $a(e,r){return d(),v("svg",ya,[...wa])}const Gt={render(){return Mt(xt,{icon:{render:$a},name:"gold"})}},Aa={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"},Ra=n("path",{stroke:"currentColor","stroke-width":"4",d:"m31 13.472 3.486 10.73.45 1.382H47.67l-9.127 6.63-1.176.855.45 1.382 3.486 10.73-9.127-6.632L31 37.695l-1.176.854-9.127 6.631 3.487-10.73.449-1.381-1.176-.854-9.127-6.631h12.735l.449-1.382z"},null,-1),Sa=[Ra];function Ta(e,r){return d(),v("svg",Aa,[...Sa])}const Ia={render(){return Mt(xt,{icon:{render:Ta},name:"xp"})}},Ca={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"},Da=n("path",{fill:"currentColor","fill-rule":"evenodd",d:"M49.306 27.104 44.133 9l9.483 11.574zm-14.426 25L56 23.654v13.793l-14.655 7.759h12.069l-7.759 5.172zm-21.552-25L18.5 9 9.017 20.574zm13.793 25L6 23.656v13.793l14.655 7.758H8.586l7.759 5.173zM21 20l10-4 10 4v16l-10 8-10-8zm6 12.5L29 22l5.5-1-2 7 4-.5-7 11 2-8z","clip-rule":"evenodd"},null,-1),Pa=[Da];function Oa(e,r){return d(),v("svg",Ca,[...Pa])}const Ba={render(){return Mt(xt,{icon:{render:Oa},name:"prem"})}},xa={class:"account-resources"},Ma={class:"account-resources__inner"},Ua={key:0,class:"account-resources__item"},La={class:"account-resources__text"},Ea={class:"account-resources__item"},qa={class:"account-resources__text"},Fa={class:"account-resources__item"},Na={class:"account-resources__text"},Va={class:"account-resources__item"},ja={class:"account-resources__text"},Ha=N({__name:"AccountResources",props:{resources:{type:Object,required:!0,default:()=>({})}},setup(e){const r=e,c=F(()=>{const m=r.resources.premium_expires_at*1e3;return m-Date.now()<=0?"":L.date.toTimePassed(m,Date.now(),!0)});return(m,s)=>(d(),v("div",xa,[n("div",Ma,[e.resources.is_premium.toLocaleString()?(d(),v("div",Ua,[p(u(Ba),{filled:!0,"font-controlled":!1,class:Q(["account-resources__icon",[{"account-resources__icon--prem":u(c)}]])},null,8,["class"]),n("div",La,k(u(c)||"0 дн."),1)])):P("",!0),n("div",Ea,[p(u(Gt),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--gold"}),n("div",qa,k(e.resources.gold.toLocaleString()),1)]),n("div",Fa,[p(u(Gt),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--credits"}),n("div",Na,k(e.resources.credits.toLocaleString()),1)]),n("div",Va,[p(u(Ia),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--xp"}),n("div",ja,k(e.resources.free_xp.toLocaleString()),1)])])]))}}),za={class:"account-preview-details__body"},Ga={class:"account-preview-details__section"},Ka={class:"account-preview-details__props-title"},Wa={class:"account-preview-details__props"},Xa={class:"account-preview-details__prop"},Qa=n("span",{class:"account-preview-details__prop-title"}," Дата создания ",-1),Ja={class:"account-preview-details__prop"},Ya=n("span",{class:"account-preview-details__prop-title"}," Дата обновления ",-1),Za={key:0,class:"account-preview-details__section"},tn={class:"account-preview-details__props-title"},en={class:"account-preview-details__props"},an={class:"account-preview-details__prop"},nn=n("span",{class:"account-preview-details__prop-title"}," Зарегистрирован ",-1),sn={class:"account-preview-details__prop"},on=n("span",{class:"account-preview-details__prop-title"}," Последний визит ",-1),ln={class:"account-preview-details__section"},cn={class:"account-preview-details__props-title"},rn={key:0,class:"account-preview-details__props"},un={class:"account-preview-details__prop"},dn=n("span",{class:"account-preview-details__prop-title"}," Командир ",-1),_n={class:"account-preview-details__prop"},mn=n("span",{class:"account-preview-details__prop-title"}," Участников ",-1),fn={class:"account-preview-details__prop"},pn=n("span",{class:"account-preview-details__prop-title"}," Создан ",-1),hn={class:"account-preview-details__prop"},vn=n("span",{class:"account-preview-details__prop-title"}," Роль ",-1),yn={class:"account-preview-details__prop"},kn=n("span",{class:"account-preview-details__prop-title"}," Вступил ",-1),gn={key:1,class:"account-preview-details__props"},bn=n("div",{class:"account-preview-details__prop"}," Не состоит в клане ",-1),wn=[bn],$n={key:1,class:"account-preview-details__section"},An={class:"account-preview-details__props-title"},Rn={class:"account-preview-details__props"},Sn={class:"account-preview-details__prop"},Tn=n("span",{class:"account-preview-details__prop-title"}," Отражаются только те дни в которые произошла смена клана или должности. Данные собираются со дня регистрации на сайте. ",-1),In={key:0,class:"account-preview-details__clan-history"},Cn={class:"account-preview-details__clan-history-date"},Dn={key:1,class:"account-preview-details__clan-history-link"},Pn={style:{display:"flex","justify-content":"space-between"}},On=n("span",null,null,-1),Bn=N({__name:"AccountPreviewDetails",props:{account:{type:[Object,null],required:!0},clanAccount:{type:[Object,null],required:!0}},setup(e,{expose:r}){const c=e,m=K(null),s=Y({user:null,clan:null,clanHistory:[],loading:0,isOpened:!1});async function i(a){s.loading++;try{const{data:l}=await it.clan.getInfo({clan_id:a});s.clan=l?l[a]:null}catch(l){j(l,{title:"Получение данных клана"})}s.loading--}async function g(a){s.loading++;try{const{data:l}=await ft.user.get(a);s.user=l}catch(l){if(ft.isResponse(l)&&l.status===404)return;j(l,{title:"Получение данных пользователя"})}finally{s.loading--}}async function b(a){s.loading++;try{const{data:l}=await it.clan.getInfo({clan_id:a.join(","),fields:"clan_id,name,tag"});return l??null}catch(l){return j(l,{title:"Получение данных кланов"}),null}finally{s.loading--}}function h(a,l){s.clanHistory=a.map((f,w,A)=>{const{raw:T,timestamp:y}=f,D=T&&l?l[T.clan_id]:null,x=`[${(D==null?void 0:D.tag)??"Deleted"}]`,M=A.length-1===w,B=a[w-1],U=L.date.toDaysPassed(y,B==null?void 0:B.timestamp);return{key:y,date:`${L.date.toDate(y)} (${M?" ... ":U})`,info:T?`${x} ${L.clan.role(T.role)}`:"Не в клане",clanId:(T==null?void 0:T.clan_id)??null}})}async function t(a){s.loading++;try{const{data:l}=await ft.stat.clansAccounts.getActivityList({id:a});return l??[]}catch(l){return j(l,{title:"Получение данных пользователя"}),[]}finally{s.loading--}}async function R(){var l;if(s.isOpened||!c.account||(s.isOpened=!0,(l=c.clanAccount)!=null&&l.clan_id&&await i(c.clanAccount.clan_id),await g(c.account.account_id),!s.user))return;const a=await t(c.account.account_id);if(a.length){const f=a.filter(({raw:A})=>A==null?void 0:A.clan_id).map(({raw:A})=>A==null?void 0:A.clan_id),w=await b(f);h(a,w)}}function C(){var a;(a=m.value)==null||a.doClose()}async function o(){var a;await R(),await((a=m.value)==null?void 0:a.doOpen())}return r({close:C,open:o}),(a,l)=>{const f=ct,w=le,A=dt,T=et,y=pt;return e.account?(d(),q(y,{key:0,ref_key:"detailedDialogRef",ref:m,class:"account-preview-details",title:"Дополнительная информация",width:"600px"},{footer:S(()=>[n("div",Pn,[On,p(T,{onClick:C},{default:S(()=>[I(" Закрыть ")]),_:1})])]),default:S(()=>{var D,x,M,B;return[n("div",za,[n("div",Ga,[n("h5",Ka,[p(f,{class:"account-preview-details__prop-title-icon",name:"sports-esports"}),I(" Аккаунт игрока ")]),n("div",Wa,[n("div",Xa,[Qa,I(" "+k(a.$formatter.date.toDate(e.account.created_at*1e3)),1)]),n("div",Ja,[Ya,I(" "+k(a.$formatter.date.toDate(e.account.updated_at*1e3)),1)])])]),u(s).user?(d(),v("div",Za,[n("h5",tn,[p(f,{class:"account-preview-details__prop-title-icon",name:"person"}),I(" Пользователь ресурса ")]),n("div",en,[n("div",an,[nn,I(" "+k(a.$formatter.date.toDate(((D=u(s).user)==null?void 0:D.createAt)??0)),1)]),n("div",sn,[on,I(" "+k(a.$formatter.date.toDate(((x=u(s).user)==null?void 0:x.visitedAt)??0)),1)])])])):P("",!0),n("div",ln,[n("h5",cn,[p(f,{class:"account-preview-details__prop-title-icon",name:"groups"}),I(" Клан игрока ")]),u(s).clan&&e.clanAccount?(d(),v("div",rn,[n("div",un,[dn,u(s).clan.leader_id?(d(),q(w,{key:0,class:"account-preview-details__clan-history-link link",to:{name:"account-id",params:{id:u(s).clan.leader_id}}},{default:S(()=>{var U;return[I(k((U=u(s).clan)==null?void 0:U.leader_name),1)]}),_:1},8,["to"])):P("",!0)]),n("div",_n,[mn,I(" "+k(a.$formatter.number.toInteger((M=u(s).clan)==null?void 0:M.members_count)),1)]),n("div",fn,[pn,I(" "+k(a.$formatter.date.toDate(((B=u(s).clan)==null?void 0:B.created_at)*1e3)),1)]),n("div",hn,[vn,I(" "+k(a.$formatter.clan.role(e.clanAccount.role)),1)]),n("div",yn,[kn,I(" "+k(a.$formatter.date.toDate(e.clanAccount.joined_at*1e3))+" ("+k(a.$formatter.date.toDaysPassed(e.clanAccount.joined_at*1e3))+") ",1)])])):(d(),v("div",gn,wn))]),u(s).user?(d(),v("div",$n,[n("h5",An,[p(f,{class:"account-preview-details__prop-title-icon",name:"history"}),I(" Клановая история ")]),n("div",Rn,[n("div",Sn,[Tn,u(s).clanHistory.length?(d(),v("div",In,[(d(!0),v(G,null,J(u(s).clanHistory,U=>(d(),v("div",{key:U.key,class:"account-preview-details__clan-history-item"},[n("span",Cn,k(U.date),1),U.clanId?(d(),q(w,{key:0,class:"account-preview-details__clan-history-link link",to:{name:"clan-id",params:{id:U.clanId}}},{default:S(()=>[I(k(U.info),1)]),_:2},1032,["to"])):(d(),v("span",Dn,k(U.info),1))]))),128))])):(d(),v(G,{key:1},[I(" Данные собираются. ")],64))])])])):P("",!0)]),p(A,{"backdrop-light":"",loading:u(s).loading>0},null,8,["loading"])]}),_:1},512)):P("",!0)}}}),xn={class:"account-preview"},Mn={key:0,class:"account-preview__inner"},Un={class:"account-preview__league"},Ln={class:"account-preview__info"},En={class:"account-preview__nickname"},qn={class:"account-preview__nickname-text"},Fn={class:"account-preview__clan-text"},Nn={class:"account-preview__props"},Vn={class:"account-preview__prop"},jn=n("span",{class:"account-preview__prop-title"}," Последний бой ",-1),Hn={class:"account-preview__prop-value"},zn={key:0,class:"account-preview__prop"},Gn=n("span",{class:"account-preview__prop-title"}," Должность ",-1),Kn={class:"account-preview__prop-value"},Wn={class:"account-preview__actions"},Xn=N({__name:"AccountPreview",props:{account:{type:[Object,null],default:null,required:!0},loading:{type:Boolean,default:!1}},setup(e){const r=K(null),c=e,m=Ye(),s=Y({clanAccount:null,isFavorite:!0,clan:null,detailsLoading:!1}),i=F(()=>{var o;return(o=s.clanAccount)==null?void 0:o.clan});Rt(()=>{var a,l;h(),((a=c.account)==null?void 0:a.account_id)&&g((l=c.account)==null?void 0:l.account_id)});async function g(o){try{const{data:a}=await it.clan.getAccountInfo({account_id:o,extra:"clan"});s.clanAccount=a?a[o]:null}catch(a){j(a,{title:"Получение данных клана"})}}async function b(){var o;s.detailsLoading=!0,await((o=r.value)==null?void 0:o.open()),s.detailsLoading=!1}async function h(){if(!c.account)return;const o=await Z.indexedDB.accountsFavorites.get(c.account.account_id);s.isFavorite=o?o==null?void 0:o.isFavorite:!1}async function t(){c.account&&(s.isFavorite=!s.isFavorite,await Z.indexedDB.accountsFavorites.set(c.account.account_id,{id:c.account.account_id,isFavorite:s.isFavorite}))}function R(){t()}async function C(){var a,l,f,w;await aa(`${(a=c.account)==null?void 0:a.nickname}/${(l=c.account)==null?void 0:l.account_id}`)?m.add({type:"success",title:"Скопировано",message:`${(f=c.account)==null?void 0:f.nickname}/${(w=c.account)==null?void 0:w.account_id}`,duration:3e3}):m.add({type:"error",message:"При копировании что-то пошло не так",duration:3e3})}return(o,a)=>{var D;const l=Je,f=le,w=ct,A=et,T=dt,y=Bn;return d(),v("div",xn,[e.account?(d(),v("div",Mn,[n("div",Un,[p(l,{large:"",rating:e.account.statistics.rating},null,8,["rating"])]),n("div",Ln,[n("div",En,[n("span",qn,k(e.account.nickname),1)]),u(s).clanAccount&&u(i)?(d(),q(f,{key:0,class:"account-preview__clan link",title:"Перейти к клану",to:{name:"clan-id",params:{id:u(i).clan_id}}},{default:S(()=>[n("span",Fn," ["+k(u(i).tag)+"] "+k(u(i).name),1)]),_:1},8,["to"])):P("",!0),n("div",Nn,[n("div",Vn,[jn,n("span",Hn,k(o.$formatter.date.toRelativeTime(e.account.last_battle_time*1e3)),1)]),u(s).clanAccount?(d(),v("div",zn,[Gn,n("span",Kn,k(o.$formatter.clan.role((D=u(s).clanAccount)==null?void 0:D.role)),1)])):P("",!0)])]),n("div",Wn,[p(A,{"is-text":"",class:"account-preview__actions-btn",title:"Копировать (nickname/ID)",onClick:C},{default:S(()=>[p(w,{name:"content-copy"})]),_:1}),p(A,{"is-text":"",class:"account-preview__actions-btn",title:"Добавить в избранные",onClick:R},{default:S(()=>[u(s).isFavorite?(d(),q(w,{key:0,name:"star"})):(d(),q(w,{key:1,name:"star-border"}))]),_:1}),p(A,{"is-text":"",disabled:u(s).detailsLoading,class:"account-preview__actions-btn",title:"Дополнительная информация",onClick:b},{default:S(()=>[p(w,{name:"info"})]),_:1},8,["disabled"])])])):P("",!0),p(T,{loading:e.loading},null,8,["loading"]),p(y,{ref_key:"accountPreviewDetailsRef",ref:r,account:e.account,"clan-account":u(s).clanAccount},null,8,["account","clan-account"])])}}}),Qn=window.setInterval,Jn={class:"session-panel"},Yn={class:"session-panel__inner"},Zn={class:"session-panel__item"},ts={class:"session-panel__buttons"},es={key:0,class:"session-panel__item session-panel__item--time"},as={class:"session-panel__time"},ns=n("span",{class:"session-panel__time-title"}," Время начала ",-1),ss=n("div",{style:{margin:"0 0 1em"}}," Вы уверены, что хотите сбросить сессию? ",-1),os={style:{"text-align":"right"}},Kt=60,is=N({__name:"SessionPanel",props:jt({updateAt:{type:Number,required:!0,default:0},hideAutoUpdate:{type:Boolean,default:!1},loading:{type:Boolean,required:!0,default:!1}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:jt(["reset","update","session-active"],["update:modelValue"]),setup(e,{emit:r}){const c=Ut(e,"modelValue"),m=e,s=qt(),i=K(null),g=Y({autoUpdateChecked:!1,autoUpdateInterval:Kt,autoUpdateCounter:Kt,autoUpdateTimer:0}),b=F(()=>{const o=L.date.toDateTime(m.updateAt),a=L.date.toDaysPassed(m.updateAt,Date.now(),!0);return`${o} (${a})`});oe(()=>{clearInterval(g.autoUpdateTimer)});const h=r;function t(){var o;(o=i.value)==null||o.doOpen()}function R(o){var a;o&&h("reset"),(a=i.value)==null||a.doClose()}function C(){if(g.autoUpdateChecked=!g.autoUpdateChecked,g.autoUpdateCounter=g.autoUpdateInterval,!g.autoUpdateChecked){clearInterval(g.autoUpdateTimer);return}const o=()=>{if(clearInterval(g.autoUpdateTimer),g.autoUpdateTimer=Qn(o,1e3),g.autoUpdateCounter>0){g.autoUpdateCounter--;return}g.autoUpdateCounter=g.autoUpdateInterval,h("update")};h("update"),o()}return(o,a)=>{const l=_t,f=ct,w=et,A=dt,T=pt;return d(),v("div",Jn,[n("div",Yn,[n("div",Zn,[n("div",ts,[p(l,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=y=>c.value=y),class:"session-panel__btn",title:"Просмотр статистики за сессию"},{default:S(()=>[I(" Сессия ")]),_:1},8,["modelValue"]),e.hideAutoUpdate===!1?(d(),q(w,{key:0,class:"session-panel__btn",title:"Автоматическое обновление данных",onClick:C},{before:S(()=>[p(f,{name:"refresh-auto"})]),default:S(()=>[u(s).isTablet?P("",!0):(d(),v(G,{key:0},[I(" Обновление ")],64)),I(" "+k(u(g).autoUpdateCounter)+" сек. ",1)]),_:1})):P("",!0),p(w,{class:"session-panel__btn",title:"Сброс данных сессии",onClick:t},{default:S(()=>[p(f,{name:"close"})]),_:1})])]),u(b)?(d(),v("div",es,[n("span",as,[ns,I(" "+k(u(b)),1)])])):P("",!0)]),p(A,{loading:e.loading},null,8,["loading"]),p(T,{ref_key:"confirmDialogRef",ref:i,title:"Сброс сессии"},{default:S(()=>[ss,n("div",os,[p(w,{align:"center",width:"80px",onClick:a[1]||(a[1]=y=>R(!0))},{default:S(()=>[I(" Да ")]),_:1}),p(w,{align:"center",width:"80px",onClick:a[2]||(a[2]=y=>R(!1))},{default:S(()=>[I(" Нет ")]),_:1})])]),_:1},512)])}}}),ls={class:"accounts-metrics"},cs={class:"accounts-metrics__filters"},rs={class:"accounts-metrics__filters-item"},us={class:"accounts-metrics__filters-item"},ds={class:"accounts-metrics__plates"},_s=N({__name:"AccountsMetrics",props:{metrics:{type:Array,required:!0,default:()=>[]},filters:{type:Object,required:!0,default:()=>({})},loading:{type:Boolean,default:!1}},emits:["filters","is-open"],setup(e,{emit:r}){const c=["battles","winRate","damagePerBattle","winsInPlatoon","battlesPerDay","tanksWithMaster"],m=e,s=Y({isOpen:!1}),i=F(()=>s.isOpen?m.metrics:m.metrics.filter(h=>c.includes(h.key))),g=r;function b(){const h=m.filters.battleMode==="random"?"rating":"random";g("filters",{...m.filters,battleMode:h})}return(h,t)=>{const R=_t,C=re;return d(),v("div",ls,[n("div",cs,[n("div",rs,[p(R,{"model-value":e.filters.battleMode==="rating",onChange:b},{default:S(()=>[I(" Рейтинг ")]),_:1},8,["model-value"])]),n("div",us,[p(R,{modelValue:u(s).isOpen,"onUpdate:modelValue":t[0]||(t[0]=o=>u(s).isOpen=o)},{default:S(()=>[I(" Все показатели ")]),_:1},8,["modelValue"])])]),n("div",ds,[p(C,{loading:e.loading,items:u(i)},null,8,["loading","items"])])])}}}),ms=["onClick"],fs={class:"achievements-list__item-inner"},ps={class:"achievements-list__item-img-wrapper"},hs={key:0,class:"achievements-list__item-count"},vs={key:0,class:"achievements-list__item-series"},ys={key:1,class:"achievements-list__item-details"},ks=N({__name:"AchievementsList",props:{achievements:{type:Array,default:()=>[]},hideName:{type:Boolean,default:!1}},emits:["medal-click"],setup(e,{emit:r}){const c=r;function m(s){c("medal-click",s)}return(s,i)=>{const g=ht;return d(),v("div",{class:Q(["achievements-list",[e.hideName?"achievements-list--small":""]])},[e.achievements.length?(d(),q(ie,{key:0,tag:"ul",class:"achievements-list__list",name:"achievements-list__item-"},{default:S(()=>[(d(!0),v(G,null,J(e.achievements,b=>(d(),v("li",{key:b.key,class:Q(["achievements-list__item",[!b.count&&!b.series?"achievements-list__item--no-count":""]])},[n("button",{class:"achievements-list__item-btn",onClick:h=>m(b)},[n("span",fs,[n("span",ps,[p(g,{class:"achievements-list__item-img",src:b.image,alt:b.key,"data-name":b.name},null,8,["src","alt","data-name"])]),b.count||b.series?(d(),v("span",hs,[I(k(b.count)+" ",1),b.series?(d(),v("span",vs," / "+k(b.series),1)):P("",!0)])):P("",!0),e.hideName?P("",!0):(d(),v("span",ys,k(b.name),1))])],8,ms)],2))),128))]),_:1})):P("",!0)],2)}}}),gs={key:0,class:"achievements-block__details"},bs={class:"achievements-block__details-header"},ws={class:"achievements-block__details-name"},$s={class:"achievements-block__details-body"},As=["textContent"],Rs=["textContent"],Ss={class:"achievements-block__details-footer"},Ts=N({__name:"AchievementsDetails",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e,{expose:r}){const c=Ut(e,"modelValue"),m=K(null),s=K(!1);function i(){s.value=!1}function g(){var b;(b=m.value)==null||b.doOpen()}return r({open:g}),(b,h)=>{const t=ht,R=et,C=pt;return d(),q(C,{ref_key:"detailsRef",ref:m,width:"640px",onOpen:i},{footer:S(()=>[n("div",Ss,[p(R,{onClick:h[0]||(h[0]=o=>{var a;return(a=u(m))==null?void 0:a.doClose()})},{default:S(()=>[I(" Закрыть ")]),_:1})])]),default:S(()=>{var o;return[c.value?(d(),v("div",gs,[n("div",bs,[p(t,{class:"achievements-block__details-img",src:c.value.image,alt:c.value.key},null,8,["src","alt"]),n("span",ws,k((o=c.value)==null?void 0:o.name),1),n("div",$s,[c.value.description?(d(),v("div",{key:0,textContent:k(c.value.description)},null,8,As)):P("",!0),c.value.condition?(d(),v("div",{key:1,textContent:k(c.value.condition)},null,8,Rs)):P("",!0)])])])):P("",!0)]}),_:1},512)}}}),Is={key:0,class:"achievements-block__inner"},Cs={class:"achievements-block__filter"},Ds={class:"achievements-block__filter-item"},Ps={class:"achievements-block__filter-item"},Os={class:"achievements-block__filter-item"},Bs={class:"achievements-block__section-title"},xs={key:1,class:"achievements-block__empty"},Ms={key:1,class:"achievements-block__empty"},_e=N({__name:"AchievementsBlock",props:{achievements:{type:Object,required:!0,default:()=>({})},achievementsInfo:{type:Object,required:!0,default:()=>({})},filters:{type:Object,required:!0,default:()=>ue.makeAccountFilters()}},emits:["filters-changed"],setup(e,{emit:r}){const c=["markOfMastery","markOfMasteryI","markOfMasteryII","markOfMasteryIII","heroesOfRassenay","medalLafayettePool","medalRadleyWalters","warrior","medalKolobanov","mainGun","sniper","camper","medalBrothersInArms","medalCrucialContribution"],m=["battle","epic","title","commemorative","step","platoon"],s=e,i=K(),g=K(),b=Y({currentMedal:null,showAll:!1}),h=F(()=>{const l=Object.keys(s.achievements.achievements),f=Object.keys(s.achievements.achievements);return l.length||f.length}),t=F(()=>{if(s.filters.achievementsShow==="important"){const f=[];return Object.keys(s.achievements.achievements).forEach(w=>{const A=lt.achievementsMedal({key:w,achievements:s.achievements,encyclopedia:s.achievementsInfo});f.push(A)}),c.reduce((w,A)=>{const T=f.find(y=>y.key===A);return T?[...w,T]:w},[])}const l=Object.keys(s.achievementsInfo);return s.filters.achievementsShow==="deserved"?l.map(f=>lt.achievementsMedal({key:f,achievements:s.achievements,encyclopedia:s.achievementsInfo})).filter(f=>s.achievements.achievements[f.key]||s.achievements.max_series[f.key]).sort((f,w)=>f.key.localeCompare(w.key)):l.map(f=>lt.achievementsMedal({key:f,achievements:s.achievements,encyclopedia:s.achievementsInfo})).toSorted((f,w)=>f.key.localeCompare(w.key))}),R=F(()=>{const l={};return t.value.forEach(f=>{l[f.section]||(l[f.section]={name:f.section,items:[]}),l[f.section].items.push(f)}),Object.values(l).sort((f,w)=>m.indexOf(f.name)-m.indexOf(w.name))}),C=r;function o({key:l}){var f;b.currentMedal=t.value.find(w=>w.key===l)??null,(f=g.value)==null||f.open()}function a(l){C("filters-changed",{...s.filters,achievementsShow:l})}return(l,f)=>{const w=_t,A=ks,T=Ts;return d(),v("div",{ref_key:"mainRef",ref:i,class:"achievements-block"},[u(h)?(d(),v("div",Is,[n("div",Cs,[n("div",Ds,[p(w,{"model-value":e.filters.achievementsShow==="important",onChange:f[0]||(f[0]=y=>a("important"))},{default:S(()=>[I(" Значимые ")]),_:1},8,["model-value"])]),n("div",Ps,[p(w,{"model-value":e.filters.achievementsShow==="deserved",onChange:f[1]||(f[1]=y=>a("deserved"))},{default:S(()=>[I(" Заслуженные ")]),_:1},8,["model-value"])]),n("div",Os,[p(w,{"model-value":e.filters.achievementsShow===null,onChange:f[2]||(f[2]=y=>a(null))},{default:S(()=>[I(" Все ")]),_:1},8,["model-value"])])]),u(t).length?(d(),v(G,{key:0},[e.filters.achievementsShow==="important"?(d(),q(A,{key:0,achievements:u(t),"hide-name":!0,onMedalClick:o},null,8,["achievements"])):(d(!0),v(G,{key:1},J(u(R),y=>(d(),v("div",{key:y.name,class:"achievements-block__section"},[n("div",Bs,k(l.$formatter.achievements.section(y.name)),1),p(A,{achievements:y.items,"hide-count":u(b).showAll,onMedalClick:o},null,8,["achievements","hide-count"])]))),128))],64)):(d(),v("div",xs," Нет значимых достижений ")),p(T,{ref_key:"detailsRef",ref:g,modelValue:u(b).currentMedal,"onUpdate:modelValue":f[3]||(f[3]=y=>u(b).currentMedal=y)},null,8,["modelValue"])])):(d(),v("div",Ms," Нет достижений "))],512)}}}),yt=N({__name:"TankType",props:{type:{type:String,required:!0,default:"",validator(e){return["AT-SPG","heavyTank","lightTank","mediumTank"].includes(e)}},size:{type:Number,default:24},isPremium:{type:Boolean,default:!1},isCollectible:{type:Boolean,default:!1}},setup(e){const r={lightTank:nt(()=>st(()=>import("./CXqewjHg.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),mediumTank:nt(()=>st(()=>import("./Babr0IR-.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url)),heavyTank:nt(()=>st(()=>import("./BWBczNIj.js"),__vite__mapDeps([6,1,2,3,4]),import.meta.url)),"AT-SPG":nt(()=>st(()=>import("./CuvN3EmH.js"),__vite__mapDeps([7,1,2,3,4]),import.meta.url))};return(c,m)=>(d(),q(Lt(r[e.type]??"span"),{filled:!0,"font-controlled":!1,class:Q(["tank-type",[e.isPremium?"tank-type--is-premium":"",e.isCollectible?"tank-type--is-collectible":""]]),width:e.size,height:e.size},null,8,["class","width","height"]))}}),me=N({__name:"TankNation",props:{nation:{type:String,default:""},size:{type:[Number,String],default:24}},setup(e){return(r,c)=>{const m=ht;return d(),q(m,{style:Et({width:`${e.size}px`,height:`${e.size}px`}),src:`/img/nations/nation-${e.nation}.svg`,alt:e.nation,class:"tank-nation"},null,8,["style","src","alt"])}}}),Us={class:"account-infographics"},Ls={class:"account-infographics__filters"},Es={class:"account-infographics__filters-chips"},qs={class:"account-infographics__chart-list"},Fs={class:"account-infographics__chart-label"},Ns={class:"account-infographics__line-icon"},Vs={key:2},js={key:"battles",class:"account-infographics__line-value"},Hs={key:"damagePerBattle",class:"account-infographics__line-value"},zs=N({__name:"AccountInfographics",props:{tanks:{type:Array,default:()=>[],required:!0}},setup(e){const r=e,c=K("battles"),m=[{value:"battles",label:L.stat.accountProp("battles")},{value:"winRate",label:L.stat.accountProp("winRate")},{value:"damagePerBattle",label:L.stat.accountProp("damagePerBattle")}],s=F(()=>[{label:"По уровню",key:"tier",value:i("tier")},{label:"По нации",key:"nation",value:i("nation")},{label:"По типу",key:"type",value:i("type")}]);function i(b){var t;const h={};if(!((t=r.tanks)!=null&&t.length))return h;r.tanks.forEach(R=>{const C=R[b];R.tier&&(C in h||(h[C]={key:C,battles:0,winRate:0,damagePerBattle:0,lineHeight:0}),h[C].battles+=R.all.battles,h[C].winRate+=R.all.wins,h[C].damagePerBattle+=R.all.damage_dealt)});for(const R in h){const C=h[R].battles;h[R].winRate=C?h[R].winRate/(C/100):0,h[R].damagePerBattle=C?h[R].damagePerBattle/C:0}for(const R in h){const o=Math.min(...Object.values(h).map(l=>l[c.value])),a=Math.max(...Object.values(h).map(l=>l[c.value]))-o/1.1;h[R].lineHeight=(h[R][c.value]-o/1.1)/(a/100)}return h}function g(b){c.value=b}return(b,h)=>{const t=_t,R=yt,C=me,o=vt;return d(),v("div",Us,[n("div",Ls,[n("div",Es,[(d(),v(G,null,J(m,a=>p(t,{key:a.value,"model-value":a.value===u(c),onChange:l=>g(a.value)},{default:S(()=>[I(k(a.label),1)]),_:2},1032,["model-value","onChange"])),64))])]),n("div",qs,[(d(!0),v(G,null,J(u(s),a=>(d(),v("div",{key:a.key,class:Q(["account-infographics__chart",[`account-infographics__chart--${a.key}`]])},[n("span",Fs,k(a.label),1),(d(!0),v(G,null,J(a.value,l=>(d(),v("div",{key:l.key,class:"account-infographics__line"},[n("span",Ns,[a.key==="type"?(d(),q(R,{key:0,type:l.key},null,8,["type"])):a.key==="nation"?(d(),q(C,{key:1,nation:l.key,size:"22"},null,8,["nation"])):a.key==="tier"?(d(),v("span",Vs,k(b.$formatter.encyclopedia.tier(l.key)),1)):(d(),v(G,{key:3},[I(k(l.key),1)],64))]),p(ie,{tag:"span",name:"account-infographics__line-value-",class:"account-infographics__line-progress",style:Et({"--chart-line-width":l.lineHeight/100})},{default:S(()=>[u(c)==="battles"?(d(),v("span",js,k(b.$formatter.number.toInteger(l.battles)),1)):P("",!0),u(c)==="winRate"?(d(),q(o,{key:"winRate","win-rate":l.winRate,class:"account-infographics__line-value"},null,8,["win-rate"])):P("",!0),u(c)==="damagePerBattle"?(d(),v("span",Hs,k(b.$formatter.number.toInteger(l.damagePerBattle)),1)):P("",!0)]),_:2},1032,["style"])]))),128))],2))),128))])])}}}),Gs=N({__name:"AccountDailyStatTable",props:{summary:{type:Object,required:!0,default:()=>({})},items:{type:Array,required:!0,default:()=>[]}},emits:["sort","row-click"],setup(e,{emit:r}){const c=[{key:"position",label:"№"},{key:"date",label:"Дата"},{key:"tanks",label:"Танков"},{key:"tier",label:"I-X",formatter:s=>tt(s)?L.number.toFloatNumber(s):"---"},{key:"battles",label:"Бои",formatter:s=>tt(s)?L.number.toInteger(s):"---"},{key:"winRate",label:"Победы",formatter:s=>tt(s)?L.number.toFloatPercent(s):"---"},{key:"damagePerBattle",label:"Урон",formatter:s=>tt(s)?L.number.toInteger(s):"---"},{key:"xpPerBattle",label:"Опыт",formatter:s=>tt(s)?L.number.toInteger(s):"---"},{key:"fragPerBattle",label:"Уничт.",tooltip:"Уничтожено За Бой",formatter:s=>tt(s)?L.number.toFloatNumber(s):"---"},{key:"hitRate",label:"Точн.",tooltip:"Точность стрельбы",formatter:s=>tt(s)?L.number.toFloatPercent(s):"---"},{key:"surviveRate",label:"Выж.",tooltip:"Выживаемость",formatter:s=>tt(s)?L.number.toFloatPercent(s):"---"},{key:"spottedPerBattle",label:"Обн.",tooltip:"Обнаружено за бой",formatter:s=>tt(s)?L.number.toFloatNumber(s):"---"}],m=r;return(s,i)=>{const g=et,b=vt,h=de;return d(),q(h,{class:"account-daily-stat-table",headers:c,data:e.items,summary:e.summary,"scroll-auto-disabling":"","no-wrap":"","row-key":"timestamp","max-height":"378px",onSort:i[0]||(i[0]=t=>m("sort",t))},{"position-summary":S(()=>[I(k(e.items.length||0),1)]),position:S(({index:t})=>[I(k(t+1),1)]),date:S(({row:t})=>[p(g,{"is-text":"",onClick:R=>m("row-click",t)},{default:S(()=>[I(k(t.date),1)]),_:2},1032,["onClick"])]),tanks:S(({row:t})=>[I(k(t.tanks?s.$formatter.number.toInteger(t.tanks.length):"---"),1)]),winRate:S(({row:t})=>[p(b,{"win-rate":t.winRate},null,8,["win-rate"])]),_:1},8,["data","summary"])}}}),fe=N({__name:"MarkOfMastery",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const r={1:nt(()=>st(()=>import("./BCkDcMF8.js"),__vite__mapDeps([8,1,2,3,4]),import.meta.url)),2:nt(()=>st(()=>import("./XHaGIQcJ.js"),__vite__mapDeps([9,1,2,3,4]),import.meta.url)),3:nt(()=>st(()=>import("./Cgg-sWyJ.js"),__vite__mapDeps([10,1,2,3,4]),import.meta.url)),4:nt(()=>st(()=>import("./BOL-cYqq.js"),__vite__mapDeps([11,1,2,3,4]),import.meta.url))},c=Ut(e,"modelValue");return(m,s)=>(d(),q(Lt(c.value?r[c.value]:"span"),{filled:!0,"font-controlled":!1,class:Q(["mark-of-mastery",[c.value?"mark-of-mastery--"+c.value:""]])},null,8,["class"]))}}),Ks={class:"account-tanks-table-desktop"},Ws={class:"account-tanks-table-desktop__table"},Xs=["title"],Qs={class:"account-tanks-table-desktop__name-text"},Js={key:0,class:"account-tanks-table-desktop__diff"},Ys={key:0,class:"account-tanks-table-desktop__diff"},Zs={key:0,class:"account-tanks-table-desktop__diff"},to={key:0,class:"account-tanks-table-desktop__diff"},eo={key:0,class:"account-tanks-table-desktop__diff"},ao={key:0,class:"account-tanks-table-desktop__diff"},no={key:0,class:"account-tanks-table-desktop__diff"},so={key:0,class:"account-tanks-table-desktop__diff"},oo={class:"account-tanks-table-desktop__mark"},io={key:0,class:"account-tanks-table-desktop__diff"},lo={class:"account-tanks-table-desktop__diff"},co=N({__name:"AccountTanksTableDesktop",props:{items:{type:Array,default:()=>[],required:!0},headers:{type:Array,default:()=>[],required:!0},summary:{type:Object,default:()=>({}),required:!0},height:{type:String,default:void 0},maxHeight:{type:String,default:void 0},sort:{type:Object,default:null},defaultSort:{type:Object,default:null},showDiff:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["row-click"],setup(e,{expose:r,emit:c}){const m=K(null),s=c;return r({sortItems(){var i;(i=m.value)==null||i.sortItems()}}),(i,g)=>{const b=yt,h=et,t=vt,R=fe,C=de,o=dt;return d(),v("div",Ks,[n("div",Ws,[p(C,{ref_key:"tableRef",ref:m,headers:e.headers,data:e.items,summary:e.summary,"default-sort":e.defaultSort,"scroll-auto-disabling":"","no-wrap":"","row-key":"tank_id",height:e.height,"max-height":e.maxHeight},{"position-summary":S(()=>[I(k(e.items.length||0),1)]),position:S(({index:a})=>[I(k(a+1),1)]),type:S(({row:a})=>[n("div",{class:"account-tanks-table-desktop__type",title:a.is_premium?"Премиум танк":""},[p(b,{type:a.type,"is-premium":a.is_premium,"is-collectible":a.is_collectible},null,8,["type","is-premium","is-collectible"])],8,Xs)]),name:S(({row:a})=>[p(h,{class:"account-tanks-table-desktop__name","is-text":"",onClick:l=>s("row-click",a.tank_id)},{default:S(()=>[n("span",Qs,k(a.name??`Tank ID: ${a.tank_id}`),1)]),_:2},1032,["onClick"])]),battles:S(({row:a})=>{var l;return[I(k(a.all.battles)+" ",1),e.showDiff?(d(),v("div",Js,k(i.$formatter.number.toInteger((l=a.diff)==null?void 0:l.battles,!0)),1)):P("",!0)]}),winRate:S(({row:a})=>{var l;return[p(t,{"win-rate":a.all.winRate,class:"account-tanks-table-desktop__win-rate"},null,8,["win-rate"]),e.showDiff?(d(),v("div",Ys,k(i.$formatter.number.toFloatPercent((l=a.diff)==null?void 0:l.winRate,!0)),1)):P("",!0)]}),damagePerBattle:S(({row:a})=>{var l;return[I(k(a.all.damagePerBattle)+" ",1),e.showDiff?(d(),v("div",Zs,k(i.$formatter.number.toInteger((l=a.diff)==null?void 0:l.damagePerBattle,!0)),1)):P("",!0)]}),xpPerBattle:S(({row:a})=>{var l;return[I(k(a.all.xpPerBattle)+" ",1),e.showDiff?(d(),v("div",to,k(i.$formatter.number.toInteger((l=a.diff)==null?void 0:l.xpPerBattle,!0)),1)):P("",!0)]}),fragPerBattle:S(({row:a})=>{var l;return[I(k(a.all.fragPerBattle)+" ",1),e.showDiff?(d(),v("div",eo,k(i.$formatter.number.toInteger((l=a.diff)==null?void 0:l.fragPerBattle,!0)),1)):P("",!0)]}),hitRate:S(({row:a})=>{var l;return[I(k(i.$formatter.number.toFloatPercent(a.all.hitRate))+" ",1),e.showDiff?(d(),v("div",ao,k(i.$formatter.number.toFloatNumber((l=a.diff)==null?void 0:l.hitRate,!0)),1)):P("",!0)]}),surviveRate:S(({row:a})=>{var l;return[I(k(i.$formatter.number.toFloatPercent(a.all.surviveRate))+" ",1),e.showDiff?(d(),v("div",no,k(i.$formatter.number.toFloatNumber((l=a.diff)==null?void 0:l.surviveRate,!0)),1)):P("",!0)]}),spottedPerBattle:S(({row:a})=>{var l;return[I(k(a.all.spottedPerBattle)+" ",1),e.showDiff?(d(),v("div",so,k(i.$formatter.number.toInteger((l=a.diff)==null?void 0:l.spottedPerBattle,!0)),1)):P("",!0)]}),mark_of_mastery:S(({row:a})=>[n("div",oo,[a.markOfMastery.value&&a.markOfMastery.count?(d(),q(R,{key:0,"model-value":a.markOfMastery.value,title:"Знак классности",width:"20",height:"20"},null,8,["model-value"])):P("",!0),I(" "+k(a.markOfMastery.count||"---"),1)]),e.showDiff?(d(),v("div",io,k(a.markOfMastery.diff),1)):P("",!0)]),last_battle_time:S(({row:a})=>[I(k(i.$formatter.date.toRelativeTime(a.last_battle_time*1e3)||"---")+" ",1),n("div",lo,k(i.$formatter.date.toDateTime(a.last_battle_time*1e3)||"---"),1)]),_:1},8,["headers","data","summary","default-sort","height","max-height"]),p(o,{loading:e.loading},null,8,["loading"])])])}}}),ro={key:0,class:"ui-table-mobile__header"},uo={key:1,class:"ui-table-mobile__head"},_o={class:"ui-table-mobile__sort"},mo=["title","onClick"],fo={key:0,class:"ui-table-mobile__sort-icons"},po={key:0,class:"ui-table-mobile__summary"},ho={key:2,class:"ui-table-mobile__no-data"},vo={key:3,class:"ui-table-mobile__footer"},pe=N({__name:"UiTableMobile",props:{data:{type:Array,required:!0,default:()=>[]},headers:{type:Array,default:()=>[]},summary:{type:Object,default:void 0},defaultSort:{type:Object,default:void 0},scrollAutoDisabling:{type:Boolean,default:!1},scrollToTop:{type:Boolean,default:!1},hideHeaders:{type:Boolean,default:!1},height:{type:String,default:void 0},rowKey:{type:String,default:void 0},maxHeight:{type:String,default:void 0},minHeight:{type:String,default:void 0}},emits:["sort","row-click"],setup(e,{expose:r,emit:c}){var A,T;const m=e,s=K(),i=K([]),g=Y({order:((A=m.defaultSort)==null?void 0:A.order)??"",prop:((T=m.defaultSort)==null?void 0:T.prop)??""});We(()=>{var y;i.value=m.data,R(),m.scrollToTop&&((y=s.value)==null||y.scrollTo({top:0}))});let b=null;function h(){s.value&&(b=oa({target:[s.value],threshold:1,callback(y){const D=y.target;y.isIntersecting?zt(!1,D):(zt(!0,D),D.scrollTo({top:0}))}}))}Rt(()=>{m.scrollAutoDisabling&&h()}),oe(()=>{m.scrollAutoDisabling&&(b==null||b.disconnect())});const t=(y="default")=>!!Xe()[y];function R(){var M;let y=g.order,D=g.prop;y===""&&m.defaultSort&&(y=m.defaultSort.order,D=m.defaultSort.prop);const x=(M=m.headers)==null?void 0:M.find(B=>B.key===D);x&&(typeof x.sortMethod=="function"?i.value.sort((B,U)=>{var X,H;return y==="desc"?((X=x.sortMethod)==null?void 0:X.call(x,U,B))||0:((H=x.sortMethod)==null?void 0:H.call(x,B,U))||0}):x.sortable===!0&&i.value.sort((B,U)=>{const X=(y==="desc"?U:B)[D],H=(y==="desc"?B:U)[D];return String(X).localeCompare(String(H),void 0,{numeric:!0,sensitivity:"base"})}))}const C=c;function o(y){let D=y.key,x=g.order;g.prop!==D&&(x=""),x?x==="asc"?x="desc":(x="",D=""):x="asc",g.order=x,g.prop=D}function a(y){var D;y.sortable&&((D=s.value)==null||D.scrollTo({top:0}),o(y),R(),C("sort",{...g,column:y}))}function l(y,D){return typeof y.formatter=="function"?y.formatter(D):D}function f(y,D){return g.order===y&&g.prop===D}function w(y){return typeof m.summary!="object"||!Object.keys(m.summary).includes(y.key)?"":typeof y.formatter=="function"?y.formatter(m.summary[y.key]):m.summary[y.key]}return r({sortItems:R}),(y,D)=>{const x=ct;return d(),v("div",{class:"ui-table-mobile",style:Et({height:e.height,maxHeight:e.maxHeight,minHeight:e.minHeight})},[t("header")?(d(),v("div",ro,[ut(y.$slots,"header")])):P("",!0),e.headers.length&&!e.hideHeaders?(d(),v("ul",uo,[(d(!0),v(G,null,J(e.headers,M=>(d(),v("li",{key:M.key,class:"ui-table-mobile__head-item"},[n("div",_o,[n("button",{title:M.tooltip,class:Q(["ui-table-mobile__sort-btn",[M.sortable?"ui-table-mobile__sort-btn--has-sort":""]]),onClick:B=>a(M)},[ut(y.$slots,`${M.key}-header`,{},()=>[I(k(M.label),1)])],10,mo),M.sortable?(d(),v("span",fo,[p(x,{size:"16",name:"arrow-up",class:Q(["ui-table-mobile__sort-icon",[f("asc",M.key)?"is-active":""]])},null,8,["class"]),p(x,{size:"16",name:"arrow-down",class:Q(["ui-table-mobile__sort-icon",[f("desc",M.key)?"is-active":""]])},null,8,["class"])])):P("",!0)]),e.summary?(d(),v("div",po,[ut(y.$slots,`${M.key}-summary`,{},()=>[I(k(w(M)),1)])])):P("",!0)]))),128))])):P("",!0),n("ul",{ref_key:"tableListRef",ref:s,class:"ui-table-mobile__list"},[(d(!0),v(G,null,J(u(i),(M,B)=>(d(),v("li",{key:String(e.rowKey?M[e.rowKey]:B),class:"ui-table-mobile__row"},[t("default")?ut(y.$slots,"default",{key:0,row:M,data:null,index:B}):(d(!0),v(G,{key:1},J(e.headers,U=>(d(),v("td",{key:U.key,class:"ui-table-mobile__cell"},[M?ut(y.$slots,`${U.key}`,{key:0,row:M,data:M[U.key],index:B},()=>[I(k(l(U,M[U.key])),1)]):P("",!0)]))),128))]))),128))],512),Array.isArray(e.data)&&e.data.length?P("",!0):(d(),v("div",ho," Нет данных ")),t("footer")?(d(),v("div",vo,[ut(y.$slots,"footer")])):P("",!0)],4)}}}),yo={class:"tank-tier"},ko=N({__name:"TankTier",props:{tier:{type:Number,required:!0}},setup(e){return(r,c)=>(d(),v("div",yo,k(r.$formatter.encyclopedia.tier(e.tier)),1))}}),go={class:"account-tanks-table-mobile"},bo=["onClick"],wo={class:"account-tanks-table-mobile__img-wrapper"},$o={class:"account-tanks-table-mobile__description"},Ao={class:"account-tanks-table-mobile__description-row"},Ro={class:"account-tanks-table-mobile__name"},So={class:"account-tanks-table-mobile__name-text"},To={class:"account-tanks-table-mobile__description-row"},Io={class:"account-tanks-table-mobile__props"},Co={class:"account-tanks-table-mobile__prop"},Do={class:"account-tanks-table-mobile__prop-value"},Po={key:0,class:"account-tanks-table-mobile__prop-sub"},Oo={class:"account-tanks-table-mobile__prop"},Bo={class:"account-tanks-table-mobile__prop-value"},xo={key:0,class:"account-tanks-table-mobile__prop-sub"},Mo={class:"account-tanks-table-mobile__prop"},Uo={class:"account-tanks-table-mobile__prop-value"},Lo={key:0,class:"account-tanks-table-mobile__prop-sub"},Eo=N({__name:"AccountTanksTableMobile",props:{items:{type:Array,default:()=>[],required:!0},headers:{type:Array,default:()=>[],required:!0},defaultSort:{type:Object,default:null},height:{type:String,default:void 0},maxHeight:{type:String,default:void 0}},emits:["row-click"],setup(e,{expose:r,emit:c}){const m=K(null),s=c;return r({sortItems(){var i;(i=m.value)==null||i.sortItems()}}),(i,g)=>{const b=ht,h=fe,t=yt,R=ct,C=vt,o=pe;return d(),v("div",go,[p(o,{ref_key:"tableRef",ref:m,data:e.items,headers:e.headers,"row-key":"tank_id",height:e.height,"default-sort":e.defaultSort,"max-height":e.maxHeight,"scroll-auto-disabling":""},{default:S(({row:a})=>[n("div",{class:"account-tanks-table-mobile__item",onClick:l=>s("row-click",a.tank_id)},[n("div",wo,[p(b,{class:"account-tanks-table-mobile__nation-img",src:`/img/nations/nation-${a.nation}.svg`,alt:a.nation},null,8,["src","alt"]),p(b,{class:"account-tanks-table-mobile__tank-img",src:a.images.preview,alt:a.name},null,8,["src","alt"]),p(ko,{class:"account-tanks-table-mobile__tier",tier:a.tier},null,8,["tier"]),a.markOfMastery.value&&a.markOfMastery.count?(d(),q(h,{key:0,class:"account-tanks-table-mobile__master","model-value":a.markOfMastery.value,title:"Знак классности"},null,8,["model-value"])):P("",!0)]),n("div",$o,[n("div",Ao,[n("div",Ro,[p(t,{type:a.type,class:"account-tanks-table-mobile__type","is-premium":a.is_premium,"is-collectible":a.is_collectible},null,8,["type","is-premium","is-collectible"]),n("span",So,k(a.name??`Tank ID: ${a.tank_id}`),1)])]),n("div",To,[n("div",Io,[n("span",Co,[p(R,{name:"sword-cross",size:"18"}),n("span",Do,[I(k(i.$formatter.number.toInteger(a.all.battles))+" ",1),a.diff?(d(),v("span",Po,k(i.$formatter.number.toInteger(a.diff.battles,!0)),1)):P("",!0)])]),n("span",Oo,[p(R,{name:"flag-variant",size:"18"}),n("span",Bo,[p(C,{"win-rate":a.all.winRate},null,8,["win-rate"]),a.diff?(d(),v("span",xo,k(i.$formatter.number.toFloatPercent(a.diff.winRate,!0)),1)):P("",!0)])]),n("span",Mo,[p(R,{name:"destruction",size:"18"}),n("span",Uo,[I(k(i.$formatter.number.toInteger(a.all.damagePerBattle))+" ",1),a.diff?(d(),v("span",Lo,k(i.$formatter.number.toInteger(a.diff.damagePerBattle,!0)),1)):P("",!0)])])])])])],8,bo)]),_:1},8,["data","headers","height","default-sort","max-height"])])}}}),he=N({__name:"AccountTanksTable",props:{tanks:{type:Array,default:()=>[],required:!0},tanksDiff:{type:[Array,null],default:null,required:!0},height:{type:String,default:void 0},maxHeight:{type:String,default:void 0},sort:{type:Object,default:null},defaultSort:{type:Object,default:null},showDiff:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["row-click"],setup(e,{expose:r,emit:c}){const m=F(()=>g.isTablet?Eo:co),s=e,i=K(null),g=qt(),b=c,h=F(()=>[{key:"position",label:"№",width:60},{key:"type",label:"Тип",width:60,sortable:!0},{key:"name",label:"Название",sortable:!0},{key:"tier",label:"I-X",sortable:!0},{key:"battles",label:"Бои",sortable:!0,sortMethod(o,a){return o.all.battles-a.all.battles},formatter:o=>L.number.toInteger(o)},{key:"winRate",label:"Победы",sortable:!0,sortMethod(o,a){const l=o,f=a;return l.all.winRate-f.all.winRate},formatter:o=>L.number.toFloatPercent(o)},{key:"damagePerBattle",label:"Урон",sortable:!0,sortMethod(o,a){return o.all.damagePerBattle-a.all.damagePerBattle},formatter:o=>L.number.toInteger(o)},{key:"xpPerBattle",label:"Опыт",sortable:!0,sortMethod(o,a){return o.all.xpPerBattle-a.all.xpPerBattle},formatter:o=>L.number.toInteger(o)},{key:"fragPerBattle",label:"Уничт.",tooltip:"Уничтожено За Бой",sortable:!0,sortMethod(o,a){return o.all.fragPerBattle-a.all.fragPerBattle},formatter:o=>L.number.toFloatNumber(o)},{key:"hitRate",label:"Точн.",tooltip:"Точность стрельбы",sortable:!0,sortMethod(o,a){return o.all.hitRate-a.all.hitRate},formatter:o=>L.number.toPercent(o)},{key:"surviveRate",label:"Выж.",tooltip:"Выживаемость",sortable:!0,sortMethod(o,a){return o.all.surviveRate-a.all.surviveRate},formatter:o=>L.number.toPercent(o)},{key:"spottedPerBattle",label:"Обн.",tooltip:"Обнаружено за бой",sortable:!0,sortMethod(o,a){return o.all.spottedPerBattle-a.all.spottedPerBattle},formatter:o=>L.number.toFloatNumber(o)},{key:"mark_of_mastery",label:"M",tooltip:"Знак классности",sortable:!0,sortMethod(o,a){const l=o.markOfMastery.count+o.markOfMastery.value*1e4,f=a.markOfMastery.count+a.markOfMastery.value*1e4;return l-f},formatter:o=>L.stat.markOfMastery(Number(o))},{key:"last_battle_time",label:"Последний бой",sortable:!0}].filter(o=>{const a=["battles","winRate","damagePerBattle","type","tier","last_battle_time"];return g.isTablet?a.includes(o.key):!0})),t=F(()=>{let o={};return s.tanks.forEach((a,l)=>{l?o=V.sum(o,a.all):o=a.all}),V.tank(o)}),R={1:"markOfMasteryIII",2:"markOfMasteryII",3:"markOfMasteryI",4:"markOfMastery"},C=F(()=>s.tanks.map(o=>{var w;const a=(w=s.tanksDiff)==null?void 0:w.find(A=>A.tank_id===o.tank_id),l=o.achievements.achievements[R[o.mark_of_mastery]]??0,f=(a==null?void 0:a.achievements.achievements[R[o.mark_of_mastery]])??0;return{...o,diff:(a==null?void 0:a.all)??null,markOfMastery:{value:o.mark_of_mastery,count:l,diff:L.number.toInteger(f,!0)||"---"}}}));return r({sortItems(){var o;(o=i.value)==null||o.sortItems()}}),(o,a)=>{const l=ia;return d(),q(l,null,{default:S(()=>[(d(),q(Lt(u(m)),{items:u(C),headers:u(h),"show-diff":e.showDiff,summary:u(t),"max-height":e.maxHeight,height:e.height,loading:e.loading,"default-sort":e.defaultSort,onRowClick:a[0]||(a[0]=f=>b("row-click",f))},null,40,["items","headers","show-diff","summary","max-height","height","loading","default-sort"]))]),_:1})}}}),qo={class:"account-daily-stat-table-mobile"},Fo={class:"account-daily-stat-table-mobile__summary"},No={class:"account-daily-stat-table-mobile__props"},Vo={class:"account-daily-stat-table-mobile__prop"},jo={class:"account-daily-stat-table-mobile__prop-icon"},Ho={class:"account-daily-stat-table-mobile__prop"},zo={class:"account-daily-stat-table-mobile__prop-icon"},Go={class:"account-daily-stat-table-mobile__prop"},Ko={class:"account-daily-stat-table-mobile__prop-icon"},Wo={class:"account-daily-stat-table-mobile__prop"},Xo=n("span",{class:"account-daily-stat-table-mobile__prop-icon",style:{"font-weight":"500","font-size":"14px"}}," # ",-1),Qo=["onClick","onKeydown"],Jo={class:"account-daily-stat-table-mobile__props"},Yo={class:"account-daily-stat-table-mobile__prop"},Zo={class:"account-daily-stat-table-mobile__prop-icon"},ti={class:"account-daily-stat-table-mobile__prop"},ei=n("span",{class:"account-daily-stat-table-mobile__prop-icon",style:{"font-weight":"500","font-size":"14px"}}," # ",-1),ai={class:"account-daily-stat-table-mobile__props"},ni={class:"account-daily-stat-table-mobile__prop"},si={class:"account-daily-stat-table-mobile__prop-icon"},oi={class:"account-daily-stat-table-mobile__prop"},ii={class:"account-daily-stat-table-mobile__prop-icon"},li={class:"account-daily-stat-table-mobile__prop"},ci={class:"account-daily-stat-table-mobile__prop-icon"},ri={class:"account-daily-stat-table-mobile__prop"},ui=n("span",{class:"account-daily-stat-table-mobile__prop-icon",style:{"font-weight":"500","font-size":"14px"}}," I-X ",-1),di=N({__name:"AccountDailyStatTableMobile",props:{summary:{type:Object,required:!0,default:()=>({})},items:{type:Array,required:!0,default:()=>[]}},emits:["row-click"],setup(e,{emit:r}){const c=r;return(m,s)=>{const i=ct,g=vt,b=pe;return d(),v("div",qo,[p(b,{data:e.items,"scroll-auto-disabling":"","no-wrap":"","row-key":"timestamp","max-height":"calc(100vh - 160px)"},{header:S(()=>[n("div",Fo,[n("div",No,[n("span",Vo,[n("span",jo,[p(i,{name:"sword-cross",size:"18"})]),I(" "+k(m.$formatter.number.toInteger(e.summary.battles)),1)]),n("span",Ho,[n("span",zo,[p(i,{name:"flag-variant",size:"18"})]),p(g,{"win-rate":e.summary.winRate},null,8,["win-rate"])]),n("span",Go,[n("span",Ko,[p(i,{name:"destruction",size:"18"})]),I(" "+k(m.$formatter.number.toInteger(e.summary.damagePerBattle)),1)]),n("span",Wo,[Xo,I(" "+k(e.items.length),1)])])])]),default:S(({row:h,index:t})=>[n("div",{tabindex:"0",role:"button",class:"account-daily-stat-table-mobile__item",onClick:R=>c("row-click",h),onKeydown:[Ht(R=>c("row-click",h),["enter"]),Ht(R=>c("row-click",h),["space"])]},[n("div",Jo,[n("span",Yo,[n("span",Zo,[p(i,{name:"event",size:"18"})]),n("b",{class:Q(["account-daily-stat-table-mobile__prop-value",["account-daily-stat-table-mobile__prop-value--bold"]])},k(h.date),1)]),n("span",ti,[ei,n("b",{class:Q(["account-daily-stat-table-mobile__prop-value",["account-daily-stat-table-mobile__prop-value--bold"]])},k(t+1),1)])]),n("div",ai,[n("span",ni,[n("span",si,[p(i,{name:"sword-cross",size:"18"})]),I(" "+k(m.$formatter.number.toInteger(h.battles)),1)]),n("span",oi,[n("span",ii,[p(i,{name:"flag-variant",size:"18"})]),p(g,{"win-rate":h.winRate},null,8,["win-rate"])]),n("span",li,[n("span",ci,[p(i,{name:"destruction",size:"18"})]),I(" "+k(m.$formatter.number.toInteger(h.damagePerBattle)),1)]),n("span",ri,[ui,I(" "+k(m.$formatter.number.toInteger(h.tier)),1)])])],40,Qo)]),_:1},8,["data"])])}}}),_i={class:"account-daily-stat"},mi={class:"account-daily-stat__filters"},fi={class:"account-daily-stat__filters-item"},pi={class:"account-daily-stat__filters-item"},hi={class:"account-daily-stat__table"},vi={style:{display:"flex","justify-content":"flex-end"}},yi=N({__name:"AccountDailyStat",props:{accountId:{type:[Number,String],default:0,required:!0},vehicles:{type:Object,default:()=>({}),required:!0}},emits:["sort"],setup(e,{emit:r}){const c=e,m=qt(),s=K(null),i=Y({loading:0,summary:{},items:[],currentItem:null,accounts:[],tanks:[]}),g=[7,14,30,60,90].map(A=>({value:A,label:new Intl.NumberFormat("ru",{style:"unit",unit:"day",unitDisplay:"long"}).format(A)})),b=[0,7,14,30,60,90,180].map(A=>({value:A,label:new Intl.NumberFormat("ru",{style:"unit",unit:"day",unitDisplay:"long"}).format(A)})),h=Y({period:7,periodOffset:0}),t=F(()=>{const A=new Date,T=new Date;return A.setDate(A.getDate()-(h.periodOffset+h.period+1)),T.setDate(T.getDate()-h.periodOffset),{dateStart:A.toISOString(),dateEnd:T.toISOString()}}),R={order:"desc",prop:"last_battle_time"},C=F(()=>i.currentItem?i.currentItem.tanks.map(A=>{var T;return lt.accountTank(A,((T=c.vehicles)==null?void 0:T[A.tank_id])??null,null)}):[]);Rt(async()=>{c.accountId&&(await a(c.accountId),l())}),Ot(t,async()=>{c.accountId&&(await a(c.accountId),l())});const o=r;async function a(A){const T={...t.value,id:A};i.loading++;try{const[y,D]=await Promise.all([ft.stat.accounts.getDiff(T),ft.stat.tanks.getDiff(T)]);i.tanks=D.data,i.accounts=y.data}catch(y){j(y,{title:"Получение дневной статистики"})}i.loading--}function l(){let A=null;i.items=[],i.accounts.forEach(T=>{var M;const y=V.accountAll(T.raw.statistics.all),D=(M=i.tanks.find(B=>{const U=L.date.toDate(B.timestamp),X=L.date.toDate(T.timestamp);return U===X}))==null?void 0:M.raw,x=()=>{const B=(D==null?void 0:D.length)??0;return((D==null?void 0:D.reduce((U,X)=>{var H;return U+((H=c.vehicles[X.tank_id])==null?void 0:H.tier)||0},0))??0)/B};i.items.push({id:T.id,date:L.date.toDate(T.timestamp),battles:y.battles,winRate:y.winRate,damagePerBattle:y.damagePerBattle,xpPerBattle:y.xpPerBattle,fragPerBattle:y.fragPerBattle,hitRate:y.hitRate,surviveRate:y.surviveRate,spottedPerBattle:y.spottedPerBattle,tanks:D||[],tier:x()}),A=A?V.sum(A,y):y}),i.summary=A?V.accountAll(A):{}}async function f(A){var T;i.currentItem=A,await Bt(),(T=s.value)==null||T.doOpen()}function w(){var A;i.currentItem=null,(A=s.value)==null||A.doClose()}return(A,T)=>{var X;const y=ce,D=Gs,x=dt,M=he,B=et,U=pt;return d(),v("div",_i,[n("div",mi,[n("div",fi,[I(" Период "),p(y,{modelValue:u(h).period,"onUpdate:modelValue":T[0]||(T[0]=H=>u(h).period=H),width:"120px",options:u(g),class:"account-daily-stat__filters-item"},null,8,["modelValue","options"])]),n("div",pi,[I(" Смещение "),p(y,{modelValue:u(h).periodOffset,"onUpdate:modelValue":T[1]||(T[1]=H=>u(h).periodOffset=H),width:"120px",options:u(b)},null,8,["modelValue","options"])])]),n("div",hi,[u(m).isTablet?(d(),q(di,{key:0,items:u(i).items,summary:u(i).summary,onSort:T[2]||(T[2]=H=>o("sort",H)),onRowClick:f},null,8,["items","summary"])):(d(),q(D,{key:1,items:u(i).items,summary:u(i).summary,onSort:T[3]||(T[3]=H=>o("sort",H)),onRowClick:f},null,8,["items","summary"])),p(x,{loading:u(i).loading>0},null,8,["loading"])]),p(U,{ref_key:"tanksDetailsRef",ref:s,width:"1280px",title:"Статистика за "+((X=u(i).currentItem)==null?void 0:X.date),onClosed:T[4]||(T[4]=H=>u(i).currentItem=null)},{footer:S(()=>[n("div",vi,[p(B,{onClick:w},{default:S(()=>[I(" Закрыть ")]),_:1})])]),default:S(()=>[u(i).currentItem?(d(),q(M,{key:0,tanks:u(C),"default-sort":R,"max-height":"calc(100vh - 200px)"},null,8,["tanks"])):P("",!0)]),_:1},8,["title"])])}}});var ki="__lodash_hash_undefined__";function gi(e){return this.__data__.set(e,ki),this}var bi=gi;function wi(e){return this.__data__.has(e)}var $i=wi,Ai=la,Ri=bi,Si=$i;function At(e){var r=-1,c=e==null?0:e.length;for(this.__data__=new Ai;++r<c;)this.add(e[r])}At.prototype.add=At.prototype.push=Ri;At.prototype.has=Si;var Ti=At;function Ii(e,r){for(var c=-1,m=e==null?0:e.length;++c<m;)if(r(e[c],c,e))return!0;return!1}var Ci=Ii;function Di(e,r){return e.has(r)}var Pi=Di,Oi=Ti,Bi=Ci,xi=Pi,Mi=1,Ui=2;function Li(e,r,c,m,s,i){var g=c&Mi,b=e.length,h=r.length;if(b!=h&&!(g&&h>b))return!1;var t=i.get(e),R=i.get(r);if(t&&R)return t==r&&R==e;var C=-1,o=!0,a=c&Ui?new Oi:void 0;for(i.set(e,r),i.set(r,e);++C<b;){var l=e[C],f=r[C];if(m)var w=g?m(f,l,C,r,e,i):m(l,f,C,e,r,i);if(w!==void 0){if(w)continue;o=!1;break}if(a){if(!Bi(r,function(A,T){if(!xi(a,T)&&(l===A||s(l,A,c,m,i)))return a.push(T)})){o=!1;break}}else if(!(l===f||s(l,f,c,m,i))){o=!1;break}}return i.delete(e),i.delete(r),o}var ve=Li;function Ei(e){var r=-1,c=Array(e.size);return e.forEach(function(m,s){c[++r]=[s,m]}),c}var qi=Ei;function Fi(e){var r=-1,c=Array(e.size);return e.forEach(function(m){c[++r]=m}),c}var Ni=Fi,Wt=Ze,Xt=ca,Vi=pa,ji=ve,Hi=qi,zi=Ni,Gi=1,Ki=2,Wi="[object Boolean]",Xi="[object Date]",Qi="[object Error]",Ji="[object Map]",Yi="[object Number]",Zi="[object RegExp]",tl="[object Set]",el="[object String]",al="[object Symbol]",nl="[object ArrayBuffer]",sl="[object DataView]",Qt=Wt?Wt.prototype:void 0,Dt=Qt?Qt.valueOf:void 0;function ol(e,r,c,m,s,i,g){switch(c){case sl:if(e.byteLength!=r.byteLength||e.byteOffset!=r.byteOffset)return!1;e=e.buffer,r=r.buffer;case nl:return!(e.byteLength!=r.byteLength||!i(new Xt(e),new Xt(r)));case Wi:case Xi:case Yi:return Vi(+e,+r);case Qi:return e.name==r.name&&e.message==r.message;case Zi:case el:return e==r+"";case Ji:var b=Hi;case tl:var h=m&Gi;if(b||(b=zi),e.size!=r.size&&!h)return!1;var t=g.get(e);if(t)return t==r;m|=Ki,g.set(e,r);var R=ji(b(e),b(r),m,s,i,g);return g.delete(e),R;case al:if(Dt)return Dt.call(e)==Dt.call(r)}return!1}var il=ol,Jt=ra,ll=1,cl=Object.prototype,rl=cl.hasOwnProperty;function ul(e,r,c,m,s,i){var g=c&ll,b=Jt(e),h=b.length,t=Jt(r),R=t.length;if(h!=R&&!g)return!1;for(var C=h;C--;){var o=b[C];if(!(g?o in r:rl.call(r,o)))return!1}var a=i.get(e),l=i.get(r);if(a&&l)return a==r&&l==e;var f=!0;i.set(e,r),i.set(r,e);for(var w=g;++C<h;){o=b[C];var A=e[o],T=r[o];if(m)var y=g?m(T,A,o,r,e,i):m(A,T,o,e,r,i);if(!(y===void 0?A===T||s(A,T,c,m,i):y)){f=!1;break}w||(w=o=="constructor")}if(f&&!w){var D=e.constructor,x=r.constructor;D!=x&&"constructor"in e&&"constructor"in r&&!(typeof D=="function"&&D instanceof D&&typeof x=="function"&&x instanceof x)&&(f=!1)}return i.delete(e),i.delete(r),f}var dl=ul,Pt=ua,_l=ve,ml=il,fl=dl,Yt=da,Zt=fa,te=_a,pl=ma,hl=1,ee="[object Arguments]",ae="[object Array]",$t="[object Object]",vl=Object.prototype,ne=vl.hasOwnProperty;function yl(e,r,c,m,s,i){var g=Zt(e),b=Zt(r),h=g?ae:Yt(e),t=b?ae:Yt(r);h=h==ee?$t:h,t=t==ee?$t:t;var R=h==$t,C=t==$t,o=h==t;if(o&&te(e)){if(!te(r))return!1;g=!0,R=!1}if(o&&!R)return i||(i=new Pt),g||pl(e)?_l(e,r,c,m,s,i):ml(e,r,h,c,m,s,i);if(!(c&hl)){var a=R&&ne.call(e,"__wrapped__"),l=C&&ne.call(r,"__wrapped__");if(a||l){var f=a?e.value():e,w=l?r.value():r;return i||(i=new Pt),s(f,w,c,m,i)}}return o?(i||(i=new Pt),fl(e,r,c,m,s,i)):!1}var kl=yl,gl=kl,se=ta;function ye(e,r,c,m,s){return e===r?!0:e==null||r==null||!se(e)&&!se(r)?e!==e&&r!==r:gl(e,r,c,m,ye,s)}var bl=ye,wl=bl;function $l(e,r){return wl(e,r)}var Al=$l;const Rl=ea(Al),Sl={class:"account-tanks-filters"},Tl={class:"account-tanks-filters__inner"},Il={class:"account-tanks-filters__list"},Cl={style:{"font-weight":"500",width:"24px","text-align":"center"}},Dl={key:0,class:"account-tanks-filters__item"},Pl={class:"account-tanks-filters__item"},Ol={class:"account-tanks-filters__item"},Bl=N({__name:"AccountTanksFilters",props:{defaultFilters:{type:Object,default:null,required:!0},filters:{type:Object,default:null,required:!0},isPrivate:{type:Boolean,default:!1,required:!0}},emits:["change","clear"],setup(e,{emit:r}){const c=e,m=["ussr","germany","usa","uk","japan","china","france","european","other"],s=[1,2,3,4,5,6,7,8,9,10].map(f=>({value:f,label:L.encyclopedia.tier(f)})),i=["lightTank","mediumTank","heavyTank","AT-SPG"],g=[{value:null,label:"Премиум: показать"},{value:!0,label:"Премиум: только"},{value:!1,label:"Премиум: спрятать"}],b=[{value:null,label:"В ангаре: все"},{value:1,label:"В ангаре: есть"},{value:0,label:"В ангаре: нет"}],h=F(()=>!Rl(c.filters,c.defaultFilters)),t=r;function R(f){let w=c.filters.tankNation;w.includes(f)?w=w.filter(A=>A!==f):w.push(f),t("change",{...c.filters,tankNation:w})}function C(f){let w=c.filters.tankTire;w.includes(f)?w=w.filter(A=>A!==f):w.push(f),t("change",{...c.filters,tankTire:w})}function o(f){let w=c.filters.tankType;w.includes(f)?w=w.filter(A=>A!==f):w.push(f),t("change",{...c.filters,tankType:w})}function a(f){t("change",{...c.filters,tankInGarage:f})}function l(f){t("change",{...c.filters,tankIsPremium:f})}return(f,w)=>{const A=me,T=_t,y=yt,D=ce,x=ct,M=et;return d(),v("div",Sl,[n("div",Tl,[n("ul",Il,[n("li",{class:Q(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[(d(),v(G,null,J(m,B=>p(T,{key:B,"model-value":e.filters.tankNation.includes(B),class:"account-tanks-filters__btn",title:f.$formatter.encyclopedia.nation(B),onChange:U=>R(B)},{default:S(()=>[p(A,{nation:B},null,8,["nation"])]),_:2},1032,["model-value","title","onChange"])),64))]),n("li",{class:Q(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[(d(),v(G,null,J(i,B=>p(T,{key:B,"model-value":e.filters.tankType.includes(B),class:"account-tanks-filters__btn",title:"Тип",onChange:U=>o(B)},{default:S(()=>[p(y,{type:B},null,8,["type"])]),_:2},1032,["model-value","onChange"])),64))]),n("li",{class:Q(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[(d(!0),v(G,null,J(u(s),B=>(d(),q(T,{key:B.value,"model-value":e.filters.tankTire.includes(B.value),class:"account-tanks-filters__btn",title:"Уровень "+B,onChange:U=>C(B.value)},{default:S(()=>[n("span",Cl,k(B.label),1)]),_:2},1032,["model-value","title","onChange"]))),128))]),e.isPrivate?(d(),v("li",Dl,[p(D,{"model-value":e.filters.tankInGarage,options:b,onChange:a},null,8,["model-value"])])):P("",!0),n("li",Pl,[p(D,{"model-value":e.filters.tankIsPremium,options:g,onChange:l},null,8,["model-value"])]),n("li",Ol,[p(M,{title:"Очистить фильтры",disabled:!u(h),onClick:w[0]||(w[0]=B=>t("clear"))},{default:S(()=>[p(x,{name:"clear"})]),_:1},8,["disabled"])])])])])}}}),xl={key:0,class:"account-tank"},Ml={class:"account-tank__header"},Ul={class:"account-tank__img-wrapper"},Ll={class:"account-tank__tier"},El={class:"account-tank__props"},ql={class:"account-tank__prop"},Fl=n("span",{class:"account-tank__prop-name"}," Нация: ",-1),Nl={class:"account-tank__prop"},Vl=n("span",{class:"account-tank__prop-name"}," Последний бой: ",-1),jl=n("h4",null,"Статистика",-1),Hl=n("h4",null,"Достижения",-1),zl=N({__name:"AccountTank",props:{tank:{type:Object,default:()=>({}),required:!0},tankDiff:{type:Object,default:null,required:!0},achievementsInfo:{type:Object,default:()=>({}),required:!0}},setup(e){const r=["battles","winRate","damagePerBattle","surviveRate","fragPerBattle","winsInPlatoon"],c=e,m=Y({showAllMetrics:!1,filters:sa()}),s=F(()=>{const g=ot.tank({tank:c.tank,tankDiff:c.tankDiff});return m.showAllMetrics?g:g.filter(b=>r.includes(b.key))});function i(g){m.filters=g}return(g,b)=>{var a;const h=ht,t=yt,R=_t,C=re,o=_e;return e.tank?(d(),v("div",xl,[n("div",Ml,[n("div",Ul,[p(h,{class:"account-tank__img account-tank__img--nation",alt:"tank.nation",src:`/img/nations/nation-${e.tank.nation}.svg`},null,8,["src"]),p(h,{class:"account-tank__img account-tank__img--tank",alt:e.tank.name,src:(a=e.tank.images)==null?void 0:a.preview},null,8,["alt","src"]),p(t,{size:28,class:"account-tank__type",type:e.tank.type,"is-premium":e.tank.is_premium,"is-collectible":e.tank.is_collectible},null,8,["type","is-premium","is-collectible"]),n("div",Ll,k(g.$formatter.encyclopedia.tier(e.tank.tier)),1)]),n("div",El,[n("div",ql,[Fl,I(" "+k(g.$formatter.encyclopedia.nation(e.tank.nation)),1)]),n("div",Nl,[Vl,I(" "+k(g.$formatter.date.toDateTime(e.tank.last_battle_time*1e3)),1)])])]),jl,p(R,{modelValue:u(m).showAllMetrics,"onUpdate:modelValue":b[0]||(b[0]=l=>u(m).showAllMetrics=l),class:"account-tank__show-all-metrics"},{default:S(()=>[I(" Все показатели ")]),_:1},8,["modelValue"]),p(C,{items:u(s)},null,8,["items"]),Hl,p(o,{achievements:e.tank.achievements,"achievements-info":e.achievementsInfo,filters:u(m).filters,onFiltersChanged:i},null,8,["achievements","achievements-info","filters"])])):P("",!0)}}}),Gl={key:0,class:"account-view"},Kl={class:"account-view__private"},Wl={key:1,class:"account-view--no-data"},Xl={key:0,class:"content-area"},Ql=n("p",null,"Нет данных.",-1),Jl=n("p",null,"Возможно аккаунт удалён.",-1),Yl=[Ql,Jl],Zl={style:{display:"flex","justify-content":"flex-end"}},Ac=N({__name:"AccountView",setup(e){const r=K(null),c=K(null),m=ue.makeAccountFilters({tankInGarage:1,tankIsPremium:null}),s=Qe(),i=ha(),g=va(),b={order:"desc",prop:"last_battle_time"},h=Y(at(b)),t=Y({tanks:[],tanksDiff:[],tanksSessions:[],tanksSnapshot:[],tanksTableItems:[],sessionUpdateAt:0,sessionActive:!1,currentTank:null,currentTankDiff:null,loading:0,filters:at(m),accountRaw:null,accountRawSnapshot:null,accountAchievementsRaw:null,accountAchievementsRawSnapshot:null,tanksRaw:null,tanksRawSnapshot:null,tanksAchievementsRaw:null,tanksAchievementsRawSnapshot:null}),R=F(()=>g.vehicles),C=F(()=>g.achievements),o=F(()=>{var _;return i.accountId===((_=t.accountRaw)==null?void 0:_.account_id)}),a=F(()=>Number(s.params.id)||i.accountId),l=F(()=>!t.accountAchievementsRaw||!t.accountAchievementsRawSnapshot||!C.value?null:V.accountAchievementsDiff(t.accountAchievementsRaw,t.accountAchievementsRawSnapshot,C.value)),f=F(()=>t.sessionActive?l.value:t.accountAchievementsRaw),w=F(()=>{if(!t.accountRaw)return null;const _=t.accountRaw.statistics.all,$=t.accountRaw.statistics.rating;return{...t.accountRaw,statistics:{all:V.accountAll(_),rating:$?V.accountRating($):null}}}),A=F(()=>{if(!t.accountRaw||!t.accountRawSnapshot)return null;const _=t.accountRaw.statistics.all,$=t.accountRaw.statistics.rating,O=t.accountRawSnapshot.statistics.all,E=t.accountRawSnapshot.statistics.rating;return{...t.accountRaw,statistics:{all:V.accountAll(V.diff(_,O)),rating:$&&E?V.accountRating(V.diff($,E)):null}}}),T=F(()=>{if(!t.accountRaw||!t.accountRawSnapshot)return null;const _=t.accountRaw.statistics.all,$=t.accountRaw.statistics.rating,O=t.accountRawSnapshot.statistics.all,E=t.accountRawSnapshot.statistics.rating,W=V.diff(V.accountAll(_),V.accountAll(O)),z=$&&E?V.diff(V.accountRating($),V.accountRating(E)):null;return{...t.accountRaw,statistics:{all:W,rating:z}}}),y=F(()=>{var _,$,O,E;return!w.value||!A.value||!f.value?ot.account():t.sessionActive?ot.account({stat:(_=A.value)==null?void 0:_.statistics.all,achievements:l.value,tanks:t.tanksSessions,createAt:new Date(t.sessionUpdateAt).valueOf()}):ot.account({stat:($=w.value)==null?void 0:$.statistics.all,statDiff:(O=T.value)==null?void 0:O.statistics.all,achievements:t.accountAchievementsRaw,achievementsDiff:l.value,tanks:t.tanks,tanksDiff:t.tanksDiff.filter(W=>W.all.battles),createAt:((E=w.value)==null?void 0:E.created_at)*1e3,createAtSnapshot:new Date(t.sessionUpdateAt).valueOf()})}),D=F(()=>{var _,$,O;return!w.value||!A.value?ot.accountRating():t.sessionActive?ot.accountRating({stat:(_=A.value)==null?void 0:_.statistics.rating}):ot.accountRating({stat:($=w.value)==null?void 0:$.statistics.rating,diff:(O=T.value)==null?void 0:O.statistics.rating})}),x=F(()=>t.filters.battleMode==="random"?y.value:D.value);Ot(()=>t.sessionActive,()=>{kt(t.filters)}),Ot(()=>t.filters,async()=>{var _;Ft(t.filters),await Bt(),(_=r.value)==null||_.sortItems()});const M=K(!1);Rt(async()=>{await St(),M.value=!0});function B(){var _;return((_=t.tanksRaw)==null?void 0:_.map($=>{var E,W;const O=(E=t.tanksAchievementsRaw)==null?void 0:E.find(z=>z.tank_id===$.tank_id);return lt.accountTank($,((W=R.value)==null?void 0:W[$.tank_id])??null,O??null)}))??[]}function U(){var _;return((_=t.tanksRawSnapshot)==null?void 0:_.map($=>{var E,W;const O=(E=t.tanksAchievementsRawSnapshot)==null?void 0:E.find(z=>z.tank_id===$.tank_id);return lt.accountTank($,((W=R.value)==null?void 0:W[$.tank_id])??null,O??null)}))??[]}function X(_,$=!1){var rt,gt,bt;const O=((rt=t.tanksAchievementsRaw)==null?void 0:rt.find(mt=>mt.tank_id===_.tank_id))??null,E=((gt=t.tanksAchievementsRawSnapshot)==null?void 0:gt.find(mt=>mt.tank_id===_.tank_id))??null,W=O&&E?V.tankAchievementsDiff(O,E):null,z=((bt=R.value)==null?void 0:bt[_.tank_id])??null;return lt.accountTank(_,z,$?O:W)}function H(){var _;return((_=t.tanksRaw)==null?void 0:_.reduce(($,O)=>{var z;const E=(z=t.tanksRawSnapshot)==null?void 0:z.find(rt=>rt.tank_id===O.tank_id);if(!E)return $.push(X(O,!0)),$;if(O.all.battles===E.all.battles)return $;const W=O.battle_life_time-E.battle_life_time;return $.push(X({...O,battle_life_time:W,all:V.diff(O.all,E.all)})),$},[]))??[]}function ke(){return t.tanks.map(_=>{const $=t.tanksSnapshot.find(E=>_.tank_id===E.tank_id);if(!$)return _;const O=_.battle_life_time-$.battle_life_time;return{..._,all:V.diff(_.all,$.all),battle_life_time:O,achievements:V.tankAchievementsDiff(_.achievements,$.achievements)}})}function ge(){t.tanks=B(),t.tanksSnapshot=U(),t.tanksSessions=H(),t.tanksDiff=ke()}async function be(_){t.loading++;try{const{data:$}=await it.tanks.getAchievements({account_id:_});t.tanksAchievementsRaw=$[_]??null}catch($){j($,{title:"Получение достижений по технике игрока"})}t.loading--}async function we(_){t.loading++;try{const{data:$}=await it.account.getAchievements({account_id:_});t.accountAchievementsRaw=$[_]??null}catch($){j($,{title:"Получение достижений по аккаунту игрока"})}t.loading--}async function $e(_){t.loading++;try{const{data:$}=await it.account.getInfo({account_id:_,extra:"statistics.rating"});t.accountRaw=($==null?void 0:$[_])??null}catch($){j($,{title:"Получение данных аккаунта"})}t.loading--}async function Ae(_){R.value||await Se(),await Re(_)}async function Re(_){t.loading++;try{const{data:$}=await it.tanks.getStats({account_id:_});t.tanksRaw=$?$[_]:null}catch($){j($,{title:"Получение статистики по технике игрока"})}t.loading--}async function Se(){if(!R.value){t.loading++;try{await g.getTanksVehicles()}catch(_){j(_,{title:"Получение данных описания техники"})}t.loading--}}async function Te(){if(!C.value){t.loading++;try{await g.getAchievements()}catch(_){j(_,{title:"Получение описания достижений"})}t.loading--}}async function St(_=!1){var $;a.value&&(await Promise.all([Te(),$e(a.value),Ae(a.value),be(a.value),we(a.value)]),_||await Le(),(_||!t.accountRawSnapshot)&&await Ee(),ge(),Ft(t.filters),await Bt(),($=r.value)==null||$.sortItems())}function Ft(_){let $=t.sessionActive?t.tanksSessions:t.tanks;_.tankInGarage!==null&&($=$.filter(O=>typeof O.in_garage!="boolean"?!0:O.in_garage===(_.tankInGarage===1))),_.tankNation.length&&($=$.filter(O=>_.tankNation.includes(O.nation))),_.tankTire.length&&($=$.filter(O=>_.tankTire.includes(O.tier))),$=$.filter(O=>{const E=_.tankIsPremium;return E===!0?O.is_premium:E===!1?!O.is_premium:!0}),_.tankType.length&&($=$.filter(O=>_.tankType.includes(O.type))),t.tanksTableItems=$}function kt(_){t.filters=at(_)}function Ie(){t.filters=at(m)}async function Ce(){if(t.accountRaw){t.loading++;try{const _=await Z.indexedDB.accountsInfo.get(t.accountRaw.account_id);t.accountRawSnapshot=(_==null?void 0:_.data)??null,t.sessionUpdateAt=(_==null?void 0:_.timestamp)??0}catch(_){j(_,{title:"Загрузка локальных данных аккаунта"})}t.loading--}}async function De(){if(t.accountRaw){t.loading++;try{await Z.indexedDB.accountsInfo.set(t.accountRaw.account_id,wt(t.accountRaw)),t.accountRawSnapshot=at(t.accountRaw),t.sessionUpdateAt=Date.now()}catch(_){j(_,{title:"Сохранение локальных данных аккаунта"})}t.loading--}}async function Pe(){if(t.accountRaw){t.loading++;try{const _=await Z.indexedDB.accountsAchievements.get(t.accountRaw.account_id);t.accountAchievementsRawSnapshot=(_==null?void 0:_.data)??null,t.sessionUpdateAt=(_==null?void 0:_.timestamp)??0}catch(_){j(_,{title:"Загрузка локальных данных достижений аккаунта"})}t.loading--}}async function Oe(){if(!(!t.accountRaw||!t.accountAchievementsRaw)){t.loading++;try{await Z.indexedDB.accountsAchievements.set(t.accountRaw.account_id,wt(t.accountAchievementsRaw)),t.accountAchievementsRawSnapshot=at(t.accountAchievementsRaw)}catch(_){j(_,{title:"Сохранение локальных данных достижений аккаунта"})}t.loading--}}async function Be(){if(t.accountRaw){t.loading++;try{const _=await Z.indexedDB.tanksStat.get(t.accountRaw.account_id);t.tanksRawSnapshot=(_==null?void 0:_.data)??null}catch(_){j(_,{title:"Загрузка локальных данных техники"})}t.loading--}}async function xe(){if(!(!t.accountRaw||!t.tanksRaw)){t.loading++;try{await Z.indexedDB.tanksStat.set(t.accountRaw.account_id,wt(t.tanksRaw)),t.tanksRawSnapshot=at(t.tanksRaw),t.sessionUpdateAt=Date.now()}catch(_){j(_,{title:"Сохранение локальных данных техники"})}t.loading--}}async function Me(){if(t.accountRaw){t.loading++;try{const _=await Z.indexedDB.tanksAchievements.get(t.accountRaw.account_id);t.tanksAchievementsRawSnapshot=(_==null?void 0:_.data)??null}catch(_){j(_,{title:"Загрузка локальных данных достижений техники"})}t.loading--}}async function Ue(){if(!(!t.accountRaw||!t.tanksAchievementsRaw)){t.loading++;try{await Z.indexedDB.tanksAchievements.set(t.accountRaw.account_id,wt(t.tanksAchievementsRaw)),t.tanksAchievementsRawSnapshot=at(t.tanksAchievementsRaw),t.sessionUpdateAt=Date.now()}catch(_){j(_,{title:"Сохранение локальных данных достижений техники"})}t.loading--}}async function Le(){await Promise.all([Ce(),Pe(),Be(),Me()])}async function Ee(){await Promise.all([De(),Oe(),xe(),Ue()])}async function qe(){await St(!0)}function Fe(){St()}function Ne(_){var $;t.sessionActive?(t.currentTank=t.tanksSessions.find(O=>_===O.tank_id)??null,t.currentTankDiff=null):(t.currentTank=t.tanks.find(O=>_===O.tank_id)??null,t.currentTankDiff=t.tanksDiff.find(O=>_===O.tank_id)??null),($=c.value)==null||$.doOpen()}return(_,$)=>{var Nt;const O=Ha,E=Xn,W=is,z=na,rt=_s,gt=_e,bt=zs,mt=yi,Ve=Bl,je=he,He=dt,ze=zl,Ge=et,Ke=pt;return d(),v(G,null,[u(t).accountRaw?(d(),v("div",Gl,[p(z,{identity:"preview"},{default:S(()=>[n("div",Kl,[u(t).accountRaw.private?(d(),q(O,{key:0,resources:u(t).accountRaw.private},null,8,["resources"])):P("",!0)]),p(E,{loading:u(t).loading>0,class:"account-view__preview",account:u(t).accountRaw},null,8,["loading","account"]),p(W,{modelValue:u(t).sessionActive,"onUpdate:modelValue":$[0]||($[0]=Tt=>u(t).sessionActive=Tt),class:"account-view__session",loading:u(t).loading>0,"update-at":u(t).sessionUpdateAt,onReset:qe,onUpdate:Fe},null,8,["modelValue","loading","update-at"])]),_:1}),p(z,{title:"Статистика",identity:"statistic"},{default:S(()=>[p(rt,{filters:u(t).filters,metrics:u(x),loading:u(t).loading>0,onFilters:kt},null,8,["filters","metrics","loading"])]),_:1}),It(p(z,{title:"Достижения",identity:"achievements"},{default:S(()=>[u(f)&&u(C)?(d(),q(gt,{key:0,filters:u(t).filters,"achievements-info":u(C),achievements:u(f),onFiltersChanged:kt},null,8,["filters","achievements-info","achievements"])):P("",!0)]),_:1},512),[[Ct,u(t).filters.battleMode==="random"]]),!u(t).sessionActive&&u(t).filters.battleMode==="random"?(d(),q(z,{key:0,title:"Инфографика",identity:"tanksBattles"},{default:S(()=>[p(bt,{tanks:u(t).tanks},null,8,["tanks"])]),_:1})):P("",!0),!u(t).sessionActive&&u(R)?It((d(),q(z,{key:1,title:"Статистика по дням",identity:"dailyStat"},{default:S(()=>[p(mt,{vehicles:u(R),"account-id":u(t).accountRaw.account_id},null,8,["vehicles","account-id"])]),_:1},512)),[[Ct,u(t).filters.battleMode==="random"]]):P("",!0),It(p(z,{title:"Техника",identity:"tanks"},{default:S(()=>[p(Ve,{class:"account-view__filters",filters:u(t).filters,"default-filters":u(m),"is-private":u(o),onChange:kt,onClear:Ie},null,8,["filters","default-filters","is-private"]),p(je,{ref_key:"tableRef",ref:r,sort:u(h),loading:u(t).loading>0,"default-sort":b,tanks:u(t).tanksTableItems,"tanks-diff":u(t).tanksDiff,"achievements-info":u(C),"show-diff":!u(t).sessionActive,height:"calc(100vh - 90px)",onRowClick:Ne},null,8,["sort","loading","tanks","tanks-diff","achievements-info","show-diff"])]),_:1},512),[[Ct,u(t).filters.battleMode==="random"]])])):(d(),v("div",Wl,[u(M)?(d(),v("div",Xl,Yl)):P("",!0),p(He,{loading:!u(M)},null,8,["loading"])])),p(Ke,{ref_key:"tankDetailsRef",ref:c,width:"1100px",title:(Nt=u(t).currentTank)==null?void 0:Nt.name,onClosed:$[2]||($[2]=Tt=>u(t).currentTank=null)},{footer:S(()=>[n("div",Zl,[p(Ge,{onClick:$[1]||($[1]=Tt=>{var Vt;return(Vt=u(c))==null?void 0:Vt.doClose()})},{default:S(()=>[I(" Закрыть ")]),_:1})])]),default:S(()=>[u(C)&&u(t).currentTank?(d(),q(ze,{key:0,tank:u(t).currentTank,"tank-diff":u(t).currentTankDiff,"achievements-info":u(C)},null,8,["tank","tank-diff","achievements-info"])):P("",!0)]),_:1},8,["title"])],64)}}});export{Ac as _};
