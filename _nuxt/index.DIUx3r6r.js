import{_ as q}from"./CSelect.vue.E537XfLD.js";import{_ as N}from"./CImage.vue.CVGEczTm.js";import{_ as R}from"./nuxt-link.BEP6SH5y.js";import{_ as b}from"./ContentLoader.vue.BtDSbBtQ.js";import{f as T,i as x,o as u,c as _,F as C,A as k,a as n,t as m,b as d,d as w,C as j,k as r,g as O,h as A,n as $,s as D,q as F,y as H,j as U,w as I}from"./entry.CiLr91Wg.js";import{_ as M}from"./PageContent.vue.CLEy-xld.js";import{u as P}from"./disableScroll.DUPiWzNJ.js";import{a as L}from"./request.DLwZlOwo.js";import"./image-broken.BY5yfqBl.js";import"./nuxt-icon.D6encLCw.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./ContentBox.vue.CXIsIDnv.js";import"./CInput.vue.DjaOH7I-.js";import"./notEmpty.BxBPJGBn.js";import"./debounce.B98QxhRz.js";import"./CDialog.vue.CAe_H11n.js";import"./index.CCZU5IUk.js";import"./user.DP2m5fhC.js";import"./index.DckVOxso.js";import"./leader.BewdLDxQ.js";import"./client-only.BKegTxbq.js";import"./dark-mode.DXWXGq7Q.js";import"./light-mode.3ww4vHhL.js";const W={class:"tournaments-list"},G={class:"tournaments-list__section-title"},J={class:"tournaments-list__list"},K={class:"tournaments-list__item-img-wrapper"},Q={class:"tournaments-list__item-content"},X={class:"tournaments-list__item-title"},Y={class:"tournaments-list__item-tier"},Z={class:"tournaments-list__item-details"},tt={class:"tournaments-list__item-date"},st=T({__name:"TournamentsList",props:{tournaments:{type:Array,default:()=>[],required:!0},loading:{type:Boolean,default:!1}},setup(g){const f=g,h=x(()=>{const a={running:[],registration_started:[],registration_finished:[],upcoming:[],finished:[],complete:[]};return f.tournaments.forEach(t=>{a[t.status].push(t)}),Object.entries(a).map(([t,s])=>({status:t,list:s})).filter(t=>t.list.length)});function p(a){const t=a.description.match(/Уровень техники: (.+?)\./i);return t!=null&&t[1]?t==null?void 0:t[1]:""}return(a,t)=>{const s=N,v=R,y=b;return u(),_("div",W,[(u(!0),_(C,null,k(r(h),l=>(u(),_("div",{key:l.status,class:"tournaments-list__section"},[n("div",G,m(a.$formatter.tournament.status(l.status)),1),n("ul",J,[(u(!0),_(C,null,k(l.list,o=>(u(),_("li",{key:o.tournament_id,class:"tournaments-list__item"},[n("div",K,[d(s,{class:"tournaments-list__item-img",loading:"lazy",src:o.logo.original,alt:"image"},null,8,["src"])]),n("div",Q,[n("div",X,[w(m(o.title)+" ",1),n("div",Y,m(p(o)),1)]),n("div",Z,[n("div",tt,m(a.$formatter.date.toDateTime(o.start_at*1e3)),1),n("div",{class:j(["tournaments-list__item-status",["tournaments-list__item-status--"+o.status]])},m(a.$formatter.tournament.status(o.status)),3)])]),d(v,{class:"tournaments-list__item-link link",to:{name:"tournaments-id",params:{id:o.tournament_id}}},null,8,["to"])]))),128))])]))),128)),d(y,{loading:g.loading},null,8,["loading"])])}}}),et={class:"tournaments-page__filter"},nt={class:"tournaments-page__count"},ot=n("span",{class:"tournaments-page__count-title"}," Кол-во: ",-1),at={class:"tournaments-page__list"},Bt=T({__name:"index",setup(g){const f=[null,"upcoming","registration_started","registration_finished","running","finished","complete"],h=P(),p=O(),a=A(),t=$({loading:0,tournaments:[],status:null}),s=$({page:1,pageSize:25,total:0}),v=$(f.map(e=>({label:e?D.tournament.status(e):"Все",value:e}))),y=x(()=>s.total>s.page*s.pageSize);F(async()=>{var e;t.status=((e=p.query)==null?void 0:e.status)??null,S(),await o(),window.addEventListener("scroll",l)}),H(()=>{window.removeEventListener("scroll",l)});function l(){const{scrollTop:e,scrollHeight:i,clientHeight:c}=document.documentElement;t.loading===0&&y.value&&e+c>=i-100&&(s.page+=1,o())}async function o(){t.loading++;try{if(t.status===null&&s.page===1){const c=await L.tournaments.getList({limit:s.pageSize,status:"running"});t.tournaments.push(...c.data)}const e=["upcoming","registration_started","registration_finished","finished","complete"].join(","),i=await L.tournaments.getList({limit:s.pageSize,page_no:s.page,status:t.status??e});s.total=i.meta.total,t.tournaments.push(...i.data)}catch(e){h.add({type:"error",title:"Получение списка турниров",message:e instanceof Error?e.message:"Неизвестная ошибка"}),console.error(e)}t.loading--}function S(){a.replace({query:{...p.query,status:t.status||null}}).catch(()=>{})}function z(){s.page=1,t.tournaments=[],S(),o()}return(e,i)=>{const c=q,B=st,E=M;return u(),U(E,{class:"tournaments-page"},{default:I(()=>[n("div",et,[w(" По статусу: "),d(c,{modelValue:r(t).status,"onUpdate:modelValue":i[0]||(i[0]=V=>r(t).status=V),style:{width:"200px"},options:r(v),onChange:z},null,8,["modelValue","options"])]),n("div",nt,[ot,w(" "+m(r(s).total),1)]),n("div",at,[d(B,{tournaments:r(t).tournaments,loading:r(t).loading>0},null,8,["tournaments","loading"])])]),_:1})}}});export{Bt as default};
