import{u as gt,h as A,_ as ft,a as ht}from"./disableScroll.DDlwJlcl.js";import{_ as vt,a as bt}from"./CSelect.vue.B4ErcSKo.js";import{f as D,v as K,x as wt,r as U,i as yt,o as m,c as f,a as n,O as Ct,V as kt,K as q,k as c,g as xt,h as At,n as z,s as E,q as Vt,m as R,b as l,w as u,F as M,A as O,C as St,t as N,T as $t,d as S,W as It,j as Bt}from"./entry.ctIX2KUb.js";import{_ as qt}from"./nuxt-link.C4UY2yYj.js";import{_ as Pt}from"./CDialog.vue.B3NqeRuW.js";import{c as Q}from"./cloneDeep.D2VMXt5F.js";import{u as Rt}from"./user.DYZIlJiw.js";import{f as T}from"./index.DmknSq2w.js";import{a as I}from"./request.C9u4Wmp-.js";import{a as B}from"./index.VOeJb_dr.js";import{_ as Mt}from"./PageSection.vue.Ba-0kVIV.js";import{_ as Ot}from"./PageContent.vue.BrPWj8J-.js";import"./isArrayLike.BUSTlxXz.js";import"./ContentBox.vue.P4GZ3NJK.js";import"./CInput.vue.DyZig88L.js";import"./notEmpty.BxBPJGBn.js";import"./debounce.C8GFgnJ3.js";import"./index.CNUfbNKa.js";import"./leader.BrrCgns1.js";import"./nuxt-icon.CmJtK45D.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./client-only.vVwufuq4.js";import"./dark-mode.D05sLCSW.js";import"./light-mode.cIfBeaYA.js";const Nt={class:"c-input-range__inner"},Tt={class:"c-input-range__input"},Ut=["max","min","step"],Dt=D({__name:"CInputRange",props:K({min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},width:{type:String,default:void 0}},{modelValue:{required:!0,default:0},modelModifiers:{}}),emits:K(["keyup","keydown","input","change"],["update:modelValue"]),setup(h,{expose:$,emit:w}){const y=h,C=wt(h,"modelValue"),k=U(),v=yt(()=>{const _=(y.max-y.min)/100;return Math.round(C.value/_)}),o=w;return $({focus:()=>{var _;(_=k.value)==null||_.focus()},blur:()=>{var _;(_=k.value)==null||_.blur()}}),(_,r)=>(m(),f("div",{class:"c-input-range",style:q({width:h.width})},[n("div",Nt,[n("div",Tt,[Ct(n("input",{ref_key:"inputRef",ref:k,"onUpdate:modelValue":r[0]||(r[0]=d=>C.value=d),max:h.max,min:h.min,step:h.step,type:"range",class:"c-input-range__input-element",onInput:r[1]||(r[1]=d=>o("input",d)),onChange:r[2]||(r[2]=d=>o("change",d)),onKeyup:r[3]||(r[3]=d=>o("keyup")),onKeydown:r[4]||(r[4]=d=>o("keydown"))},null,40,Ut),[[kt,C.value,void 0,{number:!0}]]),n("span",{class:"c-input-range__input-thumb",style:q({transform:`translateX(${c(v)-100}%)`})},null,4)])])],4))}}),Wt={class:"widget-account-stat-constructor"},Ft={class:"widget-account-stat-constructor__inner"},Gt={class:"widget-account-stat-constructor__description"},Lt={class:"content-area"},jt={key:0,style:{color:"var(--color-red)"}},Kt=n("p",null," Виджет для слежения за изменениями статистики вашего аккаунта. Используется в инструментах для стрима наподобие OBS Studio. Обновление статистики происходит 1 раз в 30 секунд. Сессия независима от аналогичной на странице аккаунта, по этому можно поделиться ссылкой. Выберите количество атрибутов и измените ширину окна браузера и плитки автоматически перестроятся на следующую линию. ",-1),zt=It('<div class="content-area"><h4>&quot;Командная игра&quot;</h4><p><i>Конфигурация =&gt; Командная игра</i></p><p> В игре участвует 2 и более взвода. Всем Участникам следует запустить сессию в одно время. Играется серия из определённого кол-ва боёв. После окончания сессии очки взвода суммируются. Победил взвод набравший больше очков. Счёт отображает атрибут - &quot;Командная игра&quot; </p><blockquote>Важно! Сессия не должна прерываться боями в &quot;Обычном режиме&quot;.</blockquote><table><tbody style="width:360px;"><tr style="text-align:left;"><th>Действие</th><th>Очки</th></tr><tr><td>Единица урона</td><td>+1</td></tr><tr><td>Победа</td><td>+500</td></tr><tr><td>Медаль &quot;Братья по оружию&quot;</td><td>+750</td></tr><tr><td>Медаль &quot;Решающий вклад&quot;</td><td>+1750</td></tr></tbody></table></div>',1),Et={class:"widget-account-stat-constructor__params"},Qt={class:"widget-account-stat-constructor__param"},Xt=n("div",{class:"widget-account-stat-constructor__param-title"}," Атрибуты ",-1),Ht={class:"widget-account-stat-constructor__param-options"},Jt=["onClick"],Yt={key:0,class:"widget-account-stat-constructor__attributes-control"},Zt={class:"widget-account-stat-constructor__param"},te=n("div",{class:"widget-account-stat-constructor__param-title"}," Конфигурация ",-1),ee={class:"widget-account-stat-constructor__param-options"},ne={class:"widget-account-stat-constructor__param"},oe=n("div",{class:"widget-account-stat-constructor__param-title"}," Режим боя ",-1),se={class:"widget-account-stat-constructor__param-options"},ae={class:"widget-account-stat-constructor__param"},ce=n("div",{class:"widget-account-stat-constructor__param-title"}," Цвет текста ",-1),ie={class:"widget-account-stat-constructor__param-options"},le={class:"widget-account-stat-constructor__checkbox-group"},re={class:"widget-account-stat-constructor__param"},ue=n("div",{class:"widget-account-stat-constructor__param-title"}," Цвет фона ",-1),de={class:"widget-account-stat-constructor__param-options"},_e={class:"widget-account-stat-constructor__checkbox-group"},me={class:"widget-account-stat-constructor__param"},pe=n("div",{class:"widget-account-stat-constructor__param-title"}," Прозрачность фона ",-1),ge={class:"widget-account-stat-constructor__param-options"},fe={style:{margin:"0 0 0 10px"}},he={key:0,class:"widget-account-stat-constructor__panel"},ve={class:"content-area"},be={style:{"white-space":"nowrap"}},we=n("p",null,"Начать новую?",-1),ye={style:{display:"flex","justify-content":"flex-end"}},Ce=D({__name:"WidgetAccountSessionConstructor",setup(h){const $=["battles","winRate","damagePerBattle","fragPerBattle","surviveRate","hitRate","spottedPerBattle","xpPerBattle","markOfMastery","medalBrothersInArms","medalCrucialContribution","teamGamePoints"],w=U(null),y=xt(),C=At(),k=gt(),v=Rt(),o=z({loading:0,account:null,achievementsInfo:null,accountAchievements:null,tanksAchievements:null,tanks:null,sessionUpdateAt:null}),W=[{value:null,label:"Обычный"},{value:"rating",label:"Рейтинговый"}],F=[{value:"default",label:"По умолчанию"},{value:"teamGamePoints",label:"Командная игра"}],_=["white","black"],r=["white","black","grey","green","orange","red","purple","blue"],d=T.makeAccountSessionWidgetFilters({battleMode:null,attributes:["battles","winRate","damagePerBattle"],style:"tile",textColor:"white",bgColor:"black",bgColorOpacity:.5}),a=z(Q(d)),p=U($.map(t=>({key:t,isVisible:!1,label:E.stat.accountProp(t)??t})));Vt(async()=>{Object.assign(a,T.makeAccountSessionWidgetFilters({...Q(d),...y.query})),b(),await ot(),G()});function X(){a.config==="default"&&(a.attributes=d.attributes),a.config==="teamGamePoints"&&(a.attributes=["battles","winRate","damagePerBattle","medalBrothersInArms","medalCrucialContribution","teamGamePoints"])}function G(){p.value=$.map(t=>{var g,x;const e=(g=o.achievementsInfo)==null?void 0:g[t],i=((x=a.attributes)==null?void 0:x.includes(t))??!1;return e?{key:t,isVisible:i,label:String(e.name).replace(/\([^)]+\)/gi,"")??t}:{key:t,isVisible:i,label:E.stat.accountProp(t)??t}}),P()}function b(){C.replace({query:T.toRouteQuery(a)}).catch(()=>null)}function H(t){a.textColor=t,b()}function J(t){a.bgColor=t,b()}function P(){p.value.sort((t,e)=>!t.isVisible&&e.isVisible?1:t.isVisible&&!e.isVisible?-1:0)}function Y(t){const e=p.value.findIndex(i=>i.key===t.key);e!==-1&&(p.value[e].isVisible=!t.isVisible,a.attributes=p.value.filter(i=>i.isVisible).map(i=>i.key),a.config=null,P(),b())}function Z(t,e){const i=p.value.findIndex(x=>x.key===t.key);if(i===-1)return;const g=p.value.splice(i,1);p.value.splice(e?i-1:i+1,0,...g),P(),b()}function tt(){X(),G(),b()}function et(){b()}function nt(){b()}async function ot(){o.loading++;try{const{data:t}=await I.encyclopedia.getAchievements();o.achievementsInfo=t??null}catch(t){A(t,{title:"Получение описания достижений"})}o.loading--}async function st(t){o.loading++;try{const{data:e}=await I.account.getInfo({account_id:t,extra:"statistics.rating"});o.account=(e==null?void 0:e[t])??null}catch(e){A(e,{title:"Получение данных игрока"})}o.loading--}async function at(t){o.loading++;try{const{data:e}=await I.account.getAchievements({account_id:t});o.accountAchievements=(e==null?void 0:e[t])??null}catch(e){A(e,{title:"Получение достижений игрока"})}o.loading--}async function ct(t){o.loading++;try{const{data:e}=await I.tanks.getAchievements({account_id:t});o.tanksAchievements=(e==null?void 0:e[t])??null}catch(e){A(e,{title:"Получение достижений техники игрока"})}o.loading--}async function it(t){o.loading++;try{const{data:e}=await I.tanks.getStats({account_id:t});o.tanks=e?e[t]:null}catch(e){A(e,{title:"Получение статистики по технике игрока"})}o.loading--}async function L(){const t=v.accountId;if(t&&(await Promise.all([st(t),at(t),ct(t),it(t)]),!(!o.account||!o.accountAchievements||!o.tanks||!o.tanksAchievements))){try{await Promise.all([B.session.account.set(t,o.account),B.session.accountAchievements.set(t,o.accountAchievements),B.session.tanks.set(t,o.tanks),B.session.tanksAchievements.set(t,o.tanksAchievements)]),k.add({type:"success",message:"Новая сессия успешно запущена"})}catch(e){A(e,{title:"Начало новой сессии"})}o.account=null,o.accountAchievements=null,o.tanks=null,o.tanksAchievements=null}}async function lt(){var t;await((t=w.value)==null?void 0:t.doClose()),await L()}async function rt(t){try{const{data:e}=await B.session.account.getList({ids:[t]});return e[0]??null}catch(e){return A(e,{title:"Получение сессии игрока"}),null}}async function ut(){var i;const t=v.accountId;if(!t)return;const e=await rt(t);e?(o.sessionUpdateAt=e.updateAt,await((i=w.value)==null?void 0:i.doOpen())):await L()}return(t,e)=>{const i=ft,g=ht,x=vt,j=bt,dt=Dt,_t=qt,mt=Pt;return m(),f("div",Wt,[n("div",Ft,[n("div",Gt,[n("div",Lt,[c(v).accountId?R("",!0):(m(),f("p",jt," Создать виджет могут только авторизованные пользователи. ")),Kt]),zt]),n("div",Et,[n("div",Qt,[Xt,n("div",Ht,[l($t,{tag:"div",class:"widget-account-stat-constructor__attributes",name:"widget-account-stat-constructor__attributes-"},{default:u(()=>[(m(!0),f(M,null,O(c(p),(s,V)=>(m(),f("div",{key:s.key,class:St(["widget-account-stat-constructor__attributes-item",[s.isVisible?"widget-account-stat-constructor__attributes-item--is-visible":""]])},[n("button",{class:"widget-account-stat-constructor__attributes-label",onClick:pt=>Y(s)},N(s.label),9,Jt),s.isVisible?(m(),f("span",Yt,[l(g,{"is-text":"","is-square":"",disabled:V===0,class:"widget-account-stat-constructor__attributes-btn",onClick:pt=>Z(s,!0)},{default:u(()=>[l(i,{name:"swipe-up"})]),_:2},1032,["disabled","onClick"])])):R("",!0)],2))),128))]),_:1})])]),n("div",Zt,[te,n("div",ee,[l(x,{modelValue:c(a).config,"onUpdate:modelValue":e[0]||(e[0]=s=>c(a).config=s),width:"200px",options:F,onChange:tt},null,8,["modelValue"])])]),n("div",ne,[oe,n("div",se,[l(x,{modelValue:c(a).battleMode,"onUpdate:modelValue":e[1]||(e[1]=s=>c(a).battleMode=s),width:"200px",options:W,onChange:et},null,8,["modelValue"])])]),n("div",ae,[ce,n("div",ie,[n("div",le,[(m(),f(M,null,O(_,s=>l(j,{key:s,"model-value":c(a).textColor===s,class:"widget-account-stat-constructor__checkbox",onChange:V=>H(s)},{default:u(()=>[n("span",{style:q({color:`var(--color-${s})`}),class:"widget-account-stat-constructor__color-pick"},null,4)]),_:2},1032,["model-value","onChange"])),64))])])]),n("div",re,[ue,n("div",de,[n("div",_e,[(m(),f(M,null,O(r,s=>l(j,{key:s,"model-value":c(a).bgColor===s,class:"widget-account-stat-constructor__checkbox",title:c(a).textColor,onChange:V=>J(s)},{default:u(()=>[n("span",{style:q({color:`var(--color-${s})`}),class:"widget-account-stat-constructor__color-pick"},null,4)]),_:2},1032,["model-value","title","onChange"])),64))])])]),n("div",me,[pe,n("div",ge,[l(dt,{modelValue:c(a).bgColorOpacity,"onUpdate:modelValue":e[2]||(e[2]=s=>c(a).bgColorOpacity=s),width:"200px",min:0,max:1,step:.1,onInput:nt},null,8,["modelValue"]),n("span",fe,N((c(a).bgColorOpacity||0)*100)+"% ",1)])])]),c(v).accountId?(m(),f("div",he,[l(g,{disabled:!c(v).accountId,class:"widget-account-stat-constructor__btn",onClick:ut},{default:u(()=>[S(" Начать сессию ")]),_:1},8,["disabled"]),l(_t,{class:"widget-account-stat-constructor__btn link",to:{name:"widgets-account-session",query:{...c(y).query,accountId:String(c(v).accountId)}},target:"_blank"},{default:u(()=>[S(" Перейти к виджету ")]),_:1},8,["to"])])):R("",!0)]),l(mt,{ref_key:"confirmDialogRef",ref:w,width:"400px",title:"Запуск новой сессии"},{footer:u(()=>[n("div",ye,[l(g,{style:{margin:"0 4px 0 0"},onClick:e[3]||(e[3]=s=>{var V;return(V=c(w))==null?void 0:V.doClose()})},{default:u(()=>[S(" Отмена ")]),_:1}),l(g,{class:"widget-account-stat-constructor__btn",onClick:lt},{default:u(()=>[S(" Так точно! ")]),_:1})])]),default:u(()=>[n("div",ve,[n("p",null,[S(" Текущая сессия от "),n("span",be,N(t.$formatter.date.toDateTime(c(o).sessionUpdateAt??0)),1),S(". ")]),we])]),_:1},512)])}}}),Ee=D({__name:"index",setup(h){return($,w)=>{const y=Ce,C=Mt,k=Ot;return m(),Bt(k,{class:"main-widgets"},{default:u(()=>[l(C,{title:"Статистика аккаунта",identity:"account-stat"},{default:u(()=>[l(y)]),_:1})]),_:1})}}});export{Ee as default};
