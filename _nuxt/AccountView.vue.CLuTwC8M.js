import{N as Ee}from"./nuxt-icon.tdHFESbn.js";import{J as qe,o as d,c as k,a as n,f as j,i as V,s as x,b as v,C as J,k as r,t as w,m as P,r as K,n as Y,j as q,w as S,d as I,F as z,A as Q,q as Te,v as Re,x as pe,y as it,T as lt,D as Fe,E as ae,_ as ne,K as Ne,L as Kt,G as ue,M as Wt,z as Ve,N as ee,O as Le,g as Xt,P as Oe,Q as Be,H as $e}from"./entry.38LME4ko.js";import{_ as Jt,m as ce}from"./RatingIcon.vue.AZcrHJ_E.js";import{_ as ct}from"./nuxt-link.C3WD0srD.js";import{_ as he,h as H,u as Qt,t as Me,d as ze}from"./disableScroll.bcJx9LND.js";import{_ as se}from"./UiButton.vue.BlJ_24Cx.js";import{_ as de,a as le,s as Z}from"./request.BVKHoC5m.js";import{_ as ve,a as Yt,i as Zt,g as ea}from"./UiDialog.vue.Bpz9VH2j.js";import{a as fe}from"./index.DK8OZMT_.js";import{c as ta,_ as rt,m as ie}from"./index.CzQlFA_7.js";import{a as _e,_ as ut}from"./UiSelect.vue.BQ5c_oUP.js";import{u as dt}from"./index.DhpBw61k.js";import{_ as aa}from"./PageSection.vue.It1jKV2c.js";import{_ as Ce}from"./UiImage.vue.ZBtbc598.js";import{f as _t,m as na}from"./index.DffU479S.js";import{_ as Ie}from"./WinRate.vue.FhVOgqcP.js";import{_ as mt,i as sa}from"./UiTable.vue.B4pWOS1Y.js";import{_ as oa}from"./client-only.CxqVZBjJ.js";import{s as N}from"./index.Cd8-L_Oi.js";import{_ as ia,a as la,b as ca,d as ra,e as ua,i as da,f as _a,g as ma,c as te}from"./cloneDeep.B1K45FHD.js";import{e as fa}from"./isArrayLike.6mJUJ9T0.js";import{u as pa}from"./user.BzIqZnQp.js";import{u as ha}from"./index.CesnwhB4.js";const va={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"},ka=n("path",{fill:"currentColor","fill-rule":"evenodd",d:"M28.5 43c8.56 0 15.5-3.134 15.5-7v6c0 3.866-6.94 7-15.5 7S13 45.866 13 42v-6c0 3.866 6.94 7 15.5 7","clip-rule":"evenodd"},null,-1),ya=n("path",{fill:"currentColor","fill-rule":"evenodd",d:"M34.5 36c8.56 0 15.5-3.134 15.5-7v6c0 3.866-6.94 7-15.5 7S19 38.866 19 35v-6c0 3.866 6.94 7 15.5 7","clip-rule":"evenodd"},null,-1),ga=n("path",{fill:"currentColor","fill-rule":"evenodd",d:"M44 19c0 3.866-6.94 7-15.5 7S13 22.866 13 19v6c0 3.866 6.94 7 15.5 7S44 28.866 44 25zm-1 0c0 1.296-1.21 2.8-3.951 4.038C36.4 24.234 32.672 25 28.5 25s-7.9-.766-10.549-1.962C15.211 21.801 14 20.296 14 19s1.21-2.8 3.951-4.038C20.6 13.766 24.328 13 28.5 13s7.9.766 10.549 1.962C41.789 16.199 43 17.704 43 19","clip-rule":"evenodd"},null,-1),ba=[ka,ya,ga];function wa(t,c){return d(),k("svg",va,[...ba])}const Ke={render(){return qe(Ee,{icon:{render:wa},name:"gold"})}},$a={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"},Aa=n("path",{stroke:"currentColor","stroke-width":"4",d:"m31 13.472 3.486 10.73.45 1.382H47.67l-9.127 6.63-1.176.855.45 1.382 3.486 10.73-9.127-6.632L31 37.695l-1.176.854-9.127 6.631 3.487-10.73.449-1.381-1.176-.854-9.127-6.631h12.735l.449-1.382z"},null,-1),Ra=[Aa];function Sa(t,c){return d(),k("svg",$a,[...Ra])}const Ta={render(){return qe(Ee,{icon:{render:Sa},name:"xp"})}},Ca={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 62 62"},Ia=n("path",{fill:"currentColor","fill-rule":"evenodd",d:"M49.306 27.104 44.133 9l9.483 11.574zm-14.426 25L56 23.654v13.793l-14.655 7.759h12.069l-7.759 5.172zm-21.552-25L18.5 9 9.017 20.574zm13.793 25L6 23.656v13.793l14.655 7.758H8.586l7.759 5.173zM21 20l10-4 10 4v16l-10 8-10-8zm6 12.5L29 22l5.5-1-2 7 4-.5-7 11 2-8z","clip-rule":"evenodd"},null,-1),Da=[Ia];function Pa(t,c){return d(),k("svg",Ca,[...Da])}const Oa={render(){return qe(Ee,{icon:{render:Pa},name:"prem"})}},Ba={class:"account-resources"},Ma={class:"account-resources__inner"},xa={key:0,class:"account-resources__item"},Ua={class:"account-resources__text"},Va={class:"account-resources__item"},La={class:"account-resources__text"},Ea={class:"account-resources__item"},qa={class:"account-resources__text"},Fa={class:"account-resources__item"},Na={class:"account-resources__text"},ja=j({__name:"AccountResources",props:{resources:{type:Object,required:!0,default:()=>({})}},setup(t){const c=t,s=V(()=>{const h=c.resources.premium_expires_at*1e3;return h-Date.now()<=0?"":x.date.toTimePassed(h,Date.now(),!0)});return(h,i)=>(d(),k("div",Ba,[n("div",Ma,[t.resources.is_premium.toLocaleString()?(d(),k("div",xa,[v(r(Oa),{filled:!0,"font-controlled":!1,class:J(["account-resources__icon",[{"account-resources__icon--prem":r(s)}]])},null,8,["class"]),n("div",Ua,w(r(s)||"0 дн."),1)])):P("",!0),n("div",Va,[v(r(Ke),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--gold"}),n("div",La,w(t.resources.gold.toLocaleString()),1)]),n("div",Ea,[v(r(Ke),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--credits"}),n("div",qa,w(t.resources.credits.toLocaleString()),1)]),n("div",Fa,[v(r(Ta),{filled:!0,"font-controlled":!1,class:"account-resources__icon account-resources__icon--xp"}),n("div",Na,w(t.resources.free_xp.toLocaleString()),1)])])]))}}),Ha={class:"account-preview-details__body"},Ga={class:"account-preview-details__section"},za={class:"account-preview-details__props-title"},Ka={class:"account-preview-details__props"},Wa={class:"account-preview-details__prop"},Xa=n("span",{class:"account-preview-details__prop-title"}," Дата создания ",-1),Ja={class:"account-preview-details__prop"},Qa=n("span",{class:"account-preview-details__prop-title"}," Дата обновления ",-1),Ya={key:0,class:"account-preview-details__section"},Za={class:"account-preview-details__props-title"},en={class:"account-preview-details__props"},tn={class:"account-preview-details__prop"},an=n("span",{class:"account-preview-details__prop-title"}," Зарегистрирован ",-1),nn={class:"account-preview-details__prop"},sn=n("span",{class:"account-preview-details__prop-title"}," Последний визит ",-1),on={class:"account-preview-details__section"},ln={class:"account-preview-details__props-title"},cn={key:0,class:"account-preview-details__props"},rn={class:"account-preview-details__prop"},un=n("span",{class:"account-preview-details__prop-title"}," Командир ",-1),dn={class:"account-preview-details__prop"},_n=n("span",{class:"account-preview-details__prop-title"}," Участников ",-1),mn={class:"account-preview-details__prop"},fn=n("span",{class:"account-preview-details__prop-title"}," Создан ",-1),pn={class:"account-preview-details__prop"},hn=n("span",{class:"account-preview-details__prop-title"}," Роль ",-1),vn={class:"account-preview-details__prop"},kn=n("span",{class:"account-preview-details__prop-title"}," Вступил ",-1),yn={key:1,class:"account-preview-details__props"},gn=n("div",{class:"account-preview-details__prop"}," Не состоит в клане ",-1),bn=[gn],wn={key:1,class:"account-preview-details__section"},$n={class:"account-preview-details__props-title"},An={class:"account-preview-details__props"},Rn={class:"account-preview-details__prop"},Sn=n("span",{class:"account-preview-details__prop-title"}," Отражаются только те дни в которые произошла смена клана или должности. Данные собираются со дня регистрации на сайте. ",-1),Tn={key:0,class:"account-preview-details__clan-history"},Cn={class:"account-preview-details__clan-history-date"},In={key:1,class:"account-preview-details__clan-history-link"},Dn={style:{display:"flex","justify-content":"space-between"}},Pn=n("span",null,null,-1),On=j({__name:"AccountPreviewDetails",props:{account:{type:[Object,null],required:!0},clanAccount:{type:[Object,null],required:!0}},setup(t,{expose:c}){const s=t,h=K(null),i=Y({user:null,clan:null,clanHistory:[],loading:0,isOpened:!1});async function f(a){i.loading++;try{const{data:o}=await le.clan.getInfo({clan_id:a});i.clan=o?o[a]:null}catch(o){H(o,{title:"Получение данных клана"})}i.loading--}async function $(a){i.loading++;try{const{data:o}=await fe.user.get(a);i.user=o}catch(o){if(fe.isResponse(o)&&o.status===404)return;H(o,{title:"Получение данных пользователя"})}finally{i.loading--}}async function g(a){i.loading++;try{const{data:o}=await le.clan.getInfo({clan_id:a.join(","),fields:"clan_id,name,tag"});return o??null}catch(o){return H(o,{title:"Получение данных кланов"}),null}finally{i.loading--}}function A(a,o){i.clanHistory=a.map((_,y,m)=>{const{raw:p,timestamp:R}=_,D=p&&o?o[p.clan_id]:null,M=`[${(D==null?void 0:D.tag)??"Deleted"}]`,L=m.length-1===y,B=a[y-1],E=x.date.toDaysPassed(R,B==null?void 0:B.timestamp);return{key:R,date:`${x.date.toDate(R)} (${L?" ... ":E})`,info:p?`${M} ${x.clan.role(p.role)}`:"Не в клане",clanId:(p==null?void 0:p.clan_id)??null}})}async function e(a){i.loading++;try{const{data:o}=await fe.stat.clansAccounts.getActivityList({id:a});return o??[]}catch(o){return H(o,{title:"Получение данных пользователя"}),[]}finally{i.loading--}}async function T(){var o;if(i.isOpened||!s.account||(i.isOpened=!0,(o=s.clanAccount)!=null&&o.clan_id&&await f(s.clanAccount.clan_id),await $(s.account.account_id),!i.user))return;const a=await e(s.account.account_id);if(a.length){const _=a.filter(({raw:m})=>m==null?void 0:m.clan_id).map(({raw:m})=>m==null?void 0:m.clan_id),y=await g(_);A(a,y)}}function C(){var a;(a=h.value)==null||a.doClose()}async function l(){var a;await T(),await((a=h.value)==null?void 0:a.doOpen())}return c({close:C,open:l}),(a,o)=>{const _=he,y=ct,m=de,p=se,R=ve;return t.account?(d(),q(R,{key:0,ref_key:"detailedDialogRef",ref:h,class:"account-preview-details",title:"Дополнительная информация",width:"600px"},{footer:S(()=>[n("div",Dn,[Pn,v(p,{onClick:C},{default:S(()=>[I(" Закрыть ")]),_:1})])]),default:S(()=>{var D,M,L,B;return[n("div",Ha,[n("div",Ga,[n("h5",za,[v(_,{class:"account-preview-details__prop-title-icon",name:"sports-esports"}),I(" Аккаунт игрока ")]),n("div",Ka,[n("div",Wa,[Xa,I(" "+w(a.$formatter.date.toDate(t.account.created_at*1e3)),1)]),n("div",Ja,[Qa,I(" "+w(a.$formatter.date.toDate(t.account.updated_at*1e3)),1)])])]),r(i).user?(d(),k("div",Ya,[n("h5",Za,[v(_,{class:"account-preview-details__prop-title-icon",name:"person"}),I(" Пользователь ресурса ")]),n("div",en,[n("div",tn,[an,I(" "+w(a.$formatter.date.toDate(((D=r(i).user)==null?void 0:D.createAt)??0)),1)]),n("div",nn,[sn,I(" "+w(a.$formatter.date.toDate(((M=r(i).user)==null?void 0:M.visitedAt)??0)),1)])])])):P("",!0),n("div",on,[n("h5",ln,[v(_,{class:"account-preview-details__prop-title-icon",name:"groups"}),I(" Клан игрока ")]),r(i).clan&&t.clanAccount?(d(),k("div",cn,[n("div",rn,[un,r(i).clan.leader_id?(d(),q(y,{key:0,class:"account-preview-details__clan-history-link link",to:{name:"account-id",params:{id:r(i).clan.leader_id}}},{default:S(()=>{var E;return[I(w((E=r(i).clan)==null?void 0:E.leader_name),1)]}),_:1},8,["to"])):P("",!0)]),n("div",dn,[_n,I(" "+w(a.$formatter.number.toInteger((L=r(i).clan)==null?void 0:L.members_count)),1)]),n("div",mn,[fn,I(" "+w(a.$formatter.date.toDate(((B=r(i).clan)==null?void 0:B.created_at)*1e3)),1)]),n("div",pn,[hn,I(" "+w(a.$formatter.clan.role(t.clanAccount.role)),1)]),n("div",vn,[kn,I(" "+w(a.$formatter.date.toDate(t.clanAccount.joined_at*1e3))+" ("+w(a.$formatter.date.toDaysPassed(t.clanAccount.joined_at*1e3))+") ",1)])])):(d(),k("div",yn,bn))]),r(i).user?(d(),k("div",wn,[n("h5",$n,[v(_,{class:"account-preview-details__prop-title-icon",name:"history"}),I(" Клановая история ")]),n("div",An,[n("div",Rn,[Sn,r(i).clanHistory.length?(d(),k("div",Tn,[(d(!0),k(z,null,Q(r(i).clanHistory,E=>(d(),k("div",{key:E.key,class:"account-preview-details__clan-history-item"},[n("span",Cn,w(E.date),1),E.clanId?(d(),q(y,{key:0,class:"account-preview-details__clan-history-link link",to:{name:"clan-id",params:{id:E.clanId}}},{default:S(()=>[I(w(E.info),1)]),_:2},1032,["to"])):(d(),k("span",In,w(E.info),1))]))),128))])):(d(),k(z,{key:1},[I(" Данные собираются. ")],64))])])])):P("",!0)]),v(m,{"backdrop-light":"",loading:r(i).loading>0},null,8,["loading"])]}),_:1},512)):P("",!0)}}}),Bn={class:"account-preview"},Mn={key:0,class:"account-preview__inner"},xn={class:"account-preview__league"},Un={class:"account-preview__info"},Vn={class:"account-preview__nickname"},Ln={class:"account-preview__nickname-text"},En={class:"account-preview__clan-text"},qn={class:"account-preview__props"},Fn={class:"account-preview__prop"},Nn=n("span",{class:"account-preview__prop-title"}," Последний бой ",-1),jn={class:"account-preview__prop-value"},Hn={key:0,class:"account-preview__prop"},Gn=n("span",{class:"account-preview__prop-title"}," Должность ",-1),zn={class:"account-preview__prop-value"},Kn={class:"account-preview__actions"},Wn=j({__name:"AccountPreview",props:{account:{type:[Object,null],default:null,required:!0},loading:{type:Boolean,default:!1}},setup(t){const c=K(null),s=t,h=Qt(),i=Y({clanAccount:null,isFavorite:!0,clan:null,detailsLoading:!1}),f=V(()=>{var l;return(l=i.clanAccount)==null?void 0:l.clan});Te(()=>{var a,o;A(),((a=s.account)==null?void 0:a.account_id)&&$((o=s.account)==null?void 0:o.account_id)});async function $(l){try{const{data:a}=await le.clan.getAccountInfo({account_id:l,extra:"clan"});i.clanAccount=a?a[l]:null}catch(a){H(a,{title:"Получение данных клана"})}}async function g(){var l;i.detailsLoading=!0,await((l=c.value)==null?void 0:l.open()),i.detailsLoading=!1}async function A(){if(!s.account)return;const l=await Z.indexedDB.accountsFavorites.get(s.account.account_id);i.isFavorite=l?l==null?void 0:l.isFavorite:!1}async function e(){s.account&&(i.isFavorite=!i.isFavorite,await Z.indexedDB.accountsFavorites.set(s.account.account_id,{id:s.account.account_id,isFavorite:i.isFavorite}))}function T(){e()}async function C(){var a,o,_,y;await ta(`${(a=s.account)==null?void 0:a.nickname}/${(o=s.account)==null?void 0:o.account_id}`)?h.add({type:"success",title:"Скопировано",message:`${(_=s.account)==null?void 0:_.nickname}/${(y=s.account)==null?void 0:y.account_id}`,duration:3e3}):h.add({type:"error",message:"При копировании что-то пошло не так",duration:3e3})}return(l,a)=>{var D;const o=Jt,_=ct,y=he,m=se,p=de,R=On;return d(),k("div",Bn,[t.account?(d(),k("div",Mn,[n("div",xn,[v(o,{large:"",rating:t.account.statistics.rating},null,8,["rating"])]),n("div",Un,[n("div",Vn,[n("span",Ln,w(t.account.nickname),1)]),r(i).clanAccount&&r(f)?(d(),q(_,{key:0,class:"account-preview__clan link",title:"Перейти к клану",to:{name:"clan-id",params:{id:r(f).clan_id}}},{default:S(()=>[n("span",En," ["+w(r(f).tag)+"] "+w(r(f).name),1)]),_:1},8,["to"])):P("",!0),n("div",qn,[n("div",Fn,[Nn,n("span",jn,w(l.$formatter.date.toRelativeTime(t.account.last_battle_time*1e3)),1)]),r(i).clanAccount?(d(),k("div",Hn,[Gn,n("span",zn,w(l.$formatter.clan.role((D=r(i).clanAccount)==null?void 0:D.role)),1)])):P("",!0)])]),n("div",Kn,[v(m,{"is-text":"",class:"account-preview__actions-btn",title:"Копировать (nickname/ID)",onClick:C},{default:S(()=>[v(y,{name:"content-copy"})]),_:1}),v(m,{"is-text":"",class:"account-preview__actions-btn",title:"Добавить в избранные",onClick:T},{default:S(()=>[r(i).isFavorite?(d(),q(y,{key:0,name:"star"})):(d(),q(y,{key:1,name:"star-border"}))]),_:1}),v(m,{"is-text":"",disabled:r(i).detailsLoading,class:"account-preview__actions-btn",title:"Дополнительная информация",onClick:g},{default:S(()=>[v(y,{name:"info"})]),_:1},8,["disabled"])])])):P("",!0),v(p,{loading:t.loading},null,8,["loading"]),v(R,{ref_key:"accountPreviewDetailsRef",ref:c,account:t.account,"clan-account":r(i).clanAccount},null,8,["account","clan-account"])])}}}),Xn=window.setInterval,Jn={class:"session-panel"},Qn={class:"session-panel__inner"},Yn={class:"session-panel__item"},Zn={class:"session-panel__buttons"},es={key:0,class:"session-panel__item session-panel__item--time"},ts={class:"session-panel__time"},as=n("span",{class:"session-panel__time-title"}," Время начала ",-1),ns=n("div",{style:{margin:"0 0 1em"}}," Вы уверены, что хотите сбросить сессию? ",-1),ss={style:{"text-align":"right"}},We=60,os=j({__name:"SessionPanel",props:Re({updateAt:{type:Number,required:!0,default:0},hideAutoUpdate:{type:[Boolean],default:!1},loading:{type:Boolean,required:!0,default:!1}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:Re(["reset","update","session-active"],["update:modelValue"]),setup(t,{emit:c}){const s=pe(t,"modelValue"),h=t,i=dt(),f=K(null),$=Y({autoUpdateChecked:!1,autoUpdateInterval:We,autoUpdateCounter:We,autoUpdateTimer:0}),g=V(()=>{const l=x.date.toDateTime(h.updateAt),a=x.date.toDaysPassed(h.updateAt,Date.now(),!0);return`${l} (${a})`});it(()=>{clearInterval($.autoUpdateTimer)});const A=c;function e(){var l;(l=f.value)==null||l.doOpen()}function T(l){var a;l&&A("reset"),(a=f.value)==null||a.doClose()}function C(){if($.autoUpdateChecked=!$.autoUpdateChecked,$.autoUpdateCounter=$.autoUpdateInterval,!$.autoUpdateChecked){clearInterval($.autoUpdateTimer);return}const l=()=>{if(clearInterval($.autoUpdateTimer),$.autoUpdateTimer=Xn(l,1e3),$.autoUpdateCounter>0){$.autoUpdateCounter--;return}$.autoUpdateCounter=$.autoUpdateInterval,A("update")};A("update"),l()}return(l,a)=>{const o=_e,_=he,y=se,m=de,p=ve;return d(),k("div",Jn,[n("div",Qn,[n("div",Yn,[n("div",Zn,[v(o,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=R=>s.value=R),class:"session-panel__btn",title:"Просмотр статистики за сессию"},{default:S(()=>[I(" Сессия ")]),_:1},8,["modelValue"]),t.hideAutoUpdate===!1?(d(),q(y,{key:0,class:"session-panel__btn",title:"Автоматическое обновление данных",onClick:C},{before:S(()=>[v(_,{name:"refresh-auto"})]),default:S(()=>[r(i).isTablet?P("",!0):(d(),k(z,{key:0},[I(" Обновление ")],64)),I(" "+w(r($).autoUpdateCounter)+" сек. ",1)]),_:1})):P("",!0),v(y,{class:"session-panel__btn",title:"Сброс данных сессии",onClick:e},{default:S(()=>[v(_,{name:"close"})]),_:1})])]),r(g)?(d(),k("div",es,[n("span",ts,[as,I(" "+w(r(g)),1)])])):P("",!0)]),v(m,{loading:t.loading},null,8,["loading"]),v(p,{ref_key:"confirmDialogRef",ref:f,title:"Сброс сессии"},{default:S(()=>[ns,n("div",ss,[v(y,{align:"center",width:"80px",onClick:a[1]||(a[1]=R=>T(!0))},{default:S(()=>[I(" Да ")]),_:1}),v(y,{align:"center",width:"80px",onClick:a[2]||(a[2]=R=>T(!1))},{default:S(()=>[I(" Нет ")]),_:1})])]),_:1},512)])}}}),is={class:"accounts-metrics"},ls={class:"accounts-metrics__filters"},cs={class:"accounts-metrics__filters-item"},rs={class:"accounts-metrics__filters-item"},us={class:"accounts-metrics__plates"},ds=j({__name:"AccountsMetrics",props:{metrics:{type:Array,required:!0,default:()=>[]},filters:{type:Object,required:!0,default:()=>({})},loading:{type:Boolean,default:!1}},emits:["filters","is-open"],setup(t,{emit:c}){const s=["battles","winRate","damagePerBattle","winsInPlatoon","battlesPerDay","tanksWithMaster"],h=t,i=Y({isOpen:!1}),f=V(()=>i.isOpen?h.metrics:h.metrics.filter(A=>s.includes(A.key))),$=c;function g(){const A=h.filters.battleMode==="random"?"rating":"random";$("filters",{...h.filters,battleMode:A})}return(A,e)=>{const T=_e,C=rt;return d(),k("div",is,[n("div",ls,[n("div",cs,[v(T,{"model-value":t.filters.battleMode==="rating",onChange:g},{default:S(()=>[I(" Рейтинг ")]),_:1},8,["model-value"])]),n("div",rs,[v(T,{modelValue:r(i).isOpen,"onUpdate:modelValue":e[0]||(e[0]=l=>r(i).isOpen=l)},{default:S(()=>[I(" Все показатели ")]),_:1},8,["modelValue"])])]),n("div",us,[v(C,{loading:t.loading,items:r(f)},null,8,["loading","items"])])])}}}),_s=["onClick"],ms={class:"achievements-list__item-inner"},fs={class:"achievements-list__item-img-wrapper"},ps={key:0,class:"achievements-list__item-count"},hs={key:0,class:"achievements-list__item-series"},vs={key:1,class:"achievements-list__item-details"},ks=j({__name:"AchievementsList",props:{achievements:{type:Array,default:()=>[]},hideName:{type:[Boolean,String],default:!1}},emits:["medal-click"],setup(t,{emit:c}){const s=c;function h(i){s("medal-click",i)}return(i,f)=>{const $=Ce;return d(),k("div",{class:J(["achievements-list",[t.hideName?"achievements-list--small":""]])},[t.achievements.length?(d(),q(lt,{key:0,tag:"ul",class:"achievements-list__list",name:"achievements-list__item-"},{default:S(()=>[(d(!0),k(z,null,Q(t.achievements,g=>(d(),k("li",{key:g.key,class:J(["achievements-list__item",[!g.count&&!g.series?"achievements-list__item--no-count":""]])},[n("button",{class:"achievements-list__item-btn",onClick:A=>h(g)},[n("span",ms,[n("span",fs,[v($,{class:"achievements-list__item-img",src:g.image,alt:g.key,"data-name":g.name},null,8,["src","alt","data-name"])]),g.count||g.series?(d(),k("span",ps,[I(w(g.count)+" ",1),g.series?(d(),k("span",hs," / "+w(g.series),1)):P("",!0)])):P("",!0),t.hideName?P("",!0):(d(),k("span",vs,w(g.name),1))])],8,_s)],2))),128))]),_:1})):P("",!0)],2)}}}),ys={key:0,class:"achievements-block__details"},gs={class:"achievements-block__details-header"},bs={class:"achievements-block__details-name"},ws={class:"achievements-block__details-body"},$s=["textContent"],As=["textContent"],Rs={class:"achievements-block__details-footer"},Ss=j({__name:"AchievementsDetails",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(t,{expose:c}){const s=pe(t,"modelValue"),h=K(null),i=K(!1);function f(){i.value=!1}function $(){var g;(g=h.value)==null||g.doOpen()}return c({open:$}),(g,A)=>{const e=Ce,T=se,C=ve;return d(),q(C,{ref_key:"detailsRef",ref:h,width:"640px",onOpen:f},{footer:S(()=>[n("div",Rs,[v(T,{onClick:A[0]||(A[0]=l=>{var a;return(a=r(h))==null?void 0:a.doClose()})},{default:S(()=>[I(" Закрыть ")]),_:1})])]),default:S(()=>{var l;return[s.value?(d(),k("div",ys,[n("div",gs,[v(e,{class:"achievements-block__details-img",src:s.value.image,alt:s.value.key},null,8,["src","alt"]),n("span",bs,w((l=s.value)==null?void 0:l.name),1),n("div",ws,[s.value.description?(d(),k("div",{key:0,textContent:w(s.value.description)},null,8,$s)):P("",!0),s.value.condition?(d(),k("div",{key:1,textContent:w(s.value.condition)},null,8,As)):P("",!0)])])])):P("",!0)]}),_:1},512)}}}),Ts={key:0,class:"achievements-block__inner"},Cs={class:"achievements-block__filter"},Is={class:"achievements-block__filter-item"},Ds={class:"achievements-block__filter-item"},Ps={class:"achievements-block__filter-item"},Os={class:"achievements-block__section-title"},Bs={key:1,class:"achievements-block__empty"},Ms={key:1,class:"achievements-block__empty"},ft=j({__name:"AchievementsBlock",props:{achievements:{type:Object,required:!0,default:()=>({})},achievementsInfo:{type:Object,required:!0,default:()=>({})},filters:{type:Object,required:!0,default:()=>_t.makeAccountFilters()}},emits:["filters-changed"],setup(t,{emit:c}){const s=["markOfMastery","markOfMasteryI","markOfMasteryII","markOfMasteryIII","heroesOfRassenay","medalLafayettePool","medalRadleyWalters","warrior","medalKolobanov","mainGun","sniper","camper","medalBrothersInArms","medalCrucialContribution"],h=["battle","epic","title","commemorative","step","platoon"],i=t,f=K(),$=K(),g=Y({currentMedal:null,showAll:!1}),A=V(()=>{const o=Object.keys(i.achievements.achievements),_=Object.keys(i.achievements.achievements);return o.length||_.length}),e=V(()=>{if(i.filters.achievementsShow==="important"){const _=[];return Object.keys(i.achievements.achievements).forEach(y=>{const m=ce.achievementsMedal({key:y,achievements:i.achievements,encyclopedia:i.achievementsInfo});_.push(m)}),s.reduce((y,m)=>{const p=_.find(R=>R.key===m);return p?[...y,p]:y},[])}const o=Object.keys(i.achievementsInfo);return i.filters.achievementsShow==="deserved"?o.map(_=>ce.achievementsMedal({key:_,achievements:i.achievements,encyclopedia:i.achievementsInfo})).filter(_=>i.achievements.achievements[_.key]||i.achievements.max_series[_.key]).sort((_,y)=>_.key.localeCompare(y.key)):o.map(_=>ce.achievementsMedal({key:_,achievements:i.achievements,encyclopedia:i.achievementsInfo})).toSorted((_,y)=>_.key.localeCompare(y.key))}),T=V(()=>{const o={};return e.value.forEach(_=>{o[_.section]||(o[_.section]={name:_.section,items:[]}),o[_.section].items.push(_)}),Object.values(o).sort((_,y)=>h.indexOf(_.name)-h.indexOf(y.name))}),C=c;function l({key:o}){var _;g.currentMedal=e.value.find(y=>y.key===o)??null,(_=$.value)==null||_.open()}function a(o){C("filters-changed",{...i.filters,achievementsShow:o})}return(o,_)=>{const y=_e,m=ks,p=Ss;return d(),k("div",{ref_key:"mainRef",ref:f,class:"achievements-block"},[r(A)?(d(),k("div",Ts,[n("div",Cs,[n("div",Is,[v(y,{"model-value":t.filters.achievementsShow==="important",onChange:_[0]||(_[0]=R=>a("important"))},{default:S(()=>[I(" Значимые ")]),_:1},8,["model-value"])]),n("div",Ds,[v(y,{"model-value":t.filters.achievementsShow==="deserved",onChange:_[1]||(_[1]=R=>a("deserved"))},{default:S(()=>[I(" Заслуженные ")]),_:1},8,["model-value"])]),n("div",Ps,[v(y,{"model-value":t.filters.achievementsShow===null,onChange:_[2]||(_[2]=R=>a(null))},{default:S(()=>[I(" Все ")]),_:1},8,["model-value"])])]),r(e).length?(d(),k(z,{key:0},[t.filters.achievementsShow==="important"?(d(),q(m,{key:0,achievements:r(e),"hide-name":!0,onMedalClick:l},null,8,["achievements"])):(d(!0),k(z,{key:1},Q(r(T),R=>(d(),k("div",{key:R.name,class:"achievements-block__section"},[n("div",Os,w(o.$formatter.achievements.section(R.name)),1),v(m,{achievements:R.items,"hide-count":r(g).showAll,onMedalClick:l},null,8,["achievements","hide-count"])]))),128))],64)):(d(),k("div",Bs," Нет значимых достижений ")),v(p,{ref_key:"detailsRef",ref:$,modelValue:r(g).currentMedal,"onUpdate:modelValue":_[3]||(_[3]=R=>r(g).currentMedal=R)},null,8,["modelValue"])])):(d(),k("div",Ms," Нет достижений "))],512)}}}),ke=j({__name:"TankType",props:Re({size:{type:Number,default:24},isPremium:{type:Boolean,default:!1},isCollectible:{type:[Boolean,String],default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const c={lightTank:ae(()=>ne(()=>import("./light-tank.gJt3XRwl.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),mediumTank:ae(()=>ne(()=>import("./medium-tank.0XOLsdIu.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url)),heavyTank:ae(()=>ne(()=>import("./heavy-tank.CqZyuEGF.js"),__vite__mapDeps([6,1,2,3,4]),import.meta.url)),"AT-SPG":ae(()=>ne(()=>import("./at-spg.CZjrbald.js"),__vite__mapDeps([7,1,2,3,4]),import.meta.url))},s=pe(t,"modelValue"),h=V(()=>["AT-SPG","heavyTank","lightTank","mediumTank"].includes(s.value)?s.value:(console.warn("Not valid tank type - ",s.value),"span"));return(i,f)=>(d(),q(Fe(c[r(h)]),{filled:!0,"font-controlled":!1,class:J(["tank-type",[t.isPremium?"tank-type--is-premium":"",t.isCollectible?"tank-type--is-collectible":""]]),width:t.size,height:t.size},null,8,["class","width","height"]))}}),xs=["src","alt"],pt=j({__name:"TankNation",props:Re({size:{type:[Number,String],default:24}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const c=pe(t,"modelValue");return(s,h)=>(d(),k("img",{style:Ne({width:`${t.size}px`,height:`${t.size}px`}),src:`/img/nations/nation-${c.value}.svg`,alt:c.value,class:"tank-nation"},null,12,xs))}}),Us={class:"account-infographics"},Vs={class:"account-infographics__filters"},Ls={class:"account-infographics__filters-chips"},Es={class:"account-infographics__chart-list"},qs={class:"account-infographics__chart-label"},Fs={class:"account-infographics__line-icon"},Ns={key:2},js={key:"battles",class:"account-infographics__line-value"},Hs={key:"damagePerBattle",class:"account-infographics__line-value"},Gs=j({__name:"AccountInfographics",props:{tanks:{type:Array,default:()=>[],required:!0}},setup(t){const c=t,s=K("battles"),h=[{value:"battles",label:x.stat.accountProp("battles")},{value:"winRate",label:x.stat.accountProp("winRate")},{value:"damagePerBattle",label:x.stat.accountProp("damagePerBattle")}],i=V(()=>[{label:"По нации",key:"nation",value:f("nation")},{label:"По уровню",key:"tier",value:f("tier")},{label:"По типу",key:"type",value:f("type")}]);function f(g){var e;const A={};if(!((e=c.tanks)!=null&&e.length))return A;c.tanks.forEach(T=>{const C=T[g];T.tier&&(C in A||(A[C]={key:C,battles:0,winRate:0,damagePerBattle:0,lineHeight:0}),A[C].battles+=T.all.battles,A[C].winRate+=T.all.wins,A[C].damagePerBattle+=T.all.damage_dealt)});for(const T in A){const C=A[T].battles;A[T].winRate=C?A[T].winRate/(C/100):0,A[T].damagePerBattle=C?A[T].damagePerBattle/C:0}for(const T in A){const l=Math.min(...Object.values(A).map(o=>o[s.value])),a=Math.max(...Object.values(A).map(o=>o[s.value]))-l/1.1;A[T].lineHeight=(A[T][s.value]-l/1.1)/(a/100)}return A}function $(g){s.value=g}return(g,A)=>{const e=_e,T=ke,C=pt,l=Ie;return d(),k("div",Us,[n("div",Vs,[n("div",Ls,[(d(),k(z,null,Q(h,a=>v(e,{key:a.value,"model-value":a.value===r(s),onChange:o=>$(a.value)},{default:S(()=>[I(w(a.label),1)]),_:2},1032,["model-value","onChange"])),64))])]),n("div",Es,[(d(!0),k(z,null,Q(r(i),a=>(d(),k("div",{key:a.key,class:J(["account-infographics__chart",[`account-infographics__chart--${a.key}`]])},[n("span",qs,w(a.label),1),(d(!0),k(z,null,Q(a.value,o=>(d(),k("div",{key:o.key,class:"account-infographics__line"},[n("span",Fs,[a.key==="type"?(d(),q(T,{key:0,modelValue:o.key,"onUpdate:modelValue":_=>o.key=_},null,8,["modelValue","onUpdate:modelValue"])):a.key==="nation"?(d(),q(C,{key:1,modelValue:o.key,"onUpdate:modelValue":_=>o.key=_,size:"22"},null,8,["modelValue","onUpdate:modelValue"])):a.key==="tier"?(d(),k("span",Ns,w(g.$formatter.encyclopedia.tier(o.key)),1)):(d(),k(z,{key:3},[I(w(o.key),1)],64))]),v(lt,{tag:"span",name:"account-infographics__line-value-",class:"account-infographics__line-progress",style:Ne({"--chart-line-width":o.lineHeight/100})},{default:S(()=>[r(s)==="battles"?(d(),k("span",js,w(g.$formatter.number.toInteger(o.battles)),1)):P("",!0),r(s)==="winRate"?(d(),q(l,{key:"winRate",modelValue:o.winRate,"onUpdate:modelValue":_=>o.winRate=_,class:"account-infographics__line-value"},null,8,["modelValue","onUpdate:modelValue"])):P("",!0),r(s)==="damagePerBattle"?(d(),k("span",Hs,w(g.$formatter.number.toInteger(o.damagePerBattle)),1)):P("",!0)]),_:2},1032,["style"])]))),128))],2))),128))])])}}}),ht=j({__name:"MarkOfMastery",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(t){const c={1:ae(()=>ne(()=>import("./3.sHqAUhBU.js"),__vite__mapDeps([8,1,2,3,4]),import.meta.url)),2:ae(()=>ne(()=>import("./2.B0O5E5gE.js"),__vite__mapDeps([9,1,2,3,4]),import.meta.url)),3:ae(()=>ne(()=>import("./1.C704M_fT.js"),__vite__mapDeps([10,1,2,3,4]),import.meta.url)),4:ae(()=>ne(()=>import("./М.BBG3w52P.js"),__vite__mapDeps([11,1,2,3,4]),import.meta.url))},s=pe(t,"modelValue");return(h,i)=>(d(),q(Fe(s.value?c[s.value]:"span"),{filled:!0,"font-controlled":!1,class:J(["mark-of-mastery",[s.value?"mark-of-mastery--"+s.value:""]])},null,8,["class"]))}}),zs={class:"account-tanks-table-desktop"},Ks={class:"account-tanks-table-desktop__table"},Ws=["title"],Xs={class:"account-tanks-table-desktop__name-text"},Js={key:0,class:"account-tanks-table-desktop__diff"},Qs={key:0,class:"account-tanks-table-desktop__diff"},Ys={key:0,class:"account-tanks-table-desktop__diff"},Zs={key:0,class:"account-tanks-table-desktop__diff"},eo={key:0,class:"account-tanks-table-desktop__diff"},to={key:0,class:"account-tanks-table-desktop__diff"},ao={key:0,class:"account-tanks-table-desktop__diff"},no={key:0,class:"account-tanks-table-desktop__diff"},so={class:"account-tanks-table-desktop__mark"},oo={key:0,class:"account-tanks-table-desktop__diff"},io={class:"account-tanks-table-desktop__diff"},lo=j({__name:"AccountTanksTableDesktop",props:{items:{type:Array,default:()=>[],required:!0},headers:{type:Array,default:()=>[],required:!0},summary:{type:Object,default:()=>({}),required:!0},height:{type:String,default:void 0},maxHeight:{type:String,default:void 0},sort:{type:Object,default:null},defaultSort:{type:Object,default:null},showDiff:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["row-click"],setup(t,{expose:c,emit:s}){const h=K(null),i=s;return c({sortItems(){var f;(f=h.value)==null||f.sortItems()}}),(f,$)=>{const g=ke,A=se,e=Ie,T=ht,C=mt,l=de;return d(),k("div",zs,[n("div",Ks,[v(C,{ref_key:"tableRef",ref:h,headers:t.headers,data:t.items,summary:t.summary,"default-sort":t.defaultSort,"scroll-auto-disabling":"","no-wrap":"","row-key":"tank_id",height:t.height,"max-height":t.maxHeight},{"position-summary":S(()=>[I(w(t.items.length||0),1)]),position:S(({index:a})=>[I(w(a+1),1)]),type:S(({row:a})=>[n("div",{class:"account-tanks-table-desktop__type",title:a.is_premium?"Премиум танк":""},[v(g,{modelValue:a.type,"onUpdate:modelValue":o=>a.type=o,"is-premium":a.is_premium,"is-collectible":a.is_collectible},null,8,["modelValue","onUpdate:modelValue","is-premium","is-collectible"])],8,Ws)]),name:S(({row:a})=>[v(A,{class:"account-tanks-table-desktop__name","is-text":"",onClick:o=>i("row-click",a.tank_id)},{default:S(()=>[n("span",Xs,w(a.name??`Tank ID: ${a.tank_id}`),1)]),_:2},1032,["onClick"])]),battles:S(({row:a})=>{var o;return[I(w(a.all.battles)+" ",1),t.showDiff?(d(),k("div",Js,w(f.$formatter.number.toInteger((o=a.diff)==null?void 0:o.battles,!0)),1)):P("",!0)]}),winRate:S(({row:a})=>{var o;return[v(e,{"model-value":a.all.winRate,class:"account-tanks-table-desktop__win-rate"},null,8,["model-value"]),t.showDiff?(d(),k("div",Qs,w(f.$formatter.number.toFloatPercent((o=a.diff)==null?void 0:o.winRate,!0)),1)):P("",!0)]}),damagePerBattle:S(({row:a})=>{var o;return[I(w(a.all.damagePerBattle)+" ",1),t.showDiff?(d(),k("div",Ys,w(f.$formatter.number.toInteger((o=a.diff)==null?void 0:o.damagePerBattle,!0)),1)):P("",!0)]}),xpPerBattle:S(({row:a})=>{var o;return[I(w(a.all.xpPerBattle)+" ",1),t.showDiff?(d(),k("div",Zs,w(f.$formatter.number.toInteger((o=a.diff)==null?void 0:o.xpPerBattle,!0)),1)):P("",!0)]}),fragPerBattle:S(({row:a})=>{var o;return[I(w(a.all.fragPerBattle)+" ",1),t.showDiff?(d(),k("div",eo,w(f.$formatter.number.toInteger((o=a.diff)==null?void 0:o.fragPerBattle,!0)),1)):P("",!0)]}),hitRate:S(({row:a})=>{var o;return[I(w(f.$formatter.number.toFloatPercent(a.all.hitRate))+" ",1),t.showDiff?(d(),k("div",to,w(f.$formatter.number.toFloatNumber((o=a.diff)==null?void 0:o.hitRate,!0)),1)):P("",!0)]}),surviveRate:S(({row:a})=>{var o;return[I(w(f.$formatter.number.toFloatPercent(a.all.surviveRate))+" ",1),t.showDiff?(d(),k("div",ao,w(f.$formatter.number.toFloatNumber((o=a.diff)==null?void 0:o.surviveRate,!0)),1)):P("",!0)]}),spottedPerBattle:S(({row:a})=>{var o;return[I(w(a.all.spottedPerBattle)+" ",1),t.showDiff?(d(),k("div",no,w(f.$formatter.number.toInteger((o=a.diff)==null?void 0:o.spottedPerBattle,!0)),1)):P("",!0)]}),mark_of_mastery:S(({row:a})=>[n("div",so,[a.markOfMastery.value&&a.markOfMastery.count?(d(),q(T,{key:0,"model-value":a.markOfMastery.value,title:"Знак классности",width:"20",height:"20"},null,8,["model-value"])):P("",!0),I(" "+w(a.markOfMastery.count||"---"),1)]),t.showDiff?(d(),k("div",oo,w(a.markOfMastery.diff),1)):P("",!0)]),last_battle_time:S(({row:a})=>[I(w(f.$formatter.date.toRelativeTime(a.last_battle_time*1e3)||"---")+" ",1),n("div",io,w(f.$formatter.date.toDateTime(a.last_battle_time*1e3)||"---"),1)]),_:1},8,["headers","data","summary","default-sort","height","max-height"]),v(l,{loading:t.loading},null,8,["loading"])])])}}}),co={key:0,class:"ui-table-mobile__header"},ro={class:"ui-table-mobile__head"},uo={class:"ui-table-mobile__sort"},_o=["title","onClick"],mo={key:0,class:"ui-table-mobile__sort-icons"},fo={key:0,class:"ui-table-mobile__summary"},po={key:1,class:"ui-table-mobile__no-data"},ho={key:2,class:"ui-table-mobile__footer"},vo=j({__name:"UiTableMobile",props:{data:{type:Array,required:!0,default:()=>[]},headers:{type:Array,required:!0,default:()=>[]},summary:{type:Object,default:void 0},defaultSort:{type:Object,default:void 0},scrollAutoDisabling:Boolean,scrollToTop:Boolean,height:{type:String,default:void 0},rowKey:{type:String,default:void 0},maxHeight:{type:String,default:void 0},minHeight:{type:String,default:void 0}},emits:["sort","row-click"],setup(t,{emit:c}){var y,m;const s=t,h=K(),i=K([]),f=Y({order:((y=s.defaultSort)==null?void 0:y.order)??"",prop:((m=s.defaultSort)==null?void 0:m.prop)??""});Kt(()=>{var p;i.value=s.data,Me(s.scrollToTop)&&((p=h.value)==null||p.scrollTo({top:0}))});let $=null;function g(){h.value&&($=sa({target:[h.value],threshold:1,callback(p){const R=p.target;p.isIntersecting?ze(!1,R):(ze(!0,R),R.scrollTo({top:0}))}}))}Te(()=>{Me(s.scrollAutoDisabling)&&g(),e()}),it(()=>{Me(s.scrollAutoDisabling)&&($==null||$.disconnect())});const A=(p="default")=>!!Wt()[p];function e(){var M;let p=f.order,R=f.prop;p===""&&s.defaultSort&&(p=s.defaultSort.order,R=s.defaultSort.prop);const D=(M=s.headers)==null?void 0:M.find(L=>L.key===R);D&&(typeof D.sortMethod=="function"?i.value.sort((L,B)=>{var E,X;return p==="desc"?((E=D.sortMethod)==null?void 0:E.call(D,B,L))||0:((X=D.sortMethod)==null?void 0:X.call(D,L,B))||0}):D.sortable===!0&&i.value.sort((L,B)=>{const E=(p==="desc"?B:L)[R],X=(p==="desc"?L:B)[R];return String(E).localeCompare(String(X),void 0,{numeric:!0,sensitivity:"base"})}))}const T=c;function C(p){let R=p.key,D=f.order;f.prop!==R&&(D=""),D?D==="asc"?D="desc":(D="",R=""):D="asc",f.order=D,f.prop=R}function l(p){var R;p.sortable&&((R=h.value)==null||R.scrollTo({top:0}),C(p),e(),T("sort",{...f,column:p}))}function a(p,R){return typeof p.formatter=="function"?p.formatter(R):R}function o(p,R){return f.order===p&&f.prop===R}function _(p){return typeof s.summary!="object"||!Object.keys(s.summary).includes(p.key)?"":typeof p.formatter=="function"?p.formatter(s.summary[p.key]):s.summary[p.key]}return(p,R)=>{const D=he;return d(),k("div",{class:"ui-table-mobile",style:Ne({height:t.height,maxHeight:t.maxHeight,minHeight:t.minHeight})},[A("header")?(d(),k("div",co,[ue(p.$slots,"header")])):P("",!0),n("ul",ro,[(d(!0),k(z,null,Q(t.headers,M=>(d(),k("li",{key:M.key,class:"ui-table-mobile__head-item"},[n("div",uo,[n("button",{title:M.tooltip,class:J(["ui-table-mobile__sort-btn",[M.sortable?"ui-table-mobile__sort-btn--has-sort":""]]),onClick:L=>l(M)},[ue(p.$slots,`${M.key}-header`,{},()=>[I(w(M.label),1)])],10,_o),M.sortable?(d(),k("span",mo,[v(D,{size:"16",name:"arrow-up",class:J(["ui-table-mobile__sort-icon",[o("asc",M.key)?"is-active":""]])},null,8,["class"]),v(D,{size:"16",name:"arrow-down",class:J(["ui-table-mobile__sort-icon",[o("desc",M.key)?"is-active":""]])},null,8,["class"])])):P("",!0)]),t.summary?(d(),k("div",fo,[ue(p.$slots,`${M.key}-summary`,{},()=>[I(w(_(M)),1)])])):P("",!0)]))),128))]),n("ul",{ref_key:"tableListRef",ref:h,class:"ui-table-mobile__list"},[(d(!0),k(z,null,Q(r(i),(M,L)=>(d(),k("li",{key:String(t.rowKey?M[t.rowKey]:L),class:"ui-table-mobile__row"},[A("default")?ue(p.$slots,"default",{key:0,row:M,index:L}):(d(!0),k(z,{key:1},Q(t.headers,B=>(d(),k("td",{key:B.key,class:"ui-table-mobile__cell"},[M?ue(p.$slots,`${B.key}`,{key:0,row:M,data:M[B.key],index:L},()=>[I(w(a(B,M[B.key])),1)]):P("",!0)]))),128))]))),128))],512),Array.isArray(t.data)&&t.data.length?P("",!0):(d(),k("div",po," Нет данных ")),A("footer")?(d(),k("div",ho,[ue(p.$slots,"footer")])):P("",!0)],4)}}}),ko={class:"tank-tier"},yo=j({__name:"TankTier",props:{tier:{type:Number,required:!0}},setup(t){return(c,s)=>(d(),k("div",ko,w(c.$formatter.encyclopedia.tier(t.tier)),1))}}),go={class:"account-tanks-table-mobile"},bo=["onClick"],wo={class:"account-tank-preview__img-wrapper"},$o={class:"account-tank-preview__icons"},Ao={class:"account-tank-preview__description"},Ro={class:"account-tank-preview__description-row"},So={class:"account-tank-preview__name"},To={class:"account-tank-preview__name-text"},Co={class:"account-tank-preview__description-row"},Io={class:"account-tank-preview__props"},Do={class:"account-tank-preview__prop"},Po={key:0,class:"account-tank-preview__prop-sub"},Oo={class:"account-tank-preview__prop"},Bo={key:0,class:"account-tank-preview__prop-sub"},Mo={class:"account-tank-preview__prop"},xo={key:0,class:"account-tank-preview__prop-sub"},Uo={class:"account-tank-preview__prop"},Vo={class:"account-tank-preview__prop-value"},Lo={key:0,class:"account-tank-preview__prop-sub"},Eo=j({__name:"AccountTanksTableMobile",props:{items:{type:Array,default:()=>[],required:!0},headers:{type:Array,default:()=>[],required:!0},defaultSort:{type:Object,default:null},height:{type:String,default:void 0},maxHeight:{type:String,default:void 0}},emits:["row-click"],setup(t,{emit:c}){const s=c;return(h,i)=>{const f=Ce,$=ke,g=Ie,A=ht;return d(),k("div",go,[v(vo,{data:t.items,headers:t.headers,"row-key":"tank_id",height:t.height,"default-sort":t.defaultSort,"max-height":t.maxHeight,"scroll-auto-disabling":""},{default:S(({row:e})=>[n("div",{class:"account-tank-preview",onClick:T=>s("row-click",e.tank_id)},[n("div",wo,[v(f,{class:"account-tank-preview__nation-img",src:`/img/nations/nation-${e.nation}.svg`,alt:e.nation},null,8,["src","alt"]),v(f,{class:"account-tank-preview__tank-img",src:e.images.preview,alt:e.name},null,8,["src","alt"]),n("div",$o,[v($,{modelValue:e.type,"onUpdate:modelValue":T=>e.type=T,"is-premium":e.is_premium,"is-collectible":e.is_collectible},null,8,["modelValue","onUpdate:modelValue","is-premium","is-collectible"]),v(yo,{class:"account-tank-preview__tier",tier:e.tier},null,8,["tier"])])]),n("div",Ao,[n("div",Ro,[n("div",So,[n("span",To,w(e.name??`Tank ID: ${e.tank_id}`),1)])]),n("div",Co,[n("div",Io,[n("span",Do,[I(w(h.$formatter.number.toInteger(e.all.battles))+" ",1),e.diff?(d(),k("span",Po,w(h.$formatter.number.toInteger(e.diff.battles,!0)),1)):P("",!0)]),n("span",Oo,[v(g,{"model-value":e.all.winRate},null,8,["model-value"]),e.diff?(d(),k("span",Bo,w(h.$formatter.number.toFloatPercent(e.diff.winRate,!0)),1)):P("",!0)]),n("span",Mo,[I(w(h.$formatter.number.toInteger(e.all.damagePerBattle))+" ",1),e.diff?(d(),k("span",xo,w(h.$formatter.number.toInteger(e.diff.damagePerBattle,!0)),1)):P("",!0)]),n("span",Uo,[n("span",Vo,[e.markOfMastery.value&&e.markOfMastery.count?(d(),q(A,{key:0,"model-value":e.markOfMastery.value,title:"Знак классности",width:"18",height:"18"},null,8,["model-value"])):P("",!0),I(" "+w(e.markOfMastery.count||"---"),1)]),e.diff?(d(),k("span",Lo,w(e.markOfMastery.diff),1)):P("",!0)])])])])],8,bo)]),_:1},8,["data","headers","height","default-sort","max-height"])])}}}),vt=j({__name:"AccountTanksTable",props:{tanks:{type:Array,default:()=>[],required:!0},tanksDiff:{type:[Array,null],default:null,required:!0},noCount:{type:[Boolean,String],default:!1},height:{type:String,default:void 0},maxHeight:{type:String,default:void 0},sort:{type:Object,default:null},defaultSort:{type:Object,default:null},showDiff:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["row-click"],setup(t,{expose:c,emit:s}){const h=V(()=>$.isTablet?Eo:lo),i=t,f=K(null),$=dt(),g=s,A=V(()=>[{key:"position",label:"№",width:60},{key:"type",label:"Тип",width:60,sortable:!0},{key:"name",label:"Название",sortable:!0},{key:"tier",label:"I-X",sortable:!0},{key:"battles",label:"Бои",sortable:!0,sortMethod(l,a){return l.all.battles-a.all.battles},formatter:l=>x.number.toInteger(l)},{key:"winRate",label:"Победы",sortable:!0,sortMethod(l,a){const o=l,_=a;return o.all.winRate-_.all.winRate},formatter:l=>x.number.toFloatPercent(l)},{key:"damagePerBattle",label:"Урон",sortable:!0,sortMethod(l,a){return l.all.damagePerBattle-a.all.damagePerBattle},formatter:l=>x.number.toInteger(l)},{key:"xpPerBattle",label:"Опыт",sortable:!0,sortMethod(l,a){return l.all.xpPerBattle-a.all.xpPerBattle},formatter:l=>x.number.toInteger(l)},{key:"fragPerBattle",label:"Уничт.",tooltip:"Уничтожено За Бой",sortable:!0,sortMethod(l,a){return l.all.fragPerBattle-a.all.fragPerBattle},formatter:l=>x.number.toFloatNumber(l)},{key:"hitRate",label:"Точн.",tooltip:"Точность стрельбы",sortable:!0,sortMethod(l,a){return l.all.hitRate-a.all.hitRate},formatter:l=>x.number.toPercent(l)},{key:"surviveRate",label:"Выж.",tooltip:"Выживаемость",sortable:!0,sortMethod(l,a){return l.all.surviveRate-a.all.surviveRate},formatter:l=>x.number.toPercent(l)},{key:"spottedPerBattle",label:"Обн.",tooltip:"Обнаружено за бой",sortable:!0,sortMethod(l,a){return l.all.spottedPerBattle-a.all.spottedPerBattle},formatter:l=>x.number.toFloatNumber(l)},{key:"mark_of_mastery",label:"M",tooltip:"Знак классности",sortable:!0,sortMethod(l,a){const o=l.markOfMastery.count+l.markOfMastery.value*1e4,_=a.markOfMastery.count+a.markOfMastery.value*1e4;return o-_},formatter:l=>x.stat.markOfMastery(Number(l))},{key:"last_battle_time",label:"Последний бой",sortable:!0}].filter(l=>{const a=["battles","winRate","damagePerBattle","type","tier","last_battle_time"];return $.isTablet?a.includes(l.key):!0})),e=V(()=>{let l={};return i.tanks.forEach((a,o)=>{o?l=N.sum(l,a.all):l=a.all}),N.tank(l)}),T={1:"markOfMasteryIII",2:"markOfMasteryII",3:"markOfMasteryI",4:"markOfMastery"},C=V(()=>i.tanks.map(l=>{var y;const a=(y=i.tanksDiff)==null?void 0:y.find(m=>m.tank_id===l.tank_id),o=l.achievements.achievements[T[l.mark_of_mastery]]??0,_=(a==null?void 0:a.achievements.achievements[T[l.mark_of_mastery]])??0;return{...l,diff:(a==null?void 0:a.all)??null,markOfMastery:{value:l.mark_of_mastery,count:o,diff:x.number.toInteger(_,!0)||"---"}}}));return c({sortItems(){var l;(l=f.value)==null||l.sortItems()}}),(l,a)=>{const o=oa;return d(),q(o,null,{default:S(()=>[(d(),q(Fe(r(h)),{items:r(C),headers:r(A),summary:r(e),"max-height":t.maxHeight,height:t.height,"default-sort":t.defaultSort,onRowClick:a[0]||(a[0]=_=>g("row-click",_))},null,40,["items","headers","summary","max-height","height","default-sort"]))]),_:1})}}}),qo={class:"account-daily-stat"},Fo={class:"account-daily-stat__filters"},No={class:"account-daily-stat__filters-item"},jo={class:"account-daily-stat__filters-item"},Ho={class:"account-daily-stat__table"},Go={style:{display:"flex","justify-content":"flex-end"}},zo=j({__name:"AccountDailyStat",props:{accountId:{type:[Number,String],default:0,required:!0},vehicles:{type:Object,default:()=>({}),required:!0}},emits:["sort"],setup(t,{emit:c}){const s=t,h=K(null),i=Y({loading:0,summary:{},items:[],currentItem:null,accounts:[],tanks:[]}),f=[7,14,30,60,90].map(m=>({value:m,label:new Intl.NumberFormat("ru",{style:"unit",unit:"day",unitDisplay:"long"}).format(m)})),$=[0,7,14,30,60,90,180].map(m=>({value:m,label:new Intl.NumberFormat("ru",{style:"unit",unit:"day",unitDisplay:"long"}).format(m)})),g=Y({period:7,periodOffset:0}),A=V(()=>{const m=new Date,p=new Date;return m.setDate(m.getDate()-(g.periodOffset+g.period+1)),p.setDate(p.getDate()-g.periodOffset),{dateStart:m.toISOString(),dateEnd:p.toISOString()}}),e={order:"desc",prop:"last_battle_time"},T=[{key:"position",label:"№"},{key:"date",label:"Дата"},{key:"tanks",label:"Танков"},{key:"tier",label:"I-X",formatter:m=>ee(m)?x.number.toFloatNumber(m):"---"},{key:"battles",label:"Бои",formatter:m=>ee(m)?x.number.toInteger(m):"---"},{key:"winRate",label:"Победы",formatter:m=>ee(m)?x.number.toFloatPercent(m):"---"},{key:"damagePerBattle",label:"Урон",formatter:m=>ee(m)?x.number.toInteger(m):"---"},{key:"xpPerBattle",label:"Опыт",formatter:m=>ee(m)?x.number.toInteger(m):"---"},{key:"fragPerBattle",label:"Уничт.",tooltip:"Уничтожено За Бой",formatter:m=>ee(m)?x.number.toFloatNumber(m):"---"},{key:"hitRate",label:"Точн.",tooltip:"Точность стрельбы",formatter:m=>ee(m)?x.number.toFloatPercent(m):"---"},{key:"surviveRate",label:"Выж.",tooltip:"Выживаемость",formatter:m=>ee(m)?x.number.toFloatPercent(m):"---"},{key:"spottedPerBattle",label:"Обн.",tooltip:"Обнаружено за бой",formatter:m=>ee(m)?x.number.toFloatNumber(m):"---"}],C=V(()=>i.currentItem?i.currentItem.tanks.map(m=>{var p;return ce.accountTank(m,((p=s.vehicles)==null?void 0:p[m.tank_id])??null,null)}):[]);Te(async()=>{s.accountId&&(await a(s.accountId),o())}),Ve(A,async()=>{s.accountId&&(await a(s.accountId),o())});const l=c;async function a(m){const p={...A.value,id:m};i.loading++;try{const[R,D]=await Promise.all([fe.stat.accounts.getDiff(p),fe.stat.tanks.getDiff(p)]);i.tanks=D.data,i.accounts=R.data}catch(R){H(R,{title:"Получение дневной статистики"})}i.loading--}function o(){let m=null;i.items=[],i.accounts.forEach(p=>{var L;const R=N.accountAll(p.raw.statistics.all),D=(L=i.tanks.find(B=>{const E=x.date.toDate(B.timestamp),X=x.date.toDate(p.timestamp);return E===X}))==null?void 0:L.raw,M=()=>{const B=(D==null?void 0:D.length)??0;return((D==null?void 0:D.reduce((E,X)=>{var oe;return E+((oe=s.vehicles[X.tank_id])==null?void 0:oe.tier)||0},0))??0)/B};i.items.push({id:p.id,date:x.date.toDate(p.timestamp),battles:R.battles,winRate:R.winRate,damagePerBattle:R.damagePerBattle,xpPerBattle:R.xpPerBattle,fragPerBattle:R.fragPerBattle,hitRate:R.hitRate,surviveRate:R.surviveRate,spottedPerBattle:R.spottedPerBattle,tanks:D||[],tier:M()}),m=m?N.sum(m,R):R}),i.summary=m?N.accountAll(m):{}}async function _(m){var p;i.currentItem=m,await Le(),(p=h.value)==null||p.doOpen()}function y(){var m;i.currentItem=null,(m=h.value)==null||m.doClose()}return(m,p)=>{var oe;const R=ut,D=se,M=Ie,L=mt,B=de,E=vt,X=ve;return d(),k("div",qo,[n("div",Fo,[n("div",No,[I(" Период "),v(R,{modelValue:r(g).period,"onUpdate:modelValue":p[0]||(p[0]=F=>r(g).period=F),width:"120px",options:r(f),class:"account-daily-stat__filters-item"},null,8,["modelValue","options"])]),n("div",jo,[I(" Смещение "),v(R,{modelValue:r(g).periodOffset,"onUpdate:modelValue":p[1]||(p[1]=F=>r(g).periodOffset=F),width:"120px",options:r($)},null,8,["modelValue","options"])])]),n("div",Ho,[v(L,{headers:T,data:r(i).items,summary:r(i).summary,"scroll-auto-disabling":"","no-wrap":"","row-key":"timestamp","max-height":"375px",onSort:p[2]||(p[2]=F=>l("sort",F))},{"position-summary":S(()=>{var F;return[I(w(((F=r(i).items)==null?void 0:F.length)||0),1)]}),position:S(({index:F})=>[I(w(F+1),1)]),date:S(({row:F})=>[v(D,{"is-text":"",onClick:ye=>_(F)},{default:S(()=>[I(w(F.date),1)]),_:2},1032,["onClick"])]),tanks:S(({row:F})=>[I(w(F.tanks?m.$formatter.number.toInteger(F.tanks.length):"---"),1)]),winRate:S(({row:F})=>[v(M,{modelValue:F.winRate,"onUpdate:modelValue":ye=>F.winRate=ye,class:"account-daily-stat__win-rate"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["data","summary"]),v(B,{loading:r(i).loading>0},null,8,["loading"])]),v(X,{ref_key:"tanksDetailsRef",ref:h,width:"1280px",title:"Статистика за "+((oe=r(i).currentItem)==null?void 0:oe.date),onClosed:p[3]||(p[3]=F=>r(i).currentItem=null)},{footer:S(()=>[n("div",Go,[v(D,{onClick:y},{default:S(()=>[I(" Закрыть ")]),_:1})])]),default:S(()=>[r(i).currentItem?(d(),q(E,{key:0,tanks:r(C),"default-sort":e,"max-height":"calc(100vh - 200px)"},null,8,["tanks"])):P("",!0)]),_:1},8,["title"])])}}});var Ko="__lodash_hash_undefined__";function Wo(t){return this.__data__.set(t,Ko),this}var Xo=Wo;function Jo(t){return this.__data__.has(t)}var Qo=Jo,Yo=ia,Zo=Xo,ei=Qo;function Se(t){var c=-1,s=t==null?0:t.length;for(this.__data__=new Yo;++c<s;)this.add(t[c])}Se.prototype.add=Se.prototype.push=Zo;Se.prototype.has=ei;var ti=Se;function ai(t,c){for(var s=-1,h=t==null?0:t.length;++s<h;)if(c(t[s],s,t))return!0;return!1}var ni=ai;function si(t,c){return t.has(c)}var oi=si,ii=ti,li=ni,ci=oi,ri=1,ui=2;function di(t,c,s,h,i,f){var $=s&ri,g=t.length,A=c.length;if(g!=A&&!($&&A>g))return!1;var e=f.get(t),T=f.get(c);if(e&&T)return e==c&&T==t;var C=-1,l=!0,a=s&ui?new ii:void 0;for(f.set(t,c),f.set(c,t);++C<g;){var o=t[C],_=c[C];if(h)var y=$?h(_,o,C,c,t,f):h(o,_,C,t,c,f);if(y!==void 0){if(y)continue;l=!1;break}if(a){if(!li(c,function(m,p){if(!ci(a,p)&&(o===m||i(o,m,s,h,f)))return a.push(p)})){l=!1;break}}else if(!(o===_||i(o,_,s,h,f))){l=!1;break}}return f.delete(t),f.delete(c),l}var kt=di;function _i(t){var c=-1,s=Array(t.size);return t.forEach(function(h,i){s[++c]=[i,h]}),s}var mi=_i;function fi(t){var c=-1,s=Array(t.size);return t.forEach(function(h){s[++c]=h}),s}var pi=fi,Xe=Yt,Je=la,hi=fa,vi=kt,ki=mi,yi=pi,gi=1,bi=2,wi="[object Boolean]",$i="[object Date]",Ai="[object Error]",Ri="[object Map]",Si="[object Number]",Ti="[object RegExp]",Ci="[object Set]",Ii="[object String]",Di="[object Symbol]",Pi="[object ArrayBuffer]",Oi="[object DataView]",Qe=Xe?Xe.prototype:void 0,xe=Qe?Qe.valueOf:void 0;function Bi(t,c,s,h,i,f,$){switch(s){case Oi:if(t.byteLength!=c.byteLength||t.byteOffset!=c.byteOffset)return!1;t=t.buffer,c=c.buffer;case Pi:return!(t.byteLength!=c.byteLength||!f(new Je(t),new Je(c)));case wi:case $i:case Si:return hi(+t,+c);case Ai:return t.name==c.name&&t.message==c.message;case Ti:case Ii:return t==c+"";case Ri:var g=ki;case Ci:var A=h&gi;if(g||(g=yi),t.size!=c.size&&!A)return!1;var e=$.get(t);if(e)return e==c;h|=bi,$.set(t,c);var T=vi(g(t),g(c),h,i,f,$);return $.delete(t),T;case Di:if(xe)return xe.call(t)==xe.call(c)}return!1}var Mi=Bi,Ye=ca,xi=1,Ui=Object.prototype,Vi=Ui.hasOwnProperty;function Li(t,c,s,h,i,f){var $=s&xi,g=Ye(t),A=g.length,e=Ye(c),T=e.length;if(A!=T&&!$)return!1;for(var C=A;C--;){var l=g[C];if(!($?l in c:Vi.call(c,l)))return!1}var a=f.get(t),o=f.get(c);if(a&&o)return a==c&&o==t;var _=!0;f.set(t,c),f.set(c,t);for(var y=$;++C<A;){l=g[C];var m=t[l],p=c[l];if(h)var R=$?h(p,m,l,c,t,f):h(m,p,l,t,c,f);if(!(R===void 0?m===p||i(m,p,s,h,f):R)){_=!1;break}y||(y=l=="constructor")}if(_&&!y){var D=t.constructor,M=c.constructor;D!=M&&"constructor"in t&&"constructor"in c&&!(typeof D=="function"&&D instanceof D&&typeof M=="function"&&M instanceof M)&&(_=!1)}return f.delete(t),f.delete(c),_}var Ei=Li,Ue=ra,qi=kt,Fi=Mi,Ni=Ei,Ze=ua,et=ma,tt=da,ji=_a,Hi=1,at="[object Arguments]",nt="[object Array]",Ae="[object Object]",Gi=Object.prototype,st=Gi.hasOwnProperty;function zi(t,c,s,h,i,f){var $=et(t),g=et(c),A=$?nt:Ze(t),e=g?nt:Ze(c);A=A==at?Ae:A,e=e==at?Ae:e;var T=A==Ae,C=e==Ae,l=A==e;if(l&&tt(t)){if(!tt(c))return!1;$=!0,T=!1}if(l&&!T)return f||(f=new Ue),$||ji(t)?qi(t,c,s,h,i,f):Fi(t,c,A,s,h,i,f);if(!(s&Hi)){var a=T&&st.call(t,"__wrapped__"),o=C&&st.call(c,"__wrapped__");if(a||o){var _=a?t.value():t,y=o?c.value():c;return f||(f=new Ue),i(_,y,s,h,f)}}return l?(f||(f=new Ue),Ni(t,c,s,h,i,f)):!1}var Ki=zi,Wi=Ki,ot=Zt;function yt(t,c,s,h,i){return t===c?!0:t==null||c==null||!ot(t)&&!ot(c)?t!==t&&c!==c:Wi(t,c,s,h,yt,i)}var Xi=yt,Ji=Xi;function Qi(t,c){return Ji(t,c)}var Yi=Qi;const Zi=ea(Yi),el={class:"account-tanks-filters"},tl={class:"account-tanks-filters__inner"},al={class:"account-tanks-filters__list"},nl={style:{"font-weight":"500",width:"24px","text-align":"center"}},sl={key:0,class:"account-tanks-filters__item"},ol={class:"account-tanks-filters__item"},il={class:"account-tanks-filters__item"},ll=j({__name:"AccountTanksFilters",props:{defaultFilters:{type:Object,default:null,required:!0},filters:{type:Object,default:null,required:!0},isPrivate:{type:[Boolean,String],default:!1,required:!0}},emits:["change","clear"],setup(t,{emit:c}){const s=t,h=["ussr","germany","usa","uk","japan","china","france","european","other"],i=[1,2,3,4,5,6,7,8,9,10].map(_=>({value:_,label:x.encyclopedia.tier(_)})),f=["lightTank","mediumTank","heavyTank","AT-SPG"],$=[{value:null,label:"Премиум: показать"},{value:!0,label:"Премиум: только"},{value:!1,label:"Премиум: спрятать"}],g=[{value:null,label:"В ангаре: все"},{value:1,label:"В ангаре: есть"},{value:0,label:"В ангаре: нет"}],A=V(()=>!Zi(s.filters,s.defaultFilters)),e=c;function T(_){let y=s.filters.tankNation;y.includes(_)?y=y.filter(m=>m!==_):y.push(_),e("change",{...s.filters,tankNation:y})}function C(_){let y=s.filters.tankTire;y.includes(_)?y=y.filter(m=>m!==_):y.push(_),e("change",{...s.filters,tankTire:y})}function l(_){let y=s.filters.tankType;y.includes(_)?y=y.filter(m=>m!==_):y.push(_),e("change",{...s.filters,tankType:y})}function a(_){e("change",{...s.filters,tankInGarage:_})}function o(_){e("change",{...s.filters,tankIsPremium:_})}return(_,y)=>{const m=pt,p=_e,R=ke,D=ut,M=he,L=se;return d(),k("div",el,[n("div",tl,[n("ul",al,[n("li",{class:J(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[(d(),k(z,null,Q(h,B=>v(p,{key:B,"model-value":t.filters.tankNation.includes(B),class:"account-tanks-filters__btn",title:_.$formatter.encyclopedia.nation(B),onChange:E=>T(B)},{default:S(()=>[v(m,{"model-value":B},null,8,["model-value"])]),_:2},1032,["model-value","title","onChange"])),64))]),n("li",{class:J(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[(d(),k(z,null,Q(f,B=>v(p,{key:B,"model-value":t.filters.tankType.includes(B),class:"account-tanks-filters__btn",title:"Тип",onChange:E=>l(B)},{default:S(()=>[v(R,{"model-value":B},null,8,["model-value"])]),_:2},1032,["model-value","onChange"])),64))]),n("li",{class:J(["account-tanks-filters__item",["account-tanks-filters__item--overflow"]])},[(d(!0),k(z,null,Q(r(i),B=>(d(),q(p,{key:B.value,"model-value":t.filters.tankTire.includes(B.value),class:"account-tanks-filters__btn",title:"Уровень "+B,onChange:E=>C(B.value)},{default:S(()=>[n("span",nl,w(B.label),1)]),_:2},1032,["model-value","title","onChange"]))),128))]),t.isPrivate?(d(),k("li",sl,[v(D,{"model-value":t.filters.tankInGarage,options:g,onChange:a},null,8,["model-value"])])):P("",!0),n("li",ol,[v(D,{"model-value":t.filters.tankIsPremium,options:$,onChange:o},null,8,["model-value"])]),n("li",il,[v(L,{title:"Очистить фильтры",disabled:!r(A),onClick:y[0]||(y[0]=B=>e("clear"))},{default:S(()=>[v(M,{name:"clear"})]),_:1},8,["disabled"])])])])])}}}),cl={key:0,class:"account-tank"},rl={class:"account-tank__header"},ul={class:"account-tank__img-wrapper"},dl={class:"account-tank__tier"},_l={class:"account-tank__props"},ml={class:"account-tank__prop"},fl=n("span",{class:"account-tank__prop-name"}," Нация: ",-1),pl={class:"account-tank__prop"},hl=n("span",{class:"account-tank__prop-name"}," Последний бой: ",-1),vl=n("h4",null,"Статистика",-1),kl=n("h4",null,"Достижения",-1),yl=j({__name:"AccountTank",props:{tank:{type:Object,default:()=>({}),required:!0},tankDiff:{type:Object,default:null,required:!0},achievementsInfo:{type:Object,default:()=>({}),required:!0}},setup(t){const c=["battles","winRate","damagePerBattle","surviveRate","fragPerBattle","winsInPlatoon"],s=t,h=Y({showAllMetrics:!1,filters:na()}),i=V(()=>{const $=ie.tank({tank:s.tank,tankDiff:s.tankDiff});return h.showAllMetrics?$:$.filter(g=>c.includes(g.key))});function f($){h.filters=$}return($,g)=>{var a;const A=Ce,e=ke,T=_e,C=rt,l=ft;return t.tank?(d(),k("div",cl,[n("div",rl,[n("div",ul,[v(A,{class:"account-tank__img account-tank__img--nation",alt:"tank.nation",src:`/img/nations/nation-${t.tank.nation}.svg`},null,8,["src"]),v(A,{class:"account-tank__img account-tank__img--tank",alt:t.tank.name,src:(a=t.tank.images)==null?void 0:a.preview},null,8,["alt","src"]),v(e,{size:28,class:"account-tank__type","model-value":t.tank.type,"is-premium":t.tank.is_premium,"is-collectible":t.tank.is_collectible},null,8,["model-value","is-premium","is-collectible"]),n("div",dl,w($.$formatter.encyclopedia.tier(t.tank.tier)),1)]),n("div",_l,[n("div",ml,[fl,I(" "+w($.$formatter.encyclopedia.nation(t.tank.nation)),1)]),n("div",pl,[hl,I(" "+w($.$formatter.date.toDateTime(t.tank.last_battle_time*1e3)),1)])])]),vl,v(T,{modelValue:r(h).showAllMetrics,"onUpdate:modelValue":g[0]||(g[0]=o=>r(h).showAllMetrics=o),class:"account-tank__show-all-metrics"},{default:S(()=>[I(" Все показатели ")]),_:1},8,["modelValue"]),v(C,{items:r(i)},null,8,["items"]),kl,v(l,{achievements:t.tank.achievements,"achievements-info":t.achievementsInfo,filters:r(h).filters,onFiltersChanged:f},null,8,["achievements","achievements-info","filters"])])):P("",!0)}}}),gl={key:0,class:"account-view"},bl={class:"account-view__private"},wl={key:1,class:"account-view--no-data"},$l={key:0,class:"content-area"},Al=n("p",null,"Нет данных.",-1),Rl=n("p",null,"Возможно аккаунт удалён.",-1),Sl=[Al,Rl],Tl={style:{display:"flex","justify-content":"flex-end"}},Ql=j({__name:"AccountView",setup(t){const c=K(null),s=K(null),h=_t.makeAccountFilters({tankInGarage:1,tankIsPremium:null}),i=Xt(),f=pa(),$=ha(),g={order:"desc",prop:"last_battle_time"},A=Y(te(g)),e=Y({tanks:[],tanksDiff:[],tanksSessions:[],tanksSnapshot:[],tanksTableItems:[],sessionUpdateAt:0,sessionActive:!1,currentTank:null,currentTankDiff:null,loading:0,filters:te(h),accountRaw:null,accountRawSnapshot:null,accountAchievementsRaw:null,accountAchievementsRawSnapshot:null,tanksRaw:null,tanksRawSnapshot:null,tanksAchievementsRaw:null,tanksAchievementsRawSnapshot:null}),T=V(()=>$.vehicles),C=V(()=>$.achievements),l=V(()=>{var u;return f.accountId===((u=e.accountRaw)==null?void 0:u.account_id)}),a=V(()=>Number(i.params.id)||f.accountId),o=V(()=>!e.accountAchievementsRaw||!e.accountAchievementsRawSnapshot||!C.value?null:N.accountAchievementsDiff(e.accountAchievementsRaw,e.accountAchievementsRawSnapshot,C.value)),_=V(()=>e.sessionActive?o.value:e.accountAchievementsRaw),y=V(()=>{if(!e.accountRaw)return null;const u=e.accountRaw.statistics.all,b=e.accountRaw.statistics.rating;return{...e.accountRaw,statistics:{all:N.accountAll(u),rating:b?N.accountRating(b):null}}}),m=V(()=>{if(!e.accountRaw||!e.accountRawSnapshot)return null;const u=e.accountRaw.statistics.all,b=e.accountRaw.statistics.rating,O=e.accountRawSnapshot.statistics.all,U=e.accountRawSnapshot.statistics.rating;return{...e.accountRaw,statistics:{all:N.accountAll(N.diff(u,O)),rating:b&&U?N.accountRating(N.diff(b,U)):null}}}),p=V(()=>{if(!e.accountRaw||!e.accountRawSnapshot)return null;const u=e.accountRaw.statistics.all,b=e.accountRaw.statistics.rating,O=e.accountRawSnapshot.statistics.all,U=e.accountRawSnapshot.statistics.rating,W=N.diff(N.accountAll(u),N.accountAll(O)),G=b&&U?N.diff(N.accountRating(b),N.accountRating(U)):null;return{...e.accountRaw,statistics:{all:W,rating:G}}}),R=V(()=>{var u,b,O,U;return!y.value||!m.value||!_.value?ie.account():e.sessionActive?ie.account({stat:(u=m.value)==null?void 0:u.statistics.all,achievements:o.value,tanks:e.tanksSessions,createAt:new Date(e.sessionUpdateAt).valueOf()}):ie.account({stat:(b=y.value)==null?void 0:b.statistics.all,statDiff:(O=p.value)==null?void 0:O.statistics.all,achievements:e.accountAchievementsRaw,achievementsDiff:o.value,tanks:e.tanks,tanksDiff:e.tanksDiff.filter(W=>W.all.battles),createAt:((U=y.value)==null?void 0:U.created_at)*1e3,createAtSnapshot:new Date(e.sessionUpdateAt).valueOf()})}),D=V(()=>{var u,b,O;return!y.value||!m.value?ie.accountRating():e.sessionActive?ie.accountRating({stat:(u=m.value)==null?void 0:u.statistics.rating}):ie.accountRating({stat:(b=y.value)==null?void 0:b.statistics.rating,diff:(O=p.value)==null?void 0:O.statistics.rating})}),M=V(()=>e.filters.battleMode==="random"?R.value:D.value);Ve(()=>e.sessionActive,()=>{ge(e.filters)}),Ve(()=>e.filters,async()=>{var u;je(e.filters),await Le(),(u=c.value)==null||u.sortItems()});const L=K(!1);Te(async()=>{await De(),L.value=!0});function B(){var u;return((u=e.tanksRaw)==null?void 0:u.map(b=>{var U,W;const O=(U=e.tanksAchievementsRaw)==null?void 0:U.find(G=>G.tank_id===b.tank_id);return ce.accountTank(b,((W=T.value)==null?void 0:W[b.tank_id])??null,O??null)}))??[]}function E(){var u;return((u=e.tanksRawSnapshot)==null?void 0:u.map(b=>{var U,W;const O=(U=e.tanksAchievementsRawSnapshot)==null?void 0:U.find(G=>G.tank_id===b.tank_id);return ce.accountTank(b,((W=T.value)==null?void 0:W[b.tank_id])??null,O??null)}))??[]}function X(u,b=!1){var re,be,we;const O=((re=e.tanksAchievementsRaw)==null?void 0:re.find(me=>me.tank_id===u.tank_id))??null,U=((be=e.tanksAchievementsRawSnapshot)==null?void 0:be.find(me=>me.tank_id===u.tank_id))??null,W=O&&U?N.tankAchievementsDiff(O,U):null,G=((we=T.value)==null?void 0:we[u.tank_id])??null;return ce.accountTank(u,G,b?O:W)}function oe(){var u;return((u=e.tanksRaw)==null?void 0:u.reduce((b,O)=>{var G;const U=(G=e.tanksRawSnapshot)==null?void 0:G.find(re=>re.tank_id===O.tank_id);if(!U)return b.push(X(O,!0)),b;if(O.all.battles===U.all.battles)return b;const W=O.battle_life_time-U.battle_life_time;return b.push(X({...O,battle_life_time:W,all:N.diff(O.all,U.all)})),b},[]))??[]}function F(){return e.tanks.map(u=>{const b=e.tanksSnapshot.find(U=>u.tank_id===U.tank_id);if(!b)return u;const O=u.battle_life_time-b.battle_life_time;return{...u,all:N.diff(u.all,b.all),battle_life_time:O,achievements:N.tankAchievementsDiff(u.achievements,b.achievements)}})}function ye(){e.tanks=B(),e.tanksSnapshot=E(),e.tanksSessions=oe(),e.tanksDiff=F()}async function gt(u){e.loading++;try{const{data:b}=await le.tanks.getAchievements({account_id:u});e.tanksAchievementsRaw=b[u]??null}catch(b){H(b,{title:"Получение достижений по технике игрока"})}e.loading--}async function bt(u){e.loading++;try{const{data:b}=await le.account.getAchievements({account_id:u});e.accountAchievementsRaw=b[u]??null}catch(b){H(b,{title:"Получение достижений по аккаунту игрока"})}e.loading--}async function wt(u){e.loading++;try{const{data:b}=await le.account.getInfo({account_id:u,extra:"statistics.rating"});e.accountRaw=(b==null?void 0:b[u])??null}catch(b){H(b,{title:"Получение данных аккаунта"})}e.loading--}async function $t(u){T.value||await Rt(),await At(u)}async function At(u){e.loading++;try{const{data:b}=await le.tanks.getStats({account_id:u});e.tanksRaw=b?b[u]:null}catch(b){H(b,{title:"Получение статистики по технике игрока"})}e.loading--}async function Rt(){if(!T.value){e.loading++;try{await $.getTanksVehicles()}catch(u){H(u,{title:"Получение данных описания техники"})}e.loading--}}async function St(){if(!C.value){e.loading++;try{await $.getAchievements()}catch(u){H(u,{title:"Получение описания достижений"})}e.loading--}}async function De(u=!1){var b;a.value&&(await Promise.all([St(),wt(a.value),$t(a.value),gt(a.value),bt(a.value)]),u||await Ut(),(u||!e.accountRawSnapshot)&&await Vt(),ye(),je(e.filters),await Le(),(b=c.value)==null||b.sortItems())}function je(u){let b=e.sessionActive?e.tanksSessions:e.tanks;u.tankInGarage!==null&&(b=b.filter(O=>typeof O.in_garage!="boolean"?!0:O.in_garage===(u.tankInGarage===1))),u.tankNation.length&&(b=b.filter(O=>u.tankNation.includes(O.nation))),u.tankTire.length&&(b=b.filter(O=>u.tankTire.includes(O.tier))),b=b.filter(O=>{const U=u.tankIsPremium;return U===!0?O.is_premium:U===!1?!O.is_premium:!0}),u.tankType.length&&(b=b.filter(O=>u.tankType.includes(O.type))),e.tanksTableItems=b}function ge(u){e.filters=te(u)}function Tt(){e.filters=te(h)}async function Ct(){if(e.accountRaw){e.loading++;try{const u=await Z.indexedDB.accountsInfo.get(e.accountRaw.account_id);e.accountRawSnapshot=(u==null?void 0:u.data)??null,e.sessionUpdateAt=(u==null?void 0:u.timestamp)??0}catch(u){H(u,{title:"Загрузка локальных данных аккаунта"})}e.loading--}}async function It(){if(e.accountRaw){e.loading++;try{await Z.indexedDB.accountsInfo.set(e.accountRaw.account_id,$e(e.accountRaw)),e.accountRawSnapshot=te(e.accountRaw),e.sessionUpdateAt=Date.now()}catch(u){H(u,{title:"Сохранение локальных данных аккаунта"})}e.loading--}}async function Dt(){if(e.accountRaw){e.loading++;try{const u=await Z.indexedDB.accountsAchievements.get(e.accountRaw.account_id);e.accountAchievementsRawSnapshot=(u==null?void 0:u.data)??null,e.sessionUpdateAt=(u==null?void 0:u.timestamp)??0}catch(u){H(u,{title:"Загрузка локальных данных достижений аккаунта"})}e.loading--}}async function Pt(){if(!(!e.accountRaw||!e.accountAchievementsRaw)){e.loading++;try{await Z.indexedDB.accountsAchievements.set(e.accountRaw.account_id,$e(e.accountAchievementsRaw)),e.accountAchievementsRawSnapshot=te(e.accountAchievementsRaw)}catch(u){H(u,{title:"Сохранение локальных данных достижений аккаунта"})}e.loading--}}async function Ot(){if(e.accountRaw){e.loading++;try{const u=await Z.indexedDB.tanksStat.get(e.accountRaw.account_id);e.tanksRawSnapshot=(u==null?void 0:u.data)??null}catch(u){H(u,{title:"Загрузка локальных данных техники"})}e.loading--}}async function Bt(){if(!(!e.accountRaw||!e.tanksRaw)){e.loading++;try{await Z.indexedDB.tanksStat.set(e.accountRaw.account_id,$e(e.tanksRaw)),e.tanksRawSnapshot=te(e.tanksRaw),e.sessionUpdateAt=Date.now()}catch(u){H(u,{title:"Сохранение локальных данных техники"})}e.loading--}}async function Mt(){if(e.accountRaw){e.loading++;try{const u=await Z.indexedDB.tanksAchievements.get(e.accountRaw.account_id);e.tanksAchievementsRawSnapshot=(u==null?void 0:u.data)??null}catch(u){H(u,{title:"Загрузка локальных данных достижений техники"})}e.loading--}}async function xt(){if(!(!e.accountRaw||!e.tanksAchievementsRaw)){e.loading++;try{await Z.indexedDB.tanksAchievements.set(e.accountRaw.account_id,$e(e.tanksAchievementsRaw)),e.tanksAchievementsRawSnapshot=te(e.tanksAchievementsRaw),e.sessionUpdateAt=Date.now()}catch(u){H(u,{title:"Сохранение локальных данных достижений техники"})}e.loading--}}async function Ut(){await Promise.all([Ct(),Dt(),Ot(),Mt()])}async function Vt(){await Promise.all([It(),Pt(),Bt(),xt()])}async function Lt(){await De(!0)}function Et(){De()}function qt(u){var b;e.sessionActive?(e.currentTank=e.tanksSessions.find(O=>u===O.tank_id)??null,e.currentTankDiff=null):(e.currentTank=e.tanks.find(O=>u===O.tank_id)??null,e.currentTankDiff=e.tanksDiff.find(O=>u===O.tank_id)??null),(b=s.value)==null||b.doOpen()}return(u,b)=>{var He;const O=ja,U=Wn,W=os,G=aa,re=ds,be=ft,we=Gs,me=zo,Ft=ll,Nt=vt,jt=de,Ht=yl,Gt=se,zt=ve;return d(),k(z,null,[r(e).accountRaw?(d(),k("div",gl,[v(G,{identity:"preview"},{default:S(()=>[n("div",bl,[r(e).accountRaw.private?(d(),q(O,{key:0,resources:r(e).accountRaw.private},null,8,["resources"])):P("",!0)]),v(U,{loading:r(e).loading>0,class:"account-view__preview",account:r(e).accountRaw},null,8,["loading","account"]),v(W,{modelValue:r(e).sessionActive,"onUpdate:modelValue":b[0]||(b[0]=Pe=>r(e).sessionActive=Pe),class:"account-view__session",loading:r(e).loading>0,"update-at":r(e).sessionUpdateAt,onReset:Lt,onUpdate:Et},null,8,["modelValue","loading","update-at"])]),_:1}),v(G,{title:"Статистика",identity:"statistic"},{default:S(()=>[v(re,{filters:r(e).filters,metrics:r(M),loading:r(e).loading>0,onFilters:ge},null,8,["filters","metrics","loading"])]),_:1}),Oe(v(G,{title:"Достижения",identity:"achievements"},{default:S(()=>[r(_)?(d(),q(be,{key:0,filters:r(e).filters,"achievements-info":r(C),achievements:r(_),onFiltersChanged:ge},null,8,["filters","achievements-info","achievements"])):P("",!0)]),_:1},512),[[Be,r(e).filters.battleMode==="random"]]),!r(e).sessionActive&&r(e).filters.battleMode==="random"?(d(),q(G,{key:0,title:"Инфографика",identity:"tanksBattles"},{default:S(()=>[v(we,{tanks:r(e).tanks},null,8,["tanks"])]),_:1})):P("",!0),r(e).sessionActive?P("",!0):Oe((d(),q(G,{key:1,title:"Статистика по дням",identity:"dailyStat"},{default:S(()=>[r(T)?(d(),q(me,{key:0,vehicles:r(T),"account-id":r(e).accountRaw.account_id},null,8,["vehicles","account-id"])):P("",!0)]),_:1},512)),[[Be,r(e).filters.battleMode==="random"]]),Oe(v(G,{title:"Техника",identity:"tanks"},{default:S(()=>[v(Ft,{class:"account-view__filters",filters:r(e).filters,"default-filters":r(h),"is-private":r(l),onChange:ge,onClear:Tt},null,8,["filters","default-filters","is-private"]),v(Nt,{ref_key:"tableRef",ref:c,sort:r(A),loading:r(e).loading>0,"default-sort":g,tanks:r(e).tanksTableItems,"tanks-diff":r(e).tanksDiff,"achievements-info":r(C),"show-diff":!r(e).sessionActive,height:"calc(100vh - 112px)",onRowClick:qt},null,8,["sort","loading","tanks","tanks-diff","achievements-info","show-diff"])]),_:1},512),[[Be,r(e).filters.battleMode==="random"]])])):(d(),k("div",wl,[r(L)?(d(),k("div",$l,Sl)):P("",!0),v(jt,{loading:!r(L)},null,8,["loading"])])),v(zt,{ref_key:"tankDetailsRef",ref:s,width:"1100px",title:(He=r(e).currentTank)==null?void 0:He.name,onClosed:b[2]||(b[2]=Pe=>r(e).currentTank=null)},{footer:S(()=>[n("div",Tl,[v(Gt,{onClick:b[1]||(b[1]=Pe=>{var Ge;return(Ge=r(s))==null?void 0:Ge.doClose()})},{default:S(()=>[I(" Закрыть ")]),_:1})])]),default:S(()=>[r(C)&&r(e).currentTank?(d(),q(Ht,{key:0,tank:r(e).currentTank,"tank-diff":r(e).currentTankDiff,"achievements-info":r(C)},null,8,["tank","tank-diff","achievements-info"])):P("",!0)]),_:1},8,["title"])],64)}}});export{Ql as _};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./light-tank.gJt3XRwl.js","./nuxt-icon.tdHFESbn.js","./_plugin-vue_export-helper.DlAUqK2U.js","./entry.38LME4ko.js","./nuxt-icon.MfBulapQ.css","./medium-tank.0XOLsdIu.js","./heavy-tank.CqZyuEGF.js","./at-spg.CZjrbald.js","./3.sHqAUhBU.js","./2.B0O5E5gE.js","./1.C704M_fT.js","./М.BBG3w52P.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
