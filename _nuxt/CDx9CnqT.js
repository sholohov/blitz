import{_ as U}from"./5xD4Hy8S.js";import{_ as M}from"./Cq4nVhTL.js";import{_ as D}from"./BYjQXuNZ.js";import{d as O,c as R,f as u,o as m,e as A,w as i,m as a,h as c,t as s,q as r,l as z,F as w,_ as j,u as q,j as C,n as d,k as E,g as H,D as S,p as T}from"./CKv8GwDH.js";import{_ as G}from"./Bm14zLTW.js";import{_ as W}from"./BYgbaSb1.js";import{_ as J}from"./CKJ7yeoF.js";import{u as K}from"./Bi8rSdHQ.js";import{_ as Q}from"./CFptAKa4.js";import{u as X}from"./Cd7HNDjG.js";import{u as B}from"./CI5TTA92.js";import{s as Y}from"./C4oTPxE3.js";import"./SiXtYWfA.js";import"./DD4asW33.js";import"./DSHhIHB-.js";import"./di2ZG6aq.js";import"./RPJY7rI9.js";const Z={style:{display:"flex","align-items":"center",gap:"14px",padding:"10px"}},tt={style:{display:"flex","flex-direction":"column","align-items":"center"}},et={style:{"font-size":"12px","font-weight":"500",margin:"4px 0 0"}},at={style:{margin:"0 0 8px 0"}},ot={style:{display:"flex","align-items":"center",gap:"20px"}},nt={style:{display:"flex",gap:"10px"}},st={style:{display:"inline-flex","flex-direction":"column","font-size":"14px"}},lt={style:{"font-size":"12px",color:"var(--color-text-light)"}},rt={style:{display:"flex",gap:"10px"}},it={style:{display:"inline-flex","flex-direction":"column","font-size":"14px"}},ct={style:{"font-size":"12px",color:"var(--color-text-light)"}},dt={style:{display:"flex",gap:"10px"}},ut={style:{display:"inline-flex","flex-direction":"column","font-size":"14px"}},pt={style:{"font-size":"12px",color:"var(--color-text-light)"}},mt={class:"leaderboards-accounts-table__nickname"},_t={class:"leaderboards-accounts-table__sub"},bt={class:"leaderboards-accounts-table__sub"},ft={class:"leaderboards-accounts-table__sub"},gt={class:"leaderboards-accounts-table__sub"},yt={class:"leaderboards-accounts-table__sub"},ht={class:"leaderboards-accounts-table__sub"},xt=O({__name:"LeaderboardAccountTable",props:{items:{type:Array,default:()=>[],required:!0},headers:{type:Array,default:()=>[],required:!0}},setup(x){const k=R(()=>K().isTablet);return(e,_)=>{const v=M,b=D,g=j,$=G,F=W,V=J;return u(k)?(m(),A(F,{key:0,ref:"accountsTable","no-wrap":"","row-key":"id","scroll-to-top":"","scroll-auto-disabling":"",data:x.items,height:"calc(100vh - 112px)"},{default:i(({row:t})=>{var l,p,y;return[a("div",Z,[a("span",tt,[c(v,{position:t.position},null,8,["position"]),a("span",et,s(t.xp_per_battle),1)]),a("div",null,[a("div",at,[c(b,{style:{"font-weight":"500"},class:"link",to:{name:"account-id",params:{id:t.id}}},{default:i(()=>[r(s(t.nickname),1)]),_:2},1032,["to"]),t.clan?(m(),A(b,{key:0,class:"link",to:{name:"clan-id",params:{id:t.clan.clan_id}}},{default:i(()=>[r(" ["+s(t.clan.tag)+"] ",1)]),_:2},1032,["to"])):(m(),z(w,{key:1},[r(" [ --- ] ")],64))]),a("div",ot,[a("span",nt,[c(g,{name:"sword-cross",size:"18",style:{color:"var(--color-text-light)"}}),a("span",st,[r(s(e.$formatter.number.toInteger(t.battles))+" ",1),a("span",lt,s(e.$formatter.number.toInteger((l=t.stat)==null?void 0:l.battles)||"---"),1)])]),a("span",rt,[c(g,{name:"flag-variant",size:"18",style:{color:"var(--color-text-light)"}}),a("span",it,[c($,{"win-rate":t.win_rate},null,8,["win-rate"]),a("span",ct,s(e.$formatter.number.toFloatPercent((p=t.stat)==null?void 0:p.winRate)??"---"),1)])]),a("span",dt,[c(g,{name:"destruction",size:"18",style:{color:"var(--color-text-light)"}}),a("span",ut,[r(s(e.$formatter.number.toInteger(t.damage_per_battle))+" ",1),a("span",pt,s(e.$formatter.number.toInteger((y=t.stat)==null?void 0:y.damagePerBattle)),1)])])])])])]}),_:1},8,["data"])):(m(),A(V,{key:1,ref:"accountsTable","no-wrap":"","row-key":"id","scroll-to-top":"","scroll-auto-disabling":"",headers:x.headers,data:x.items,height:"calc(100vh - 112px)"},{nickname:i(({row:t})=>[a("div",mt,[c(v,{class:"leaderboards-accounts-table__nickname-mark",position:t.position},null,8,["position"]),c(b,{class:"leaderboards-accounts-table__nickname-link link",to:{name:"account-id",params:{id:t.id}}},{default:i(()=>[r(s(t.nickname),1)]),_:2},1032,["to"])])]),clan:i(({row:t})=>[t.clan?(m(),A(b,{key:0,class:"leaderboards-accounts-table__clan link",to:{name:"clan-id",params:{id:t.clan.clan_id}}},{default:i(()=>[r(s(t.clan.tag),1)]),_:2},1032,["to"])):(m(),z(w,{key:1},[r(" --- ")],64))]),battles:i(({row:t})=>{var l;return[r(s(t.battles)+" ",1),a("div",_t,s(e.$formatter.number.toInteger((l=t.stat)==null?void 0:l.battles)||"---"),1)]}),win_rate:i(({row:t})=>{var l;return[c($,{"win-rate":t.win_rate,class:"leaderboards-accounts-table__win-rate"},null,8,["win-rate"]),a("div",bt,s(e.$formatter.number.toFloatPercent((l=t.stat)==null?void 0:l.winRate)||"---"),1)]}),damage_per_battle:i(({row:t})=>{var l;return[r(s(t.damage_per_battle)+" ",1),a("div",ft,s(e.$formatter.number.toInteger((l=t.stat)==null?void 0:l.damagePerBattle)||"---"),1)]}),frags_per_battle:i(({row:t})=>{var l,p;return[r(s(t.frags_per_battle)+" / "+s(t.frags8p_per_battle)+" ",1),a("div",gt,s(e.$formatter.number.toFloatNumber((l=t.stat)==null?void 0:l.fragPerBattle)||"---")+" / "+s(e.$formatter.number.toFloatNumber((p=t.stat)==null?void 0:p.frag8pPerBattle)||"---"),1)]}),xp_per_battle:i(({row:t})=>{var l;return[r(s(t.xp_per_battle)+" ",1),a("div",yt,s(e.$formatter.number.toInteger((l=t.stat)==null?void 0:l.xpPerBattle)||"---"),1)]}),spotted_per_battle:i(({row:t})=>{var l;return[r(s(t.spotted_per_battle)+" ",1),a("div",ht,s(e.$formatter.number.toInteger((l=t.stat)==null?void 0:l.spottedPerBattle)||"---"),1)]}),_:1},8,["headers","data"]))}}}),kt={class:"leaderboards-accounts-page"},vt={key:0,class:"leaderboards-accounts-page__user-position"},$t={class:"leaderboards-accounts-page__filters"},It={class:"leaderboards-accounts-page__filters-item"},Pt={class:"leaderboards-accounts-page__filters-item"},qt=O({__name:"accounts",setup(x){q({title:"Рейтинги / Техника"});const k=X(),e=C({loading:0,tanks:[],accountsLeaderboard:[],userOnLeaderboard:null,items:[],clanAccounts:null,accounts:null}),_=C({page:1,pageSize:99,period:7,battlesPerDay:10,battlesMin:1e4}),v=[7,14,30,60,90].map(o=>({value:o,label:new Intl.NumberFormat("ru",{style:"unit",unit:"day",unitDisplay:"long"}).format(o)})),b=[{label:"От 1к",value:1e3},{label:"от 5к",value:5e3},{label:"от 10к",value:1e4},{label:"от 30к",value:3e4}],g=[{key:"nickname",label:"Ник"},{key:"clan",label:"Клан"},{key:"xp_per_battle",label:"Опыт",tooltip:d.stat.accountProp("xp"),formatter:o=>d.number.toInteger(o)},{key:"battles",label:"Бои",tooltip:d.stat.accountProp("battles"),formatter:o=>d.number.toInteger(o)},{key:"win_rate",label:"Победы",tooltip:d.stat.accountProp("winRate"),formatter:o=>d.number.toFloatNumber(o)},{key:"damage_per_battle",label:"Урон",tooltip:d.stat.accountProp("damagePerBattle"),formatter:o=>d.number.toInteger(o)},{key:"frags_per_battle",label:"Уничт. / ур. >= 8",tooltip:d.stat.accountProp("fragPerBattle"),formatter:o=>d.number.toFloatNumber(o)},{key:"spotted_per_battle",label:"Обн.",tooltip:d.stat.accountProp("spotted"),formatter:o=>d.number.toFloatNumber(o)}];E(()=>{p()});async function $(o){e.loading++;try{const{data:n}=await T.account.getInfo({extra:"statistics.rating",account_id:o.join(",")});e.accounts=n??null}catch(n){e.accounts=null,B(n,{title:"Поучение списка аккаунтов"})}e.loading--}async function F(o){e.loading++;try{const{data:n}=await T.clan.getAccountInfo({extra:"clan",account_id:o.join(",")});e.clanAccounts=n??null}catch(n){e.clanAccounts=null,B(n,{title:"Ошибка поучения списка клановых аккаунтов"})}e.loading--}async function V(){e.loading++;try{const{data:o}=await S.leaderboards.getAccounts(_);e.accountsLeaderboard=o}catch(o){e.accountsLeaderboard=[],B(o,{title:"Получение рейтинга игроков"})}e.loading--}async function t(){e.loading++;try{const{data:o}=await S.leaderboards.getAccounts({..._,ids:[k.accountId]});e.userOnLeaderboard=o[0]}catch(o){e.userOnLeaderboard=null,B(o,{title:"Получение рейтинга пользователя"})}e.loading--}async function l(){const o=e.accountsLeaderboard.map(n=>n.id);o.length&&(await Promise.allSettled([F(o),$(o)]),e.items=e.accountsLeaderboard.map(n=>{var L,h,f,N;const I=(h=(L=e.clanAccounts)==null?void 0:L[n.id])==null?void 0:h.clan,P=(N=(f=e.accounts)==null?void 0:f[n.id])==null?void 0:N.statistics;return{...n,stat:P?Y.accountAll(P.all):null,clan:I??null}}))}async function p(){await Promise.all([V(),k.accountId?t():null]),await l()}function y(){p()}return(o,n)=>{var h;const I=U,P=xt,L=Q;return m(),z("div",kt,[n[6]||(n[6]=a("div",{class:"leaderboards-accounts-page__description content-area"},[a("h2",null,"Топ «Опытных» игроков"),a("p",null,'Чем выше средний "Опыт", тем выше ваша позиция в рейтинге.'),a("p",null,"Условия участия:"),a("ol",null,[a("li",null,"Быть авторизованным на ресурсе не менее 3-х дней"),a("li",null,'Провести суммарно не менее 10 "обычных" боёв в сутки')])],-1)),u(e).userOnLeaderboard?(m(),z("div",vt,[n[2]||(n[2]=r(" Ваша позиция в рейтинге: ")),a("b",null,s((h=u(e).userOnLeaderboard)==null?void 0:h.position),1),n[3]||(n[3]=r(". "))])):H("",!0),a("div",$t,[a("div",It,[n[4]||(n[4]=r(" За период: ")),c(I,{modelValue:u(_).period,"onUpdate:modelValue":n[0]||(n[0]=f=>u(_).period=f),style:{width:"120px"},options:u(v),onChange:y},null,8,["modelValue","options"])]),a("div",Pt,[n[5]||(n[5]=r(" Боёв: ")),c(I,{modelValue:u(_).battlesMin,"onUpdate:modelValue":n[1]||(n[1]=f=>u(_).battlesMin=f),style:{width:"120px"},options:b,onChange:y},null,8,["modelValue"])])]),c(P,{headers:g,items:u(e).items},null,8,["items"]),c(L,{loading:u(e).loading>0},null,8,["loading"])])}}});export{qt as default};
