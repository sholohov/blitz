import{_ as j}from"./CSelect.vue.CLsfmUyK.js";import{_ as R}from"./nuxt-link.BmjxKRKG.js";import{_ as T}from"./WinRate.vue.8iAWDvYD.js";import{_ as z}from"./CTable.vue.DunflFFB.js";import{_ as D}from"./PageSection.vue.CKfXtxms.js";import{_ as q}from"./ContentLoader.vue.5R4WWV0u.js";import{_ as W}from"./PageContent.vue.n4vBIMsY.js";import{u as G}from"./disableScroll.DYMxvxot.js";import{u as H}from"./user.BLX4PKls.js";import{f as J,n as $,s as i,q as K,j as B,w as l,o as h,b as p,k as d,c as L,d as c,a as n,t as s,m as Q,C as X,F as Y}from"./entry.C5iIeEMf.js";import{s as Z}from"./index.1j3v_9h4.js";import{a as N}from"./request.CetvaxyE.js";import{a as V}from"./index._XgVvohx.js";import"./ContentBox.vue.g5rI3kyf.js";import"./CInput.vue.BzXPJvzC.js";import"./notEmpty.BxBPJGBn.js";import"./debounce.BZWlxxZt.js";import"./CDialog.vue.D0Z0bHx-.js";import"./index.BzyaR5Y-.js";import"./leader.DDloK97O.js";import"./nuxt-icon.BveY_ybo.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./client-only.BhNB6yJk.js";import"./dark-mode.D9QiTkaj.js";import"./light-mode.tI1GCGOc.js";const ee=n("div",{class:"leaderboards-page__description content-area",style:{"max-width":"800px"}},[n("p",null,'Чем выше средний "Опыт", тем выше ваша позиция в рейтинге.'),n("p",null,"Условия участия:"),n("ol",null,[n("li",null,"Быть авторизованным на ресурсе не менее 3-х дней"),n("li",null,'Провести суммарно не менее 10 "обычных" боёв в сутки')])],-1),te={key:0,class:"leaderboards-page__user-position"},ae={class:"leaderboards-page__filters"},oe={class:"leaderboards-page__filters-item"},re={class:"leaderboards-page__filters-item"},se={class:"leaderboards-page__sub"},ne={class:"leaderboards-page__sub"},le={class:"leaderboards-page__sub"},ie={class:"leaderboards-page__sub"},ce={class:"leaderboards-page__sub"},de={class:"leaderboards-page__sub"},Me=J({__name:"index",setup(pe){const k=G(),v=H(),a=$({loading:0,leaderboard:[],userOnLeaderboard:null,items:[],clanAccounts:null,accounts:null}),m=$({page:1,pageSize:100,period:7,battlesPerDay:10,battlesMin:1e4}),A=[{label:"7 дней",value:7},{label:"14 дней",value:14},{label:"30 дней",value:30},{label:"90 дней",value:90}],F=[{label:"От 1к",value:1e3},{label:"от 5к",value:5e3},{label:"от 10к",value:1e4},{label:"от 30к",value:3e4}],O=[{key:"position",label:"#",width:40,align:"center"},{key:"nickname",label:"Ник"},{key:"clan",label:"Клан"},{key:"battles",label:"Бои",tooltip:i.stat.accountProp("battles"),formatter:e=>i.number.toInteger(e)},{key:"win_rate",label:"Победы",tooltip:i.stat.accountProp("winRate"),formatter:e=>i.number.toFloatNumber(e)},{key:"damage_per_battle",label:"Урон",tooltip:i.stat.accountProp("damagePerBattle"),formatter:e=>i.number.toInteger(e)},{key:"frags_per_battle",label:"Уничт. / ур. >= 8",tooltip:i.stat.accountProp("fragPerBattle"),formatter:e=>i.number.toFloatNumber(e)},{key:"xp_per_battle",label:"Опыт",tooltip:i.stat.accountProp("xp"),formatter:e=>i.number.toInteger(e)},{key:"spotted_per_battle",label:"Обн.",tooltip:i.stat.accountProp("spotted"),formatter:e=>i.number.toFloatNumber(e)}];K(()=>{P()});async function P(){await Promise.all([E(),v.accountId?M():null]);const e=a.leaderboard.map(({id:o})=>o);e.length&&(await Promise.allSettled([w(e),S(e)]),a.items=a.leaderboard.map(o=>{var b,g,f,y;const u=(g=(b=a.clanAccounts)==null?void 0:b[o.id])==null?void 0:g.clan,_=(y=(f=a.accounts)==null?void 0:f[o.id])==null?void 0:y.statistics;return{...o,stat:_?Z.accountAll(_.all):null,clan:u??null}}))}async function S(e){a.loading++;try{const{data:o}=await N.account.getInfo({extra:"statistics.rating",account_id:e.join(",")});a.accounts=o??null}catch(o){a.accounts=null,k.add({type:"error",title:"Поучение списка аккаунтов",message:o instanceof Error?o.message:"Неизвестная ошибка"}),console.error(o)}a.loading--}async function w(e){a.loading++;try{const{data:o}=await N.clan.getAccountInfo({extra:"clan",account_id:e.join(",")});a.clanAccounts=o??null}catch(o){a.clanAccounts=null,k.add({type:"error",title:"Ошибка поучения списка клановых аккаунтов",message:o instanceof Error?o.message:"Неизвестная ошибка"}),console.error(o)}a.loading--}async function E(){a.loading++;try{const{data:e}=await V.leaderboards.getList(m);a.leaderboard=e}catch(e){a.leaderboard=[],this.notify.add({type:"error",title:"Получение рейтинга игроков",message:e instanceof Error?e.message:"Неизвестная ошибка"}),console.error(e)}a.loading--}async function M(){a.loading++;try{const{data:e}=await V.leaderboards.getList({...m,ids:[v.accountId]});a.userOnLeaderboard=e[0]}catch(e){a.userOnLeaderboard=null,k.add({type:"error",title:"Получение рейтинга пользователя",message:e instanceof Error?e.message:"Неизвестная ошибка"}),console.error(e)}a.loading--}function x(){P()}return(e,o)=>{const u=j,_=R,b=T,g=z,f=D,y=q,U=W;return h(),B(U,{class:"leaderboards-page"},{default:l(()=>[p(f,{title:"Топ «Опытных» игроков (тест)",identity:"xp"},{default:l(()=>{var C;return[ee,d(a).userOnLeaderboard?(h(),L("div",te,[c(" Ваша позиция в рейтинге: "),n("b",null,s((C=d(a).userOnLeaderboard)==null?void 0:C.position),1),c(". ")])):Q("",!0),n("div",ae,[n("div",oe,[c(" За период: "),p(u,{modelValue:d(m).period,"onUpdate:modelValue":o[0]||(o[0]=t=>d(m).period=t),style:{width:"120px"},options:A,onChange:x},null,8,["modelValue"])]),n("div",re,[c(" Боёв: "),p(u,{modelValue:d(m).battlesMin,"onUpdate:modelValue":o[1]||(o[1]=t=>d(m).battlesMin=t),style:{width:"120px"},options:F,onChange:x},null,8,["modelValue"])])]),p(g,{ref:"accountsTable","no-wrap":"","scroll-to-top":"","scroll-auto-disabling":"",headers:O,data:d(a).items,height:"calc(100vh - 112px)"},{position:l(({row:t})=>[n("span",{class:X(["leaderboards-page__mark",["leaderboards-page__mark--"+t.position]])},s(t.position),3)]),nickname:l(({row:t})=>[p(_,{class:"leaderboards-page__nickname link",to:{name:"account-id",params:{id:t.id}}},{default:l(()=>[c(s(t.nickname),1)]),_:2},1032,["to"])]),clan:l(({row:t})=>[t.clan?(h(),B(_,{key:0,class:"leaderboards-page__clan link",to:{name:"clan-id",params:{id:t.clan.clan_id}}},{default:l(()=>[c(s(t.clan.tag),1)]),_:2},1032,["to"])):(h(),L(Y,{key:1},[c(" --- ")],64))]),battles:l(({row:t})=>{var r;return[c(s(t.battles)+" ",1),n("div",se,s(e.$formatter.number.toInteger((r=t.stat)==null?void 0:r.battles)||"---"),1)]}),win_rate:l(({row:t})=>{var r;return[p(b,{"model-value":t.win_rate,class:"leaderboards-page__win-rate"},null,8,["model-value"]),n("div",ne,s(e.$formatter.number.toFloatPercent((r=t.stat)==null?void 0:r.winRate)||"---"),1)]}),damage_per_battle:l(({row:t})=>{var r;return[c(s(t.damage_per_battle)+" ",1),n("div",le,s(e.$formatter.number.toInteger((r=t.stat)==null?void 0:r.damagePerBattle)||"---"),1)]}),frags_per_battle:l(({row:t})=>{var r,I;return[c(s(t.frags_per_battle)+" / "+s(t.frags8p_per_battle)+" ",1),n("div",ie,s(e.$formatter.number.toFloatNumber((r=t.stat)==null?void 0:r.fragPerBattle)||"---")+" / "+s(e.$formatter.number.toFloatNumber((I=t.stat)==null?void 0:I.frag8pPerBattle)||"---"),1)]}),xp_per_battle:l(({row:t})=>{var r;return[c(s(t.xp_per_battle)+" ",1),n("div",ce,s(e.$formatter.number.toInteger((r=t.stat)==null?void 0:r.xpPerBattle)||"---"),1)]}),spotted_per_battle:l(({row:t})=>{var r;return[c(s(t.spotted_per_battle)+" ",1),n("div",de,s(e.$formatter.number.toInteger((r=t.stat)==null?void 0:r.spottedPerBattle)||"---"),1)]}),_:1},8,["data"])]}),_:1}),p(y,{loading:d(a).loading>0},null,8,["loading"])]),_:1})}}});export{Me as default};
