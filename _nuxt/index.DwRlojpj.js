import{_ as R}from"./CSelect.vue.B4ErcSKo.js";import{_ as T}from"./nuxt-link.C4UY2yYj.js";import{_ as z}from"./WinRate.vue.CAQSEhR2.js";import{_ as D}from"./CTable.vue.DsGWM1Ic.js";import{_ as E}from"./PageSection.vue.Ba-0kVIV.js";import{_ as W}from"./ContentLoader.vue.qy506COs.js";import{_ as q}from"./PageContent.vue.BrPWj8J-.js";import{u as G}from"./user.DYZIlJiw.js";import{f as H,n as $,s as i,q as J,j as B,w as r,o as y,b as p,k as c,c as L,d,a as s,t as n,m as K,C as Q,F as X}from"./entry.ctIX2KUb.js";import{s as Y}from"./index.BCHmrf2d.js";import{a as N}from"./request.C9u4Wmp-.js";import{a as V}from"./index.VOeJb_dr.js";import{h as k}from"./disableScroll.DDlwJlcl.js";import"./ContentBox.vue.P4GZ3NJK.js";import"./CInput.vue.DyZig88L.js";import"./notEmpty.BxBPJGBn.js";import"./debounce.C8GFgnJ3.js";import"./CDialog.vue.B3NqeRuW.js";import"./index.CNUfbNKa.js";import"./leader.BrrCgns1.js";import"./nuxt-icon.CmJtK45D.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./client-only.vVwufuq4.js";import"./dark-mode.D05sLCSW.js";import"./light-mode.cIfBeaYA.js";const Z=s("div",{class:"leaderboards-page__description content-area",style:{"max-width":"800px"}},[s("p",null,'Чем выше средний "Опыт", тем выше ваша позиция в рейтинге.'),s("p",null,"Условия участия:"),s("ol",null,[s("li",null,"Быть авторизованным на ресурсе не менее 3-х дней"),s("li",null,'Провести суммарно не менее 10 "обычных" боёв в сутки')])],-1),tt={key:0,class:"leaderboards-page__user-position"},at={class:"leaderboards-page__filters"},et={class:"leaderboards-page__filters-item"},ot={class:"leaderboards-page__filters-item"},lt={class:"leaderboards-page__sub"},nt={class:"leaderboards-page__sub"},st={class:"leaderboards-page__sub"},rt={class:"leaderboards-page__sub"},it={class:"leaderboards-page__sub"},dt={class:"leaderboards-page__sub"},Mt=H({__name:"index",setup(ct){const v=G(),e=$({loading:0,leaderboard:[],userOnLeaderboard:null,items:[],clanAccounts:null,accounts:null}),_=$({page:1,pageSize:100,period:7,battlesPerDay:10,battlesMin:1e4}),A=[{label:"7 дней",value:7},{label:"14 дней",value:14},{label:"30 дней",value:30},{label:"90 дней",value:90}],F=[{label:"От 1к",value:1e3},{label:"от 5к",value:5e3},{label:"от 10к",value:1e4},{label:"от 30к",value:3e4}],O=[{key:"position",label:"#",width:40,align:"center"},{key:"nickname",label:"Ник"},{key:"clan",label:"Клан"},{key:"battles",label:"Бои",tooltip:i.stat.accountProp("battles"),formatter:t=>i.number.toInteger(t)},{key:"win_rate",label:"Победы",tooltip:i.stat.accountProp("winRate"),formatter:t=>i.number.toFloatNumber(t)},{key:"damage_per_battle",label:"Урон",tooltip:i.stat.accountProp("damagePerBattle"),formatter:t=>i.number.toInteger(t)},{key:"frags_per_battle",label:"Уничт. / ур. >= 8",tooltip:i.stat.accountProp("fragPerBattle"),formatter:t=>i.number.toFloatNumber(t)},{key:"xp_per_battle",label:"Опыт",tooltip:i.stat.accountProp("xp"),formatter:t=>i.number.toInteger(t)},{key:"spotted_per_battle",label:"Обн.",tooltip:i.stat.accountProp("spotted"),formatter:t=>i.number.toFloatNumber(t)}];J(()=>{P()});async function P(){await Promise.all([M(),v.accountId?U():null]);const t=e.leaderboard.map(({id:o})=>o);t.length&&(await Promise.allSettled([S(t),w(t)]),e.items=e.leaderboard.map(o=>{var b,g,f,h;const u=(g=(b=e.clanAccounts)==null?void 0:b[o.id])==null?void 0:g.clan,m=(h=(f=e.accounts)==null?void 0:f[o.id])==null?void 0:h.statistics;return{...o,stat:m?Y.accountAll(m.all):null,clan:u??null}}))}async function w(t){e.loading++;try{const{data:o}=await N.account.getInfo({extra:"statistics.rating",account_id:t.join(",")});e.accounts=o??null}catch(o){e.accounts=null,k(o,{title:"Поучение списка аккаунтов"})}e.loading--}async function S(t){e.loading++;try{const{data:o}=await N.clan.getAccountInfo({extra:"clan",account_id:t.join(",")});e.clanAccounts=o??null}catch(o){e.clanAccounts=null,k(o,{title:"Ошибка поучения списка клановых аккаунтов"})}e.loading--}async function M(){e.loading++;try{const{data:t}=await V.leaderboards.getList(_);e.leaderboard=t}catch(t){e.leaderboard=[],k(t,{title:"Получение рейтинга игроков"})}e.loading--}async function U(){e.loading++;try{const{data:t}=await V.leaderboards.getList({..._,ids:[v.accountId]});e.userOnLeaderboard=t[0]}catch(t){e.userOnLeaderboard=null,k(t,{title:"Получение рейтинга пользователя"})}e.loading--}function x(){P()}return(t,o)=>{const u=R,m=T,b=z,g=D,f=E,h=W,j=q;return y(),B(j,{class:"leaderboards-page"},{default:r(()=>[p(f,{title:"Топ «Опытных» игроков (тест)",identity:"xp"},{default:r(()=>{var C;return[Z,c(e).userOnLeaderboard?(y(),L("div",tt,[d(" Ваша позиция в рейтинге: "),s("b",null,n((C=c(e).userOnLeaderboard)==null?void 0:C.position),1),d(". ")])):K("",!0),s("div",at,[s("div",et,[d(" За период: "),p(u,{modelValue:c(_).period,"onUpdate:modelValue":o[0]||(o[0]=a=>c(_).period=a),style:{width:"120px"},options:A,onChange:x},null,8,["modelValue"])]),s("div",ot,[d(" Боёв: "),p(u,{modelValue:c(_).battlesMin,"onUpdate:modelValue":o[1]||(o[1]=a=>c(_).battlesMin=a),style:{width:"120px"},options:F,onChange:x},null,8,["modelValue"])])]),p(g,{ref:"accountsTable","no-wrap":"","scroll-to-top":"","scroll-auto-disabling":"",headers:O,data:c(e).items,height:"calc(100vh - 112px)"},{position:r(({row:a})=>[s("span",{class:Q(["leaderboards-page__mark",["leaderboards-page__mark--"+a.position]])},n(a.position),3)]),nickname:r(({row:a})=>[p(m,{class:"leaderboards-page__nickname link",to:{name:"account-id",params:{id:a.id}}},{default:r(()=>[d(n(a.nickname),1)]),_:2},1032,["to"])]),clan:r(({row:a})=>[a.clan?(y(),B(m,{key:0,class:"leaderboards-page__clan link",to:{name:"clan-id",params:{id:a.clan.clan_id}}},{default:r(()=>[d(n(a.clan.tag),1)]),_:2},1032,["to"])):(y(),L(X,{key:1},[d(" --- ")],64))]),battles:r(({row:a})=>{var l;return[d(n(a.battles)+" ",1),s("div",lt,n(t.$formatter.number.toInteger((l=a.stat)==null?void 0:l.battles)||"---"),1)]}),win_rate:r(({row:a})=>{var l;return[p(b,{"model-value":a.win_rate,class:"leaderboards-page__win-rate"},null,8,["model-value"]),s("div",nt,n(t.$formatter.number.toFloatPercent((l=a.stat)==null?void 0:l.winRate)||"---"),1)]}),damage_per_battle:r(({row:a})=>{var l;return[d(n(a.damage_per_battle)+" ",1),s("div",st,n(t.$formatter.number.toInteger((l=a.stat)==null?void 0:l.damagePerBattle)||"---"),1)]}),frags_per_battle:r(({row:a})=>{var l,I;return[d(n(a.frags_per_battle)+" / "+n(a.frags8p_per_battle)+" ",1),s("div",rt,n(t.$formatter.number.toFloatNumber((l=a.stat)==null?void 0:l.fragPerBattle)||"---")+" / "+n(t.$formatter.number.toFloatNumber((I=a.stat)==null?void 0:I.frag8pPerBattle)||"---"),1)]}),xp_per_battle:r(({row:a})=>{var l;return[d(n(a.xp_per_battle)+" ",1),s("div",it,n(t.$formatter.number.toInteger((l=a.stat)==null?void 0:l.xpPerBattle)||"---"),1)]}),spotted_per_battle:r(({row:a})=>{var l;return[d(n(a.spotted_per_battle)+" ",1),s("div",dt,n(t.$formatter.number.toInteger((l=a.stat)==null?void 0:l.spottedPerBattle)||"---"),1)]}),_:1},8,["data"])]}),_:1}),p(h,{loading:c(e).loading>0},null,8,["loading"])]),_:1})}}});export{Mt as default};
