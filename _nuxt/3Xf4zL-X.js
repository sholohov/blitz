import{_ as ct}from"./BrvVNMDf.js";import{d as B,o as u,q as v,s as n,F as O,C as E,v as _,t as w,x as U,h as G,l as P,e as q,m as Y,n as M,p as N,g as s,j as k,I as Q,w as L,f as F,r as ut,A as mt,as as _t,at as dt,au as pt,ab as gt,ak as ft,u as ht,a as bt,b as yt,c as vt}from"./BytUdlbn.js";import{_ as z}from"./BwHplgHP.js";import{_ as $t}from"./DOZyoLp2.js";import{_ as Z}from"./D4jFUD0b.js";import{_ as Tt}from"./QCHe77Wz.js";import{_ as wt}from"./NGRFUg7B.js";import{_ as St}from"./CX4hQkTI.js";import{n as nt}from"./BxBPJGBn.js";import{s as K}from"./rFoUnFSB.js";import{_ as kt}from"./T65hoJzy.js";import{d as It,t as Ct}from"./B6Z-PVrD.js";import{_ as At}from"./Bt0MSxaA.js";import{_ as st}from"./HxHq1sF7.js";import{_ as xt}from"./Cjnaychb.js";import{_ as Ot}from"./fWUsAX9K.js";import{c as Rt}from"./B4FMxlHh.js";import"./bM0fVfPW.js";import"./DSr_Q9T0.js";import"./DlAUqK2U.js";import"./DlbbhUVy.js";import"./1T5zVu7K.js";import"./DD4asW33.js";import"./BpX7lcxd.js";import"./BgnVvIy8.js";import"./8hVWOGRC.js";import"./DT3k13SP.js";import"./XFwUmNy4.js";import"./2PKvI08a.js";import"./DN5pBZVe.js";import"./CgXCKoo3.js";import"./DsOP9sTD.js";const Gt={key:0,class:"tournaments-stages"},qt={class:"tournaments-stages__inner"},Dt={class:"tournaments-stages__list"},Lt={class:"tournaments-stages__title"},Et={class:"tournaments-stages__params"},Mt={class:"tournaments-stages__param"},Nt={class:"tournaments-stages__param"},jt={class:"tournaments-stages__param"},Ut={class:"tournaments-stages__param"},Ft=B({__name:"TournamentsStages",props:{stages:{type:Array,default:()=>[]}},setup(m){function o(t){const c=U.encyclopedia.tier(t.min_tier),e=U.encyclopedia.tier(t.max_tier);return c===e?c:`${c} - ${e}`}return(t,c)=>m.stages.length?(u(),v("div",Gt,[n("div",qt,[n("ul",Dt,[(u(!0),v(O,null,E(m.stages,e=>(u(),v("li",{key:e.stage_id,class:"tournaments-stages__stage"},[n("div",Lt,_(e.title),1),n("div",Et,[n("div",Mt,[c[0]||(c[0]=n("span",{class:"tournaments-stages__param-title"}," Дата ",-1)),e.start_at?(u(),v(O,{key:0},[w(_(t.$formatter.date.toDateTime(e.start_at*1e3)),1)],64)):(u(),v(O,{key:1},[w(" --- ")],64))]),n("div",Nt,[c[1]||(c[1]=n("span",{class:"tournaments-stages__param-title"}," Система ",-1)),w(" "+_(t.$formatter.tournament.stageType(e.type)),1)]),n("div",jt,[c[2]||(c[2]=n("span",{class:"tournaments-stages__param-title"}," Уровень ",-1)),w(" "+_(o(e)),1)]),n("div",Ut,[c[3]||(c[3]=n("span",{class:"tournaments-stages__param-title"}," Условие ",-1)),w(" до "+_(e.victory_limit)+" побед ",1)])])]))),128))])])])):G("",!0)}}),Pt={class:"tournaments-matches"},Vt={class:"tournaments-matches__filters"},Bt={class:"tournaments-matches__filters-item"},Ht={class:"tournaments-matches__filters-item"},Wt={class:"tournaments-matches__list"},Xt={class:"tournaments-matches__round"},Yt={class:"tournaments-matches__teams"},Jt={class:"tournaments-matches__score"},Kt={class:"tournaments-matches__date"},Qt=B({__name:"TournamentsMatches",props:{stages:{type:Array,default:()=>[],required:!0},tournamentId:{type:Object,default:()=>({}),required:!0}},setup(m){const o=m,t=P({loading:0,matches:[],selectedStage:null,selectedGroup:null}),c=P({page:1,pageSize:25,total:0}),e=q(()=>o.stages.map(d=>({label:d.title,value:d}))),T=q(()=>t.selectedStage?t.selectedStage.groups.map(d=>({label:`Группа ${d.group_order}`,value:d})):[]);Y(()=>{var d;t.selectedStage=I(),t.selectedGroup=((d=t.selectedStage)==null?void 0:d.groups[0])??null,f()});function I(){const d=o.stages.findLast(r=>r.state==="complete");return o.stages.findLast(r=>r.state==="schedule_ready")??d??o.stages[0]}function f(){!t.selectedStage||!t.selectedGroup||b(o.tournamentId,t.selectedStage.stage_id,t.selectedGroup.group_id)}async function b(d,l,r){t.loading++;try{const{data:h,meta:y}=await M.tournaments.getMatches({tournament_id:d,stage_id:l,group_id:r,limit:c.pageSize,page_no:c.page});c.total=y.total,t.matches=h}catch(h){N(h,{title:"Получение списка матчей"})}t.loading--}function x(d){t.selectedStage=d,t.selectedGroup=d.groups[0],c.page=1,f()}function C(d){t.selectedGroup=d,c.page=1,f()}return(d,l)=>{var h;const r=z;return u(),v("div",Pt,[n("div",Vt,[n("div",Bt,[w(" Этап ("+_(s(c).total??0)+") ",1),k(r,{value:s(t).selectedStage,"id-key":"stage_id",style:{width:"250px"},options:s(e),onChange:x},null,8,["value","options"])]),n("div",Ht,[w(" Группа ("+_(((h=s(t).selectedStage)==null?void 0:h.groups.length)??0)+") ",1),k(r,{value:s(t).selectedGroup,"id-key":"group_id",style:{width:"170px"},options:s(T),onChange:C},null,8,["value","options"])])]),n("div",Wt,[(u(!0),v(O,null,E(s(t).matches,y=>(u(),v("div",{key:y.id,class:"tournaments-matches__match"},[n("div",Xt," round: "+_(y.round),1),n("div",Yt,[(u(),v(O,null,E([1,2],A=>n("div",{key:A,class:Q(["tournaments-matches__team",["tournaments-matches__team--"]])},[w(_(y[`team_${A}_id`])+" ",1),n("span",Jt,_(y[`team_${A}_score`]||0),1)])),64))]),n("span",Kt,_(d.$formatter.date.toDateTime(y.start_time*1e3)),1)]))),128))])])}}}),Zt={class:"tournament-team"},zt={class:"tournament-team__inner"},te={class:"tournament-team__props-list"},ee={class:"tournament-team__props"},ae={class:"tournament-team__props"},ne={class:"tournament-team__props"},se={class:"tournament-team__player-list"},oe={key:0,class:"tournament-team__details"},ie={class:"tournament-team__player-name"},re={class:"tournament-team__player-stat"},le={class:"tournament-team__stat-item"},ce={key:1,class:"tournament-team__empty"},ue=B({__name:"TournamentTeam",props:{tournament:{type:Object,default:()=>({}),required:!0},team:{type:Object,default:()=>({}),required:!0}},setup(m){const o=m,t=P({loading:0,players:[],statisticsAll:null});Y(()=>{const f=o.tournament.max_players_count;t.players=Array(f).fill(T({})),I()});async function c(f){t.loading++;try{const{data:b}=await M.clan.getAccountInfo({extra:"clan",account_id:f.join(",")});return Object.values(b).filter(nt)}catch(b){return N(b,{title:"Поучение списка клановых аккаунтов"}),[]}finally{t.loading--}}async function e(f){t.loading++;try{const{data:b}=await M.account.getInfo({extra:"statistics.rating",account_id:f.join(",")});return Object.values(b).filter(nt)}catch(b){return N(b,{title:"Поучение списка аккаунтов"}),[]}finally{t.loading--}}function T(f){var C,d,l,r,h,y,A,p;const b=(C=f.account)==null?void 0:C.statistics.all,x=(d=f.account)==null?void 0:d.statistics.rating;return{id:((l=f.player)==null?void 0:l.account_id)??0,name:((r=f.player)==null?void 0:r.name)??"",isOwner:((h=f.player)==null?void 0:h.role)==="owner",clan:(y=f.clanAccount)!=null&&y.clan?{id:f.clanAccount.clan_id,tag:((A=f.clanAccount.clan)==null?void 0:A.tag)??"",name:((p=f.clanAccount.clan)==null?void 0:p.name)??""}:null,statistic:{all:b?K.accountAll(b):null,rating:x?K.accountRating(x):null}}}async function I(){const f=o.team.players.map(l=>l.account_id),[b,x]=await Promise.all([e(f),c(f)]),C=b.reduce((l,r,h)=>h===0?b[0].statistics:K.sumFull(l,r.statistics),{});t.statisticsAll=K.accountAll(C.all,b.length);const d=o.tournament.max_players_count;t.players=Array(d).fill({}).map((l,r)=>{const h=o.team.players[r],y=b.find(p=>p.account_id===(h==null?void 0:h.account_id)),A=x.find(p=>p.account_id===(h==null?void 0:h.account_id));return T({player:h,account:y,clanAccount:A})}).sort(l=>l.isOwner?1:0)}return(f,b)=>{var r,h;const x=Tt,C=wt,d=St,l=Z;return u(),v("div",Zt,[n("div",zt,[n("div",te,[n("div",ee,[b[0]||(b[0]=n("span",{class:"tournament-team__props-title"},"Статус",-1)),w(" "+_(f.$formatter.tournament.teamStatusDetails(m.team.status)),1)]),n("div",ae,[b[1]||(b[1]=n("span",{class:"tournament-team__props-title"},"Ср. побед",-1)),k(x,{"win-rate":((r=s(t).statisticsAll)==null?void 0:r.winRate)||0},null,8,["win-rate"])]),n("div",ne,[b[2]||(b[2]=n("span",{class:"tournament-team__props-title"},"Ср. боёв",-1)),w(" "+_(f.$formatter.number.toInteger(((h=s(t).statisticsAll)==null?void 0:h.battles)||0)),1)])]),n("ul",se,[(u(!0),v(O,null,E(s(t).players,(y,A)=>{var p;return u(),v("li",{key:y.id||A,class:"tournament-team__player"},[k(C,{width:"18",height:"18",class:"tournament-team__player-role",role:y.isOwner?"commander":"private"},null,8,["role"]),y.id?(u(),v("div",oe,[n("div",ie,[k(d,{class:"tournament-team__player-link link",to:{name:"account-id",params:{id:y.id}}},{default:L(()=>[w(_(y.name),1)]),_:2},1032,["to"]),y.clan?(u(),F(d,{key:0,class:"tournament-team__player-link link",to:{name:"clan-id",params:{id:y.clan.id}}},{default:L(()=>{var S;return[w(_(`[${(S=y.clan)==null?void 0:S.tag}]`),1)]}),_:2},1032,["to"])):G("",!0)]),n("span",re,[y.statistic.all?(u(),F(x,{key:0,class:"tournament-team__stat-item","win-rate":y.statistic.all.winRate},null,8,["win-rate"])):G("",!0),n("span",le,_((p=y.statistic.all)==null?void 0:p.battles),1)])])):(u(),v("span",ce," Место свободно "))])}),128))]),k(l,{"backdrop-light":"",loading:s(t).loading>0},null,8,["loading"])])])}}}),me={class:"tournaments-teams"},_e={class:"tournaments-teams__filters"},de={class:"tournaments-teams__filters-item"},pe={class:"tournaments-teams__filters-item"},ge={class:"tournaments-teams__count"},fe={class:"tournaments-teams__list"},he=["onClick"],be={class:"tournaments-teams__team-description"},ye={class:"tournaments-teams__team-name"},ve={class:"tournaments-teams__team-owner"},$e={class:"tournaments-teams__team-owner-text"},Te={class:"tournaments-teams__team-count"},we=B({__name:"TournamentsTeams",props:{tournament:{type:Object,default:()=>({}),required:!0}},setup(m){const o=[null,"confirmed","forming","disqualified"],t=m,c=ut(null),e=P({loading:0,teams:[],currentTeam:null}),T=P({page:1,total:0,pageSize:50}),I=P({status:"confirmed",search:""}),f=o.map(p=>({label:p?U.tournament.teamStatus(p):"Все",value:p})),b=q(()=>T.total>T.page*T.pageSize);Y(()=>{window.addEventListener("scroll",r)}),mt(()=>{window.removeEventListener("scroll",r)});function x(p){var S;return(S=p.players.find(D=>D.role==="owner"))==null?void 0:S.name}const C=It(d,1e3,{leading:!0});async function d(){await l()}async function l(){e.loading++;try{const{data:p,meta:S}=await M.tournaments.getTeams({tournament_id:t.tournament.tournament_id,limit:T.pageSize,page_no:T.page,...I});T.total=S.total,e.teams.push(...p)}catch(p){N(p,{title:"Получение списка команд"})}e.loading--}function r(){if(!e.teams.length)return;const{scrollTop:p,scrollHeight:S,clientHeight:D}=document.documentElement;e.loading===0&&b.value&&b.value&&p+D>=S-100&&(T.page+=1,l())}function h(){T.page=1,e.teams=[],d()}async function y(p=""){I.search=p=p.trim(),!(p.length<2&&p!=="")&&(T.page=1,e.teams=[],await C())}function A(p){var S;e.currentTeam=p,(S=c.value)==null||S.doOpen()}return(p,S)=>{var g;const D=z,H=$t,W=Z,a=ue,i=kt;return u(),v("div",me,[n("div",_e,[n("div",de,[S[0]||(S[0]=w(" Статус ")),k(D,{"model-value":s(I).status,style:{width:"220px"},options:s(f),onChange:h},null,8,["model-value","options"])]),n("div",pe,[S[1]||(S[1]=w(" Поиск ")),k(H,{"model-value":s(I).search,type:"search",placeholder:"Введите название команды",style:{width:"300px"},onInput:y},null,8,["model-value"])])]),n("div",ge,[S[2]||(S[2]=n("div",{class:"tournaments-teams__count-title"}," Кол-во: ",-1)),w(" "+_(s(T).total||0),1)]),n("div",fe,[(u(!0),v(O,null,E(s(e).teams,$=>(u(),v("button",{key:$.team_id,class:"tournaments-teams__team",onClick:R=>A($)},[n("span",{class:Q(["tournaments-teams__status",[$.status?`tournaments-teams__status--${$.status}`:""]])},null,2),n("span",be,[n("span",ye,_($.title),1),n("span",ve,[n("span",$e,_(x($)),1)])]),n("span",Te,_($.players.length)+" / "+_(m.tournament.max_players_count),1)],8,he))),128)),k(W,{loading:s(e).loading>0},null,8,["loading"])]),k(i,{ref_key:"teamDialogRef",ref:c,width:"500px",title:(g=s(e).currentTeam)==null?void 0:g.title},{default:L(()=>[s(e).currentTeam?(u(),F(a,{key:0,tournament:m.tournament,team:s(e).currentTeam},null,8,["tournament","team"])):G("",!0)]),_:1},8,["title"])])}}});function Se(m,o,t){var c=-1,e=m.length;o<0&&(o=-o>e?0:e+o),t=t>e?e:t,t<0&&(t+=e),e=o>t?0:t-o>>>0,o>>>=0;for(var T=Array(e);++c<e;)T[c]=m[c+o];return T}var ke=Se,Ie=gt,Ce=dt,Ae=pt,xe=_t;function Oe(m,o,t){if(!xe(t))return!1;var c=typeof o;return(c=="number"?Ce(t)&&Ae(o,t.length):c=="string"&&o in t)?Ie(t[o],m):!1}var Re=Oe,Ge=Ct,ot=1/0,qe=17976931348623157e292;function De(m){if(!m)return m===0?m:0;if(m=Ge(m),m===ot||m===-ot){var o=m<0?-1:1;return o*qe}return m===m?m:0}var Le=De,Ee=Le;function Me(m){var o=Ee(m),t=o%1;return o===o?t?o-t:o:0}var Ne=Me,je=ke,Ue=Re,Fe=Ne,Pe=Math.ceil,Ve=Math.max;function Be(m,o,t){(t?Ue(m,o,t):o===void 0)?o=1:o=Ve(Fe(o),0);var c=m==null?0:m.length;if(!c||o<1)return[];for(var e=0,T=0,I=Array(Pe(c/o));e<c;)I[T++]=je(m,e,e+=o);return I}var He=Be;const We=ft(He),Xe={class:"tournaments-tables"},Ye={class:"tournaments-tables__filters"},Je={class:"tournaments-tables__filters-item"},Ke={class:"tournaments-tables__filters-item"},Qe={class:"tournaments-tables__stage-state"},Ze={key:0,class:"tournaments-tables__table-scroll"},ze={key:0,class:"tournaments-tables__table-round-title"},ta=["onClick"],ea={class:"tournaments-tables__table-team-details"},aa={class:"tournaments-tables__table-team-title"},na={class:"tournaments-tables__table-team-score"},sa={class:"tournaments-tables__table-team-details"},oa={class:"tournaments-tables__table-team-title"},ia=B({__name:"TournamentsTables",props:{tournamentId:{type:[String,Number],default:"",required:!0},stages:{type:Array,default:()=>[],required:!0}},setup(m){const o=m,t=P({loading:0,standings:[],tables:[],matches:[],selectedStage:null,selectedGroup:null,tableOne:[],tableTwo:[],highlightTeamId:null,total:0,standingsTotal:0}),c=q(()=>t.tables.filter(a=>{var i;return a.group_id===((i=t.selectedGroup)==null?void 0:i.group_id)})),e=q(()=>c.value.map(a=>{const i=t.standings.find(g=>a.team_id===g.team_id&&g.group_id===a.group_id);return{...a,wins:(i==null?void 0:i.wins)??0,draws:(i==null?void 0:i.draws)??0,losses:(i==null?void 0:i.losses)??0}})),T=[{key:"position",label:"#",width:40,align:"center"},{key:"name",label:"Команда"},{key:"matches_played",label:"Бои",width:60,align:"center"},{key:"wins",label:"Победы",width:60,align:"center"},{key:"draws",label:"Ничьи",width:60,align:"center"},{key:"losses",label:"Пораж.",width:60,align:"center"},{key:"team_points",label:"Очки",width:60,align:"center"}],I=q(()=>o.stages.map(a=>({label:a.title,value:a,disabled:!["complete","schedule_ready"].includes(a.state)}))),f=q(()=>t.selectedStage?t.selectedStage.groups.map(a=>({label:`Группа ${a.group_order}`,value:a})):[]),b=q(()=>{var a;switch((a=t.selectedStage)==null?void 0:a.state){case"draft":return"Проект создан";case"groups_ready":return"Группы сформированы";case"schedule_ready":return"График построен";case"complete":return"Этап завершён";default:return"..."}});Y(async()=>{var a;t.selectedStage=l(),t.selectedGroup=((a=t.selectedStage)==null?void 0:a.groups[0])??null,await r(),C()});function x(a){var g;const i=(g=t.selectedStage)==null?void 0:g.type;if(i==="SE"){if(a===1)return"Финал";if(a===2)return"Полуфинал";if(a===3)return"Четвертьфинал";if(a===-1)return"Матч за третье место"}if(i==="DE"){if(a===3)return"Верхняя сетка | Четвертьфинал";if(a===2)return"Верхняя сетка | Полуфинал";if(a===1)return"Верхняя сетка | Финал";if(a===0)return"Гранд-Финал";if(a===-1)return"Нижняя сетка | Финал";if(a===-2)return"Нижняя сетка | Полуфинал";if(a===-3)return"Нижняя сетка | Четвертьфинал"}return""}function C(){t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.matches.forEach(a=>{const i=t.tables.find(R=>R.team_id===a.team_1_id),g=t.tables.find(R=>R.team_id===a.team_2_id);if(!i||!g)return;const $={...a,teams:[i,g]};a.round===3&&t.tableOne[0].push($),a.round===2&&t.tableOne[1].push($),a.round===1&&t.tableOne[2].push($),a.round===-3&&t.tableTwo[0].push($),a.round===-2&&t.tableTwo[1].push($),a.round===-1&&t.tableTwo[2].push($),a.round===0&&t.tableTwo[3].push($)})}function d(a,i){return i.team_id===a.winner_team_id}function l(){const a=o.stages.findLast(g=>g.state==="schedule_ready"),i=o.stages.findLast(g=>g.state==="complete");return a??i??o.stages[0]}async function r(){var g,$,R;const a=(g=t.selectedStage)==null?void 0:g.stage_id,i=($=t.selectedGroup)==null?void 0:$.group_id;!a||!i||(await p({tournament_id:o.tournamentId,group_id:i,stage_id:a}),((R=t.selectedStage)==null?void 0:R.type)==="RR"?await y({tournament_id:o.tournamentId,team_id:c.value.map(J=>J.team_id).join(",")}):await h({tournament_id:o.tournamentId,group_id:i,stage_id:a}))}async function h(a){t.loading++;try{const{data:i}=await M.tournaments.getMatches({...a,limit:25});t.matches=i}catch(i){N(i,{title:"Получение матчей"})}t.loading--}async function y(a){const i=We(String(a.team_id).split(","),10);for(const g of i)await A({...a,team_id:g.join(",")})}async function A(a){t.loading++;try{const{data:i,meta:g}=await M.tournaments.getStandings({...a,limit:25});t.standings.push(...i),t.standingsTotal=g.total}catch(i){N(i,{title:"Получение результатов команд"})}t.loading--}async function p(a){let i=1;const g=25,$=async()=>{await S({...a,page_no:i,limit:g}),t.total>i*g&&(i++,await $())};await $()}async function S(a){t.loading++;try{const{data:i,meta:g}=await M.tournaments.getTables(a);t.tables.push(...i),t.total=g.total}catch(i){N(i,{title:"Получение турнирной сетки"})}t.loading--}async function D(a){t.selectedStage=a,t.selectedGroup=a.groups[0],t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.standings=[],t.tables=[],t.matches=[],await r(),t.selectedStage.type!=="RR"&&C()}async function H(a){t.selectedGroup=a,t.selectedStage&&(t.selectedStage.type==="RR"?(t.standings=[],await y({tournament_id:o.tournamentId,team_id:c.value.map(i=>i.team_id).join(",")})):(t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.matches=[],await h({tournament_id:o.tournamentId,group_id:a.group_id,stage_id:t.selectedStage.stage_id}),C()))}function W(a){t.highlightTeamId=a.team_id}return(a,i)=>{var J,tt;const g=z,$=At,R=Z;return u(),v("div",Xe,[n("div",Ye,[n("div",Je,[w(" Этап ("+_(s(t).total??0)+") ",1),k(g,{"model-value":s(t).selectedStage,"id-key":"stage_id",style:{width:"250px"},options:s(I),disabled:!s(I).length,onChange:D},null,8,["model-value","options","disabled"])]),n("div",Ke,[w(" Группа ("+_(((J=s(t).selectedStage)==null?void 0:J.groups.length)??"---")+") ",1),k(g,{"model-value":s(t).selectedGroup,"id-key":"group_id",style:{width:"170px"},disabled:!s(f).length,options:s(f),onChange:H},null,8,["model-value","disabled","options"])])]),n("div",Qe,[i[0]||(i[0]=n("span",{class:"tournaments-tables__stage-state-label"}," Состояние этапа ",-1)),w(" "+_(s(b)),1)]),((tt=s(t).selectedStage)==null?void 0:tt.type)!=="RR"?(u(),v("div",Ze,[(u(!0),v(O,null,E([s(t).tableOne,s(t).tableTwo],(V,et)=>(u(),v("div",{key:et,class:Q(["tournaments-tables__table",[`tournaments-tables__table--${et?"bottom":"top"}`]])},[(u(!0),v(O,null,E(V,(it,rt)=>(u(),v("div",{key:rt,class:"tournaments-tables__table-round"},[(u(!0),v(O,null,E(it,(X,lt)=>(u(),v("div",{key:X.id,class:"tournaments-tables__table-battle"},[lt===0?(u(),v("div",ze,_(x(X.round)),1)):G("",!0),(u(!0),v(O,null,E(X.teams,(j,at)=>(u(),v("button",{key:at,class:Q(["tournaments-tables__table-team",[d(X,j)?"tournaments-tables__table-team--is-winner":"",j.team_id===s(t).highlightTeamId?"tournaments-tables__table-team--is-highlight":""]]),onClick:$a=>W(j)},[n("span",ea,[k(st,{class:"tournaments-tables__table-team-clan-emblem",alt:j.clan_label,emblem:j.clan_emblem_preset_id},null,8,["alt","emblem"]),n("span",aa,[j.clan_label?(u(),v(O,{key:0},[w(" ["+_(j.clan_label)+"] ",1)],64)):G("",!0),w(" "+_(j.title),1)])]),n("span",na,_(X[`team_${at+1}_score`]??"-"),1)],10,ta))),128))]))),128))]))),128))],2))),128))])):(u(),F($,{key:1,"no-wrap":"","scroll-auto-disabling":"","row-key":"account_id",height:"calc(100vh - 112px)",headers:T,data:s(e)},{name:L(({row:V})=>[n("div",sa,[k(st,{class:"tournaments-tables__table-team-clan-emblem",alt:V.clan_label,emblem:V.clan_emblem_preset_id},null,8,["alt","emblem"]),n("span",oa,[V.clan_label?(u(),v(O,{key:0},[w(" ["+_(V.clan_label)+"] ",1)],64)):G("",!0),w(" "+_(V.title),1)])])]),_:1},8,["data"])),k(R,{loading:s(t).loading>0},null,8,["loading"])])}}}),ra={key:0,class:"tournaments-info-page__inner"},la={class:"tournaments-info-page__header"},ca={class:"tournaments-info-page__details"},ua={class:"tournaments-info-page__title"},ma={class:"tournaments-info-page__props"},_a={class:"tournaments-info-page__prop"},da={class:"tournaments-info-page__prop-title"},pa={class:"tournaments-info-page__props"},ga={class:"tournaments-info-page__prop"},fa={class:"tournaments-info-page__body"},ha=["textContent"],ba={class:"tournaments-info-page__body"},ya={class:"tournaments-info-page__body"},va={class:"tournaments-info-page__body"},tn=B({__name:"[id]",setup(m){const{$formatter:o}=ht(),t=bt();yt({title:()=>o.route.getTitle(Rt.toString(t.name)??"")});const c=vt(),e=P({loading:0,tournament:null,stages:[],activeTab:"info"}),T=q(()=>{var r,h;const l=[{label:"Описание",name:"info"},{label:"Команды",name:"teams",disabled:((r=e.tournament)==null?void 0:r.status)==="upcoming"}];return e.stages.length&&l.push({label:"Сетка",name:"tables",disabled:!["running","finished","complete"].includes(((h=e.tournament)==null?void 0:h.status)??"")}),l}),I=q(()=>{var l;switch((l=e.tournament)==null?void 0:l.status){case"upcoming":return{title:"Начало регистрации",date:U.date.toDateTime(e.tournament.registration_start_at*1e3)};case"registration_started":return{title:"Окончание регистрации",date:U.date.toDateTime(e.tournament.registration_end_at*1e3)};case"registration_finished":return{title:"Начало мачей",date:U.date.toDateTime(e.tournament.matches_start_at*1e3)};case"running":return{title:"Завершение",date:U.date.toDateTime(e.tournament.end_at*1e3)};case"finished":case"complete":return{title:"Завершен",date:U.date.toDateTime(e.tournament.end_at*1e3)}}return{title:"---",date:"---"}});Y(async()=>{var r;const l=(r=t.query)==null?void 0:r.activeTab;C(l||T.value[0].name),await f()});async function f(){const l=t.params.id;l&&await Promise.all([b(l),x(l)])}async function b(l){e.loading++;try{const{data:r}=await M.tournaments.getInfo({tournament_id:l});e.tournament=r[l]??null}catch(r){N(r,{title:"Получение информации турнира"})}e.loading--}async function x(l){e.loading++;try{const{data:r}=await M.tournaments.getStages({tournament_id:l});e.stages=r??[]}catch(r){N(r,{title:"Получение этапов турнира"})}e.loading--}function C(l){var r;e.activeTab=l,((r=t.query)==null?void 0:r.activeTab)!==l&&c.replace({query:{...t.query,activeTab:l}})}function d({name:l}){C(l)}return(l,r)=>{const h=ct,y=Ft,A=Qt,p=we,S=ia,D=xt,H=Z,W=Ot;return u(),F(W,{class:"tournaments-info-page"},{default:L(()=>{var a,i,g,$;return[s(e).tournament?(u(),v("div",ra,[n("div",la,[k(h,{src:s(e).tournament.logo.original,alt:"Tournament IMG",class:"tournaments-info-page__img"},null,8,["src"]),n("div",ca,[n("h1",ua,_((a=s(e).tournament)==null?void 0:a.title),1),n("div",ma,[n("div",_a,[n("div",da,_(s(I).title),1),w(" "+_(s(I).date),1)])]),n("div",pa,[n("div",ga,[r[1]||(r[1]=n("div",{class:"tournaments-info-page__prop-title"}," Команд ",-1)),w(" "+_(((i=s(e).tournament)==null?void 0:i.teams.confirmed)||0)+" / "+_(((g=s(e).tournament)==null?void 0:g.teams.total)||0)+" / "+_((($=s(e).tournament)==null?void 0:$.teams.max)||0),1)])])])]),k(D,{modelValue:s(e).activeTab,"onUpdate:modelValue":r[0]||(r[0]=R=>s(e).activeTab=R),tabs:s(T),onTabClick:d},{info:L(()=>[n("div",fa,[s(e).stages.length?(u(),F(y,{key:0,stages:s(e).stages,class:"tournaments-info-page__stages","tournament-id":s(e).tournament.tournament_id},null,8,["stages","tournament-id"])):G("",!0),n("div",{class:"tournaments-info-page__description",textContent:_(s(e).tournament.description)},null,8,ha)])]),matches:L(()=>[n("div",ba,[s(e).stages.length?(u(),F(A,{key:0,stages:s(e).stages,"tournament-id":s(e).tournament.tournament_id},null,8,["stages","tournament-id"])):G("",!0)])]),teams:L(()=>[n("div",ya,[k(p,{tournament:s(e).tournament},null,8,["tournament"])])]),tables:L(()=>[n("div",va,[s(e).stages.length?(u(),F(S,{key:0,"tournament-id":s(e).tournament.tournament_id,stages:s(e).stages},null,8,["tournament-id","stages"])):G("",!0)])]),_:1},8,["modelValue","tabs"])])):G("",!0),k(H,{loading:s(e).loading>0},null,8,["loading"])]}),_:1})}}});export{tn as default};
