import{_ as L,a as G,u as ee}from"./disableScroll.BUC5HZdp.js";import{_ as H}from"./nuxt-link.CEOfUkt0.js";import{_ as te}from"./CDialog.vue.BpKdiBXO.js";import{f as E,r as W,i as j,o as u,c as f,a as t,b as _,w as p,k as r,C as Z,t as i,d as m,F as q,A as U,m as P,j as R,D as ie,_ as J,n as V,q as ae,E as oe,s as K,g as ce,G as re,H as _e}from"./entry.FvyONZHj.js";import{_ as ne}from"./ContentLoader.vue.kCcbdDCf.js";import{c as de,m as ue,s as Q,_ as me}from"./index.CD1WNIvx.js";import{s as O,a as z}from"./request.CuV_NRrd.js";import{_ as pe}from"./PageSection.vue.Ddp3OhH1.js";import{_ as ve}from"./CInput.vue.Bb_H1cLp.js";import{_ as fe}from"./CSelect.vue.C8JmigRq.js";import{f as F}from"./index.DVAFURtC.js";import{_ as he}from"./RoleIcon.vue.CupN9KW3.js";import{_ as be}from"./WinRate.vue.DiFcwfq2.js";import{_ as ge,m as X}from"./RatingIcon.vue.EjjZvg7-.js";import{_ as we}from"./CTable.vue.Cu8sf2MZ.js";import{s as T}from"./index.CPrYhzBm.js";import{n as ye}from"./notEmpty.BxBPJGBn.js";import{c as Y}from"./cloneDeep.DdCxMNxM.js";import{a as $e}from"./index.Dsl6k6x1.js";import"./isArrayLike.CBTZaP6R.js";const ke={class:"clan-events"},Ce={class:"clan-events__inner"},De={class:"clan-events__count"},Ie={class:"clan-events__prop"},xe=t("span",{class:"clan-events__prop-title"}," События от ",-1),Be={key:0,class:"clan-events__prop"},Ae={class:"clan-events__prop-title"},Pe={key:1,class:"clan-events__prop"},Re={class:"clan-events__prop-title"},je={key:2},Se={style:{display:"flex","justify-content":"space-between"}},Ee=t("div",null,null,-1),Fe=E({__name:"ClanEvents",props:{savedAt:{type:Number,default:0,required:!0},clan:{type:Object,default:()=>({}),required:!0},savedClan:{type:Object,default:()=>({}),required:!0}},emits:["reset"],setup(n,{emit:v}){const h=n,e=W(null),g=j(()=>{const a=h.clan.members_ids??[],D=h.savedClan.members??[];return Object.values(D).filter(b=>!a.includes(b.account_id))}),w=j(()=>{var b,y;const a=((b=h.clan)==null?void 0:b.members)??[],D=((y=h.savedClan)==null?void 0:y.members_ids)??[];return Object.values(a).filter(x=>!D.includes(x.account_id))}),k=j(()=>w.value.length+g.value.length),I=v;function $(){var a;I("reset"),(a=e.value)==null||a.doClose()}function s(){var a;(a=e.value)==null||a.doOpen()}function d(){var a;(a=e.value)==null||a.doClose()}return(a,D)=>{const b=L,y=G,x=H,S=te;return u(),f("div",ke,[t("div",Ce,[_(y,{disabled:!r(k),class:Z(["clan-events__btn",[r(k)?"clan-events__btn--has-unread":""]]),"is-text":"","is-square":"",title:"События клана",onClick:s},{default:p(()=>[_(b,{name:"mail"})]),_:1},8,["disabled","class"]),t("div",De,i(r(k)>99?"99+":r(k)),1)]),_(S,{ref_key:"dialogRef",ref:e,width:"640px",title:"События клана"},{title:p(()=>[t("div",Ie,[xe,m(" "+i(a.$formatter.date.toDateTime(n.savedAt))+" ("+i(a.$formatter.date.toDaysPassed(n.savedAt,Date.now()))+") ",1)])]),footer:p(()=>[t("div",Se,[Ee,t("div",null,[_(y,{onClick:$},{default:p(()=>[m(" Прочитано ")]),_:1}),_(y,{onClick:d},{default:p(()=>[m(" Закрыть ")]),_:1})])])]),default:p(()=>[r(g).length?(u(),f("div",Be,[t("span",Ae," Покинули ("+i(r(g).length)+") ",1),(u(!0),f(q,null,U(r(g),(l,o)=>(u(),f("span",{key:l.account_id,class:"clan-events__prop-value"},[_(x,{to:{name:"account-id",params:{id:l.account_id}},class:"link"},{default:p(()=>[m(i(l.account_name),1)]),_:2},1032,["to"]),m(i(o+1!==r(g).length?", ":""),1)]))),128))])):P("",!0),r(w).length?(u(),f("div",Pe,[t("span",Re," Вступили ("+i(r(w).length)+") ",1),(u(!0),f(q,null,U(r(w),(l,o)=>(u(),f("span",{key:l.account_id,class:"clan-events__prop-value"},[_(x,{to:{name:"account-id",params:{id:l.account_id}},class:"link"},{default:p(()=>[m(i(l.account_name),1)]),_:2},1032,["to"]),m(i(o+1!==r(w).length?", ":""),1)]))),128))])):P("",!0),r(k)?P("",!0):(u(),f("span",je," Пока всё тихо ... "))]),_:1},512)])}}}),Me={class:"social-links"},Oe={class:"social-links__links"},qe=["href","title"],Te=E({__name:"SocialLinks",props:{links:{type:Array,default:()=>[],required:!0}},setup(n){return(v,h)=>(u(),f("div",Me,[t("div",Oe,[(u(!0),f(q,null,U(n.links,e=>(u(),f("a",{key:e.link,class:"link social-links__links-item",href:e.link,target:"_blank",title:e.title},[(u(),R(ie(e.icon),{width:"24",height:"24"}))],8,qe))),128))])]))}}),Ve=/(https?:\/\/)?(www\.)?(discord\.(gg|io|me|li)|discordapp\.com\/invite)\/.+[a-z|0-9]/gi,Le=/(https?:\/\/)?(www\.)?((t|telegram)\.me)\/\+?[a-zA-Z0-9_]{5,32}/gi,Ne=n=>{const v=[],h=n.match(Ve),e=n.match(Le);return h!=null&&h.length&&v.push({title:"Discord",icon:()=>J(()=>import("./discord.CgTq0l7I.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),link:h[0]}),e!=null&&e.length&&v.push({title:"Telegram",icon:()=>J(()=>import("./telegram.CkWIgnNv.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url),link:e[0]}),v},ze={parse:Ne},Ue={class:"clan-preview-details__body"},Ge={key:0,class:"clan-preview-details__section"},He={class:"clan-preview-details__props-title"},We={class:"clan-preview-details__section"},Ze={class:"clan-preview-details__props-title"},Je=["textContent"],Ke={key:1,class:"clan-preview-details__section"},Qe={class:"clan-preview-details__props-title"},Xe={class:"clan-preview-details__props"},Ye={class:"clan-preview-details__prop"},et=t("span",{class:"clan-preview-details__prop-title"}," Создатель ",-1),tt={class:"clan-preview-details__prop"},at=t("span",{class:"clan-preview-details__prop-title"}," Дата создания ",-1),nt={class:"clan-preview-details__prop"},st=t("span",{class:"clan-preview-details__prop-title"}," Дата обновления ",-1),lt={class:"clan-preview-details__prop"},it=t("span",{class:"clan-preview-details__prop-title"}," Участников ",-1),ot={key:0,class:"clan-preview-details__prop"},ct=t("span",{class:"clan-preview-details__prop-title"}," Старое название ",-1),rt={class:"clan-preview-details__section"},_t={class:"clan-preview-details__props-title"},dt={class:"clan-preview-details__props"},ut={class:"clan-preview-details__prop"},mt=t("span",{class:"clan-preview-details__prop-title"}," Политика приёма. ",-1),pt=t("div",{class:"clan-preview-details__props-subtitle"}," Пороги статистики для вступления: ",-1),vt={class:"clan-preview-details__prop"},ft=t("span",{class:"clan-preview-details__prop-title"}," Боёв в день ",-1),ht={class:"clan-preview-details__prop"},bt=t("span",{class:"clan-preview-details__prop-title"}," Боёв всего ",-1),gt={class:"clan-preview-details__prop"},wt=t("span",{class:"clan-preview-details__prop-title"}," Урон ср. ",-1),yt={class:"clan-preview-details__prop"},$t=t("span",{class:"clan-preview-details__prop-title"}," Уровень ",-1),kt={class:"clan-preview-details__prop"},Ct=t("span",{class:"clan-preview-details__prop-title"}," Побед ",-1),Dt={style:{display:"flex","justify-content":"space-between"}},It=E({__name:"ClanPreviewDetails",props:{clan:{type:Object,default:()=>({}),required:!0}},setup(n,{expose:v}){const h=n,e=W(null),g=V({descExpended:!1}),w=j(()=>ze.parse(h.clan.description??""));function k(){var s;(s=e.value)==null||s.doOpen()}function I(){var s;(s=e.value)==null||s.doClose()}function $(){g.descExpended=!g.descExpended}return v({open:k,close:I}),(s,d)=>{const a=L,D=G,b=H,y=Te,x=te;return u(),R(x,{ref_key:"clanDetailsRef",ref:e,class:"clan-preview-details",title:`[${n.clan.tag}] ${n.clan.name}`,width:"640px"},{footer:p(()=>[t("div",Dt,[_(y,{class:"clan-preview-details__links",links:r(w)},null,8,["links"]),_(D,{onClick:I},{default:p(()=>[m(" Закрыть ")]),_:1})])]),default:p(()=>[t("div",Ue,[n.clan.motto?(u(),f("div",Ge,[t("h5",He,[_(a,{class:"clan-preview-details__prop-title-icon",name:"format-quote"}),m(" Девиз ")]),t("i",null,i(n.clan.motto),1)])):P("",!0),t("div",We,[t("h5",Ze,[_(a,{class:"clan-preview-details__prop-title-icon",name:"description"}),m(" Описание ")]),n.clan.description?(u(),f("div",{key:0,class:Z(["content-area clan-preview-details__desc",r(g).descExpended?"clan-preview-details__desc--expended":""]),textContent:i(n.clan.description)},null,10,Je)):P("",!0),_(D,{"is-text":"",class:"clan-preview-details__desc-expend-btn",onClick:$},{default:p(()=>[m(i(r(g).descExpended?"Свернуть":"Развернуть"),1)]),_:1})]),n.clan.motto?(u(),f("div",Ke,[t("h5",Qe,[_(a,{class:"clan-preview-details__prop-title-icon",name:"info"}),m(" Информация ")]),t("div",Xe,[t("div",Ye,[et,n.clan.creator_id?(u(),R(b,{key:0,class:"link",to:n.clan.creator_id?{name:"account-id",params:{id:n.clan.creator_id}}:{}},{default:p(()=>[m(i(n.clan.creator_name),1)]),_:1},8,["to"])):(u(),f(q,{key:1},[m(" Не известен ")],64))]),t("div",tt,[at,m(" "+i(s.$formatter.date.toDate(n.clan.created_at*1e3)),1)]),t("div",nt,[st,m(" "+i(s.$formatter.date.toDate(n.clan.updated_at*1e3)),1)]),t("div",lt,[it,m(" "+i(s.$formatter.number.toInteger(n.clan.members_count)),1)]),n.clan.old_tag?(u(),f("div",ot,[ct,m(" ["+i(n.clan.old_tag)+"] "+i(n.clan.old_name),1)])):P("",!0)])])):P("",!0),t("div",rt,[t("h5",_t,[_(a,{class:"clan-preview-details__prop-title-icon",name:"person-search"}),m(" Рекрутинг ")]),t("div",dt,[t("div",ut,[mt,m(" "+i(s.$formatter.clan.recruitingPolicy(n.clan.recruiting_policy))+". ",1)]),n.clan.recruiting_policy==="open"&&n.clan.recruiting_options?(u(),f(q,{key:0},[pt,t("div",vt,[ft,m(" "+i(s.$formatter.number.toInteger(n.clan.recruiting_options.average_battles_per_day)),1)]),t("div",ht,[bt,m(" "+i(s.$formatter.number.toInteger(n.clan.recruiting_options.battles)),1)]),t("div",gt,[wt,m(" "+i(s.$formatter.number.toInteger(n.clan.recruiting_options.average_damage)),1)]),t("div",yt,[$t,m(" "+i(s.$formatter.number.toInteger(n.clan.recruiting_options.vehicles_level)),1)]),t("div",kt,[Ct,m(" "+i(s.$formatter.number.toInteger(n.clan.recruiting_options.wins_ratio))+"% ",1)])],64)):P("",!0)])])])]),_:1},8,["title"])}}}),xt={class:"clan-preview"},Bt={class:"clan-preview__inner"},At={class:"clan-preview__emblem"},Pt=["data-text","src"],Rt={class:"clan-preview__info"},jt={class:"clan-preview__title"},St={class:"clan-preview__tag"},Et={class:"clan-preview__name"},Ft={class:"clan-preview__props"},Mt={class:"clan-preview__prop"},Ot=t("span",{class:"clan-preview__prop-title"}," Участников ",-1),qt={class:"clan-preview__prop-value"},Tt={class:"clan-preview__prop"},Vt=t("span",{class:"clan-preview__prop-title"}," События ",-1),Lt={class:"clan-preview__prop-value"},Nt={class:"clan-preview__actions"},zt=E({__name:"ClanPreview",props:{clan:{type:Object,default:()=>({}),required:!0},hideDescription:{type:[Boolean,String],default:!1},loading:{type:Boolean,default:!1}},setup(n){const v=n,h=W(null),e=ee(),g=V({isFavorite:!1}),w=j(()=>{const a=v.clan.emblem_set_id;return a?`https://wotblitz-gc.gcdn.co/icons/clanEmblems1x/clan-icon-v2-${a}.png`:""});ae(()=>{k()});async function k(){const a=await O.indexedDB.clansFavorites.get(v.clan.clan_id);g.isFavorite=a?a==null?void 0:a.isFavorite:!1}async function I(){v.clan&&(g.isFavorite=!g.isFavorite,await O.indexedDB.clansFavorites.set(v.clan.clan_id,{id:v.clan.clan_id,isFavorite:g.isFavorite}))}async function $(){await de(`${v.clan.tag}/${v.clan.clan_id}`)?e.add({type:"success",title:"Скопировано",message:`${v.clan.tag}/${v.clan.clan_id}`,duration:3e3}):e.add({type:"error",message:"Клан копировании что-то пошло не так",duration:3e3})}function s(){var a;(a=h.value)==null||a.open()}function d(){I()}return(a,D)=>{const b=L,y=G,x=ne,S=It;return u(),f("div",xt,[t("div",Bt,[t("div",At,[t("img",{class:"clan-preview__emblem-img","data-text":n.clan.clan_id??"No image",alt:"Эмблема клана",src:r(w)},null,8,Pt)]),t("div",Rt,[t("div",jt,[t("span",St,"["+i(n.clan.tag??"...")+"]",1),t("span",Et,i(n.clan.name??"..."),1)]),t("div",Ft,[t("div",Mt,[Ot,t("span",qt,i(n.clan.members_count??"---"),1)]),t("div",Tt,[Vt,t("span",Lt,[oe(a.$slots,"events")])])])]),t("div",Nt,[_(y,{"is-text":"",class:"clan-preview__actions-btn",title:"Копировать (nickname/ID)",onClick:$},{default:p(()=>[_(b,{name:"content-copy"})]),_:1}),_(y,{"is-text":"",class:"clan-preview__actions-btn",title:"Добавить в избранные",onClick:d},{default:p(()=>[r(g).isFavorite?(u(),R(b,{key:0,name:"star"})):(u(),R(b,{key:1,name:"star-border"}))]),_:1}),_(y,{"is-text":"",class:"clan-preview__actions-btn",title:"Полная информация",onClick:s},{default:p(()=>[_(b,{name:"info"})]),_:1})])]),_(x,{loading:n.loading},null,8,["loading"]),_(S,{ref_key:"previewDetailsRef",ref:h,clan:n.clan},null,8,["clan"])])}}}),Ut={class:"clan-view-filters"},Gt={class:"clan-view-filters__list"},Ht={class:"clan-view-filters__item clan-view-filters__item--search"},Wt=t("div",{class:"clan-view-filters__item-title"}," Поиск в клане ",-1),Zt={class:"clan-view-filters__item"},Jt=t("div",{class:"clan-view-filters__item-title"}," Дней в клане ",-1),Kt={class:"clan-view-filters__item"},Qt=t("div",{class:"clan-view-filters__item-title"}," Дней отсутствовал ",-1),Xt=E({__name:"ClanViewFilter",props:{filters:{type:Object,required:!0,default:F.makeClanFilters}},emits:["filters-change"],setup(n,{emit:v}){const h=n,e=[{value:null,label:"Не выбрано"},{value:"<3",label:"Меньше чем 3"},{value:"<5",label:"Меньше чем 5"},{value:"<7",label:"Меньше чем 7"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],g=[{value:null,label:"Не выбрано"},{value:"<1",label:"Меньше чем 1"},{value:"<3",label:"Меньше чем 3"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],w=v;function k(I,$){w("filters-change",{...h.filters,[I]:$})}return(I,$)=>{const s=ve,d=fe;return u(),f("div",Ut,[t("div",Gt,[t("div",Ht,[Wt,_(s,{"model-value":n.filters.search,style:{width:"100%"},placeholder:"Введите ник",type:"search","onUpdate:modelValue":$[0]||($[0]=a=>k("search",a))},null,8,["model-value"])]),t("div",Zt,[Jt,_(d,{"model-value":n.filters.joinedAtDays,style:{width:"150px"},options:e,onChange:$[1]||($[1]=a=>k("joinedAtDays",a))},null,8,["model-value"])]),t("div",Kt,[Qt,_(d,{"model-value":n.filters.lastBattleDays,style:{width:"150px"},options:g,onChange:$[2]||($[2]=a=>k("lastBattleDays",a))},null,8,["model-value"])])])])}}}),Yt={class:"clan-view-table"},ea={class:"clan-view-table__total"},ta={class:"clan-view-table__total-value"},aa={class:"clan-view-table__member"},na=["title"],sa={key:0,class:"clan-view-table__name clan-view-table__name--deleted"},la={class:"clan-view-table__sub"},ia={class:"clan-view-table__sub"},oa={class:"clan-view-table__sub"},ca={class:"clan-view-table__sub"},ra={class:"clan-view-table__sub"},_a={class:"clan-view-table__sub"},da=E({__name:"ClanViewMembersTable",props:{members:{type:Array,default:()=>[],required:!0},savedMembers:{type:Array,default:()=>[],required:!0},users:{type:Array,default:()=>[],required:!0},sort:{type:Object,default:()=>({}),required:!0}},emits:["sort"],setup(n,{emit:v}){const h=n,e=v,g=[{key:"account_name",label:"Ник",sortable:!0},{key:"battles",label:"Боёв",sortable:!0,sortMethod(s,d){return s.statistic.all.battles-d.statistic.all.battles}},{key:"winRate",label:"Побед",sortable:!0,sortMethod(s,d){return s.statistic.all.winRate-d.statistic.all.winRate}},{key:"damagePerBattle",label:"Урон",sortable:!0,sortMethod(s,d){return s.statistic.all.damagePerBattle-d.statistic.all.damagePerBattle}},{key:"rating",label:"Рейтинг",sortable:!0,sortMethod(s,d){var b,y;const a=((b=s.statistic.rating)==null?void 0:b.rating)??0,D=((y=d.statistic.rating)==null?void 0:y.rating)??0;return a-D}},{key:"battlesPerDay",label:"Боёв в день",sortable:!0},{key:"last_battle_time",label:"Последний бой",sortable:!0},{key:"joined_at",label:"В клане",sortable:!0}],w=j(()=>h.members.map(s=>{const d=h.savedMembers.find(y=>y.account_id===s.account_id),a=d?T.diff(s.statistic.all,d.statistic.all):null,D=T.battlesPerDay({createAt:s.create_at*1e3,battles:s.statistic.all.battles}),b=d?T.battlesPerDay({createAt:d.create_at,battles:(a==null?void 0:a.battles)||0})-D:null;return{...s,battlesPerDay:D,battlesPerDayDiff:b,diff:a}}));function k(s){const d=h.users.find(a=>a.id===s.account_id);return d?{found:!0,online:Date.now()-new Date(d.visitedAt).valueOf()<1e3*60*5}:{found:!1,online:!1}}function I(s){const d=s;return/^del_\d+$/.test(d.account_name)||!d.last_battle_time}function $(s,d){const a=d;return a.diff?s==="winRate"?K.number.toFloatNumber(a.diff[s],!0):K.number.toInteger(a.diff[s],!0):"---"}return(s,d)=>{const a=he,D=L,b=H,y=be,x=ge,S=we;return u(),f("div",Yt,[t("div",ea,[m(" Кол-во: "),t("span",ta,i(r(w).length||0),1)]),r(w)?(u(),R(S,{key:0,data:r(w),"default-sort":n.sort,headers:g,"no-wrap":"","scroll-auto-disabling":"","row-key":"account_id",height:"calc(100vh - 112px)",class:"clan-view-table__table",onSort:d[0]||(d[0]=l=>e("sort",l))},{account_name:p(({row:l})=>[t("span",aa,[t("span",{class:Z(["clan-view-table__role",["clan-view-table__role--"+l.role,k(l).found?"clan-view-table__role--is-user":"",k(l).online?"clan-view-table__role--is-online":""]]),title:s.$formatter.clan.role(l.role)??"Не известна"},[l.role?(u(),R(a,{key:0,width:"18",height:"18",class:"clan-view-table__role-icon",role:l.role},null,8,["role"])):(u(),R(D,{key:1,style:{width:"16px",color:"var(--color-text-light)"},name:"close"}))],10,na),I(l)?(u(),f("span",sa,i(l.account_name),1)):(u(),R(b,{key:1,class:"link clan-view-table__name",to:{name:"account-id",params:{id:l.account_id}}},{default:p(()=>[m(i(l.account_name),1)]),_:2},1032,["to"]))])]),battles:p(({row:l})=>[m(i(l.statistic.all.battles||"---")+" ",1),t("span",la,i($("battles",l)||"---"),1)]),winRate:p(({row:l})=>[_(y,{"model-value":l.statistic.all.winRate,class:"clan-view-table__win-rate"},null,8,["model-value"]),t("span",ia,i($("winRate",l)||"---"),1)]),rating:p(({row:l})=>[_(x,{rating:l.statistic.rating},null,8,["rating"])]),damagePerBattle:p(({row:l})=>[m(i(l.statistic.all.damagePerBattle||"---")+" ",1),t("span",oa,i($("damagePerBattle",l)),1)]),battlesPerDay:p(({row:l})=>[m(i(l.battlesPerDay||"---")+" ",1),t("span",ca,i(s.$formatter.number.toInteger(l.battlesPerDayDiff,!0)||"---"),1)]),last_battle_time:p(({row:l})=>[m(i(s.$formatter.date.toRelativeTime(l.last_battle_time*1e3)||"---")+" ",1),t("span",ra,i(s.$formatter.date.toDateTime(l.last_battle_time*1e3)||"---"),1)]),joined_at:p(({row:l})=>[m(i(s.$formatter.date.toDaysPassed(l.joined_at*1e3)||"---")+" ",1),t("span",_a,i(s.$formatter.date.toDate(l.joined_at*1e3)||"---"),1)]),_:1},8,["data","default-sort"])):P("",!0)])}}}),ua={key:0,class:"clan-page"},ma={key:1,class:"clan-page--no-data"},pa={key:0,class:"content-area"},va=t("p",null,"Нет данных.",-1),fa=t("p",null,"Возможно клан удалён.",-1),ha=[va,fa],qa=E({__name:"[id]",setup(n){const v=ee(),h=ce(),e=V({loading:0,users:[],clanInfo:null,clan:null,filters:F.makeClanFilters(),statisticsSum:null,savedMembers:[],savedClan:null,metricsItems:[],clanSavedAt:0}),g=V({order:"desc",prop:""}),w=j(()=>{var o;return((o=e.clan)==null?void 0:o.members)||[]}),k=j(()=>{let o=w.value.filter(C=>{const A=C.account_name.toLowerCase(),M=e.filters.search.toLowerCase();return A.includes(M)});const c=Date.now(),B=1e3*60*60*24;if(e.filters.joinedAtDays){const C=F.parseParameter(e.filters.joinedAtDays);o=w.value.filter(A=>F.executeExpression(c-Number(C.value)*B,A.joined_at*1e3,C.operator))}if(e.filters.lastBattleDays){const C=F.parseParameter(e.filters.lastBattleDays);o=w.value.filter(A=>F.executeExpression(c-Number(C.value)*B,A.last_battle_time*1e3,C.operator))}return o});ae(()=>{const o=+h.params.id;o&&a(o)});async function I(o){e.loading++;try{const{data:c}=await z.clan.getAccountInfo({account_id:o.join(",")});return c}catch(c){return v.add({type:"error",title:"Получение данных участников клана",message:c instanceof Error?c.message:"Неизвестная ошибка"}),console.error(c),null}finally{e.loading--}}async function $(o){e.loading++;try{const{data:c}=await z.clan.getInfo({clan_id:o});e.clanInfo=c[o]??null}catch(c){v.add({type:"error",title:"Получение данных клана",message:c instanceof Error?c.message:"Неизвестная ошибка"}),console.error(c)}e.loading--}async function s(o){e.loading++;try{const{data:c}=await $e.user.getList({id:o});e.users=c}catch(c){v.add({type:"error",title:"Получение данных аккаунта",message:c instanceof Error?c.message:"Неизвестная ошибка"}),console.error(c)}e.loading--}async function d(o){e.loading++;try{const{data:c}=await z.account.getInfo({extra:"statistics.rating",account_id:o.join(",")});return c}catch(c){return v.add({type:"error",title:"Получение данных аккаунта",message:c instanceof Error?c.message:"Неизвестная ошибка"}),console.error(c),null}finally{e.loading--}}async function a(o){if(await $(o),!e.clanInfo)return;const c=await I(e.clanInfo.members_ids);e.clanInfo.members=c,await Promise.all([s(e.clanInfo.members_ids),D(e.clanInfo),y(e.clanInfo)]),e.savedClan||await b(e.clanInfo);const B=await d(e.clanInfo.members_ids);if(!B)return;e.clan=X.clan(e.clanInfo,B);const C=Object.values(B).filter(ye);e.statisticsSum=C.reduce((A,M,N)=>N===0?C[0].statistics:T.sumFull(A,M.statistics),{}),e.metricsItems=ue.clan(C,e.statisticsSum),Q.clanMembersDefault(w.value)}async function D(o){e.loading++;const c=[];for(const B in o.members){const C=await O.indexedDB.accountsInfo.get(B);C&&(C.data.created_at=C.timestamp,c.push(X.clanMember(o.members[B],C.data)))}e.savedMembers=c,e.loading--}async function b(o){e.loading++,await O.indexedDB.clansInfo.set(o.clan_id,re(o)),e.savedClan=Y(o),e.clanSavedAt=Date.now(),e.loading--}async function y(o){e.loading++;const c=await O.indexedDB.clansInfo.get(o.clan_id);e.savedClan=(c==null?void 0:c.data)??null,e.clanSavedAt=(c==null?void 0:c.timestamp)??0,e.loading--}function x(o){o.order||Q.clanMembersDefault(w.value)}async function S(){e.clanInfo&&await b(e.clanInfo)}function l(o){console.log(o.search),e.filters=Y(o)}return(o,c)=>{const B=Fe,C=zt,A=pe,M=me,N=Xt,se=da,le=ne;return r(e).clanInfo?(u(),f("div",ua,[_(A,{identity:"preview"},{default:p(()=>[_(C,{class:"clan-page__preview","hide-description":!0,clan:r(e).clanInfo,loading:r(e).loading>0},_e({_:2},[r(e).clanInfo&&r(e).savedClan?{name:"events",fn:p(()=>[_(B,{clan:r(e).clanInfo,"saved-clan":r(e).savedClan,"saved-at":r(e).clanSavedAt,onReset:S},null,8,["clan","saved-clan","saved-at"])]),key:"0"}:void 0]),1032,["clan","loading"])]),_:1}),_(A,{title:"Статистика",identity:"statistic"},{default:p(()=>[_(M,{loading:r(e).loading>0,items:r(e).metricsItems},null,8,["loading","items"])]),_:1}),_(A,{title:"Участники",identity:"members"},{default:p(()=>[_(N,{class:"clan-page__filters",filters:r(e).filters,onFiltersChange:l},null,8,["filters"]),_(se,{sort:r(g),users:r(e).users,"saved-members":r(e).savedMembers,members:r(k),onSort:x},null,8,["sort","users","saved-members","members"])]),_:1})])):(u(),f("div",ma,[r(e).loading?P("",!0):(u(),f("div",pa,ha)),_(le,{loading:r(e).loading>0},null,8,["loading"])]))}}});export{qa as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./discord.CgTq0l7I.js","./nuxt-icon.DJXNAOIX.js","./_plugin-vue_export-helper.DlAUqK2U.js","./entry.FvyONZHj.js","./nuxt-icon.MfBulapQ.css","./telegram.CkWIgnNv.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
