import{_ as N}from"./D4jFUD0b.js";import{d as x,a3 as T,l as V,r as W,m as q,x as s,n as f,G as w,o as u,q as p,s as _,F as G,C as O,v as P,j as $,g as l,I as j,u as L,a as M,b as z,e as E,f as B,w as H,h as U}from"./BytUdlbn.js";import{f as I}from"./CtzQypMv.js";import{s as i}from"./rFoUnFSB.js";import{_ as k}from"./CGpAa8Mt.js";import{c as J}from"./B4FMxlHh.js";const K={class:"widget-account-session__list"},Q={class:"widget-account-session__label"},X={class:"widget-account-session__value"},Y=x({__name:"WidgetAccountSession",props:{params:{type:Object,default:()=>I.makeAccountSessionWidgetFilters,required:!0}},setup(m){T(n=>({"4e90af88":o.params.bgColorOpacity,"2264f1fa":o.params.bgColor,"0885f9db":o.params.textColor}));const o=m,e=V({loading:0,accountSession:null,account:null,achievementsInfo:null,accountAchievements:null,accountAchievementsSession:null,tanksStat:null,tanksStatSession:null,updateTimerDuration:3e4}),c=W([]);q(()=>{R()});async function v(){e.loading++;try{const{data:n}=await f.encyclopedia.getAchievements();e.achievementsInfo=n??null}catch(n){console.error(n)}e.loading--}async function h(n){e.loading++;try{const{data:t}=await f.account.getInfo({account_id:n,extra:"statistics.rating"});e.account=(t==null?void 0:t[n])??null}catch(t){console.error(t)}e.loading--}async function d(n){e.loading++;try{const{data:t}=await w.session.account.get(n);e.accountSession=t.raw}catch(t){console.error(t)}e.loading--}async function g(n){e.loading++;try{const{data:t}=await f.account.getAchievements({account_id:n});e.accountAchievements=(t==null?void 0:t[n])??null}catch(t){console.error(t)}e.loading--}async function y(n){e.loading++;try{const{data:t}=await w.session.accountAchievements.get(n);e.accountAchievementsSession=t.raw}catch(t){console.error(t)}e.loading--}function C(n,t){switch(n){case"battles":return s.number.toInteger(t.battles);case"winRate":return s.number.toFloatPercent(t.winRate);case"damagePerBattle":return s.number.toInteger(t.damagePerBattle);case"fragPerBattle":return s.number.toFloatNumber(t.fragPerBattle);case"surviveRate":return s.number.toFloatPercent(t.spottedPerBattle);case"hitRate":return s.number.toFloatPercent(t.hitRate);case"spottedPerBattle":return s.number.toFloatNumber(t.spottedPerBattle);case"xpPerBattle":return"xpPerBattle"in t?s.number.toInteger(t.xpPerBattle):"---";default:return"---"}}function b(){if(!e.account||!e.accountSession)return;const n=i.diffFull(e.account.statistics,e.accountSession.statistics);let t;e.achievementsInfo&&e.accountAchievements&&e.accountAchievementsSession&&(t=i.accountAchievementsDiff(e.accountAchievements,e.accountAchievementsSession,e.achievementsInfo)),c.value=o.params.attributes.map(a=>{var A,S;if(a==="teamGamePoints"&&t)return{key:a,label:s.stat.accountProp(a),value:String(i.teamPoints(n,t))};const r=(A=e.achievementsInfo)==null?void 0:A[a];if(r&&t)return{key:a,label:String(r.name).replace(/\([^)]+\)/gi,"")??a,value:String(((S=t.achievements)==null?void 0:S[a])??0)};const D=o.params.battleMode==="rating"&&n.rating?i.accountRating(n.rating):i.accountAll(n.all);return{key:a,label:s.stat.accountProp(a),value:C(a,D)}})}function F(n){b();let t;const a=async()=>{e.loading++,clearTimeout(t),await Promise.all([h(n),g(n)]),b(),t=setTimeout(a,e.updateTimerDuration),e.loading--};a()}async function R(){c.value=o.params.attributes.map(t=>({key:t,label:s.stat.accountProp(t),value:"---"}));const n=o.params.accountId;n&&(await Promise.all([v(),d(n),y(n)]),e.accountSession&&F(n))}return(n,t)=>{const a=N;return u(),p("div",{class:j(["widget-account-session",["widget-account-session--"+m.params.style]])},[_("div",K,[(u(!0),p(G,null,O(l(c),r=>(u(),p("div",{key:r.key,class:"widget-account-session__item"},[_("div",Q,P(r.label),1),_("div",X,P(r.value),1),$(a,{loading:l(e).loading>0},null,8,["loading"])]))),128))])],2)}}}),ot=x({__name:"account-session",setup(m){const{$formatter:o}=L(),e=M();z({title:()=>o.route.getTitle(J.toString(e.name)??"")});const c=E(()=>I.makeAccountSessionWidgetFilters(e.query));return(v,h)=>{const d=Y,g=k;return u(),B(g,null,{default:H(()=>[l(c)?(u(),B(d,{key:0,class:"widgets-account-session-page",params:l(c)},null,8,["params"])):U("",!0)]),_:1})}}});export{ot as default};
