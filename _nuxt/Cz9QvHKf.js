function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./Bauoipmh.js","./-p8L5eN0.js","./DlAUqK2U.js","./C1pZ3Ysy.js","./nuxt-icon.MfBulapQ.css","./Dwr8Az_0.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{_ as N,u as re,h as R}from"./C2BuzcM2.js";import{_ as Z}from"./BfF4LBiS.js";import{_ as J}from"./dAvVLxv5.js";import{_ as se}from"./DYVPuHM_.js";import{f as M,r as z,i as F,o as m,c as b,a as t,b as d,w as h,k as r,C as K,t as o,d as p,F as T,A as W,m as P,j as S,D as _e,E as Q,_ as X,n as L,q as le,G as de,s as Y,u as ue,g as me,H as pe,I as ve}from"./C1pZ3Ysy.js";import{s as U,_ as ie,a as H}from"./DIwkXMey.js";import{c as fe}from"./ZnSD-95i.js";import{_ as he}from"./BEb8pHFb.js";import{_ as be}from"./CRLgDY2X.js";import{m as ee,_ as ge}from"./CIRgc-9e.js";import{_ as we}from"./BrX1J4SK.js";import{_ as ye}from"./CnQv4oo3.js";import{f as E}from"./DzhOpHWC.js";import{_ as $e}from"./BndQpib1.js";import{_ as ke}from"./DZd8ySUx.js";import{_ as Ce,m as te}from"./3YsmnF-1.js";import{_ as De}from"./DsHWkLU8.js";import{s as V}from"./BwpGAOBT.js";import{n as Ie}from"./BxBPJGBn.js";import{c as ae}from"./BQfcXNWw.js";import{a as Ae}from"./CEfgnHem.js";import"./BVbz9zww.js";import"./C4gBlWGJ.js";import"./-p8L5eN0.js";import"./DlAUqK2U.js";import"./Ba3yjCYF.js";import"./BJRgOVf2.js";const xe={class:"clan-events"},Be={class:"clan-events__inner"},je={class:"clan-events__count"},Pe={class:"clan-events__prop"},Se=t("span",{class:"clan-events__prop-title"}," События от ",-1),Re={key:0,class:"clan-events__prop"},Fe={class:"clan-events__prop-title"},Me={key:1,class:"clan-events__prop"},Ee={class:"clan-events__prop-title"},Oe={key:2},qe={style:{display:"flex","justify-content":"space-between"}},Ue=t("div",null,null,-1),Te=M({__name:"ClanEvents",props:{savedAt:{type:Number,default:0,required:!0},clan:{type:Object,default:()=>({}),required:!0},savedClan:{type:Object,default:()=>({}),required:!0}},emits:["reset"],setup(a,{emit:v}){const e=a,u=z(null),f=F(()=>{const s=e.clan.members_ids??[],y=e.savedClan.members??[];return Object.values(y).filter($=>!s.includes($.account_id))}),w=F(()=>{var $,C;const s=(($=e.clan)==null?void 0:$.members)??[],y=((C=e.savedClan)==null?void 0:C.members_ids)??[];return Object.values(s).filter(x=>!y.includes(x.account_id))}),g=F(()=>w.value.length+f.value.length),I=v;function k(){var s;I("reset"),(s=u.value)==null||s.doClose()}function n(){var s;(s=u.value)==null||s.doOpen()}function l(){var s;(s=u.value)==null||s.doClose()}return(s,y)=>{const $=N,C=Z,x=J,O=se;return m(),b("div",xe,[t("div",Be,[d(C,{disabled:!r(g),class:K(["clan-events__btn",[r(g)?"clan-events__btn--has-unread":""]]),"is-text":"","is-square":"",title:"События клана",onClick:n},{default:h(()=>[d($,{name:"mail"})]),_:1},8,["disabled","class"]),t("div",je,o(r(g)>99?"99+":r(g)),1)]),d(O,{ref_key:"dialogRef",ref:u,width:"640px",title:"События клана"},{title:h(()=>[t("div",Pe,[Se,p(" "+o(s.$formatter.date.toDateTime(a.savedAt))+" ("+o(s.$formatter.date.toDaysPassed(a.savedAt,Date.now()))+") ",1)])]),footer:h(()=>[t("div",qe,[Ue,t("div",null,[d(C,{onClick:k},{default:h(()=>[p(" Прочитано ")]),_:1}),d(C,{onClick:l},{default:h(()=>[p(" Закрыть ")]),_:1})])])]),default:h(()=>[r(f).length?(m(),b("div",Re,[t("span",Fe," Покинули ("+o(r(f).length)+") ",1),(m(!0),b(T,null,W(r(f),(i,q)=>(m(),b("span",{key:i.account_id,class:"clan-events__prop-value"},[d(x,{to:{name:"account-id",params:{id:i.account_id}},class:"link"},{default:h(()=>[p(o(i.account_name),1)]),_:2},1032,["to"]),p(o(q+1!==r(f).length?", ":""),1)]))),128))])):P("",!0),r(w).length?(m(),b("div",Me,[t("span",Ee," Вступили ("+o(r(w).length)+") ",1),(m(!0),b(T,null,W(r(w),(i,q)=>(m(),b("span",{key:i.account_id,class:"clan-events__prop-value"},[d(x,{to:{name:"account-id",params:{id:i.account_id}},class:"link"},{default:h(()=>[p(o(i.account_name),1)]),_:2},1032,["to"]),p(o(q+1!==r(w).length?", ":""),1)]))),128))])):P("",!0),r(g)?P("",!0):(m(),b("span",Oe," Пока всё тихо ... "))]),_:1},512)])}}}),Ve={class:"social-links"},Le={class:"social-links__links"},Ne=["href","title"],ze=M({__name:"SocialLinks",props:{links:{type:Array,default:()=>[],required:!0}},setup(a){return(v,e)=>(m(),b("div",Ve,[t("div",Le,[(m(!0),b(T,null,W(a.links,u=>(m(),b("a",{key:u.link,class:"link social-links__links-item",href:u.link,target:"_blank",title:u.title},[(m(),S(_e(u.icon)))],8,Ne))),128))])]))}}),Ge=/(https?:\/\/)?(www\.)?(discord\.(gg|io|me|li)|discordapp\.com\/invite)\/.+[a-z|0-9]/gi,He=/(https?:\/\/)?(www\.)?((t|telegram)\.me)\/\+?[a-zA-Z0-9_]{5,32}/gi,We=a=>{const v=[],e=a.match(Ge),u=a.match(He);return e!=null&&e.length&&v.push({title:"Discord",icon:Q(()=>X(()=>import("./Bauoipmh.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),link:e[0]}),u!=null&&u.length&&v.push({title:"Telegram",icon:Q(()=>X(()=>import("./Dwr8Az_0.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url)),link:u[0]}),v},Ze={class:"clan-preview-details__body"},Je={key:0,class:"clan-preview-details__section"},Ke={class:"clan-preview-details__props-title"},Qe={class:"clan-preview-details__section"},Xe={class:"clan-preview-details__props-title"},Ye=["textContent"],et={key:1,class:"clan-preview-details__section"},tt={class:"clan-preview-details__props-title"},at={class:"clan-preview-details__props"},nt={class:"clan-preview-details__prop"},st=t("span",{class:"clan-preview-details__prop-title"}," Создатель ",-1),lt={class:"clan-preview-details__prop"},it=t("span",{class:"clan-preview-details__prop-title"}," Дата создания ",-1),ot={class:"clan-preview-details__prop"},ct=t("span",{class:"clan-preview-details__prop-title"}," Дата обновления ",-1),rt={class:"clan-preview-details__prop"},_t=t("span",{class:"clan-preview-details__prop-title"}," Участников ",-1),dt={key:0,class:"clan-preview-details__prop"},ut=t("span",{class:"clan-preview-details__prop-title"}," Старое название ",-1),mt={class:"clan-preview-details__section"},pt={class:"clan-preview-details__props-title"},vt={class:"clan-preview-details__props"},ft={class:"clan-preview-details__prop"},ht=t("span",{class:"clan-preview-details__prop-title"}," Политика приёма. ",-1),bt=t("div",{class:"clan-preview-details__props-subtitle"}," Пороги статистики для вступления: ",-1),gt={class:"clan-preview-details__prop"},wt=t("span",{class:"clan-preview-details__prop-title"}," Боёв в день ",-1),yt={class:"clan-preview-details__prop"},$t=t("span",{class:"clan-preview-details__prop-title"}," Боёв всего ",-1),kt={class:"clan-preview-details__prop"},Ct=t("span",{class:"clan-preview-details__prop-title"}," Урон ср. ",-1),Dt={class:"clan-preview-details__prop"},It=t("span",{class:"clan-preview-details__prop-title"}," Уровень ",-1),At={class:"clan-preview-details__prop"},xt=t("span",{class:"clan-preview-details__prop-title"}," Побед ",-1),Bt={style:{display:"flex","justify-content":"space-between"}},jt=M({__name:"ClanPreviewDetails",props:{clan:{type:Object,default:()=>({}),required:!0}},setup(a,{expose:v}){const e=a,u=z(null),f=L({descExpended:!1}),w=F(()=>We(e.clan.description??""));function g(){var n;(n=u.value)==null||n.doOpen()}function I(){var n;(n=u.value)==null||n.doClose()}function k(){f.descExpended=!f.descExpended}return v({open:g,close:I}),(n,l)=>{const s=N,y=Z,$=J,C=ze,x=se;return m(),S(x,{ref_key:"clanDetailsRef",ref:u,class:"clan-preview-details",title:`[${a.clan.tag}] ${a.clan.name}`,width:"640px"},{footer:h(()=>[t("div",Bt,[r(w).length?(m(),S(C,{key:0,class:"clan-preview-details__links",links:r(w)},null,8,["links"])):P("",!0),d(y,{onClick:I},{default:h(()=>[p(" Закрыть ")]),_:1})])]),default:h(()=>[t("div",Ze,[a.clan.motto?(m(),b("div",Je,[t("h5",Ke,[d(s,{class:"clan-preview-details__prop-title-icon",name:"format-quote"}),p(" Девиз ")]),t("i",null,o(a.clan.motto),1)])):P("",!0),t("div",Qe,[t("h5",Xe,[d(s,{class:"clan-preview-details__prop-title-icon",name:"description"}),p(" Описание ")]),a.clan.description?(m(),b("div",{key:0,class:K(["content-area clan-preview-details__desc",r(f).descExpended?"clan-preview-details__desc--expended":""]),textContent:o(a.clan.description)},null,10,Ye)):P("",!0),d(y,{"is-text":"",class:"clan-preview-details__desc-expend-btn",onClick:k},{default:h(()=>[p(o(r(f).descExpended?"Свернуть":"Развернуть"),1)]),_:1})]),a.clan.motto?(m(),b("div",et,[t("h5",tt,[d(s,{class:"clan-preview-details__prop-title-icon",name:"info"}),p(" Информация ")]),t("div",at,[t("div",nt,[st,a.clan.creator_id?(m(),S($,{key:0,class:"link",to:a.clan.creator_id?{name:"account-id",params:{id:a.clan.creator_id}}:{}},{default:h(()=>[p(o(a.clan.creator_name),1)]),_:1},8,["to"])):(m(),b(T,{key:1},[p(" Не известен ")],64))]),t("div",lt,[it,p(" "+o(n.$formatter.date.toDate(a.clan.created_at*1e3)),1)]),t("div",ot,[ct,p(" "+o(n.$formatter.date.toDate(a.clan.updated_at*1e3)),1)]),t("div",rt,[_t,p(" "+o(n.$formatter.number.toInteger(a.clan.members_count)),1)]),a.clan.old_tag?(m(),b("div",dt,[ut,p(" ["+o(a.clan.old_tag)+"] "+o(a.clan.old_name),1)])):P("",!0)])])):P("",!0),t("div",mt,[t("h5",pt,[d(s,{class:"clan-preview-details__prop-title-icon",name:"person-search"}),p(" Рекрутинг ")]),t("div",vt,[t("div",ft,[ht,p(" "+o(n.$formatter.clan.recruitingPolicy(a.clan.recruiting_policy))+". ",1)]),a.clan.recruiting_policy==="open"&&a.clan.recruiting_options?(m(),b(T,{key:0},[bt,t("div",gt,[wt,p(" "+o(n.$formatter.number.toInteger(a.clan.recruiting_options.average_battles_per_day)),1)]),t("div",yt,[$t,p(" "+o(n.$formatter.number.toInteger(a.clan.recruiting_options.battles)),1)]),t("div",kt,[Ct,p(" "+o(n.$formatter.number.toInteger(a.clan.recruiting_options.average_damage)),1)]),t("div",Dt,[It,p(" "+o(n.$formatter.number.toInteger(a.clan.recruiting_options.vehicles_level)),1)]),t("div",At,[xt,p(" "+o(n.$formatter.number.toInteger(a.clan.recruiting_options.wins_ratio))+"% ",1)])],64)):P("",!0)])])])]),_:1},8,["title"])}}}),Pt={class:"clan-preview"},St={class:"clan-preview__inner"},Rt={class:"clan-preview__emblem"},Ft={class:"clan-preview__info"},Mt={class:"clan-preview__title"},Et={class:"clan-preview__tag"},Ot={class:"clan-preview__name"},qt={class:"clan-preview__props"},Ut={class:"clan-preview__prop"},Tt=t("span",{class:"clan-preview__prop-title"}," Участников ",-1),Vt={class:"clan-preview__prop-value"},Lt={class:"clan-preview__prop"},Nt=t("span",{class:"clan-preview__prop-title"}," События ",-1),zt={class:"clan-preview__prop-value"},Gt={class:"clan-preview__actions"},Ht=M({__name:"ClanPreview",props:{clan:{type:Object,default:()=>({}),required:!0},hideDescription:{type:[Boolean,String],default:!1},loading:{type:Boolean,default:!1}},setup(a){const v=a,e=z(null),u=re(),f=L({isFavorite:!1});le(()=>{w()});async function w(){const l=await U.indexedDB.clansFavorites.get(v.clan.clan_id);f.isFavorite=l?l==null?void 0:l.isFavorite:!1}async function g(){v.clan&&(f.isFavorite=!f.isFavorite,await U.indexedDB.clansFavorites.set(v.clan.clan_id,{id:v.clan.clan_id,isFavorite:f.isFavorite}))}async function I(){await fe(`${v.clan.tag}/${v.clan.clan_id}`)?u.add({type:"success",title:"Скопировано",message:`${v.clan.tag}/${v.clan.clan_id}`,duration:3e3}):u.add({type:"error",message:"Клан копировании что-то пошло не так",duration:3e3})}function k(){var l;(l=e.value)==null||l.open()}function n(){g()}return(l,s)=>{const y=N,$=Z,C=ie,x=jt;return m(),b("div",Pt,[t("div",St,[t("div",Rt,[d(he,{class:"clan-preview__emblem-img",alt:a.clan.name,emblem:a.clan.emblem_set_id},null,8,["alt","emblem"])]),t("div",Ft,[t("div",Mt,[t("span",Et,"["+o(a.clan.tag??"...")+"]",1),t("span",Ot,o(a.clan.name??"..."),1)]),t("div",qt,[t("div",Ut,[Tt,t("span",Vt,o(a.clan.members_count??"---"),1)]),t("div",Lt,[Nt,t("span",zt,[de(l.$slots,"events")])])])]),t("div",Gt,[d($,{"is-text":"",class:"clan-preview__actions-btn",title:"Копировать (nickname/ID)",onClick:I},{default:h(()=>[d(y,{name:"content-copy"})]),_:1}),d($,{"is-text":"",class:"clan-preview__actions-btn",title:"Добавить в избранные",onClick:n},{default:h(()=>[r(f).isFavorite?(m(),S(y,{key:0,name:"star"})):(m(),S(y,{key:1,name:"star-border"}))]),_:1}),d($,{"is-text":"",class:"clan-preview__actions-btn",title:"Полная информация",onClick:k},{default:h(()=>[d(y,{name:"info"})]),_:1})])]),d(C,{loading:a.loading},null,8,["loading"]),d(x,{ref_key:"previewDetailsRef",ref:e,clan:a.clan},null,8,["clan"])])}}}),Wt={class:"clan-view-filters"},Zt={class:"clan-view-filters__list"},Jt={class:"clan-view-filters__item clan-view-filters__item--search"},Kt=t("div",{class:"clan-view-filters__item-title"}," Поиск в клане ",-1),Qt={class:"clan-view-filters__item"},Xt=t("div",{class:"clan-view-filters__item-title"}," Дней в клане ",-1),Yt={class:"clan-view-filters__item"},ea=t("div",{class:"clan-view-filters__item-title"}," Дней отсутствовал ",-1),ta=M({__name:"ClanViewFilter",props:{filters:{type:Object,required:!0,default:E.makeClanFilters}},emits:["filters-change"],setup(a,{emit:v}){const e=a,u=[{value:null,label:"Не выбрано"},{value:"<3",label:"Меньше чем 3"},{value:"<5",label:"Меньше чем 5"},{value:"<7",label:"Меньше чем 7"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],f=[{value:null,label:"Не выбрано"},{value:"<1",label:"Меньше чем 1"},{value:"<3",label:"Меньше чем 3"},{value:">3",label:"Больше чем 3"},{value:">5",label:"Больше чем 5"},{value:">7",label:"Больше чем 7"}],w=v;function g(I,k){w("filters-change",{...e.filters,[I]:k})}return(I,k)=>{const n=we,l=ye;return m(),b("div",Wt,[t("div",Zt,[t("div",Jt,[Kt,d(n,{"model-value":a.filters.search,style:{width:"100%"},placeholder:"Введите ник",type:"search","onUpdate:modelValue":k[0]||(k[0]=s=>g("search",s))},null,8,["model-value"])]),t("div",Qt,[Xt,d(l,{"model-value":a.filters.joinedAtDays,style:{width:"150px"},options:u,onChange:k[1]||(k[1]=s=>g("joinedAtDays",s))},null,8,["model-value"])]),t("div",Yt,[ea,d(l,{"model-value":a.filters.lastBattleDays,style:{width:"150px"},options:f,onChange:k[2]||(k[2]=s=>g("lastBattleDays",s))},null,8,["model-value"])])])])}}}),aa={class:"clan-view-table"},na={class:"clan-view-table__total"},sa={class:"clan-view-table__total-value"},la={class:"clan-view-table__member"},ia=["title"],oa={key:0,class:"clan-view-table__name clan-view-table__name--deleted"},ca={class:"clan-view-table__sub"},ra={class:"clan-view-table__sub"},_a={class:"clan-view-table__sub"},da={class:"clan-view-table__sub"},ua={class:"clan-view-table__sub"},ma={class:"clan-view-table__sub"},pa=M({__name:"ClanViewMembersTable",props:{members:{type:Array,default:()=>[],required:!0},savedMembers:{type:Array,default:()=>[],required:!0},users:{type:Array,default:()=>[],required:!0},sort:{type:Object,default:()=>({}),required:!0}},emits:["sort"],setup(a,{emit:v}){const e=a,u=v,f=[{key:"account_name",label:"Ник",sortable:!0},{key:"battles",label:"Боёв",sortable:!0,sortMethod(n,l){return n.statistic.all.battles-l.statistic.all.battles}},{key:"winRate",label:"Побед",sortable:!0,sortMethod(n,l){return n.statistic.all.winRate-l.statistic.all.winRate}},{key:"damagePerBattle",label:"Урон",sortable:!0,sortMethod(n,l){return n.statistic.all.damagePerBattle-l.statistic.all.damagePerBattle}},{key:"rating",label:"Рейтинг",sortable:!0,sortMethod(n,l){var $,C;const s=(($=n.statistic.rating)==null?void 0:$.rating)??0,y=((C=l.statistic.rating)==null?void 0:C.rating)??0;return s-y}},{key:"battlesPerDay",label:"Боёв в день",sortable:!0},{key:"last_battle_time",label:"Последний бой",sortable:!0},{key:"joined_at",label:"В клане",sortable:!0}],w=F(()=>e.members.map(n=>{const l=e.savedMembers.find(C=>C.account_id===n.account_id),s=l?V.diff(n.statistic.all,l.statistic.all):null,y=V.battlesPerDay({createAt:n.create_at*1e3,battles:n.statistic.all.battles}),$=l?V.battlesPerDay({createAt:l.create_at,battles:(s==null?void 0:s.battles)||0})-y:null;return{...n,battlesPerDay:y,battlesPerDayDiff:$,diff:s}}));function g(n){const l=e.users.find(s=>s.id===n.account_id);return l?{found:!0,online:Date.now()-new Date(l.visitedAt).valueOf()<1e3*60*5}:{found:!1,online:!1}}function I(n){const l=n;return/^del_\d+$/.test(l.account_name)||!l.last_battle_time}function k(n,l){const s=l;return s.diff?n==="winRate"?Y.number.toFloatNumber(s.diff[n],!0):Y.number.toInteger(s.diff[n],!0):"---"}return(n,l)=>{const s=$e,y=N,$=J,C=ke,x=Ce,O=De;return m(),b("div",aa,[t("div",na,[p(" Кол-во: "),t("span",sa,o(r(w).length||0),1)]),r(w)?(m(),S(O,{key:0,data:r(w),"default-sort":a.sort,headers:f,"no-wrap":"","scroll-auto-disabling":"","row-key":"account_id",height:"calc(100vh - 112px)",class:"clan-view-table__table",onSort:l[0]||(l[0]=i=>u("sort",i))},{account_name:h(({row:i})=>[t("span",la,[t("span",{class:K(["clan-view-table__role",["clan-view-table__role--"+i.role,g(i).found?"clan-view-table__role--is-user":"",g(i).online?"clan-view-table__role--is-online":""]]),title:n.$formatter.clan.role(i.role)??"Не известна"},[i.role?(m(),S(s,{key:0,width:"18",height:"18",class:"clan-view-table__role-icon",role:i.role},null,8,["role"])):(m(),S(y,{key:1,style:{width:"16px",color:"var(--color-text-light)"},name:"close"}))],10,ia),I(i)?(m(),b("span",oa,o(i.account_name),1)):(m(),S($,{key:1,class:"link clan-view-table__name",to:{name:"account-id",params:{id:i.account_id}}},{default:h(()=>[p(o(i.account_name),1)]),_:2},1032,["to"]))])]),battles:h(({row:i})=>[p(o(i.statistic.all.battles||"---")+" ",1),t("span",ca,o(k("battles",i)||"---"),1)]),winRate:h(({row:i})=>[d(C,{"model-value":i.statistic.all.winRate,class:"clan-view-table__win-rate"},null,8,["model-value"]),t("span",ra,o(k("winRate",i)||"---"),1)]),rating:h(({row:i})=>[d(x,{rating:i.statistic.rating},null,8,["rating"])]),damagePerBattle:h(({row:i})=>[p(o(i.statistic.all.damagePerBattle||"---")+" ",1),t("span",_a,o(k("damagePerBattle",i)),1)]),battlesPerDay:h(({row:i})=>[p(o(i.battlesPerDay||"---")+" ",1),t("span",da,o(n.$formatter.number.toInteger(i.battlesPerDayDiff,!0)||"---"),1)]),last_battle_time:h(({row:i})=>[p(o(n.$formatter.date.toRelativeTime(i.last_battle_time*1e3)||"---")+" ",1),t("span",ua,o(n.$formatter.date.toDateTime(i.last_battle_time*1e3)||"---"),1)]),joined_at:h(({row:i})=>[p(o(n.$formatter.date.toDaysPassed(i.joined_at*1e3)||"---")+" ",1),t("span",ma,o(n.$formatter.date.toDate(i.joined_at*1e3)||"---"),1)]),_:1},8,["data","default-sort"])):P("",!0)])}}}),va=(a,v)=>{const{prop:e,order:u}=v;return u?a.toSorted((f,w)=>{const g=(u==="desc"?w:f)[e],I=(u==="desc"?f:w)[e];return String(g).localeCompare(String(I),void 0,{numeric:!0,sensitivity:"base"})}):a},fa=a=>{a.sort((v,e)=>v.joined_at-e.joined_at)},ha=a=>{a.sort((v,e)=>{const u={recruit:0,private:1,executive_officer:2,commander:3};return u[e.role]-u[v.role]})},ba=a=>{fa(a),ha(a)},ne={smart:va,clanMembersDefault:ba},ga={key:0,class:"clan-page"},wa={key:1,class:"clan-page--no-data"},ya={key:0,class:"content-area"},$a=t("p",null,"Нет данных.",-1),ka=t("p",null,"Возможно клан удалён.",-1),Ca=[$a,ka],Xa=M({__name:"[id]",setup(a){ue({title:"Инфо / Кланы"});const v=me(),e=L({loading:0,users:[],clanInfo:null,clan:null,filters:E.makeClanFilters(),statisticsSum:null,savedMembers:[],savedClan:null,metricsItems:ee.clan(),clanSavedAt:0,sessionUpdateAt:0,sessionActive:!1}),u=L({order:"desc",prop:""}),f=F(()=>{var _;return((_=e.clan)==null?void 0:_.members)||[]}),w=F(()=>{let _=f.value.filter(D=>{const A=D.account_name.toLowerCase(),j=e.filters.search.toLowerCase();return A.includes(j)});const c=Date.now(),B=1e3*60*60*24;if(e.filters.joinedAtDays){const D=E.parseParameter(e.filters.joinedAtDays);_=f.value.filter(A=>E.executeExpression(c-Number(D.value)*B,A.joined_at*1e3,D.operator))}if(e.filters.lastBattleDays){const D=E.parseParameter(e.filters.lastBattleDays);_=f.value.filter(A=>E.executeExpression(c-Number(D.value)*B,A.last_battle_time*1e3,D.operator))}return _}),g=z(!1);le(async()=>{await y(),g.value=!0});async function I(_){e.loading++;try{const{data:c}=await H.clan.getAccountInfo({account_id:_.join(",")});return c}catch(c){return R(c,{title:"Получение данных участников клана"}),null}finally{e.loading--}}async function k(_){e.loading++;try{const{data:c}=await H.clan.getInfo({clan_id:_});e.clanInfo=c[_]??null}catch(c){R(c,{title:"Получение данных клана"})}e.loading--}async function n(_){e.loading++;try{const{data:c}=await Ae.user.getList({id:_});e.users=c}catch(c){R(c,{title:"Получение данных аккаунта"})}e.loading--}async function l(_){e.loading++;try{const{data:c}=await H.account.getInfo({extra:"statistics.rating",account_id:_.join(",")});return c}catch(c){return R(c,{title:"Получение данных аккаунта"}),null}finally{e.loading--}}async function s(_){await Promise.all([$(_),x(_)])}async function y(){const _=+v.params.id;if(!_||(await k(_),!e.clanInfo))return;const c=await I(e.clanInfo.members_ids);e.clanInfo.members||(e.clanInfo.members={});for(const A in c){const j=c[A];j&&(e.clanInfo.members[A]={account_id:j.account_id,account_name:j.account_name,joined_at:j.joined_at,role:j.role})}await Promise.all([n(e.clanInfo.members_ids),s(e.clanInfo)]),e.savedClan||await C(e.clanInfo);const B=await l(e.clanInfo.members_ids);if(!B)return;e.clan=te.clan(e.clanInfo,B);const D=Object.values(B).filter(Ie);e.statisticsSum=D.reduce((A,j,G)=>G===0?D[0].statistics:V.sumFull(A,j.statistics),{}),e.metricsItems=ee.clan(D,e.statisticsSum),ne.clanMembersDefault(f.value)}async function $(_){e.loading++;try{const c=[];for(const B in _.members){const D=await U.indexedDB.accountsInfo.get(B);D&&(D.data.created_at=D.timestamp,D.timestamp>e.sessionUpdateAt&&(e.sessionUpdateAt=D.timestamp),c.push(te.clanMember(_.members[B],D.data)))}e.savedMembers=c}catch(c){R(c,{title:"Загрузка локальных данных аккаунтов"})}e.loading--}async function C(_){e.loading++;try{await U.indexedDB.clansInfo.set(_.clan_id,pe(_)),e.savedClan=ae(_),e.clanSavedAt=Date.now()}catch(c){R(c,{title:"Локальное сохранение данных аккаунтов"})}e.loading--}async function x(_){e.loading++;try{const c=await U.indexedDB.clansInfo.get(_.clan_id);e.savedClan=(c==null?void 0:c.data)??null,e.clanSavedAt=(c==null?void 0:c.timestamp)??0}catch(c){R(c,{title:"Загрузка локальных данных клана"})}e.loading--}function O(_){_.order||ne.clanMembersDefault(f.value)}async function i(){e.clanInfo&&await C(e.clanInfo)}function q(_){e.filters=ae(_)}return(_,c)=>{const B=Te,D=Ht,A=be,j=ge,G=ta,oe=pa,ce=ie;return r(e).clanInfo?(m(),b("div",ga,[d(A,{identity:"preview"},{default:h(()=>[d(D,{class:"clan-page__preview","hide-description":!0,clan:r(e).clanInfo,loading:r(e).loading>0},ve({_:2},[r(e).clanInfo&&r(e).savedClan?{name:"events",fn:h(()=>[d(B,{clan:r(e).clanInfo,"saved-clan":r(e).savedClan,"saved-at":r(e).clanSavedAt,onReset:i},null,8,["clan","saved-clan","saved-at"])]),key:"0"}:void 0]),1032,["clan","loading"])]),_:1}),d(A,{title:"Статистика",identity:"statistic"},{default:h(()=>[d(j,{loading:r(e).loading>0,items:r(e).metricsItems},null,8,["loading","items"])]),_:1}),d(A,{title:"Участники",identity:"members"},{default:h(()=>[d(G,{class:"clan-page__filters",filters:r(e).filters,onFiltersChange:q},null,8,["filters"]),d(oe,{sort:r(u),users:r(e).users,"saved-members":r(e).savedMembers,members:r(w),onSort:O},null,8,["sort","users","saved-members","members"])]),_:1})])):(m(),b("div",wa,[r(g)?(m(),b("div",ya,Ca)):P("",!0),d(ce,{loading:!r(g)},null,8,["loading"])]))}}});export{Xa as default};
