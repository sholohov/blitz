import{_ as V}from"./B0dwicF1.js";import{d as k,m as U,u as $,b3 as E,p as F,r as b,b4 as O,e as j,ar as H,o as d,f as B,w as u,g as v,q as y,j as r,s as i,y as D,t as m,v as C,_ as w,h as S,aK as P,M as q,a7 as z,F as A,C as G,I as K,a as L,k as J,B as Q,an as W}from"./Divx9Nzj.js";import{_ as X}from"./D1vz3_zC.js";import{_ as N}from"./BX-xDoGX.js";import{_ as Y}from"./Bssrnu3E.js";import{_ as Z}from"./B3Z3JZGk.js";import{u as ee}from"./C8llOfle.js";import{u as te}from"./4hdVvK08.js";import"./DD4asW33.js";import"./DRlS0BVX.js";import"./34P0Lxgg.js";import"./BxBPJGBn.js";import"./mry5RTp6.js";const ne={key:0,class:"update-message"},oe={class:"update-message__title"},se={class:"update-message__control"},ae=k({__name:"UpdateMessage",setup(x){U(()=>{f()});const _=b(!1),c=b(null),s=H(),p=j(()=>{const e=s.public.clientVersion;return!c.value||!e||_.value?!1:c.value!==e});function f(){const{$firebase:e}=$(),l=e.db();E(O(l,"app","info"),o=>{const t=o.data();c.value=(t==null?void 0:t.version)??null},o=>{F(o,{title:"Получение данных версии из Firebase"})})}function n(){location.reload()}function a(){_.value=!0}return(e,l)=>{const o=D,t=w,g=X;return d(),B(P,{name:"update-message-"},{default:u(()=>[v(p)?(d(),y("div",ne,[r(g,{class:"update-message__inner"},{default:u(()=>[i("div",oe,[r(o,{class:"update-message__icon",name:"new-releases"}),m(" Обновление v"+C(v(c)),1)]),l[2]||(l[2]=i("div",{class:"update-message__body"}," Что бы изменения вступили в силу, необходимо обновить страницу. ",-1)),i("div",se,[r(t,{class:"update-message__btn",onClick:n},{default:u(()=>l[0]||(l[0]=[m(" Обновить ")])),_:1}),r(t,{class:"update-message__btn",onClick:a},{default:u(()=>l[1]||(l[1]=[m(" Скрыть ")])),_:1})])]),_:1})])):S("",!0)]),_:1})}}}),ie={class:"update-db-dialog__header"},le={style:{display:"flex","justify-content":"flex-end"}},re=k({__name:"UpdateDBDialog",emits:["confirm"],setup(x,{expose:_,emit:c}){const s=b(null),p=c;function f(){var a;(a=s.value)==null||a.doClose(),p("confirm")}function n(){var a;(a=s.value)==null||a.doOpen()}return _({open:n}),(a,e)=>{const l=D,o=w,t=N;return d(),B(t,{ref_key:"dialogRef",ref:s,class:"update-db-dialog","modal-enabled":"",width:"480px"},{title:u(()=>[i("div",ie,[r(l,{class:"update-db-dialog__icon",name:"database-alert"}),e[0]||(e[0]=i("b",null,"База данных обновлена",-1))])]),footer:u(()=>[i("div",le,[r(o,{onClick:f},{default:u(()=>e[1]||(e[1]=[m(" Так точно ")])),_:1})])]),default:u(()=>[e[2]||(e[2]=m(" Для продолжения использования необходимо: ")),e[3]||(e[3]=i("br",null,null,-1)),e[4]||(e[4]=m(" 1. Закрыть все вкладки ресурса, кроме активной.")),e[5]||(e[5]=i("br",null,null,-1)),e[6]||(e[6]=m(" 2. Обновить текущую страницу.")),e[7]||(e[7]=i("br",null,null,-1)),e[8]||(e[8]=m(" 3. Готово.")),e[9]||(e[9]=i("br",null,null,-1))]),_:1},512)}}}),ue={class:"ui-notification"},ce={key:0,class:"ui-notification__item-title"},_e={class:"ui-notification__item-body"},de=["onClick"],pe=k({__name:"UiNotification",props:{appendToBody:{type:Boolean,default:!1}},setup(x){const _=q(),c=s=>{if(s.title)return s.title;switch(s.type){case"success":return"Успешно";case"error":return"Ошибка";case"info":return"Информация";case"warning":return"Внимание";default:return s.title}};return(s,p)=>{const f=Z;return d(),B(f,null,{default:u(()=>[i("div",ue,[r(z,{tag:"ul",class:"ui-notification__list",name:"ui-notification__item-"},{default:u(()=>[(d(!0),y(A,null,G(v(_).items,n=>(d(),y("li",{key:n.id,class:K(["ui-notification__item",[n.type?"ui-notification__item--"+n.type:""]])},[n.title||n.type?(d(),y("div",ce,C(c(n)),1)):S("",!0),i("div",_e,C(n.message),1),i("button",{class:"ui-notification__item-close",onClick:a=>v(_).remove(n)},null,8,de)],2))),128))]),_:1})])]),_:1})}}}),fe={class:"layout"},Ne=k({__name:"default",async setup(x){const{$storage:_}=$(),c=L(),s=J(),p=ee(),f=te(),n=_.user.get();n&&s.setUser({accountId:Number(n.account_id),name:n.nickname}),U(()=>{l(),f.init()});const a=b(null),e=b(null);Q(()=>c.fullPath,(o,t)=>{o!==t&&p.toggleMainSearch(!1)}),W(()=>{var o,t;p.mainSearchOpened?(o=a.value)==null||o.doOpen():(t=a.value)==null||t.doClose()});async function l(){const{$indexedDB:o}=$(),t=await o.getInstance();t.onBlocked=()=>{var g;return(g=e.value)==null?void 0:g.open()}}return(o,t)=>{const g=V,h=ae,M=re,R=Y,I=N,T=pe;return d(),y("div",fe,[r(g),r(h),r(M,{ref_key:"updateDBRef",ref:e},null,512),v(f).isTablet?(d(),B(I,{key:0,ref_key:"searchDialogRef",ref:a,title:"Поиск аккаунтов и кланов",width:"480px",position:"top",onClose:t[0]||(t[0]=me=>v(p).toggleMainSearch(!1))},{default:u(()=>[r(R,{style:{height:"270px"}})]),_:1},512)):S("",!0),r(T)])}}});export{Ne as default};
