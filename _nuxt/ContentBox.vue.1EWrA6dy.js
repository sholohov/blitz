import{_ as W}from"./CInput.vue.BvL80IAb.js";import{f as R,h as G,r as l,i as I,q as H,y as J,o as c,c as r,a as L,b as B,k as A,l as Q,w as V,F as D,A as K,t as N,B as X,m as Y,$ as Z,j as ee,C as te,E as ne,D as ae}from"./entry.DnyhrCzd.js";import{n as oe}from"./notEmpty.BxBPJGBn.js";import{d as se}from"./debounce.DaU679KR.js";import{a as k}from"./request.D7J0I_-4.js";import{h as E}from"./disableScroll.DbQbNoWW.js";const le={class:"main-search__inner"},ce={class:"main-search__input"},ie={key:0,class:"main-search__dropdown"},re={key:0,class:"main-search__item-title"},ue=["onKeydown","onClick","textContent"],he=R({__name:"MainSearch",props:{context:{type:String,default:"account"}},setup(x){const C=G(),_=l(null),p=l(null),i=l(""),h=l([]),y=l([]),g=l([]),m=l([]),u=l(0),f=l(-1),T=I(()=>[h.value,y.value,g.value]),U=I(()=>[h.value,y.value,g.value].some(e=>e.length>0));H(()=>{window.addEventListener("click",$)}),J(()=>{window.removeEventListener("click",$)});function w(){h.value=[],y.value=[],g.value=[]}function $(e){var t;(t=_.value)!=null&&t.contains(e.target)||(w(),i.value="")}async function S(e){var t;w(),i.value=e.name??"",await C.push({name:e.context+"-id",params:{id:String(e.id)}}),(t=p.value)==null||t.focus()}function j(){var t;const e=(t=_.value)==null?void 0:t.querySelectorAll(".main-search__item-btn");return e?[...e]:[]}async function q(e){u.value++;try{const a=((await k.account.getList({search:e,limit:5})).data||[]).map(n=>({name:n.nickname,id:n.account_id,context:"account"}));if(a.length){const n=await k.clan.getAccountInfo({extra:"clan",account_id:a.map(s=>s.id).join(",")});n.data&&a.forEach(s=>{var d,v;const o=(v=(d=n.data[s.id])==null?void 0:d.clan)==null?void 0:v.tag;s.name+=o?` [${o}]`:""}),h.value=[{id:1,name:"Аккаунты",context:"title"},...a]}}catch(t){E(t,{title:"Поиск аккаунта"})}u.value--}async function F(e){u.value++;try{const{data:t}=await k.clan.getList({search:e,limit:5}),a=(t.filter(oe)??[]).map(n=>({name:`[${n.tag}] ${n.name}`,id:n.clan_id,context:"clan"}));a.length&&(y.value=[{id:2,name:"Кланы",context:"title"},...a])}catch(t){E(t,{title:"Поиск клана"})}u.value--}async function M(e){u.value++;try{const a=((await k.tournaments.getList({search:e,limit:5})).data||[]).map(n=>({name:n.title,id:n.tournament_id,context:"tournaments"}));a.length&&(g.value=[{id:3,name:"Турниры",context:"title"},...a])}catch(t){E(t,{title:"Поиск турнира"})}u.value--}async function O(e){e.length>=3&&await q(e),e.length>=2&&(await F(e),await M(e)),m.value=j()}const z=se(O,1e3,{leading:!0});async function P(e=""){i.value=e=e.replace(/\/\d+$/,"").trim(),i.value.length<2&&w(),await z(e)}function b(e){var a,n,s,o,d,v;const t=e.target;u.value>0||(e.key==="Escape"&&(w(),i.value="",f.value=-1,(a=p.value)==null||a.focus()),t.tagName==="INPUT"&&(f.value=-1),e.key==="ArrowUp"&&(e.preventDefault(),(n=m.value)!=null&&n.length&&f.value>0?(s=m.value[--f.value])==null||s.focus():(o=p.value)==null||o.focus()),e.key==="ArrowDown"&&(e.preventDefault(),(d=m.value)!=null&&d.length&&f.value<m.value.length-1&&((v=m.value[++f.value])==null||v.focus())))}return(e,t)=>{const a=W;return c(),r("div",{ref_key:"rootRef",ref:_,class:"main-search"},[L("div",le,[L("div",ce,[B(a,{ref_key:"inputRef",ref:p,modelValue:A(i),"onUpdate:modelValue":t[0]||(t[0]=n=>Q(i)?i.value=n:null),placeholder:"Поиск игрока, клана или турнира",type:"search",onInput:P,onKeydown:b},null,8,["modelValue"])]),B(Z,null,{default:V(()=>[A(U)?(c(),r("div",ie,[(c(!0),r(D,null,K(A(T),(n,s)=>(c(),r("ul",{key:s,class:"main-search__list",onKeydown:b},[(c(!0),r(D,null,K(n,o=>(c(),r("li",{key:o.context+o.id,class:"main-search__item"},[o.context==="title"?(c(),r("div",re,N(o.name),1)):(c(),r("button",{key:1,class:"main-search__item-btn",onKeydown:X(d=>S(o),["enter"]),onClick:d=>S(o),textContent:N(o.name)},null,40,ue))]))),128))],32))),128))])):Y("",!0)]),_:1})])],512)}}}),ye=R({__name:"ContentBox",props:{tag:{type:String,default:"div"},innerClass:{type:String,default:void 0}},setup(x){return(C,_)=>(c(),ee(ae(x.tag),{class:"content-box"},{default:V(()=>[L("div",{class:te(["content-box__inner",[x.innerClass]])},[ne(C.$slots,"default")],2)]),_:3}))}});export{ye as _,he as a};
