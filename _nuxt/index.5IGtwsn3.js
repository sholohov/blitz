import{_ as V}from"./UiSelect.vue.BQ5c_oUP.js";import{_ as q}from"./UiImage.vue.ZBtbc598.js";import{_ as N}from"./nuxt-link.C3WD0srD.js";import{_ as R,a as S}from"./request.BVKHoC5m.js";import{f as T,i as x,o as l,c as _,F as k,A as L,a as n,t as u,b as d,d as w,C as b,k as r,u as U,g as j,h as H,n as $,s as O,q as A,y as D,j as F,w as W}from"./entry.38LME4ko.js";import{_ as I}from"./PageLayout.vue.Bsa4TKTj.js";import{h as M}from"./disableScroll.bcJx9LND.js";import"./UiButton.vue.BlJ_24Cx.js";import"./index.DhpBw61k.js";import"./image-broken.h9FV3rD3.js";import"./nuxt-icon.tdHFESbn.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./MainSearch.vue.C-zG-Ats.js";import"./UiInput.vue.Bnd6JzIv.js";import"./notEmpty.BxBPJGBn.js";import"./debounce.D6S8q1nH.js";import"./UiDialog.vue.Bpz9VH2j.js";import"./user.BzIqZnQp.js";import"./index.DK8OZMT_.js";import"./index.CesnwhB4.js";import"./ContentBox.vue.DBRxv3kT.js";import"./leader.DCwJw9Y9.js";import"./client-only.CxqVZBjJ.js";import"./dark-mode.CsF_CE04.js";import"./light-mode.DkKAGSZC.js";const P={class:"tournaments-list"},G={class:"tournaments-list__section-title"},J={class:"tournaments-list__list"},K={class:"tournaments-list__item-img-wrapper"},Q={class:"tournaments-list__item-content"},X={class:"tournaments-list__item-title"},Y={class:"tournaments-list__item-tier"},Z={class:"tournaments-list__item-details"},tt={class:"tournaments-list__item-date"},st=T({__name:"TournamentsList",props:{tournaments:{type:Array,default:()=>[],required:!0},loading:{type:Boolean,default:!1}},setup(f){const h=f,p=x(()=>{const s={running:[],registration_started:[],registration_finished:[],upcoming:[],finished:[],complete:[]};return h.tournaments.forEach(t=>{s[t.status].push(t)}),Object.entries(s).map(([t,m])=>({status:t,list:m})).filter(t=>t.list.length)});function v(s){const t=s.description.match(/Уровень техники: (.+?)\./i);return t!=null&&t[1]?t==null?void 0:t[1]:""}return(s,t)=>{const m=q,y=N,g=R;return l(),_("div",P,[(l(!0),_(k,null,L(r(p),i=>(l(),_("div",{key:i.status,class:"tournaments-list__section"},[n("div",G,u(s.$formatter.tournament.status(i.status)),1),n("ul",J,[(l(!0),_(k,null,L(i.list,o=>(l(),_("li",{key:o.tournament_id,class:"tournaments-list__item"},[n("div",K,[d(m,{class:"tournaments-list__item-img",loading:"lazy",src:o.logo.original,alt:"image"},null,8,["src"])]),n("div",Q,[n("div",X,[w(u(o.title)+" ",1),n("div",Y,u(v(o)),1)]),n("div",Z,[n("div",tt,u(s.$formatter.date.toDateTime(o.start_at*1e3)),1),n("div",{class:b(["tournaments-list__item-status",["tournaments-list__item-status--"+o.status]])},u(s.$formatter.tournament.status(o.status)),3)])]),d(y,{class:"tournaments-list__item-link link",to:{name:"tournaments-id",params:{id:o.tournament_id}}},null,8,["to"])]))),128))])]))),128)),d(g,{loading:f.loading},null,8,["loading"])])}}}),et={class:"tournaments-page__filter"},nt={class:"tournaments-page__count"},ot=n("span",{class:"tournaments-page__count-title"}," Кол-во: ",-1),at={class:"tournaments-page__list"},Vt=T({__name:"index",setup(f){const h=[null,"upcoming","registration_started","registration_finished","running","finished","complete"];U({title:"Турниры"});const p=j(),v=H(),s=$({loading:0,tournaments:[],status:null}),t=$({page:1,pageSize:25,total:0}),m=$(h.map(e=>({label:e?O.tournament.status(e):"Все",value:e}))),y=x(()=>t.total>t.page*t.pageSize);A(async()=>{var e;s.status=((e=p.query)==null?void 0:e.status)??null,o(),await i(),window.addEventListener("scroll",g)}),D(()=>{window.removeEventListener("scroll",g)});function g(){const{scrollTop:e,scrollHeight:a,clientHeight:c}=document.documentElement;s.loading===0&&y.value&&e+c>=a-100&&(t.page+=1,i())}async function i(){s.loading++;try{if(s.status===null&&t.page===1){const c=await S.tournaments.getList({limit:t.pageSize,status:"running"});s.tournaments.push(...c.data)}const e=["upcoming","registration_started","registration_finished","finished","complete"].join(","),a=await S.tournaments.getList({limit:t.pageSize,page_no:t.page,status:s.status??e});t.total=a.meta.total,s.tournaments.push(...a.data)}catch(e){M(e,{title:"Получение списка турниров"})}s.loading--}function o(){v.replace({query:{...p.query,status:s.status||null}}).catch(()=>{})}function C(){t.page=1,s.tournaments=[],o(),i()}return(e,a)=>{const c=V,z=st,B=I;return l(),F(B,{class:"tournaments-page"},{default:W(()=>[n("div",et,[w(" По статусу: "),d(c,{modelValue:r(s).status,"onUpdate:modelValue":a[0]||(a[0]=E=>r(s).status=E),style:{width:"200px"},options:r(m),onChange:C},null,8,["modelValue","options"])]),n("div",nt,[ot,w(" "+u(r(t).total),1)]),n("div",at,[d(z,{tournaments:r(s).tournaments,loading:r(s).loading>0},null,8,["tournaments","loading"])])]),_:1})}}});export{Vt as default};
