import{_ as ct}from"./CImage.vue.BpBC8UI2.js";import{f as W,o as u,c as f,a,F as O,A as V,t as m,d as w,m as R,s as j,n as P,i as G,q as Y,k as o,b as S,C as Q,w as L,j as F,r as ut,y as _t,g as mt,h as dt}from"./entry.DnyhrCzd.js";import{_ as z}from"./CSelect.vue.CbIsFS8V.js";import{a as E}from"./request.D7J0I_-4.js";import{h as M}from"./disableScroll.DbQbNoWW.js";import{_ as pt}from"./CInput.vue.BvL80IAb.js";import{_ as Z}from"./ContentLoader.vue.gSVxuRhP.js";import{_ as gt}from"./WinRate.vue.DMG6i7Ym.js";import{_ as ht}from"./RoleIcon.vue.CzanZlRP.js";import{_ as ft}from"./nuxt-link.B5LnOQLN.js";import{n as nt}from"./notEmpty.BxBPJGBn.js";import{s as K}from"./index.rFE-yYyM.js";import{_ as bt,b as yt,g as vt}from"./CDialog.vue.CQlkuHhL.js";import{d as $t,t as Tt}from"./debounce.DaU679KR.js";import{_ as wt}from"./CTable.vue.BtjbC63F.js";import{e as kt,i as St,_ as Ct}from"./isArrayLike.Dc0Sd8p3.js";import{_ as st}from"./ClanEmblem.vue.BjXFUQpI.js";import{_ as It}from"./CTabs.vue.J3gTlVdQ.js";import{_ as At}from"./PageContent.vue.DookzeT3.js";import"./image-broken.8lwG3CGm.js";import"./nuxt-icon.BsZsWr24.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./ContentBox.vue.1EWrA6dy.js";import"./index.D7cX-f-u.js";import"./user.CdOYHEHf.js";import"./index.BRuhnkRA.js";import"./leader.C8Lo4CF8.js";import"./client-only.BwacdUep.js";import"./dark-mode.dGHoi32H.js";import"./light-mode.C-MYmDsT.js";const xt={key:0,class:"tournaments-stages"},Ot={class:"tournaments-stages__inner"},Rt={class:"tournaments-stages__list"},Gt={class:"tournaments-stages__title"},qt={class:"tournaments-stages__params"},Dt={class:"tournaments-stages__param"},Lt=a("span",{class:"tournaments-stages__param-title"}," Дата ",-1),Vt={class:"tournaments-stages__param"},Et=a("span",{class:"tournaments-stages__param-title"}," Система ",-1),Mt={class:"tournaments-stages__param"},Nt=a("span",{class:"tournaments-stages__param-title"}," Уровень ",-1),jt={class:"tournaments-stages__param"},Ft=a("span",{class:"tournaments-stages__param-title"}," Условие ",-1),Pt=W({__name:"TournamentsStages",props:{stages:{type:Array,default:()=>[]}},setup(_){function s(t){const n=j.encyclopedia.tier(t.min_tier),r=j.encyclopedia.tier(t.max_tier);return n===r?n:`${n} - ${r}`}return(t,n)=>_.stages.length?(u(),f("div",xt,[a("div",Ot,[a("ul",Rt,[(u(!0),f(O,null,V(_.stages,r=>(u(),f("li",{key:r.stage_id,class:"tournaments-stages__stage"},[a("div",Gt,m(r.title),1),a("div",qt,[a("div",Dt,[Lt,r.start_at?(u(),f(O,{key:0},[w(m(t.$formatter.date.toDateTime(r.start_at*1e3)),1)],64)):(u(),f(O,{key:1},[w(" --- ")],64))]),a("div",Vt,[Et,w(" "+m(t.$formatter.tournament.stageType(r.type)),1)]),a("div",Mt,[Nt,w(" "+m(s(r)),1)]),a("div",jt,[Ft,w(" до "+m(r.victory_limit)+" побед ",1)])])]))),128))])])])):R("",!0)}}),Bt={class:"tournaments-matches"},Ut={class:"tournaments-matches__filters"},Wt={class:"tournaments-matches__filters-item"},Ht={class:"tournaments-matches__filters-item"},Xt={class:"tournaments-matches__list"},Yt={class:"tournaments-matches__round"},Jt={class:"tournaments-matches__teams"},Kt={class:"tournaments-matches__score"},Qt={class:"tournaments-matches__date"},Zt=W({__name:"TournamentsMatches",props:{stages:{type:Array,default:()=>[],required:!0},tournamentId:{type:Object,default:()=>({}),required:!0}},setup(_){const s=_,t=P({loading:0,matches:[],selectedStage:null,selectedGroup:null}),n=P({page:1,pageSize:25,total:0}),r=G(()=>s.stages.map(i=>({label:i.title,value:i}))),$=G(()=>t.selectedStage?t.selectedStage.groups.map(i=>({label:`Группа ${i.group_order}`,value:i})):[]);Y(()=>{var i;t.selectedStage=C(),t.selectedGroup=((i=t.selectedStage)==null?void 0:i.groups[0])??null,g()});function C(){const i=s.stages.findLast(b=>b.state==="complete");return s.stages.findLast(b=>b.state==="schedule_ready")??i??s.stages[0]}function g(){!t.selectedStage||!t.selectedGroup||T(s.tournamentId,t.selectedStage.stage_id,t.selectedGroup.group_id)}async function T(i,c,b){t.loading++;try{const{data:y,meta:h}=await E.tournaments.getMatches({tournament_id:i,stage_id:c,group_id:b,limit:n.pageSize,page_no:n.page});n.total=h.total,t.matches=y}catch(y){M(y,{title:"Получение списка матчей"})}t.loading--}function I(i){t.selectedStage=i,t.selectedGroup=i.groups[0],n.page=1,g()}function A(i){t.selectedGroup=i,n.page=1,g()}return(i,c)=>{var y;const b=z;return u(),f("div",Bt,[a("div",Ut,[a("div",Wt,[w(" Этап ("+m(o(n).total??0)+") ",1),S(b,{value:o(t).selectedStage,"id-key":"stage_id",style:{width:"250px"},options:o(r),onChange:I},null,8,["value","options"])]),a("div",Ht,[w(" Группа ("+m(((y=o(t).selectedStage)==null?void 0:y.groups.length)??0)+") ",1),S(b,{value:o(t).selectedGroup,"id-key":"group_id",style:{width:"170px"},options:o($),onChange:A},null,8,["value","options"])])]),a("div",Xt,[(u(!0),f(O,null,V(o(t).matches,h=>(u(),f("div",{key:h.id,class:"tournaments-matches__match"},[a("div",Yt," round: "+m(h.round),1),a("div",Jt,[(u(),f(O,null,V([1,2],x=>a("div",{key:x,class:Q(["tournaments-matches__team",["tournaments-matches__team--"]])},[w(m(h[`team_${x}_id`])+" ",1),a("span",Kt,m(h[`team_${x}_score`]||0),1)])),64))]),a("span",Qt,m(i.$formatter.date.toDateTime(h.start_time*1e3)),1)]))),128))])])}}}),zt={class:"tournament-team"},te={class:"tournament-team__inner"},ee={class:"tournament-team__props-list"},ae={class:"tournament-team__props"},ne=a("span",{class:"tournament-team__props-title"},"Статус",-1),se={class:"tournament-team__props"},oe=a("span",{class:"tournament-team__props-title"},"Ср. побед",-1),ie={class:"tournament-team__props"},le=a("span",{class:"tournament-team__props-title"},"Ср. боёв",-1),re={class:"tournament-team__player-list"},ce={key:0,class:"tournament-team__details"},ue={class:"tournament-team__player-name"},_e={class:"tournament-team__player-stat"},me={class:"tournament-team__stat-item"},de={key:1,class:"tournament-team__empty"},pe=W({__name:"TournamentTeam",props:{tournament:{type:Object,default:()=>({}),required:!0},team:{type:Object,default:()=>({}),required:!0}},setup(_){const s=_,t=P({loading:0,players:[],statisticsAll:null});Y(()=>{const g=s.tournament.max_players_count;t.players=Array(g).fill($({})),C()});async function n(g){t.loading++;try{const{data:T}=await E.clan.getAccountInfo({extra:"clan",account_id:g.join(",")});return Object.values(T).filter(nt)}catch(T){return M(T,{title:"Поучение списка клановых аккаунтов"}),[]}finally{t.loading--}}async function r(g){t.loading++;try{const{data:T}=await E.account.getInfo({extra:"statistics.rating",account_id:g.join(",")});return Object.values(T).filter(nt)}catch(T){return M(T,{title:"Поучение списка аккаунтов"}),[]}finally{t.loading--}}function $(g){var A,i,c,b,y,h,x,d;const T=(A=g.account)==null?void 0:A.statistics.all,I=(i=g.account)==null?void 0:i.statistics.rating;return{id:((c=g.player)==null?void 0:c.account_id)??0,name:((b=g.player)==null?void 0:b.name)??"",isOwner:((y=g.player)==null?void 0:y.role)==="owner",clan:(h=g.clanAccount)!=null&&h.clan?{id:g.clanAccount.clan_id,tag:((x=g.clanAccount.clan)==null?void 0:x.tag)??"",name:((d=g.clanAccount.clan)==null?void 0:d.name)??""}:null,statistic:{all:T?K.accountAll(T):null,rating:I?K.accountRating(I):null}}}async function C(){const g=s.team.players.map(c=>c.account_id),[T,I]=await Promise.all([r(g),n(g)]),A=T.reduce((c,b,y)=>y===0?T[0].statistics:K.sumFull(c,b.statistics),{});t.statisticsAll=K.accountAll(A.all,T.length);const i=s.tournament.max_players_count;t.players=Array(i).fill({}).map((c,b)=>{const y=s.team.players[b],h=T.find(d=>d.account_id===(y==null?void 0:y.account_id)),x=I.find(d=>d.account_id===(y==null?void 0:y.account_id));return $({player:y,account:h,clanAccount:x})}).sort(c=>c.isOwner?1:0)}return(g,T)=>{var b,y;const I=gt,A=ht,i=ft,c=Z;return u(),f("div",zt,[a("div",te,[a("div",ee,[a("div",ae,[ne,w(" "+m(g.$formatter.tournament.teamStatusDetails(_.team.status)),1)]),a("div",se,[oe,S(I,{"model-value":((b=o(t).statisticsAll)==null?void 0:b.winRate)||0},null,8,["model-value"])]),a("div",ie,[le,w(" "+m(g.$formatter.number.toInteger(((y=o(t).statisticsAll)==null?void 0:y.battles)||0)),1)])]),a("ul",re,[(u(!0),f(O,null,V(o(t).players,(h,x)=>{var d;return u(),f("li",{key:h.id||x,class:"tournament-team__player"},[S(A,{width:"18",height:"18",class:"tournament-team__player-role",role:h.isOwner?"commander":"private"},null,8,["role"]),h.id?(u(),f("div",ce,[a("div",ue,[S(i,{class:"tournament-team__player-link link",to:{name:"account-id",params:{id:h.id}}},{default:L(()=>[w(m(h.name),1)]),_:2},1032,["to"]),h.clan?(u(),F(i,{key:0,class:"tournament-team__player-link link",to:{name:"clan-id",params:{id:h.clan.id}}},{default:L(()=>{var k;return[w(m(`[${(k=h.clan)==null?void 0:k.tag}]`),1)]}),_:2},1032,["to"])):R("",!0)]),a("span",_e,[h.statistic.all?(u(),F(I,{key:0,class:"tournament-team__stat-item","model-value":h.statistic.all.winRate},null,8,["model-value"])):R("",!0),a("span",me,m((d=h.statistic.all)==null?void 0:d.battles),1)])])):(u(),f("span",de," Место свободно "))])}),128))]),S(c,{"backdrop-light":"",loading:o(t).loading>0},null,8,["loading"])])])}}}),ge={class:"tournaments-teams"},he={class:"tournaments-teams__filters"},fe={class:"tournaments-teams__filters-item"},be={class:"tournaments-teams__filters-item"},ye={class:"tournaments-teams__count"},ve=a("div",{class:"tournaments-teams__count-title"}," Кол-во: ",-1),$e={class:"tournaments-teams__list"},Te=["onClick"],we={class:"tournaments-teams__team-description"},ke={class:"tournaments-teams__team-name"},Se={class:"tournaments-teams__team-owner"},Ce={class:"tournaments-teams__team-owner-text"},Ie={class:"tournaments-teams__team-count"},Ae=W({__name:"TournamentsTeams",props:{tournament:{type:Object,default:()=>({}),required:!0}},setup(_){const s=[null,"confirmed","forming","disqualified"],t=_,n=ut(null),r=P({loading:0,teams:[],currentTeam:null}),$=P({page:1,total:0,pageSize:50}),C=P({status:"confirmed",search:""}),g=s.map(d=>({label:d?j.tournament.teamStatus(d):"Все",value:d})),T=G(()=>$.total>$.page*$.pageSize);Y(()=>{window.addEventListener("scroll",b)}),_t(()=>{window.removeEventListener("scroll",b)});function I(d){var k;return(k=d.players.find(q=>q.role==="owner"))==null?void 0:k.name}const A=$t(i,1e3,{leading:!0});async function i(){await c()}async function c(){r.loading++;try{const{data:d,meta:k}=await E.tournaments.getTeams({tournament_id:t.tournament.tournament_id,limit:$.pageSize,page_no:$.page,...C});$.total=k.total,r.teams.push(...d)}catch(d){M(d,{title:"Получение списка команд"})}r.loading--}function b(){const{scrollTop:d,scrollHeight:k,clientHeight:q}=document.documentElement;r.loading===0&&T.value&&T.value&&d+q>=k-100&&($.page+=1,c())}function y(){$.page=1,r.teams=[],i()}async function h(d=""){C.search=d=d.trim(),!(d.length<2&&d!=="")&&($.page=1,r.teams=[],await A())}function x(d){var k;r.currentTeam=d,(k=n.value)==null||k.doOpen()}return(d,k)=>{var p;const q=z,H=pt,U=Z,e=pe,l=bt;return u(),f("div",ge,[a("div",he,[a("div",fe,[w(" Статус "),S(q,{modelValue:o(C).status,"onUpdate:modelValue":k[0]||(k[0]=v=>o(C).status=v),style:{width:"220px"},options:o(g),onChange:y},null,8,["modelValue","options"])]),a("div",be,[w(" Поиск "),S(H,{modelValue:o(C).search,"onUpdate:modelValue":k[1]||(k[1]=v=>o(C).search=v),type:"search",placeholder:"Введите название команды",style:{width:"300px"},onInput:h},null,8,["modelValue"])])]),a("div",ye,[ve,w(" "+m(o($).total||0),1)]),a("div",$e,[(u(!0),f(O,null,V(o(r).teams,v=>(u(),f("button",{key:v.team_id,class:"tournaments-teams__team",onClick:D=>x(v)},[a("span",{class:Q(["tournaments-teams__status",[v.status?`tournaments-teams__status--${v.status}`:""]])},null,2),a("span",we,[a("span",ke,m(v.title),1),a("span",Se,[a("span",Ce,m(I(v)),1)])]),a("span",Ie,m(v.players.length)+" / "+m(_.tournament.max_players_count),1)],8,Te))),128)),S(U,{loading:o(r).loading>0},null,8,["loading"])]),S(l,{ref_key:"teamDialogRef",ref:n,width:"500px","append-to-body":"",title:(p=o(r).currentTeam)==null?void 0:p.title},{default:L(()=>[o(r).currentTeam?(u(),F(e,{key:0,tournament:_.tournament,team:o(r).currentTeam},null,8,["tournament","team"])):R("",!0)]),_:1},8,["title"])])}}});function xe(_,s,t){var n=-1,r=_.length;s<0&&(s=-s>r?0:r+s),t=t>r?r:t,t<0&&(t+=r),r=s>t?0:t-s>>>0,s>>>=0;for(var $=Array(r);++n<r;)$[n]=_[n+s];return $}var Oe=xe,Re=kt,Ge=St,qe=Ct,De=yt;function Le(_,s,t){if(!De(t))return!1;var n=typeof s;return(n=="number"?Ge(t)&&qe(s,t.length):n=="string"&&s in t)?Re(t[s],_):!1}var Ve=Le,Ee=Tt,ot=1/0,Me=17976931348623157e292;function Ne(_){if(!_)return _===0?_:0;if(_=Ee(_),_===ot||_===-ot){var s=_<0?-1:1;return s*Me}return _===_?_:0}var je=Ne,Fe=je;function Pe(_){var s=Fe(_),t=s%1;return s===s?t?s-t:s:0}var Be=Pe,Ue=Oe,We=Ve,He=Be,Xe=Math.ceil,Ye=Math.max;function Je(_,s,t){(t?We(_,s,t):s===void 0)?s=1:s=Ye(He(s),0);var n=_==null?0:_.length;if(!n||s<1)return[];for(var r=0,$=0,C=Array(Xe(n/s));r<n;)C[$++]=Ue(_,r,r+=s);return C}var Ke=Je;const Qe=vt(Ke),Ze={class:"tournaments-tables"},ze={class:"tournaments-tables__filters"},ta={class:"tournaments-tables__filters-item"},ea={class:"tournaments-tables__filters-item"},aa={class:"tournaments-tables__stage-state"},na=a("span",{class:"tournaments-tables__stage-state-label"}," Состояние этапа ",-1),sa={key:0,class:"tournaments-tables__table-scroll"},oa={key:0,class:"tournaments-tables__table-round-title"},ia=["onClick"],la={class:"tournaments-tables__table-team-details"},ra={class:"tournaments-tables__table-team-title"},ca={class:"tournaments-tables__table-team-score"},ua={class:"tournaments-tables__table-team-details"},_a={class:"tournaments-tables__table-team-title"},ma=W({__name:"TournamentsTables",props:{tournamentId:{type:[String,Number],default:"",required:!0},stages:{type:Array,default:()=>[],required:!0}},setup(_){const s=_,t=P({loading:0,standings:[],tables:[],matches:[],selectedStage:null,selectedGroup:null,tableOne:[],tableTwo:[],highlightTeamId:null,total:0,standingsTotal:0}),n=G(()=>t.tables.filter(e=>{var l;return e.group_id===((l=t.selectedGroup)==null?void 0:l.group_id)})),r=G(()=>n.value.map(e=>{const l=t.standings.find(p=>e.team_id===p.team_id&&p.group_id===e.group_id);return{...e,wins:(l==null?void 0:l.wins)??0,draws:(l==null?void 0:l.draws)??0,losses:(l==null?void 0:l.losses)??0}})),$=[{key:"position",label:"#",width:40,align:"center"},{key:"name",label:"Команда"},{key:"matches_played",label:"Бои",width:60,align:"center"},{key:"wins",label:"Победы",width:60,align:"center"},{key:"draws",label:"Ничьи",width:60,align:"center"},{key:"losses",label:"Пораж.",width:60,align:"center"},{key:"team_points",label:"Очки",width:60,align:"center"}],C=G(()=>s.stages.map(e=>({label:e.title,value:e,disabled:!["complete","schedule_ready"].includes(e.state)}))),g=G(()=>t.selectedStage?t.selectedStage.groups.map(e=>({label:`Группа ${e.group_order}`,value:e})):[]),T=G(()=>{var e;switch((e=t.selectedStage)==null?void 0:e.state){case"draft":return"Проект создан";case"groups_ready":return"Группы сформированы";case"schedule_ready":return"График построен";case"complete":return"Этап завершён";default:return"..."}});Y(async()=>{var e;t.selectedStage=c(),t.selectedGroup=((e=t.selectedStage)==null?void 0:e.groups[0])??null,await b(),A()});function I(e){var p;const l=(p=t.selectedStage)==null?void 0:p.type;if(l==="SE"){if(e===1)return"Финал";if(e===2)return"Полуфинал";if(e===3)return"Четвертьфинал";if(e===-1)return"Матч за третье место"}if(l==="DE"){if(e===3)return"Верхняя сетка | Четвертьфинал";if(e===2)return"Верхняя сетка | Полуфинал";if(e===1)return"Верхняя сетка | Финал";if(e===0)return"Гранд-Финал";if(e===-1)return"Нижняя сетка | Финал";if(e===-2)return"Нижняя сетка | Полуфинал";if(e===-3)return"Нижняя сетка | Четвертьфинал"}return""}function A(){t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.matches.forEach(e=>{const l=t.tables.find(D=>D.team_id===e.team_1_id),p=t.tables.find(D=>D.team_id===e.team_2_id);if(!l||!p)return;const v={...e,teams:[l,p]};e.round===3&&t.tableOne[0].push(v),e.round===2&&t.tableOne[1].push(v),e.round===1&&t.tableOne[2].push(v),e.round===-3&&t.tableTwo[0].push(v),e.round===-2&&t.tableTwo[1].push(v),e.round===-1&&t.tableTwo[2].push(v),e.round===0&&t.tableTwo[3].push(v)})}function i(e,l){return l.team_id===e.winner_team_id}function c(){const e=s.stages.findLast(p=>p.state==="schedule_ready"),l=s.stages.findLast(p=>p.state==="complete");return e??l??s.stages[0]}async function b(){var p,v,D;const e=(p=t.selectedStage)==null?void 0:p.stage_id,l=(v=t.selectedGroup)==null?void 0:v.group_id;!e||!l||(await d({tournament_id:s.tournamentId,group_id:l,stage_id:e}),((D=t.selectedStage)==null?void 0:D.type)==="RR"?await h({tournament_id:s.tournamentId,team_id:n.value.map(J=>J.team_id).join(",")}):await y({tournament_id:s.tournamentId,group_id:l,stage_id:e}))}async function y(e){t.loading++;try{const{data:l}=await E.tournaments.getMatches({...e,limit:25});t.matches=l}catch(l){M(l,{title:"Получение матчей"})}t.loading--}async function h(e){const l=Qe(String(e.team_id).split(","),10);for(const p of l)await x({...e,team_id:p.join(",")})}async function x(e){t.loading++;try{const{data:l,meta:p}=await E.tournaments.getStandings({...e,limit:25});t.standings.push(...l),t.standingsTotal=p.total}catch(l){M(l,{title:"Получение результатов команд"})}t.loading--}async function d(e){let l=1;const p=25,v=async()=>{await k({...e,page_no:l,limit:p}),t.total>l*p&&(l++,await v())};await v()}async function k(e){t.loading++;try{const{data:l,meta:p}=await E.tournaments.getTables(e);t.tables.push(...l),t.total=p.total}catch(l){M(l,{title:"Получение турнирной сетки"})}t.loading--}async function q(e){t.selectedStage=e,t.selectedGroup=e.groups[0],t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.standings=[],t.tables=[],t.matches=[],await b(),t.selectedStage.type!=="RR"&&A()}async function H(e){t.selectedGroup=e,t.selectedStage&&(t.selectedStage.type==="RR"?(t.standings=[],await h({tournament_id:s.tournamentId,team_id:n.value.map(l=>l.team_id).join(",")})):(t.tableOne=[[],[],[],[]],t.tableTwo=[[],[],[],[]],t.matches=[],await y({tournament_id:s.tournamentId,group_id:e.group_id,stage_id:t.selectedStage.stage_id}),A()))}function U(e){t.highlightTeamId=e.team_id}return(e,l)=>{var J,tt;const p=z,v=wt,D=Z;return u(),f("div",Ze,[a("div",ze,[a("div",ta,[w(" Этап ("+m(o(t).total??0)+") ",1),S(p,{"model-value":o(t).selectedStage,"id-key":"stage_id",style:{width:"250px"},options:o(C),disabled:!o(C).length,onChange:q},null,8,["model-value","options","disabled"])]),a("div",ea,[w(" Группа ("+m(((J=o(t).selectedStage)==null?void 0:J.groups.length)??"---")+") ",1),S(p,{"model-value":o(t).selectedGroup,"id-key":"group_id",style:{width:"170px"},disabled:!o(g).length,options:o(g),onChange:H},null,8,["model-value","disabled","options"])])]),a("div",aa,[na,w(" "+m(o(T)),1)]),((tt=o(t).selectedStage)==null?void 0:tt.type)!=="RR"?(u(),f("div",sa,[(u(!0),f(O,null,V([o(t).tableOne,o(t).tableTwo],(B,et)=>(u(),f("div",{key:et,class:Q(["tournaments-tables__table",[`tournaments-tables__table--${et?"bottom":"top"}`]])},[(u(!0),f(O,null,V(B,(it,lt)=>(u(),f("div",{key:lt,class:"tournaments-tables__table-round"},[(u(!0),f(O,null,V(it,(X,rt)=>(u(),f("div",{key:X.id,class:"tournaments-tables__table-battle"},[rt===0?(u(),f("div",oa,m(I(X.round)),1)):R("",!0),(u(!0),f(O,null,V(X.teams,(N,at)=>(u(),f("button",{key:at,class:Q(["tournaments-tables__table-team",[i(X,N)?"tournaments-tables__table-team--is-winner":"",N.team_id===o(t).highlightTeamId?"tournaments-tables__table-team--is-highlight":""]]),onClick:Aa=>U(N)},[a("span",la,[S(st,{class:"tournaments-tables__table-team-clan-emblem",alt:N.clan_label,emblem:N.clan_emblem_preset_id},null,8,["alt","emblem"]),a("span",ra,[N.clan_label?(u(),f(O,{key:0},[w(" ["+m(N.clan_label)+"] ",1)],64)):R("",!0),w(" "+m(N.title),1)])]),a("span",ca,m(X[`team_${at+1}_score`]??"-"),1)],10,ia))),128))]))),128))]))),128))],2))),128))])):(u(),F(v,{key:1,"no-wrap":"","scroll-auto-disabling":"","row-key":"account_id",height:"calc(100vh - 112px)",headers:$,data:o(r)},{name:L(({row:B})=>[a("div",ua,[S(st,{class:"tournaments-tables__table-team-clan-emblem",alt:B.clan_label,emblem:B.clan_emblem_preset_id},null,8,["alt","emblem"]),a("span",_a,[B.clan_label?(u(),f(O,{key:0},[w(" ["+m(B.clan_label)+"] ",1)],64)):R("",!0),w(" "+m(B.title),1)])])]),_:1},8,["data"])),S(D,{loading:o(t).loading>0},null,8,["loading"])])}}}),da={key:0,class:"tournaments-info-page__inner"},pa={class:"tournaments-info-page__header"},ga={class:"tournaments-info-page__details"},ha={class:"tournaments-info-page__title"},fa={class:"tournaments-info-page__props"},ba={class:"tournaments-info-page__prop"},ya={class:"tournaments-info-page__prop-title"},va={class:"tournaments-info-page__props"},$a={class:"tournaments-info-page__prop"},Ta=a("div",{class:"tournaments-info-page__prop-title"}," Команд ",-1),wa={class:"tournaments-info-page__body"},ka=["textContent"],Sa={class:"tournaments-info-page__body"},Ca={class:"tournaments-info-page__body"},Ia={class:"tournaments-info-page__body"},on=W({__name:"[id]",setup(_){const s=mt(),t=dt(),n=P({loading:0,tournament:null,stages:[],activeTab:"info"}),r=G(()=>{var c,b;const i=[{label:"Описание",name:"info"},{label:"Команды",name:"teams",disabled:((c=n.tournament)==null?void 0:c.status)==="upcoming"}];return n.stages.length&&i.push({label:"Сетка",name:"tables",disabled:!["running","finished","complete"].includes(((b=n.tournament)==null?void 0:b.status)??"")}),i}),$=G(()=>{var i;switch((i=n.tournament)==null?void 0:i.status){case"upcoming":return{title:"Начало регистрации",date:j.date.toDateTime(n.tournament.registration_start_at*1e3)};case"registration_started":return{title:"Окончание регистрации",date:j.date.toDateTime(n.tournament.registration_end_at*1e3)};case"registration_finished":return{title:"Начало мачей",date:j.date.toDateTime(n.tournament.matches_start_at*1e3)};case"running":return{title:"Завершение",date:j.date.toDateTime(n.tournament.end_at*1e3)};case"finished":case"complete":return{title:"Завершен",date:j.date.toDateTime(n.tournament.end_at*1e3)}}return{title:"---",date:"---"}});Y(async()=>{var c;const i=(c=s.query)==null?void 0:c.activeTab;I(i||r.value[0].name),await C()});async function C(){const i=s.params.id;i&&await Promise.all([g(i),T(i)])}async function g(i){n.loading++;try{const{data:c}=await E.tournaments.getInfo({tournament_id:i});n.tournament=c[i]??null}catch(c){M(c,{title:"Получение информации турнира"})}n.loading--}async function T(i){n.loading++;try{const{data:c}=await E.tournaments.getStages({tournament_id:i});n.stages=c??[]}catch(c){M(c,{title:"Получение этапов турнира"})}n.loading--}function I(i){var c;n.activeTab=i,((c=s.query)==null?void 0:c.activeTab)!==i&&t.replace({query:{...s.query,activeTab:i}})}function A({name:i}){I(i)}return(i,c)=>{const b=ct,y=Pt,h=Zt,x=Ae,d=ma,k=It,q=Z,H=At;return u(),F(H,{class:"tournaments-info-page"},{default:L(()=>{var U,e,l,p;return[o(n).tournament?(u(),f("div",da,[a("div",pa,[S(b,{src:o(n).tournament.logo.original,alt:"Tournament IMG",class:"tournaments-info-page__img"},null,8,["src"]),a("div",ga,[a("h1",ha,m((U=o(n).tournament)==null?void 0:U.title),1),a("div",fa,[a("div",ba,[a("div",ya,m(o($).title),1),w(" "+m(o($).date),1)])]),a("div",va,[a("div",$a,[Ta,w(" "+m(((e=o(n).tournament)==null?void 0:e.teams.confirmed)||0)+" / "+m(((l=o(n).tournament)==null?void 0:l.teams.total)||0)+" / "+m(((p=o(n).tournament)==null?void 0:p.teams.max)||0),1)])])])]),S(k,{modelValue:o(n).activeTab,"onUpdate:modelValue":c[0]||(c[0]=v=>o(n).activeTab=v),tabs:o(r),onTabClick:A},{info:L(()=>[a("div",wa,[o(n).stages.length?(u(),F(y,{key:0,stages:o(n).stages,class:"tournaments-info-page__stages","tournament-id":o(n).tournament.tournament_id},null,8,["stages","tournament-id"])):R("",!0),a("div",{class:"tournaments-info-page__description",textContent:m(o(n).tournament.description)},null,8,ka)])]),matches:L(()=>[a("div",Sa,[o(n).stages.length?(u(),F(h,{key:0,stages:o(n).stages,"tournament-id":o(n).tournament.tournament_id},null,8,["stages","tournament-id"])):R("",!0)])]),teams:L(()=>[a("div",Ca,[S(x,{tournament:o(n).tournament},null,8,["tournament"])])]),tables:L(()=>[a("div",Ia,[o(n).stages.length?(u(),F(d,{key:0,"tournament-id":o(n).tournament.tournament_id,stages:o(n).stages},null,8,["tournament-id","stages"])):R("",!0)])]),_:1},8,["modelValue","tabs"])])):R("",!0),S(q,{loading:o(n).loading>0},null,8,["loading"])]}),_:1})}}});export{on as default};
